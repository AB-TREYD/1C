# Процедуры

## Функция ПроверкаЦены()
Функция предназначена для проверки цены перед печатью спецификации, чтобы Строка.ЦенаЗаКМ * Строка.Количество = Сумме.

**Возвращаемое значение:** СоответсвуютСуммы <Булево>  
Истина, когда все суммы сходятся. Ложь, когда хотя бы одна сумма не сходится
```
СоответсвуютСуммы = Истина;
Для каждого Строка из Объект.Товары Цикл
    Сумма = Строка.ЦенаЗаКМ * Строка.Количество;
    РазностьСумм = Макс(Сумма,Строка.Сумма)-Мин(Сумма,Строка.Сумма);
    Если РазностьСумм > 0.01 Тогда
	    СоответсвуютСуммы = Ложь;		
    КонецЕсли;
КонецЦикла;	

Возврат СоответсвуютСуммы  
```

## Процедура ВсеВОдномЗапретПесчетаЦенПриИзмененииПосле(Элемент)
1. Устанавливает значение ТоварыЦенаЗаКМЗапретПересчета в ТЧ Товары
2. Вызывает [ТолькоПросмотрДляЦеныЗаКМ](#процедура-толькопросмотрдляценызакмзначение)
3. Когда реквизит становится истиной, вызываем ПоменятьСогласноЦенеЗаКМ(Ложь) и РассчитатьИтоговыеПоказателиЗаказа(встроенная функция)

> [!NOTE]
> ЗапретПесчетаЦен[^1] реквизит на форме

<details>

<summary>Код</summary>

```
Для Каждого Строка Из Объект.Товары Цикл
	Строка.ВсеВОдномЦенаЗаКМЗапретПересчета = ЗапретПесчетаЦен;
КонецЦикла;	

ТолькоПросмотрДляЦеныЗаКМ(ЗапретПесчетаЦен);

Если ЗапретПесчетаЦен Тогда
	ПоменятьСогласноЦенеЗаКМ(Ложь); 
	РассчитатьИтоговыеПоказателиЗаказа(ЭтаФорма);
КонецЕсли;
```
 
</details>

## Процедура ТолькоПросмотрДляЦеныЗаКМ(Значение)
**Значение** - значение из ЗапретПесчетаЦен[^1]
Отключает доступ к полям после закрепления цен в ТЧ Товары.

<details>
<summary>Код</summary>

```
Элементы.ГруппаРасходыПоСделке.ТолькоПросмотр = Значение;	
Элементы.ТоварыВидЦены.ТолькоПросмотр = Значение;
Элементы.ТоварыЦена.ТолькоПросмотр = Значение;
Элементы.ТоварыПроцентАвтоматическойСкидки.ТолькоПросмотр = Значение;
Элементы.ТоварыСуммаАвтоматическойСкидки.ТолькоПросмотр = Значение;    
Элементы.ТоварыПроцентРучнойСкидки.ТолькоПросмотр = Значение;
Элементы.ТоварыСуммаРучнойСкидки.ТолькоПросмотр = Значение;
Элементы.ТоварыСумма.ТолькоПросмотр = Значение;
Элементы.ТоварыСтавкаНДС.ТолькоПросмотр = Значение;
Элементы.ТоварыСуммаНДС.ТолькоПросмотр = Значение;
Элементы.ТоварыЦенаЗаКМ.ТолькоПросмотр = Значение;       
Элементы.ТоварыСуммаСкидкиЗаОбъем.ТолькоПросмотр = Значение; 
Элементы.ТоварыНазначитьРучнуюСкидку.Доступность = Не Значение;
Элементы.ТоварыНазначитьРучнуюСкидку1.Доступность = Не Значение;
```
 
</details>


[^1]:ЗапретПесчетаЦен реквизит на форме, отвечающий за все галки ТоварыЦенаЗаКМЗапретПересчета в таблице Товаров
