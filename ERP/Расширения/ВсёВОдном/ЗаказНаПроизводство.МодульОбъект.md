# Процедуры
## ОбработкаПроведения(Отказ, РежимПроведения)



  <details>


  <summary> Обработка проведения  ---  Процедура отвечает за отправку заказа в EV </summary> 

   ![Картинка](../../../ERP/Скрины/Всё%20в%20одном.%20Обработка%20проведения.png)

    В процедуре **ПолучениеПараметровКабеля** получить параметры кабеля из справочника номенклатуры 
    В процедуре **ПоместитьIDZakВПозициюЗаказаКлиента** при необходимости вписывает IDzak'и в **Продукцию** и записывает **Заказ клиента**
   
 

    
  </details>

  
  ## Перед Записью
  <details>
    <summary> Перед Записью  ---  Процедура отвечает за сравнение заказов в EV</summary> 
  
   ![Картинка](../../../ERP/Скрины/Всё%20в%20одном.%20Перед%20Записью.PNG)

    В процедуре **ЗаписатьДанныеВXML** происходит запись продукции в XML 
    В процедуре **ОтправитьЗапросНаЧтениеXMLвEV** происходит отправка запроса на чтение ранее записанного XML файла
  
  </details> 
  
  ## При Записи
  <details>
  <summary> При Записи  ---  Процедура отвечает за пометку удаления заказа в EV</summary> 
    
   ![Картинка](../../../ERP/Скрины/Всё%20в%20одном.%20При%20записи.PNG)

    В процедуре **ПометитьНаУдалениеЗаказыВEV** происходит запись продукции в XML 
    В процедуре **ОтправитьЗапросНаЧтениеXMLвEV** происходит отправка запроса на чтение ранее записанного XML файла
    
  </details>

   ## Процедура ОтправитьЗапросНаЧтениеXMLвEV(Параметр)
  <details>
  <summary>Код</summary> 

        
	Если нРег(НСтр(СтрокаСоединенияИнформационнойБазы(), "Ref")) = "stavtzev_erp" тогда 		
		Соединение = Новый HTTPСоединение("1s-1", 80, "Администратор","22170");
		УстановитьПривилегированныйРежим(Истина);	
		Текст = "/Stavtzev_EV/ru/hs/ZSZ?a="+Параметр;	
		Запрос = Новый HTTPЗапрос(Текст);
		Результат = Соединение.Получить(Запрос);					
		УстановитьПривилегированныйРежим(Ложь);	     
	КонецЕсли;	


  </details>





  ##  Процедура ПометитьНаУдалениеЗаказыВEV()	
  <details>
    <summary>Код</summary> 

    	Если Не ЭтотОбъект.Ссылка.ДокументОснование = Неопределено Тогда 
    		ЗаписьXML = Новый ЗаписьXML;
    		ЗаписьXML.ОткрытьФайл("\\192.168.99.2\obmen\test2.xml");
    		ЗаписьXML.ЗаписатьОбъявлениеXML();
    		ЗаписьXML.ЗаписатьНачалоЭлемента("ЗаказыНаУдаление"); 
    		Для каждого Стр из ЭтотОбъект.Продукция цикл
    			ЗаписьXML.ЗаписатьНачалоЭлемента("ЗаказНаУдаление");
    			ЗаписьXML.ЗаписатьАтрибут("НомерСчета",СокрЛП(ЭтотОбъект.Ссылка.ДокументОснование.Номер)+
    			"/"+Строка(Стр .НомерСтроки));									
    			ЗаписьXML.ЗаписатьАтрибут("IDZAK",Стр .IDZAK);   
    			ЗаписьXML.ЗаписатьКонецЭлемента();
    		КонецЦикла;     	
    		ЗаписьXML.ЗаписатьКонецЭлемента();	
    		СтрXML = ЗаписьXML.Закрыть();
    	КонецЕсли;

</details>

</details>
