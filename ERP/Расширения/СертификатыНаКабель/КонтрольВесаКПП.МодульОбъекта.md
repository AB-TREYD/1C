# Процедуры 
## ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)
Вызывается при создание на основании Паспорта КПП  
Разбиваем строку намоткафакт из заказа в производство для вычисления веса тары  
Обращаемся в упаковку кабеля по номеру барабана и заказу клиента, для получения веса брутто


> [!NOTE]
> **ДанныеЗаполнения** - "ДокументСсылка.ПаспортаКПП"

<details>
	<summary>Код</summary>
 
```
Если ТипЗнч(ДанныеЗаполнения) = Тип("ДокументСсылка.ПаспортаКПП") Тогда
	// Заполнение шапки
	ДатаДляВесаКПП = ДанныеЗаполнения.Ссылка.Дата;
	ЗаказКлиента = ДанныеЗаполнения.НомерСчета;
	МаркаКабеля = ДанныеЗаполнения.МаркаКабеля;
	ДлинаОтрезка = ДанныеЗаполнения.ДлинаОтрезка;
	ВесОтрезка = ДанныеЗаполнения.ВесОтрезка;
	Если ДлинаОтрезка <> 0 тогда 
		Вес1Метра = ВесОтрезка/ДлинаОтрезка;
	КонецЕсли;
	
	ДлинаКабеляПоПаспорту = ДанныеЗаполнения.Длина;
	
	СсылкаДляВесаКПП = ДанныеЗаполнения.Ссылка;  
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЗаказНаПроизводство2_2.Продукция.(
	|		НамоткаФакт КАК НамоткаФакт
	|	) КАК Продукция
	|ИЗ
	|	Документ.ЗаказНаПроизводство2_2 КАК ЗаказНаПроизводство2_2
	|ГДЕ
	|	ЗаказНаПроизводство2_2.ДокументОснование = &ДокументОснование";
	
	Запрос.УстановитьПараметр("ДокументОснование", ЗаказКлиента);
	
	РезультатЗапроса = Запрос.Выполнить().Выгрузить();
	
	Для каждого строка из РезультатЗапроса цикл
		
		СтрокаБарабанов = строка.Продукция[0].НамоткаФакт;
		Намотки = СтрокаБарабанов + Символы.ПС;
		
		Барабаны = СтрРазделить(СтрокаБарабанов,"Б");
		
		Для каждого строка из Барабаны цикл
			
			Если Лев(строка,2) <> "" тогда 
				Если Число(Лев(строка,2)) = 8 тогда 	
					ВесТары = ВесТары + 36.5; 
				ИначеЕсли Число(Лев(строка,2)) = 10 тогда 	
					ВесТары = ВесТары + 39; 	
				ИначеЕсли Число(Лев(строка,2)) = 12 тогда 	
					ВесТары = ВесТары + 107;
				ИначеЕсли Число(Лев(строка,2)) = 14 тогда 	
					ВесТары = ВесТары + 165;
				ИначеЕсли Число(Лев(строка,2)) = 16 тогда 	
					ВесТары = ВесТары + 237;
				ИначеЕсли Число(Лев(строка,2)) = 18 тогда 	
					ВесТары = ВесТары + 422;
				ИначеЕсли Число(Лев(строка,2)) = 20 тогда 	
					ВесТары = ВесТары + 555;
				ИначеЕсли Число(Лев(строка,2)) = 22 тогда 	
					ВесТары = ВесТары + 763; 	
				КонецЕсли;
			КонецЕсли;	
		КонецЦикла;   
		
	КонецЦикла; 
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	УпаковкаКабеля.Вес КАК Вес
	|ИЗ
	|	Документ.УпаковкаКабеля КАК УпаковкаКабеля";
	|ГДЕ
	|	УпаковкаКабеля.НомерБарабана = &НомерБарабана
	|	И УпаковкаКабеля.Зарезервирован = &Зарезервирован";
	
	Запрос.УстановитьПараметр("НомерБарабана", СсылкаДляВесаКПП.НомерБарабана);
	Запрос.УстановитьПараметр("Зарезервирован", ЗаказКлиента);
	
	РезультатЗапроса = Запрос.Выполнить().Выгрузить();
	
	ВесБрутто = РезультатЗапроса[0].Вес;
	
	Если Вес1Метра <> 0 тогда
		РасчетнаяДлинаКабеляПоВесу = ВесБрутто/Вес1Метра;
	КонецЕсли;
	
	
КонецЕсли;	
```
