# Процедуры

## Процедура ОИТС_ОбработкаПроведения(Отказ, РежимПроведения)
Создание движения по регистру накоплений "ТМЦНаСкладеОИТС".

<details>
<summary> Код </summary>
  
      Если Склад = Справочники.Склады.НайтиПоНаименованию("Отдел ИТС (администрирование)") И Подразделение = Справочники.СтруктураПредприятия.НайтиПоНаименованию("Отдел ИТС") Тогда
      	Движения.ТМЦНаСкладеОИТС.Записывать = Истина;
      	Для Каждого ТекСтрокаТовары Из Товары Цикл
      		Движение = Движения.ТМЦНаСкладеОИТС.Добавить();
      		Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
      		Движение.Период = Дата;
      		Движение.НаименованиеТовара = ТекСтрокаТовары.Номенклатура;
      		Движение.Организация = Организация;
      		Если  ОИТС_УчетТМЦ.ЗапросИзРегистра(ТекСтрокаТовары.СерийныйНомер).Количество() > 0 Тогда
      			Движение.СерийныйНомер = ТекСтрокаТовары.СерийныйНомер;
      		КонецЕсли;
      		Движение.Количество = ТекСтрокаТовары.Количество; 
      		Движение.ЕдиницыИзмерения = ТекСтрокаТовары.Номенклатура.ЕдиницаИзмерения;
      		Если ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.СписаниеТоваровПоТребованию Тогда 
      			Движение.ОтработанРанее = Истина;
      		КонецЕсли;
      	КонецЦикла;
      КонецЕсли;
</details>

## Процедура ОИТС_ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
При отмене проведения находит и удаляет записи в соответствующем документе "УчетОтработанныхРанееТМЦ" по конкретному сотруднику.

<details>
<summary> Код </summary>
    
	Если Склад = Справочники.Склады.НайтиПоНаименованию("Отдел ИТС (администрирование)") И Подразделение = Справочники.СтруктураПредприятия.НайтиПоНаименованию("Отдел ИТС") И ЗначениеЗаполнено(ОИТС_СсылкаНаДокумент) Тогда
		Если РежимЗаписи = РежимЗаписиДокумента.ОтменаПроведения Тогда
			ДокументРедактирование = ОИТС_СсылкаНаДокумент.ПолучитьОбъект();
			Для Каждого Товар Из Товары Цикл
				НайденныеСтроки = ДокументРедактирование.Товары.НайтиСтроки(Новый Структура("Номенклатура, СерийныйНомер", Товар.Номенклатура, Товар.СерийныйНомер)); 
				Если НайденныеСтроки.Количество() > 0 Тогда
					НайденныеСтроки[0].Количество = НайденныеСтроки[0].Количество - Товар.Количество;
					ОИТС_УчетТМЦ.ЗаписьВРегистрСведений(ДокументРедактирование.Ссылка, 
					Новый Структура("Номенклатура, СерийныйНомер, Количество", Товар.Номенклатура, Товар.СерийныйНомер, Товар.Количество), "Отменили", Ссылка);	
					Если НайденныеСтроки[0].Количество = 0 Тогда
						ДокументРедактирование.Товары.Удалить(НайденныеСтроки[0]);
					КонецЕсли;	
				КонецЕсли;		
			КонецЦикла;
			ДокументРедактирование.Записать();	
		КонецЕсли;
	КонецЕсли;
</details>


