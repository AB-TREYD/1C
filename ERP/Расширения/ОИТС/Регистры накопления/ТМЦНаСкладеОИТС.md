# Процедуры

## Процедура Удалить(Команда)
Перебирает строки выбранных товаров на удаление и по условию вызывает серверную процедуру.

<details>
<summary> Код </summary>
  
    СЗ = Новый СписокЗначений;
    СЗ.ЗагрузитьЗначения(Элементы.Список.ВыделенныеСтроки);
    МассивНаУдаление = СЗ.ВыгрузитьЗначения();
    Для Каждого Строка из МассивНаУдаление Цикл
      Если СтрНайти(Строка(Элементы.Список.ДанныеСтроки(Строка).Регистратор), "Объект не найден") > 0 Тогда
        УдалитьНаСервере(Элементы.Список.ДанныеСтроки(Строка));
      КонецЕсли;
    КонецЦикла;
</details>

## Процедура УдалитьНаСервере(Данные)
Используется для удаления записи из регистра, а также для поиска и удаления выбранных товаров в документе "УчетОтработанныхРанееТМЦ" по конкретному сотруднику.

<details>
<summary> Код </summary>

    ДанныеИзЗапроса = ЗапросДляУдаления(Данные);
    Если ДанныеИзЗапроса.ВидДвижения = ВидДвиженияНакопления.Расход И ЗначениеЗаполнено(ДанныеИзЗапроса.СсылкаНаДокумент) Тогда
      ДокументРедактирование = ДанныеИзЗапроса.СсылкаНаДокумент.ПолучитьОбъект();
      НайденныеСтроки = ДокументРедактирование.Товары.НайтиСтроки(Новый Структура("Номенклатура, СерийныйНомер", Данные.НаименованиеТовара, Данные.СерийныйНомер)); 
      Если НайденныеСтроки.Количество() > 0 Тогда
        НайденныеСтроки[0].Количество = НайденныеСтроки[0].Количество - Данные.Количество;
        ОИТС_УчетТМЦ.ЗаписьВРегистрСведений(ДокументРедактирование.Ссылка,
          Новый Структура("Номенклатура, СерийныйНомер, Количество", Данные.НаименованиеТовара, Данные.СерийныйНомер, Данные.Количество), "Отменили");
        Если НайденныеСтроки[0].Количество = 0 Тогда
          ДокументРедактирование.Товары.Удалить(НайденныеСтроки[0]);
        КонецЕсли;	
      КонецЕсли;		
      ДокументРедактирование.Записать();
    КонецЕсли;
    
    НаборЗаписей = РегистрыНакопления.ТМЦНаСкладеОИТС.СоздатьНаборЗаписей(); 
    НаборЗаписей.Отбор.Регистратор.Установить(Данные.Регистратор);
    НаборЗаписей.Прочитать();
    ПоискВНабореЗаписей = Новый ТаблицаЗначений;
    ПоискВНабореЗаписей = НаборЗаписей.Выгрузить();
    СтрокаНаУдаление = ПоискВНабореЗаписей.Найти(Данные.СерийныйНомер);
    НаборЗаписей.Очистить();
    НовСтрока = НаборЗаписей.Добавить();
    ЗаполнитьЗначенияСвойств(НовСтрока, СтрокаНаУдаление);
    НаборЗаписей.Загрузить(ПоискВНабореЗаписей);
    НаборЗаписей.Удалить(НаборЗаписей[0]);
    НаборЗаписей.Записать();
    Элементы.Список.Обновить();		
</details>

# Функции

## Функция ЗапросДляУдаления(Данные)
Необходима для определения вида движения и ссылки на документ, в котором будут удаляться записи.

<details>
<summary> Код </summary>
  
    Запрос = Новый Запрос;
    Запрос.Текст = 
      "ВЫБРАТЬ
      |	ТМЦНаСкладеОИТС.ВидДвижения КАК ВидДвижения,
      |	ТМЦНаСкладеОИТС.СсылкаНаДокумент КАК СсылкаНаДокумент
      |ИЗ
      |	РегистрНакопления.ТМЦНаСкладеОИТС КАК ТМЦНаСкладеОИТС
      |ГДЕ
      |	ТМЦНаСкладеОИТС.Регистратор = &Регистратор
      |	И ТМЦНаСкладеОИТС.НаименованиеТовара = &НаименованиеТовара
      |	И ТМЦНаСкладеОИТС.НомерСтроки = &НомерСтроки";
      
    Запрос.УстановитьПараметр("НаименованиеТовара", Данные.НаименованиеТовара);
    Запрос.УстановитьПараметр("Регистратор", Данные.Регистратор);
    Запрос.УстановитьПараметр("НомерСтроки", Данные.НомерСтроки);
  
    РезультатЗапроса = Запрос.Выполнить();
    
    ВыборкаДетальныеЗаписи = РезультатЗапроса.Выгрузить();
    
    Возврат ВыборкаДетальныеЗаписи[0]; 
</details>
