# Процедуры
## ПередЗаписью()
Переделал механизм подтягивания длины намотки, вначале ищем по текущей позиции ищем заказ на производство, а далее по IDZak[^1] находим эту позицию в заказе клиента
```
	НомерСтроки = СтрРазделить(Код, "/"); 
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ЗаказНаПроизводство2_2.Ссылка КАК Ссылка,
		|	ЗаказНаПроизводство2_2.ДокументОснование КАК ДокументОснование,
		|	ЗаказНаПроизводство2_2.Продукция.(
		|		IDZak КАК IDZak
		|	) КАК Продукция
		|ИЗ
		|	Документ.ЗаказНаПроизводство2_2 КАК ЗаказНаПроизводство2_2
		|ГДЕ
		|	ЗаказНаПроизводство2_2.ДокументОснование = &ДокументОснование";
	
	Запрос.УстановитьПараметр("ДокументОснование", ЗаказКлиента);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		
		IDZak = ВыборкаДетальныеЗаписи.Ссылка.Продукция[Число(НомерСтроки[1]) - 1].IDZak;
		
		Отбор = Новый Структура();
		Отбор.Вставить("IDZak", IDZak);
		
		НайденнаяСтрока = ЗаказКлиента.Товары.НайтиСтроки(Отбор);
		
		Попытка
			Если НайденнаяСтрока.Количество() = 0 Тогда
				ДлинаНамотки = ЗаказКлиента.Товары[Число(НомерСтроки[1]) - 1].КоличествоУпаковок;
			Иначе 
				ДлинаНамотки = НайденнаяСтрока[0].КоличествоУпаковок;
			КонецЕсли;
		Исключение 
			Сообщить("Длинна намотки не подтянулась, обратитесь к администратору");
		КонецПопытки;
		
	КонецЦикла;
```
## Роли
Особых ролей не требует
[^1]: [ЗаказНаПроизводство.МодульОбъект](/../ВсёВОдном/ЗаказНаПроизводство.МодульОбъект.md)
