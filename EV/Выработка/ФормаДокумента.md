## #Область События_формы

<details>
  <summary>
    Код  </summary>

  
  
  
  ## &НаСервере Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)  
  
  <details>
    <summary>
      Код  </summary>
    
    
            Если Параметры.СозданиеОткрытие Тогда
              //Документ новый
              Объект.ВыборВыработки = Параметры.ВыборВыработки;		
              Выбор = Параметры.ВыборВыработки; 
              Объект.КатегорияРаботника=Выбор;		
            Иначе
              Выбор = Объект.ВыборВыработки; 
            КонецЕсли;                        	
            Элементы.ФИО.Заголовок = Выбор;
            //Определяет какие страницы показывать
            Если Выбор = "Волочильщик" Тогда
              ЭтаФорма.Элементы.Страница1.Видимость = Истина;
            ИначеЕсли Выбор = "Скрутчик" Тогда
              ЭтаФорма.Элементы.Страница2.Видимость = Истина;       
              ПроверкаНаДрамИПроволочныйЭкранБроня();
            ИначеЕсли Выбор = "Опрессовщик" Тогда
              ЭтаФорма.Элементы.Страница3.Видимость = Истина;
            ИначеЕсли Выбор = "Волочильщик (мультивайер)" Тогда  
              ЭтаФорма.Элементы.Страница4.Видимость = Истина;
            КонецЕсли;  
            ЭтаФорма.Доступность=не Объект.ЗакрытаяДата;
            Элементы.ВыборВыработки.Видимость = Ложь;
            
            
            Элементы.Невидимое.Видимость = РольДоступна("Администратор");     
            
            ОтработатьКнопкуПроверено(Ложь);   
            ИтогВыработкиНаСервере();
            ДоступАдмина();
            ПроверитьНаличиеСсылокНаЗаказы();
</details>


  ## &НаКлиенте Процедура ПередЗакрытием(Отказ, ЗавершениеРаботы, ТекстПредупреждения, СтандартнаяОбработка)		

  
  <details>
    <summary>
      Код  </summary>
    
        	Если не ЗавершениеРаботы тогда      
        		ПроверкаКоэффициента();	
        		ПередЗакрытиемНаСервере();    
        	КонецЕсли;
  </details>

	

  
    

## &НаКлиенте Процедура ЗакрытаяДатаПриИзменении(Элемент)

  <details>
    <summary>
      Код  </summary>
    
        Если Объект.ЗакрытаяДата=Истина тогда
      		ЭтаФорма.Доступность=Ложь;	
      	Иначе	                        
      		ЭтаФорма.Доступность=Истина;		
      	КонецЕсли;
  </details>

## &НаСервере Процедура ПередЗакрытиемНаСервере()

  <details>
    <summary>
      Код  </summary>
 
         Попытка 
        		Если Объект.ПометкаУдаления= ложь тогда		
        			ЭтотОбъект.Записать(Новый Структура("РежимЗаписи", РежимЗаписиДокумента.Проведение));
        		ИначеЕсли Объект.ПометкаУдаления=истина тогда
        			Сообщить("Выработка #"+Объект.Номер + " помечена на удаление");
        		КонецЕсли                                                              
        	Исключение  
        		Сообщить("Не удалось сохранить выработку, возможно она уже открыта у кого-то другого");
        	КонецПопытки;

  </details>




## #Область Пересчет_денег_события

  
  <details>
    <summary>
      Код  </summary>


## #Область Волочилка
 

  
  <details>
    <summary>
      Код  </summary>

##    ## &НаКлиенте Процедура ВолочильщикПереходНаМаркоРазмерПриИзменении(Элемент)

  <details>
    <summary>
      Код  </summary>
          ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура ВолочильщикКоличествоВКМПриИзменении(Элемент)

  <details>
    <summary>
      Код  </summary>
            ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>
 
## &НаКлиенте Процедура ВолочильщикСменаБунтаПриИзменении(Элемент)

  <details>
    <summary>
      Код  </summary>	
 
       ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
 </details>

## &НаКлиенте Процедура ВолочильщикСменаКатушекНаПриемникеПриИзменении(Элемент)

  
  <details>
    <summary>      
      Код  </summary>
          ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>


## &НаКлиенте Процедура ВолочильщикРасценкаЗаКМПриИзменении(Элемент)

  <details>
    <summary>
      Код  </summary>
          ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура ВолочильщикРасценкаЗаСменкуКатушекНаПриемникеПриИзменении(Элемент)
 
  <details>
    <summary>
      Код  </summary>
            ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>
  
    ## &НаКлиенте Процедура ВолочильщикРасценкаЗаПереходНаМаркоразмерПриИзменении(Элемент)
	
  <details>
    <summary>
      Код  </summary>
            ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура ВолочильщикРасценкаЗаСменуБунтаПриИзменении(Элемент)
	 
  <details>
    <summary>
      Код  </summary>
          ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>
  
  ## &НаКлиенте Процедура ВолочильщикКоэффициентЗагруженностиОборудованияПриИзменении(Элемент)
	 
  <details>
    <summary>
      Код  </summary>
          ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>
  
</details>

## #Область Мультик
  
  <details>
    <summary>
      Код  </summary>

## &НаКлиенте Процедура ВолочильщикМультивайерКоличествоВКМПриИзменении(Элемент)
	 
  <details>
    <summary>
      Код  </summary>
            ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура ВолочильщикМультивайерСменаВолокПриИзменении(Элемент)
	
  <details>
    <summary>
      Код  </summary>
    ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>


## &НаКлиенте Процедура ВолочильщикМультивайерСменаКорзинПриИзменении(Элемент)
	 
  <details>
    <summary>
      Код  </summary>
        ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);	
  </details>

## &НаКлиенте Процедура ВолочильщикМультивайерСменуКатушекНаПриемникеПриИзменении(Элемент)
	
  <details>
    <summary>
      Код  </summary>
        ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура ВолочильщикМультивайерПереходНаМаркоРазмерПриИзменении(Элемент)
	 
  <details>
    <summary>
      Код  </summary>
        ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура ВолочильщикМультивайерРасценкаЗаКМПриИзменении(Элемент)
 
  <details>
    <summary>
      Код  </summary>
        ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура ВолочильщикМультивайерРасценкаЗаСменуКатушекНаПриемникеПриИзменении(Элемент)
	
   <details>
    <summary>
      Код  </summary>
         ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура ВолочильщикМультивайерСменаКатушекПриИзменении(Элемент)
	 
  <details>
    <summary>
      Код  </summary>
        ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>


## &НаКлиенте Процедура ВолочильщикМультивайерРасценкаЗаСменуВолокПриИзменении(Элемент)
	 
  <details>
    <summary>
      Код  </summary>
        ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура ВолочильщикМультивайерРасценкаЗаПереходНаМаркоразмерПриИзменении(Элемент)

  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>


## &НаКлиенте Процедура ВолочильщикМультивайерРасценкаЗаСменуКорзинПриИзменении(Элемент)
	

  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>


## &НаКлиенте Процедура ВолочильщикМультивайерКоэффициентЗагруженностиОборудованияПриИзменении(Элемент)
	

  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>



    
</details>
  


## #Область Скрутка
 

  
  <details>
    <summary>
      Код  </summary>
    
## &НаКлиенте Процедура СкрутчикКоличествоВКМПриИзменении(Элемент)
	 

  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>


## &НаКлиенте Процедура СкрутчикПереходНаМаркоРазмерПриИзменении(Элемент)
	 

  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>


## &НаКлиенте Процедура СкрутчикНастройкаПриИзменении(Элемент)
	

  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>


## &НаКлиенте Процедура СкрутчикСменаКатушекПриИзменении(Элемент) 

  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура СкрутчикСнятиеКатушекПриИзменении(Элемент) 

  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>     

## &НаКлиенте Процедура СкрутчикРасценкаНастройкиПриИзменении(Элемент) 

  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура СкрутчикРасценкаЗаПереходНаМаркоразмерПриИзменении(Элемент)
	

  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура СкрутчикРасценкаЗаСнятиеКатушекПриИзменении(Элемент)

  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте
Процедура СкрутчикРасценкаЗаСменуКатушекНаПриемникеПриИзменении(Элемент)
	

  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура СкрутчикРасценкаЗаКМПриИзменении(Элемент)
	

  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура СкрутчикКоэффициентЗагруженностиОборудованияПриИзменении(Элемент)
	
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);	
  </details>

## &НаКлиенте Процедура СкрутчикУстановкаЗаряднойКатушкиПриИзменении(Элемент)
	

  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура СкрутчикСнятиеЗаряднойКатушкиПриИзменении(Элемент)
	 

  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура СкрутчикСнятиеКатушкиБрониЭкранаПриИзменении(Элемент)
	

  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура СкрутчикУстановкаКатушкиБрониЭкранаПриИзменении(Элемент)
	 

  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура СкрутчикРасценкаЗаСнятиеЗаряднойКатушкиПриИзменении(Элемент)


  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура СкрутчикРасценкаЗаУстановкуЗаряднойКатушкиПриИзменении(Элемент)
  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура СкрутчикРасценкаЗаСнятиеКатушкиБрониЭкранаПриИзменении(Элемент)
	
  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура СкрутчикРасценкаЗаУстановкуКатушкиБрониЭкранаПриИзменении(Элемент)


  
  <details>
    <summary>
      Код  </summary>ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>








</details>

## #Область Пресс
  <details>
    <summary>
      Код  </summary>

## &НаКлиенте Процедура ОпрессовщикСменаПластикатаПриИзменении(Элемент) 

  <details>
    <summary>
      Код  </summary>
    ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура ОпрессовщикСменаЦветаПриИзменении(Элемент)   
  <details>
    <summary>
      Код  </summary>
    ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура ОпрессовщикСменаИнструментаПриИзменении(Элемент)

  
  <details>
    <summary>
      Код  </summary>
    	ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура ОпрессовщикКоличествоВКМПриИзменении(Элемент) 

  
  <details>
    <summary>
      Код  </summary>
    ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура ОпрессовщикПереходНаМаркоРазмерПриИзменении(Элемент)  

  
  <details>
    <summary>
      Код  </summary>
    ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>    

## &НаКлиенте Процедура ОпрессовщикРасценкаЗаСменуЦветаПриИзменении(Элемент) 

  
  <details>
    <summary>
      Код  </summary>
    ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура ОпрессовщикРасценкаЗаСменуИнструментаПриИзменении(Элемент)

  
  <details>
    <summary>
      Код  </summary>
    ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура ОпрессовщикРасценкаЗаКМПриИзменении(Элемент) 

  
  <details>
    <summary>
      Код  </summary>
    ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура ОпрессовщикРасценкаЗаПереходНаМаркоразмерПриИзменении(Элемент)

  
  <details>
    <summary>
      Код  </summary>
    ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>
  
## &НаКлиенте Процедура ОпрессовщикРасценкаЗаСменуПластикатаПриИзменении(Элемент)  

  
  <details>
    <summary>
      Код  </summary>
    ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура ОпрессовщикКоэфЗаДлинуПриИзменении(Элемент)

  
  <details>
    <summary>
      Код  </summary>
    ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  </details>

## &НаКлиенте Процедура ОпрессовщикКоэффициентЗагруженностиОборудованияПриИзменении(Элемент)

  
  <details>
    <summary>
      Код  </summary>
    	ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
  
</details> 

## &НаКлиенте Процедура ОпрессовщикПриИзменении(Элемент)

  
  <details>
    <summary>
      Код  </summary>
    	ИтогВыработкиНаСервере();
  </details>

## &НаКлиенте Процедура ВолочильщикМультивайерПриИзменении(Элемент)

  
  <details>
    <summary>
      Код  </summary>
    ИтогВыработкиНаСервере();
  </details>

## &НаКлиенте Процедура СкрутчикПриИзменении(Элемент) 

  
  <details>
    <summary>
      Код  </summary>
    ИтогВыработкиНаСервере();
  </details>

## &НаКлиенте Процедура ВолочильщикПриИзменении(Элемент)

  
  <details>
    <summary>
      Код  </summary>
    ИтогВыработкиНаСервере();
  </details>

</details>

</details>

</details>




  ## #Область Групповой_изменение_галки


  
  <details>
    <summary>
      Код  </summary>

    
## &НаКлиенте Процедура ВолочильщикГрупповойПриИзменении(Элемент)
  
<details>
    <summary>
      Код  </summary>	

      ИзменениеГрупповойГалки();
</details>
 
## &НаКлиенте Процедура ОпрессовщикГрупповойПриИзменении(Элемент)	
<details>
    <summary>
      Код  </summary>	

      ИзменениеГрупповойГалки();
</details>

## &НаКлиенте Процедура СкрутчикГрупповойПриИзменении(Элемент)
<details>
    <summary>
      Код  </summary>	

      ИзменениеГрупповойГалки();
</details>

## &НаКлиенте Процедура ВолочильщикМультивайерГрупповойПриИзменении(Элемент)
<details>
    <summary>
      Код  </summary>	

      ИзменениеГрупповойГалки();
</details>
</details>






## #Область Открытие_счета 
  <details>
    <summary>
      Код  </summary>
    
    

## &НаКлиенте Процедура ОпрессовщикНомерСчетаОткрытие(Элемент, СтандартнаяОбработка) 
  <details>
    <summary>
      Код  </summary>
    
    
	СтандартнаяОбработка=Ложь;
	Если Элемент.Родитель.ТекущиеДанные.Групповой тогда
		ОпрессовщикГрупповойПриИзменении(Элемент);
	Иначе	
		ОпрессовщикНомерСчетаПриИзменении(Элемент);
	КонецЕсли;
</details>  

## &НаКлиенте Процедура ВолочильщикНомерСчетаОткрытие(Элемент, СтандартнаяОбработка) 
  <details>
    <summary>
      Код  </summary>
    
    
	СтандартнаяОбработка=Ложь;  
	Если Элемент.Родитель.ТекущиеДанные.Групповой тогда
		ВолочильщикГрупповойПриИзменении(Элемент);
	Иначе	
		ВолочильщикНомерСчетаПриИзменении(Элемент);
	КонецЕсли;
</details>

## &НаКлиенте Процедура ВолочильщикМультивайерНомерСчетаОткрытие(Элемент, СтандартнаяОбработка) 
  <details>
    <summary>
      Код  </summary>
    
    
	СтандартнаяОбработка=Ложь;
	Если Элемент.Родитель.ТекущиеДанные.Групповой тогда
		ВолочильщикМультивайерГрупповойПриИзменении(Элемент);
	Иначе	
		ВолочильщикМультивайерНомерСчетаПриИзменении(Элемент);
	КонецЕсли;
</details> 

## &НаКлиенте Процедура СкрутчикНомерСчетаОткрытие(Элемент, СтандартнаяОбработка) 
  <details>
    <summary>
      Код  </summary>
    
    

	СтандартнаяОбработка=Ложь;
	Если Элемент.Родитель.ТекущиеДанные.Групповой тогда
		СкрутчикГрупповойПриИзменении(Элемент);
	Иначе	
		СкрутчикНомерСчетаПриИзменении(Элемент);
	КонецЕсли;
</details>

 


</details>

## #Область Изменение_счета
 
  <details>
    <summary>
      Код  </summary>
    
    

## &НаСервере Процедура ОпрессовщикНомерСчетаПриИзмененииНаСервере(ТекДанные) 
  <details>
    <summary>
      Код  </summary>
    
    
	ФРМ 					= ФормированиеРабочихМассивов;
	ПараметрыДляРасчета 	= Новый Структура;
	ДлительностьОпераций 	= Новый Структура;
	Операция 				= Перечисления.ВидОперации;
	ВидОперации 			= ТекДанные.ВидОперации;                                                                               
	ОборудованиеИМаркоРазмер	= ФРМ.ОпределитьОборудованиеИМаркоРазмер(ВидОперации, ТекДанные.СсылкаНаЗаказ,ТекДанные.номерОперации);		
	ПараметрыДляРасчета 		= ФРМ.ПараметрыДляРасчетаИзЗаказа(ТекДанные.СсылкаНаЗаказ, ВидОперации,ОборудованиеИМаркоРазмер.Оборудование.Наименование, ТекДанные.НомерОперации);
	
	Если ПараметрыДляРасчета	= ложь тогда
	иначе			                              
		РасценкаЗаСменуИКоэффициент = ФРМ.РасчетРасценкиЗаСмену(ОборудованиеИМаркоРазмер.Оборудование);
		ПараметрыДляРасчета.Вставить("РасценкаЗаСмену", РасценкаЗаСменуИКоэффициент.РасценкаЗаСмену);			
		ДопОперации 						= ФРМ.НайтиНаименованияОпераций(1);
		ДопОперации 						= ФРМ.НайтиДлительностьОпераций1(ОборудованиеИМаркоРазмер.Оборудование, ВидОперации, ДопОперации);
		НовСтр								= Объект.Опрессовщик[ТекДанные.НомерСтроки-1];
		ЗаполнитьЗначенияСвойств(НовСтр,ПараметрыДляРасчета);
		НовСтр.МаркоРазмер 					= ОборудованиеИМаркоРазмер.Маркоразмер;
		НовСтр.РасценкаЗаСменуЦвета 		= ?(ВидОперации = Операция.Изоляция, ФРМ.РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[0][1]),0);
		НовСтр.РасценкаЗаСменуПластиката	= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[1][1]);
		НовСтр.РасценкаЗаСменуИнструмента	= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[2][1]);
		НовСтр.Оборудование					= ОборудованиеИМаркоРазмер.Оборудование;   
		//получаем тот самый материал с минимальной скоростью;
		МатериалДляВыбораСкорости = НахождениеМинимальнойЛинейнойСкоростиПоМатериалу(НовСтр.Оборудование, ВидОперации, МассивМатериалов(ПараметрыДляРасчета)); 
		//Минайкин добавил функция для нахождение минимальной линейной скорости
		НовСтр.ЛинейнаяСкорость		  		= ФРМ.НайтиЛСкорость(НовСтр.СсылкаНаЗаказ,МатериалДляВыбораСкорости,ВидОперации,НовСтр.Оборудование,НовСтр.НомерОперации);
		НовСтр.КоэффициентСмены				= ФРМ.ПоискКоэффициентаЗаСмену(НовСтр.Оборудование);
		НовСтр.РасценкаЗаКМ 				= ФРМ.РасчетРасценокЗаКМ(ПараметрыДляРасчета.РасценкаЗаСмену,ПараметрыДляРасчета.ДлинаКон,ПараметрыДляРасчета.ВремяИзготовленияПоЗаказу);
		Если НовСтр.Групповой = ложь тогда
			НовСтр.КоэффициентЗагруженностиОборудования = ФРМ.РасчетКоэФЗагрОборуд(НовСтр.Групповой,НовСтр.ВидОперации,НовСтр.Оборудование,НовСтр.НомерОперации,неопределено,НовСтр.СсылкаНаЗаказ);
		Иначе
		КонецЕсли;
	КонецЕсли;
</details>

## &НаКлиенте Процедура ОпрессовщикНомерСчетаПриИзменении(Элемент) 
  <details>
    <summary>
      Код  </summary>
    
    
	СтандартнаяОбработка=Ложь;              
	ФРМ = ФормированиеРабочихМассивов;          
	ТД=ТекущийЭлемент.ТекущиеДанные;
	ВписатьСсылкуИзФормыВыбораЗаказа(ТД);	
	Если ЗначениеЗаполнено(ТД.СсылкаНаЗаказ) тогда
		ПараметрыФормы = Новый Структура;   
		ПараметрыФормы.Вставить("СсылкаНаЗаказ",ТД.СсылкаНаЗаказ);     
		ПараметрыФормы.Вставить("Фио",Объект.ФИО);  
		ПараметрыФормы.Вставить("ГрупповойРезерв",?(ТД.ГрупповойРезерв="",ложь,ТД.ГрупповойРезерв));
		Форма = ПолучитьФорму("Документ.Выработка.Форма.ФормаВыбораЭтапа", ПараметрыФормы);
		РезультатФормы = Форма.ОткрытьМодально(); 
		Если не РезультатФормы = неопределено тогда
			Если РезультатФормы.Свойство("ОбщееКолвоКм") тогда         
				//тут	Строка.НазваниеОборудования = "Экструзионная линия № 001 ХМ 90/25" или Строка.НазваниеОборудования = "Экструзионная линия № 009 ХМ 70/25" 
				ЗаполнитьЗначенияСвойств(ТД,РезультатФормы);
				ТД.КоличествоВКМ						= РезультатФормы.ОбщееКолвоКМ;
				ТД.КоэффициентСмены						= РезультатФормы.КоэфСмены;
				ТД.РасценкаЗаКм							= РезультатФормы.Цена/Тд.КоличествовКм;	 

			иначе  
				//остальное тут
				НомерОперации				= РезультатФормы.НомерОперации;
				ОборудованиеИМаркоРазмер	= ФРМ.ОпределитьОборудованиеИМаркоРазмер(РезультатФормы.ВидОперации, ТД.СсылкаНаЗаказ,РезультатФормы.НомерОперации);		
				ДопОперации 				= ФРМ.НайтиНаименованияОпераций(1);
				ДопОперации 				= ФРМ.НайтиДлительностьОпераций1(ОборудованиеИМаркоРазмер.Оборудование, РезультатФормы.ВидОперации, ДопОперации);	
				ДлинаКон					= ФРМ.ОпределитьДлинаКонечная(РезультатФормы.Оборудование,РезультатФормы.ВидОперации,РезультатФормы.НомерЭтапа,РезультатФормы.IDZak,РезультатФормы.НомерОперации);
				РасценкаЗаСменуИКоэф		= ФРМ.РасчетРасценкиЗаСмену(РезультатФормы.Оборудование);
				ТД.РасценкаЗаКМ				= ФРМ.РасчетРасценокЗаКМ(РасценкаЗаСменуИКоэф.РасценкаЗаСмену,ДлинаКон,РезультатФормы.ЗатратыВремениНаОперацию);
				ЗаполнитьЗначенияСвойств(ТД,РезультатФормы);
				ТД.МаркоРазмер				= ОборудованиеИМаркоРазмер.Маркоразмер;							
				ТД.РасценкаЗаСменуЦвета 	= ?(Строка(ТД.ВидОперации)="Изоляция",ФРМ.РасчетРасценокЗаТехнологическуюОперацию(РасценкаЗаСменуИКоэф.РасценкаЗаСмену,ДопОперации[0][1]),0);
				ТД.РасценкаЗаСменуПластиката 		= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(РасценкаЗаСменуИКоэф.РасценкаЗаСмену,ДопОперации[1][1]);
				ТД.РасценкаЗаСменуИнструмента 		= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(РасценкаЗаСменуИКоэф.РасценкаЗаСмену,ДопОперации[2][1]);
				ТД.КоэффициентСмены					= ФРМ.ПоискКоэффициентаЗаСмену(РезультатФормы.Оборудование);
				//Может быть много материалов на этапе, у которых разные скорости => будем крутить на минимальной из них
				//получаем тот самый материал с минимальной скоростью;
				МатериалДляВыбораСкорости = НахождениеМинимальнойЛинейнойСкоростиПоМатериалу(ТД.Оборудование, РезультатФормы.ВидОперации, МассивМатериалов(РезультатФормы)); 
				//Минайкин добавил функция для нахождение минимальной линейной скорости
				ТД.ЛинейнаяСкорость		  = ФРМ.НайтиЛСкорость(ТД.СсылкаНаЗаказ,МатериалДляВыбораСкорости,РезультатФормы.ВидОперации,ТД.Оборудование,ТД.НомерОперации);
				Если ТД.Групповой = ложь тогда
					ТД.КоэффициентЗагруженностиОборудования = ФРМ.РасчетКоэФЗагрОборуд(ТД.Групповой,ТД.ВидОперации,ТД.Оборудование,ТД.НомерОперации,неопределено,ТД.СсылкаНаЗаказ);
				КонецЕсли;
			
				ПроверкаКоэффициента();	 
			КонецЕсли;
			ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
			ЭтотОбъект.Записать();      
			
		Иначе
			Сообщить("Видимо вы закрыли форму!");
		КонецЕсли;
	КонецЕсли;    
</details>

## &НаСервере Процедура СкрутчикНомерСчетаПриИзмененииНаСервере(ТекДанные) 
  <details>
    <summary>
      Код  </summary>
    
    
	ФРМ = ФормированиеРабочихМассивов;
	ПараметрыДляРасчета = Новый Структура;
	ДлительностьОпераций = Новый Структура;
	ВидОперации = ТекДанные.ВидОперации;                                                                               
	ОборудованиеИМаркоРазмер=ФРМ.ОпределитьОборудованиеИМаркоРазмер(ВидОперации, ТекДанные.СсылкаНаЗаказ,ТекДанные.НомерОперации);		
	ПараметрыДляРасчета = ФРМ.ПараметрыДляРасчетаИзЗаказа(ТекДанные.СсылкаНаЗаказ, ВидОперации,ОборудованиеИМаркоРазмер.Оборудование.Наименование, ТекДанные.НомерОперации);
	Если ПараметрыДляРасчета= ложь тогда
	иначе		
		РасценкаЗаСменуИКоэффициент=ФРМ.РасчетРасценкиЗаСмену(ОборудованиеИМаркоРазмер.Оборудование);
		ПараметрыДляРасчета.Вставить("РасценкаЗаСмену", РасценкаЗаСменуИКоэффициент.РасценкаЗаСмену);
		ДопОперации 								= ФРМ.НайтиНаименованияОпераций(2);
		ДопОперации 								= ФРМ.НайтиДлительностьОпераций1(ОборудованиеИМаркоРазмер.Оборудование, ВидОперации, ДопОперации,ФРМ.ПолучитьСсылкуНаДок(ТекДанные.НомерСчета).ИсполнениеЖилы);         
		ТчДокумента									= Документы.ЗаказыВПроизводство.НайтиПоНомеру(ПараметрыДляРасчета.НомерДокумента).ПолучитьОбъект();
		НовСтр										= Объект.Скрутчик[ТекДанные.НомерСтроки-1];
		ЗаполнитьЗначенияСвойств(НовСтр,ПараметрыДляРасчета);
		НовСтр.РасценкаЗаКМ							= ФРМ.РасчетРасценокЗаКМ(ПараметрыДляРасчета.РасценкаЗаСмену,ПараметрыДляРасчета.ДлинаКон,ПараметрыДляРасчета.ВремяИзготовленияПоЗаказу);
		НовСтр.МаркоРазмер							= ОборудованиеИМаркоРазмер.Маркоразмер;
		НовСтр.РасценкаЗаСнятиеЗаряднойКатушки		= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[0][1]);
		НовСтр.РасценкаЗаУстановкуЗаряднойКатушки	= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[1][1]);
		НовСтр.РасценкаЗаСнятиеКатушкиБрониЭкрана	= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[2][1]);
		НовСтр.РасценкаЗаУстановкуКатушкиБрониЭкрана= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[3][1]);
		НовСтр.Оборудование							= ОборудованиеИМаркоРазмер.Оборудование;				
		НовСтр.ЛинейнаяСкорость						= ФРМ.НайтиЛСкорость(НовСтр.СсылкаНаЗаказ,НовСтр.Материал1,ВидОперации,НовСтр.Оборудование,НовСтр.НомерОперации);
		НовСтр.КоэффициентСмены						= ФРМ.ПоискКоэффициентаЗаСмену(НовСтр.Оборудование);         			
		НовСтр.РасценкаЗаКМ=ФРМ.РасчетРасценокЗаКМ(ПараметрыДляРасчета.РасценкаЗаСмену,ПараметрыДляРасчета.ДлинаКон,ПараметрыДляРасчета.ВремяИзготовленияПоЗаказу);    
		Если НовСтр.Групповой= ложь тогда
			НовСтр.КоэффициентЗагруженностиОборудования= ФРМ.РасчетКоэФЗагрОборуд(НовСтр.Групповой,НовСтр.ВидОперации,НовСтр.Оборудование,НовСтр.НомерОперации,неопределено,НовСтр.СсылкаНаЗаказ);
		КонецЕсли;
	КонецЕсли;
</details>

## &НаКлиенте Процедура СкрутчикНомерСчетаПриИзменении(Элемент) 
  <details>
    <summary>
      Код  </summary>
    
    
	ФРМ = ФормированиеРабочихМассивов;           
	ТД 	= ТекущийЭлемент.ТекущиеДанные;
	СтандартнаяОбработка=Ложь;            
	
	ВписатьСсылкуИзФормыВыбораЗаказа(ТД);	
	Если ЗначениеЗаполнено(ТД.СсылкаНаЗаказ) тогда
		ПараметрыФормы = Новый Структура("СсылкаНаЗаказ,ФИО",ТД.СсылкаНаЗаказ,Объект.ФИО);
		Форма = ПолучитьФорму("Документ.Выработка.Форма.ФормаВыбораЭтапа", ПараметрыФормы);
		РезультатФормы=Форма.ОткрытьМодально();      
		Если не РезультатФормы=неопределено тогда
			НомерОперации=РезультатФормы.НомерОперации;
			ОборудованиеИМаркоРазмер=ФРМ.ОпределитьОборудованиеИМаркоРазмер(РезультатФормы.ВидОперации, ТД.СсылкаНаЗаказ,РезультатФормы.НомерОперации);		
			ДопОперации 							= ФРМ.НайтиНаименованияОпераций(2);
			ДопОперации 							= ФРМ.НайтиДлительностьОпераций1(ОборудованиеИМаркоРазмер.Оборудование, РезультатФормы.ВидОперации, ДопОперации,ПолучитьИсполнение(ФРМ.ПолучитьСсылкуНаДок(ТД.НомерСчета)));         
			ДлинаКон								= ФРМ.ОпределитьДлинаКонечная(РезультатФормы.Оборудование,РезультатФормы.ВидОперации,РезультатФормы.НомерЭтапа,РезультатФормы.IDZak,РезультатФормы.НомерОперации);
			РасценкаЗаСменуИКоэф					= ФРМ.РасчетРасценкиЗаСмену(РезультатФормы.Оборудование);
			ЗаполнитьЗначенияСвойств(ТД,РезультатФормы);          
			ТД.МаркоРазмер							= ОборудованиеИМаркоРазмер.Маркоразмер;  
			ТД.РасценкаЗаСнятиеЗаряднойКатушки		= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(РасценкаЗаСменуИКоэф.РасценкаЗаСмену,ДопОперации[0][1]);
			ТД.РасценкаЗаУстановкуЗаряднойКатушки	= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(РасценкаЗаСменуИКоэф.РасценкаЗаСмену,ДопОперации[1][1]);
			ТД.РасценкаЗаСнятиеКатушкиБрониЭкрана	= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(РасценкаЗаСменуИКоэф.РасценкаЗаСмену,ДопОперации[2][1]);
			ТД.РасценкаЗаУстановкуКатушкиБрониЭкрана= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(РасценкаЗаСменуИКоэф.РасценкаЗаСмену,ДопОперации[3][1]);
			ТД.КоэффициентСмены						= ФРМ.ПоискКоэффициентаЗаСмену(РезультатФормы.Оборудование);
			ТД.ЛинейнаяСкорость						= ФРМ.НайтиЛСкорость(ТД.СсылкаНаЗаказ,ТД.Материал1,РезультатФормы.ВидОперации,ТД.Оборудование,ТД.НомерОперации);
			ТД.РасценкаЗаКМ=ФРМ.РасчетРасценокЗаКМ(РасценкаЗаСменуИКоэф.РасценкаЗаСмену,ДлинаКон,РезультатФормы.ЗатратыВремениНаОперацию);
			Если ТД.Групповой= ложь тогда
				ТД.КоэффициентЗагруженностиОборудования=ФРМ.РасчетКоэФЗагрОборуд(ТД.Групповой,ТД.ВидОперации,ТД.Оборудование,ТД.НомерОперации,неопределено,ТД.СсылкаНаЗаказ);
			КонецЕсли;
			Попытка		
				ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
			Исключение	
			КонецПопытки;   
			ПроверкаКоэффициента();	
			ЭтотОбъект.Записать();  
		Иначе
			Сообщить("Видимо вы закрыли форму!");
		КонецЕсли;
	Иначе
		Сообщить("Вы вписали номер счета, который отсутсвует в заказах на производство!");
	КонецЕсли;    
</details>

## &НаСервере Процедура ВолочильщикМультивайерНомерСчетаПриИзмененииНаСервере(ТекДанные)    
  <details>
    <summary>
      Код  </summary>
    
    
	ФРМ						 = ФормированиеРабочихМассивов;
	ПараметрыДляРасчета 	= Новый Структура;
	ДлительностьОпераций 	= Новый Структура;
	Материал				= Неопределено;
	ВидОперации 			= ТекДанные.ВидОперации;                                                                               
	ОборудованиеИМаркоРазмер	= ФРМ.ОпределитьОборудованиеИМаркоРазмер(ВидОперации, ТекДанные.СсылкаНаЗаказ, ТекДанные.НомерОперации);
	ПараметрыДляРасчета			= ФРМ.ПараметрыДляРасчетаИзЗаказа(ТекДанные.СсылкаНаЗаказ, ВидОперации,ОборудованиеИМаркоРазмер.Оборудование.Наименование, ТекДанные.НомерОперации);
	Если ПараметрыДляРасчета	= ложь тогда
	иначе			
		РасценкаЗаСменуИКоэффициент = ФРМ.РасчетРасценкиЗаСмену(ОборудованиеИМаркоРазмер.Оборудование);
		ПараметрыДляРасчета.Вставить("РасценкаЗаСмену", РасценкаЗаСменуИКоэффициент.РасценкаЗаСмену);
		ДопОперации 								= ФРМ.НайтиНаименованияОпераций(3);
		ДопОперации 								= ФРМ.НайтиДлительностьОпераций1(ОборудованиеИМаркоРазмер.Оборудование, ВидОперации, ДопОперации);
		ТчДокумента									= Документы.ЗаказыВПроизводство.НайтиПоНомеру(ПараметрыДляРасчета.НомерДокумента).ПолучитьОбъект();
		НовСтр										= Объект.ВолочильщикМультивайер[ТекДанные.НомерСтроки-1];
		ЗаполнитьЗначенияСвойств(НовСтр,ПараметрыДляРасчета);
		НовСтр.РасценкаЗаКМ							= ФРМ.РасчетРасценокЗаКМ(ПараметрыДляРасчета.РасценкаЗаСмену,ПараметрыДляРасчета.ДлинаКон,ПараметрыДляРасчета.ВремяИзготовленияПоЗаказу);
		НовСтр.МаркоРазмер							= ОборудованиеИМаркоРазмер.Маркоразмер;
		НовСтр.РасценкаЗаПереходНаМаркоразмер		= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[3][1]);
		НовСтр.РасценкаЗаСменуКорзин				= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[2][1]);
		НовСтр.РасценкаЗаСменуВолок					= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[1][1]);
		НовСтр.РасценкаЗаСменуКатушекНаПриемнике	= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[0][1]);
		НовСтр.Оборудование							= ОборудованиеИМаркоРазмер.Оборудование; 
		НовСтр.ЛинейнаяСкорость						= ФРМ.НайтиЛСкорость(НовСтр.СсылкаНаЗаказ,Материал,ВидОперации,НовСтр.Оборудование,НовСтр.НомерОперации);
		НовСтр.КоэффициентСмены						= ФРМ.ПоискКоэффициентаЗаСмену(НовСтр.Оборудование);
		Если НовСтр.Групповой = ложь тогда
			НовСтр.КоэффициентЗагруженностиОборудования= ФРМ.РасчетКоэФЗагрОборуд(НовСтр.Групповой,НовСтр.ВидОперации,НовСтр.Оборудование,НовСтр.НомерОперации,неопределено,НовСтр.СсылкаНаЗаказ);
		КонецЕсли;
	КонецЕсли;
</details>

## &НаКлиенте Процедура ВолочильщикМультивайерНомерСчетаПриИзменении(Элемент) 
  <details>
    <summary>
      Код  </summary>
    
    
	СтандартнаяОбработка=Ложь;  
	ФРМ = ФормированиеРабочихМассивов;
	ТД = ТекущийЭлемент.ТекущиеДанные;                     
	ВписатьСсылкуИзФормыВыбораЗаказа(ТД);	
	Если ЗначениеЗаполнено(ТД.СсылкаНаЗаказ) тогда
		
		ПараметрыФормы = Новый Структура("СсылкаНаЗаказ,ФИО",ТД.СсылкаНаЗаказ,Объект.ФИО);
		Форма = ПолучитьФорму("Документ.Выработка.Форма.ФормаВыбораЭтапа", ПараметрыФормы);
		РезультатФормы=Форма.ОткрытьМодально();      
		Если не РезультатФормы=неопределено тогда
			
			НомерОперации=РезультатФормы.НомерОперации;
			ОборудованиеИМаркоРазмер=ФРМ.ОпределитьОборудованиеИМаркоРазмер(РезультатФормы.ВидОперации, ТД.СсылкаНаЗаказ,РезультатФормы.НомерОперации);		
			ДопОперации 							= ФРМ.НайтиНаименованияОпераций(3);
			ДопОперации 							= ФРМ.НайтиДлительностьОпераций1(ОборудованиеИМаркоРазмер.Оборудование, РезультатФормы.ВидОперации, ДопОперации);
			ДлинаКон								= ФРМ.ОпределитьДлинаКонечная(РезультатФормы.Оборудование,РезультатФормы.ВидОперации,РезультатФормы.НомерЭтапа,РезультатФормы.IDZak,РезультатФормы.НомерОперации);
			РасценкаЗаСменуИКоэф					= ФРМ.РасчетРасценкиЗаСмену(РезультатФормы.Оборудование);   
			ЗаполнитьЗначенияСвойств(ТД,РезультатФормы);
			ТД.МаркоРазмер							= ОборудованиеИМаркоРазмер.Маркоразмер;
			ТД.РасценкаЗаПереходНаМаркоразмер		= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(РасценкаЗаСменуИКоэф.РасценкаЗаСмену,ДопОперации[3][1]);
			ТД.РасценкаЗаСменуКорзин				= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(РасценкаЗаСменуИКоэф.РасценкаЗаСмену,ДопОперации[2][1]);
			ТД.РасценкаЗаСменуВолок					= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(РасценкаЗаСменуИКоэф.РасценкаЗаСмену,ДопОперации[1][1]);
			ТД.РасценкаЗаСменуКатушекНаПриемнике	= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(РасценкаЗаСменуИКоэф.РасценкаЗаСмену,ДопОперации[0][1]);
			ТД.ЛинейнаяСкорость 					= ФРМ.НайтиЛСкорость(ТД.СсылкаНаЗаказ,ТД.Материал1,РезультатФормы.ВидОперации,ТД.Оборудование,ТД.НомерОперации);
			ТД.РасценкаЗаКМ=ФРМ.РасчетРасценокЗаКМ(РасценкаЗаСменуИКоэф.РасценкаЗаСмену,ДлинаКон,РезультатФормы.ЗатратыВремениНаОперацию);
			ТД.КоэффициентСмены						= ФРМ.ПоискКоэффициентаЗаСмену(РезультатФормы.Оборудование);
			ТД.КоэффициентЗагруженностиОборудования = ФРМ.РасчетКоэФЗагрОборуд(ТД.Групповой,ТД.ВидОперации,ТД.Оборудование,ТД.НомерОперации,неопределено,ТД.СсылкаНаЗаказ);
			Попытка		
				ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
			Исключение	
			КонецПопытки;
			ПроверкаКоэффициента();			
			ЭтотОбъект.Записать();    
		КонецЕсли;
	Иначе
		Сообщить("Вы вписали номер счета, который отсутсвует в заказах на производство!");
	КонецЕсли;    
	
	
</details>

## &НаСервере Процедура ВолочильщикНомерСчетаПриИзмененииНаСервере(ТекДанные)  
  <details>
    <summary>
      Код  </summary>
    
    
	ПараметрыДляРасчета 	= Новый Структура;
	ДлительностьОпераций 	= Новый Структура;  
	ФРМ = ФормированиеРабочихМассивов;
	ВидОперации = ТекДанные.ВидОперации;                                                                               
	
	ОборудованиеИМаркоРазмер	= ФРМ.ОпределитьОборудованиеИМаркоРазмер(ВидОперации, ТекДанные.СсылкаНаЗаказ,ТекДанные.НомерОперации);
	ПараметрыДляРасчета 		= ФРМ.ПараметрыДляРасчетаИзЗаказа(ТекДанные.СсылкаНаЗаказ, ВидОперации,ОборудованиеИМаркоРазмер.Оборудование.Наименование, ТекДанные.НомерОперации);
	
	Если ПараметрыДляРасчета	= ложь тогда
	иначе
		РасценкаЗаСменуИКоэффициент = ФРМ.РасчетРасценкиЗаСмену(ОборудованиеИМаркоРазмер.Оборудование);
		
		ПараметрыДляРасчета.Вставить("РасценкаЗаСмену", РасценкаЗаСменуИКоэффициент.РасценкаЗаСмену);
		ДопОперации 								= ФРМ.НайтиНаименованияОпераций(4);
		ДопОперации 								= ФРМ.НайтиДлительностьОпераций1(ОборудованиеИМаркоРазмер.Оборудование, ВидОперации, ДопОперации);
		ТчДокумента									= Документы.ЗаказыВПроизводство.НайтиПоНомеру(ПараметрыДляРасчета.НомерДокумента).ПолучитьОбъект();		
		НовСтр										= Объект.Волочильщик[ТекДанные.НомерСтроки-1];			
		ЗаполнитьЗначенияСвойств(НовСтр,ПараметрыДляРасчета);
		НовСтр.МаркоРазмер							= ОборудованиеИМаркоРазмер.Маркоразмер;
		НовСтр.РасценкаЗаПереходНаМаркоразмер		= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[2][1]);
		НовСтр.РасценкаЗаСменуБунта					= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[1][1]);
		НовСтр.РасценкаЗаСменуКатушекНаПриемнике	= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[0][1]);
		НовСтр.Оборудование							= ОборудованиеИМаркоРазмер.Оборудование;	
		НовСтр.ЛинейнаяСкорость						= ФРМ.НайтиЛСкорость(НовСтр.СсылкаНаЗаказ,НовСтр.Материал1,ВидОперации,НовСтр.Оборудование,НовСтр.НомерОперации);
		НовСтр.КоэффициентСмены						= ФРМ.ПоискКоэффициентаЗаСмену(НовСтр.Оборудование); 											
 		НовСтр.РасценкаЗаКМ=ФРМ.РасчетРасценокЗаКМ(ПараметрыДляРасчета.РасценкаЗаСмену,ПараметрыДляРасчета.ДлинаКон,ПараметрыДляРасчета.ВремяИзготовленияПоЗаказу);
		Если НовСтр.Групповой=Ложь тогда
			НовСтр.КоэффициентЗагруженностиОборудования= ФРМ.РасчетКоэФЗагрОборуд(НовСтр.Групповой,НовСтр.ВидОперации,НовСтр.Оборудование,НовСтр.НомерОперации,неопределено,НовСтр.СсылкаНаЗаказ);
		КонецЕсли;
	КонецЕсли;
</details>

## &НаКлиенте Процедура ВолочильщикНомерСчетаПриИзменении(Элемент) 
  <details>
    <summary>
      Код  </summary>
    
    
	СтандартнаяОбработка=Ложь;   
	ФРМ = ФормированиеРабочихМассивов;
	ТД 	= ТекущийЭлемент.ТекущиеДанные;
	ВписатьСсылкуИзФормыВыбораЗаказа(ТД);	
	Если ЗначениеЗаполнено(ТД.СсылкаНаЗаказ) тогда
		ПараметрыФормы = Новый Структура("СсылкаНаЗаказ,ФИО",ТД.СсылкаНаЗаказ,Объект.ФИО);
		Форма = ПолучитьФорму("Документ.Выработка.Форма.ФормаВыбораЭтапа", ПараметрыФормы);
		РезультатФормы			= Форма.ОткрытьМодально();     
		Если не РезультатФормы	= неопределено тогда
			НомерОперации				= РезультатФормы.НомерОперации;
			ОборудованиеИМаркоРазмер	= ФРМ.ОпределитьОборудованиеИМаркоРазмер(РезультатФормы.ВидОперации, ТД.СсылкаНаЗаказ,РезультатФормы.НомерОперации);		
			ДопОперации 							= ФРМ.НайтиНаименованияОпераций(4);
			ДопОперации 							= ФРМ.НайтиДлительностьОпераций1(ОборудованиеИМаркоРазмер.Оборудование, РезультатФормы.ВидОперации, ДопОперации);
			ДлинаКон								= ФРМ.ОпределитьДлинаКонечная(РезультатФормы.Оборудование,РезультатФормы.ВидОперации,РезультатФормы.НомерЭтапа,РезультатФормы.IDZak,РезультатФормы.НомерОперации);
			РасценкаЗаСменуИКоэф					= ФРМ.РасчетРасценкиЗаСмену(РезультатФормы.Оборудование);
			ЗаполнитьЗначенияСвойств(ТД,РезультатФормы);
			ТД.МаркоРазмер							= ОборудованиеИМаркоРазмер.Маркоразмер;
			ТД.РасценкаЗаПереходНаМаркоразмер		= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(РасценкаЗаСменуИКоэф.РасценкаЗаСмену,ДопОперации[2][1]);
			ТД.РасценкаЗаСменуБунта					= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(РасценкаЗаСменуИКоэф.РасценкаЗаСмену,ДопОперации[1][1]);
			ТД.РасценкаЗаСменуКатушекНаПриемнике	= ФРМ.РасчетРасценокЗаТехнологическуюОперацию(РасценкаЗаСменуИКоэф.РасценкаЗаСмену,ДопОперации[0][1]);			
			ТД.ЛинейнаяСкорость						= ФРМ.НайтиЛСкорость(ТД.СсылкаНаЗаказ,ТД.Материал1,РезультатФормы.ВидОперации,ТД.Оборудование,РезультатФормы.НомерОперации);;
			ТД.РасценкаЗаКМ = ФРМ.РасчетРасценокЗаКМ(РасценкаЗаСменуИКоэф.РасценкаЗаСмену,ДлинаКон,РезультатФормы.ЗатратыВремениНаОперацию);		
			ТД.КоэффициентСмены						= ФРМ.ПоискКоэффициентаЗаСмену(РезультатФормы.Оборудование);
			ТД.КоэффициентЗагруженностиОборудования=ФРМ.РасчетКоэФЗагрОборуд(ТД.Групповой,ТД.ВидОперации,ТД.Оборудование,ТД.НомерОперации,неопределено,ТД.СсылкаНаЗаказ);			
			Попытка		
				ПересчетДенег(Элемент.Родитель.ТекущиеДанные.ИсходныйНомерСтроки);
			Исключение	
			КонецПопытки;  
			ПроверкаКоэффициента();	
			ЭтотОбъект.Записать();   
		КонецЕсли;
	Иначе
		Сообщить("Вы вписали номер счета, который отсутсвует в заказах на производство!");
	КонецЕсли;  
</details>



</details>

## #Область Деньги  
  <details>
    <summary>
      Код  </summary>
    
    

## Процедура ПересчетДенег(НомерСтроки) 
  <details>
    <summary>
      Код  </summary>
    
    
	
	Попытка 
		Индекс = НомерСтроки-1;
		ФИО = Объект.ФИО;
		Коэф = ФормированиеРабочихМассивов.КоэфЗаРазряд(ФИО);
		//ТекДанные=ЭтаФорма.ТекущийЭлемент.ТекущиеДанные;
		
		
		Признак = СтрЗаменить(СтрЗаменить(СтрЗаменить(Объект.ВыборВыработки,"(",""),")","")," ","");
		Если 		Признак = "Волочильщик" тогда
			ЦифраДенюжек = 4;	
		ИначеЕсли   Признак = "ВолочильщикМультивайер" тогда
			ЦифраДенюжек = 1;	
		ИначеЕсли   Признак = "Опрессовщик" тогда
			ЦифраДенюжек = 2;	
		ИначеЕсли   Признак = "Скрутчик" тогда
			ЦифраДенюжек = 3;	
		КонецЕсли;
		Денюжки = ВернутьДенюжки(Индекс,Признак,ЦифраДенюжек,Коэф);    
		Если не денюжки = неопределено тогда
			Объект[Признак][Индекс].ИтоговаяСумма_Вариант2				= Денюжки.Итог;
			Объект[Признак][Индекс].ИтоговаяСуммаСРазрядом_Вариант2  	= Денюжки.ИтогСразрядом; 
			Если Признак = "Скрутчик" тогда	ПроверкаНаДрамИПроволочныйЭкранБроня() КонецЕсли;
		КонецЕсли;
	Исключение     
		Сообщить("Произошла ошибка, расчеты не были произведены. Проверьте заполненность данных");
	КонецПопытки;
	

</details>

## Функция ВернутьДенюжки(Идентификатор,ТЧ,Признак,Коэф) 
  <details>
    <summary>
      Код  </summary>
    
    
	Массив = Новый массив;             
	НашаСтр = Объект[ТЧ].НайтиПоИдентификатору(Идентификатор);
	Если не НашаСтр = Неопределено тогда
		Массив.Добавить(НашаСтр);
		Денюжки = ФормированиеРабочихМассивов.ДенюжкиВыработки(Признак,Объект[ТЧ].Выгрузить(Массив),Коэф); 
	Иначе
		Денюжки = Неопределено;
	КонецЕсли;
	Возврат Денюжки
	</details>

</details>

## #Область КНОПКИ 
  <details>
    <summary>
      Код  </summary>
    
    

## &НаКлиенте Процедура ПровереноКоманда(Команда)              
  <details>
    <summary>
      Код  </summary>
    
                                                          
	ОтработатьКнопкуПроверено();
</details>

## &НаКлиенте Процедура ОткрытьВыбранныйЗаказ(Команда)  //открывает заказ        
  <details>
    <summary>
      Код  </summary>
    
    
	ФормаПараметр = Новый Структура("Ключ",ТекущийЭлемент.ТекущиеДанные.СсылкаНаЗаказ);   
	Если ЗначениеЗаполнено(ФормаПараметр.Ключ) тогда
		Форма = ПолучитьФорму("Документ.ЗаказыВПроизводство.Форма.ФормаДокумента", ФормаПараметр).ОткрытьМодально();	
	КонецЕсли;
</details>   

## &НаКлиенте Процедура ИтогВыработки(Команда) // считает итог всех строк выработки   
  <details>
    <summary>
      Код  </summary>
    
    
	ИтогВыработкиНаСервере();
</details>

## Процедура ИтогВыработкиНаСервере()           
  <details>
    <summary>
      Код  </summary>
    
    
  СРазрядом  = Объект[СтрЗаменить(Объект.КатегорияРаботника," (мультивайер)","Мультивайер")].Итог("ИтоговаяСуммаСРазрядом_Вариант2");
	БезРазряда = Объект[СтрЗаменить(Объект.КатегорияРаботника," (мультивайер)","Мультивайер")].Итог("ИтоговаяСумма_Вариант2");
	Элементы.БезРазряда_Число.Заголовок = ?(БезРазряда=0,"-",БезРазряда);
	Элементы.СРазрядом_Число.Заголовок  = ?(СРазрядом=0,"-",СРазрядом);
</details> 


## &НаКлиенте Процедура ОбновитьРасчеты(Команда) //Пересчитывает итоговую сумма и перезаполняет данные из заказа   
  <details>
    <summary>
      Код  </summary>
    
    
	ДлительностьОпераций =Новый Структура;
	НаименованиеОперации= Новый Структура;
	ФИО = Объект.ФИО; 
	ФРМ = ФормированиеРабочихМассивов;
	КоэфЗаРазряд = ФРМ.КоэфЗаРазряд(ФИО);       
	ТекстСообщения = "Отчет об обновлении выработки" + Символы.ПС;    
	ТекстСообщения = ТекстСообщения+"---------------------------------------------------------------" + Символы.ПС;
	ТекстСообщения = ТекстСообщения+"---------------------------------------------------------------" + Символы.ПС;
	
	//тут гарантированно определяется наша имя ТЧ
	ТЧ = СтрЗаменить(СтрЗаменить(СтрЗаменить(Объект.ВыборВыработки,"(",""),")","")," ","");
	Если 		Объект[ТЧ].НайтиСтроки(Новый структура("НомерОперации",0)).Количество()> 0 тогда	
		Предупреждение(" ""НомерОперации"" пуст у одной или нескольких строк(заполняется сам при выборе этапа)! Сообщите в IT-отдел."); 
	ИначеЕсли 	Объект[ТЧ].НайтиСтроки(Новый структура("ВидОперации",ПредопределенноеЗначение("Перечисление.ВидОперации.ПустаяСсылка"))).Количество() > 0 тогда
		Предупреждение(" ""ВидОперации"" пуст у одной или нескольких строк! Перезаполните эту строку"); 
	ИначеЕсли 	Объект[ТЧ].НайтиСтроки(Новый структура("СсылкаНаЗаказ",ПредопределенноеЗначение("Документ.ЗаказыВПроизводство.ПустаяСсылка"))).Количество()> 0 тогда
		Предупреждение(" Не найдена связь с заказом у одной или нескольких строк! Сообщите в IT-отдел."); 
	Иначе 
		Для каждого СтрТЧ из Объект[ТЧ] Цикл    
			
			ТекДанные=Новый Структура("ВидОперации,НомерСчета,НомерСтроки,НомерОперации,СсылкаНаЗаказ");
			ЗаполнитьЗначенияСвойств(ТекДанные,СтрТЧ);
			Попытка //Перезаписываем заказ
				ФРМ.ПерезаписатьЗаказ(СтрТЧ.СсылкаНаЗаказ);   
				Сообщ = (Строка(СтрТЧ.СсылкаНаЗаказ) +" был перезаписан");
			Исключение
				Сообщ = Строка(СтрТЧ.СсылкаНаЗаказ) +" не был перезаписан";
			КонецПопытки;  
			ТекстСообщения = ТекстСообщения+Сообщ + Символы.ПС;
			Если СтрТЧ.Групповой = ложь тогда	
				Если СтрТЧ.ГрупповойРезерв = "" тогда	
					Если 		ТЧ = "Волочильщик" тогда
						ВолочильщикНомерСчетаПриИзмененииНаСервере(ТекДанные); ЦифраДенюжек = 4;	
					ИначеЕсли   ТЧ = "ВолочильщикМультивайер" тогда
						ВолочильщикМультивайерНомерСчетаПриИзмененииНаСервере(ТекДанные); ЦифраДенюжек = 1;	
					ИначеЕсли   ТЧ = "Опрессовщик" тогда
						ОпрессовщикНомерСчетаПриИзмененииНаСервере(ТекДанные); ЦифраДенюжек = 2;	
					ИначеЕсли   ТЧ = "Скрутчик" тогда
						СкрутчикНомерСчетаПриИзмененииНаСервере(ТекДанные); ЦифраДенюжек = 3;	
					КонецЕсли;
					Сообщ = "Обновлено: Номер счета #" + СтрТЧ.НомерСчета;
					СтрТЧ.КоэффициентЗагруженностиОборудования  = ФРМ.РасчетКоэФЗагрОборуд(СтрТЧ.Групповой,СтрТЧ.ВидОперации,СтрТЧ.Оборудование,СтрТЧ.НомерОперации,неопределено,СтрТЧ.СсылкаНаЗаказ);
					СтрТЧ.КоэффициентСмены						= ФРМ.ПоискКоэффициентаЗаСмену(СтрТЧ.Оборудование);      
				ИначеЕсли СтрТЧ.ГрупповойРезерв <> "" тогда
					//тут  пересчет 70/90пресса	
					Пресс7090 = ФормированиеРабочихМассивов.ОбновитьВыработку7090пресс(СтрТЧ.ГрупповойРезерв,Объект.ФИО,СтрТЧ.СсылкаНаЗаказ);   
					СтрТЧ.РасценкаЗаКм = Пресс7090.Цена/СтрТЧ.КоличествовКм;	 				
					ЗаполнитьЗначенияСвойств(СтрТЧ,Пресс7090);
					КоэфЗагрОб = ?(СтрТЧ.КоэффициентЗагруженностиОборудования = 0,1,СтрТЧ.КоэффициентЗагруженностиОборудования);
					ЦифраДенюжек = 2;
				КонецЕсли;
			ИначеЕсли СтрТЧ.Групповой = Истина тогда     
				Если   ТЧ = "Опрессовщик" тогда
					ОпрессовщикНомерСчетаПриИзмененииНаСервере(ТекДанные); ЦифраДенюжек = 2;	
				ИначеЕсли   ТЧ = "Скрутчик" тогда
					СкрутчикНомерСчетаПриИзмененииНаСервере(ТекДанные); ЦифраДенюжек = 3;	
				КонецЕсли;
				
				Сообщ = ("Обновлено: Номер счета #" + СтрТЧ.НомерСчета);
				ЗаполнитьЗначенияСвойств(СтрТЧ,ОбновитьРасчетыГрупповуюВыработку(СтрТЧ.ВидОперации,СтрТЧ.оборудование,СтрТЧ.Сечение,СтрТЧ.МаркоРазмер,СтрТЧ.ГрупповойРезерв));
			КонецЕсли;
			ТекстСообщения = ТекстСообщения+Сообщ + Символы.ПС;
			
			Денюжки = ВернутьДенюжки(СтрТЧ.ПолучитьИдентификатор(),ТЧ,ЦифраДенюжек,КоэфЗаРазряд);// "Волочильщик",4,Коэф);						
			СтрТЧ.ИтоговаяСумма_Вариант2			= Денюжки.Итог;
			СтрТЧ.ИтоговаяСуммаСРазрядом_Вариант2  	= Денюжки.ИтогСразрядом;  
			////////////////////////////////////////////////////////               
			ТекстСообщения = ТекстСообщения+"---------------------------------------------------------------" + Символы.ПС;
			
		КонецЦикла; 
	КонецЕсли;	          
	Если не	ТекстСообщения = "Отчет об обновлении выработки" + Символы.ПС тогда	Сообщить(ТекстСообщения) КонецЕсли;
	ИтогВыработкиНаСервере();
</details>         

## &НаКлиенте Процедура ЗаполнитьОтходы(Команда) 
  <details>
    <summary>
      Код  </summary>
    
    
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("Оборудование1",Неопределено);  
	ПараметрыФормы.Вставить("ФИОСотрудника1", Объект.ФИО);
	ОткрытьФормуМодально("Справочник.НоменклатураОборудований.Форма.ЗаписьОтходов",	ПараметрыФормы);
</details>


</details>

## Процедура ПроверкаНаДрамИПроволочныйЭкранБроня() 
  <details>
    <summary>
      Код  </summary>
    
    
	
	ЕстьДрам = ложь;
	Для каждого строка из Объект.Скрутчик цикл  
		Если Строка(Строка.Оборудование) = "Крутильная машина № 017 Драмтвистер  JPD-2500" и СтрНайти(Строка.ВидОперации,"проволоч")  тогда
			ЕстьДрам = Истина;			
		КонецЕсли;
	КонецЦикла;              
	Элементы.СкрутчикРасценкаЗаСнятиеКатушкиБрониЭкрана.Видимость 		= ЕстьДрам;
	Элементы.СкрутчикРасценкаЗаУстановкуКатушкиБрониЭкрана.Видимость 	= ЕстьДрам;
	Элементы.СкрутчикУстановкаКатушкиБрониЭкрана.Видимость 				= ЕстьДрам;
	Элементы.СкрутчикСнятиеКатушкиБрониЭкрана.Видимость 				= ЕстьДрам;
	
</details>


## &НаКлиенте Процедура ПроверкаКоэффициента()                      //если коэф загр об =0 тогда ищет коэф смены( прописан в оборудовании) 
  <details>
    <summary>
      Код  </summary>
    
    
	Для Каждого Строка из Объект[СтрЗаменить(Объект.КатегорияРаботника," (мультивайер)","Мультивайер")] цикл
		Если Строка.КоэффициентЗагруженностиОборудования=0 тогда
			Строка.КоэффициентЗагруженностиОборудования=ФормированиеРабочихМассивов.ПоискКоэффициентаЗаСмену(Строка.Оборудование);
		КонецЕсли
	КонецЦикла;		
	
</details>

## функция ОбновитьРасчетыГрупповуюВыработку(ВидОперации,Оборудование,Сечение,МаркоРазмер,ГрупповойРезерв);	 
  <details>
    <summary>
      Код  </summary>
    
    
	
	
 ## #Область расшифровка_и_внесение_в_таблицу	 
  <details>
    <summary>
      Код  </summary>
    
    

	Итератор=1;    
	ТаблЗначений=Новый ТаблицаЗначений;	  
	ТаблЗначений.Колонки.Добавить("Оборудование");
	ТаблЗначений.Колонки.Добавить("НомерЗаказа");										
	ТаблЗначений.Колонки.Добавить("ДлинаЗаказа");     
	ТаблЗначений.Колонки.Добавить("ОбщееВремяНаЭтапе");  
	ТаблЗначений.Колонки.Добавить("ВремяНеЗависящееОтДлиныЗаказа");         
	ТаблЗначений.Колонки.Добавить("КоэффициентЗагруженностиОборудования");  
	ТаблЗначений.Колонки.Добавить("КоэффициентЗагруженностиОборудованияИтоговый");
	ТаблЗначений.Колонки.Добавить("НомерОперации");          
	ТаблЗначений.Колонки.Добавить("ПустоеВремяНаЭтапе");//+01,10
	Строка=ГрупповойРезерв;
	Результат=Новый структура;
	Пока не СтрПолучитьСтроку(Строка,итератор)="" цикл    
		СтрокаИтератор=СтрПолучитьСтроку(Строка,Итератор);
		Вхождение0=Найти(СтрокаИтератор,"#");	  //номер строки    
		Вхождение1=Найти(СтрокаИтератор,"ab");    
		Вхождение2=Найти(СтрокаИтератор,"bc");
		Вхождение3=Найти(СтрокаИтератор,"cd");
		Вхождение4=Найти(СтрокаИтератор,"de");
		Вхождение5=Найти(СтрокаИтератор,"ef");
		Вхождение6=Найти(СтрокаИтератор,"fg"); 
		Вхождение7=Найти(СтрокаИтератор, "gh");    
		Вхождение8=Найти(СтрокаИтератор, "hj");
		Вхождение9=Найти(СтрокаИтератор, Символы.ПС);
		СтрокаТабл = ТаблЗначений.Добавить();
		СтрокаТабл.Оборудование=Справочники.НоменклатураОборудований.НайтиПоНаименованию(Сред(СтрокаИтератор,Вхождение1+2,Вхождение2-1-Вхождение1-1));         
		СтрокаТабл.НомерЗаказа=Сред(СтрокаИтератор,Вхождение0+1,Вхождение1-1-Вхождение0);
		СтрокаТабл.ДлинаЗаказа=Сред(СтрокаИтератор,Вхождение2+2,Вхождение3-1-Вхождение2-1);
		СтрокаТабл.ОбщееВремяНаЭтапе=Сред(СтрокаИтератор,Вхождение3+2,Вхождение4-1-Вхождение3-1);
		СтрокаТабл.ВремяНеЗависящееОтДлиныЗаказа=Сред(СтрокаИтератор,Вхождение4+2,Вхождение5-1-Вхождение4-1);
		СтрокаТабл.КоэффициентЗагруженностиОборудования=Сред(СтрокаИтератор,Вхождение5+2,Вхождение6-1-Вхождение5-1);
		СтрокаТабл.КоэффициентЗагруженностиОборудованияИтоговый=Сред(СтрокаИтератор,Вхождение6+2,Вхождение7-1-Вхождение6-1);
		СтрокаТабл.НомерОперации=Сред(СтрокаИтератор,Вхождение7+2,Вхождение8-1-Вхождение7-1);
		СтрокаТабл.ПустоеВремяНаЭтапе=Сред(СтрокаИтератор,Вхождение8+2);                        		
		Итератор=Итератор+1;				
	КонецЦикла;     	
	</details>	     
	Если ВидОперации= Перечисления.ВидОперации.СкруткаСтренги тогда
		ОбщееЧистоеВремя = 0;
		ОбщееВремяСмены  = 0;                        
		ВремяПодготовки  = 0;  
		Для каждого строка из ТаблЗначений цикл		
			СсылкаНаЗаказ = Документы.ЗаказыВПроизводство.НайтиПоНомеру(Строка.НомерЗаказа);
			Времена = ФормированиеРабочихМассивов.РасчетКоэФЗагрОборуд(Истина,ВидОперации,Оборудование,число(строка.НомерОперации),неопределено,СсылкаНаЗаказ);
			ОбщееВремяСмены=ОбщееВремяСмены+Времена.ВремяСмены;
			ОбщееЧистоеВремя=ОбщееЧистоеВремя+Времена.ЧистоеВремя; 
			Строка.КоэффициентЗагруженностиОборудования=Времена.КоэффициентЗагруженностиОборудования;
			
			Если Строка=ТаблЗначений[0] тогда
				ВремяПодготовки=Времена.ВремяПодготовки;
			КонецЕсли;     
		КонецЦикла;	 
		Для каждого Строка из ТаблЗначений цикл                                         							   	                
			Строка.КоэффициентЗагруженностиОборудованияИтоговый = ОбщееЧистоеВремя/(ОбщееВремяСмены+ОбщееЧистоеВремя+ВремяПодготовки);
		КонецЦикла			
	Иначе
		Для каждого строка из ТаблЗначений цикл		
			// нужно для скрутки тпж
			Если Строка(ВидОперации) = "Скрутка ТПЖ" тогда
				ПараметрыДляСкруткиТПЖ=новый структура;
				ПараметрыДляСкруткиТПЖ.Вставить("ОбщееПустоеВремя",0);
				ПараметрыДляСкруткиТПЖ.Вставить("ПустоеВремяВсехЗаказовКромеПервого",0);					
			КонецЕсли;
			//-	
			
			СсылкаНаЗаказ = Документы.ЗаказыВПроизводство.НайтиПоНомеру(Строка.НомерЗаказа);
			
			Если не СсылкаНаЗаказ =неопределено тогда			      			
				
				ПараметрыЗаказа=Новый структура;
				ПараметрыЗаказа.Вставить("Диаметр",				СсылкаНаЗаказ.ДиаметрПроволоки);
				ПараметрыЗаказа.Вставить("КолвоКМпоЗаказу",		СсылкаНаЗаказ.КоличествоКилометровПоЗаказу); //Кол-во км по заказу или кол-во км в производство?
				ПараметрыЗаказа.Вставить("КолвоКМвПроизводство",СсылкаНаЗаказ.КоличествоКилометровВПроизводство); 	
				ПараметрыКоэф=ФормированиеРабочихМассивов.РасчетКоэФЗагрОборуд(Истина,ВидОперации,Оборудование,число(строка.НомерОперации),неопределено,СсылкаНаЗаказ);		
				Строка.ДлинаЗаказа=ПараметрыЗаказа.КолвоКМпоЗаказу;                                                                       
				Строка.КоэффициентЗагруженностиОборудования=ПараметрыКоэф.КоэффициентЗагруженностиОборудования;                              
				Строка.ВремяНеЗависящееОтДлиныЗаказа=ПараметрыКоэф.ВремяНеЗависящееОтДлиныЗаказа; 
				Строка.ОбщееВремяНаЭтапе=ПараметрыКоэф.ОбщееВремяНаЭтапе;				     
				Строка.ПустоеВремяНаЭтапе=ПараметрыКоэф.ПустоеВремяНаЭтапе; //+01,10
				
				// находим большее значение из всех имеющихся и присваиваем его остальным как Итоговый                                      
				//Для скрутки тпж - находим ОбщееПустоеВремя, ОбщееВремяНаЭтапе=от первого заказа все времена и вычитаем лишние операции
				//+всё пустое время остальных заказов!
				КоэффициентЗагруженностиОборудованияИтоговый=0;	                               									 		   
				Для каждого Строка из ТаблЗначений цикл                                         							   	       	  
					Если Строка(ВидОперации) = "Скрутка ТПЖ" тогда //+01,10							                                  
						ПараметрыДляСкруткиТПЖ.ОбщееПустоеВремя=ПараметрыДляСкруткиТПЖ.ОбщееПустоеВремя+строка.ПустоеВремяНаЭтапе;                                                                            
						Если КоэффициентЗагруженностиОборудованияИтоговый>0 тогда
							ПараметрыДляСкруткиТПЖ.ПустоеВремяВсехЗаказовКромеПервого=
							ПараметрыДляСкруткиТПЖ.ПустоеВремяВсехЗаказовКромеПервого+строка.ПустоеВремяНаЭтапе;																														
							ПараметрыКоэф = ФормированиеРабочихМассивов.РасчетКоэФЗагрОборуд(Истина,
							ВидОперации,Оборудование,
							число(ТаблЗначений[0].НомерОперации),
							ПараметрыДляСкруткиТПЖ,СсылкаНаЗаказ);         
							КоэффициентЗагруженностиОборудования=ПараметрыКоэф.КоэффициентЗагруженностиОборудования;   
							Строка.КоэффициентЗагруженностиОборудования=окр(число(КоэффициентЗагруженностиОборудования),2);						
						КонецЕсли;  					
						КоэффициентЗагруженностиОборудованияИтоговый=Строка.КоэффициентЗагруженностиОборудования;
						КоэффициентЗагруженностиОборудования=КоэффициентЗагруженностиОборудованияИтоговый;
					иначе	
						Если число(Строка.КоэффициентЗагруженностиОборудования)>КоэффициентЗагруженностиОборудованияИтоговый тогда     		     
							КоэффициентЗагруженностиОборудованияИтоговый=окр(число(Строка.КоэффициентЗагруженностиОборудования),2);	                    
						КонецЕсли; 
					КонецЕсли;                                                                 									       
				КонецЦикла;                                                                                                                     
				Для каждого Строка из ТаблЗначений цикл                                         							   	                
					Строка.КоэффициентЗагруженностиОборудованияИтоговый=Окр(КоэффициентЗагруженностиОборудованияИтоговый,2);	   	                    				
					Если строка(ВидОперации)="Скрутка ТПЖ" тогда 
						Строка.КоэффициентЗагруженностиОборудования=КоэффициентЗагруженностиОборудованияИтоговый;	   	                    				
					КонецЕсли;
					
				КонецЦикла; 	                                                                                                                						
			КонецЕсли;	
		КонецЦикла;  
	КонецЕсли;
	
 ## #Область ШифруемОбратноВСтроку 
  <details>
    <summary>
      Код  </summary>
    
    
	итератор=0;
	Для каждого строка из ТаблЗначений цикл		
		Итератор=Итератор+1;		
		Текст=Строка(Итератор)+"#"+Строка.НомерЗаказа
		+"ab"+Строка(Строка.Оборудование)
		+"bc"+Строка(Строка.ДлинаЗаказа)
		+"cd"+Строка(Строка.ОбщееВремяНаЭтапе)
		+"de"+Строка(Строка.ВремяНеЗависящееОтДлиныЗаказа)
		+"ef"+Строка(Строка.КоэффициентЗагруженностиОборудования)
		+"fg"+Строка(Строка.КоэффициентЗагруженностиОборудованияИтоговый)
		+"gh"+Строка(Строка.НомерОперации)
		+"hj"+строка(Строка.ПустоеВремяНаЭтапе);
		
		Если Итератор=1 тогда 
			ГрупповойРезерв=Текст;   
		ИначеЕсли Итератор>1 тогда
			ГрупповойРезерв=ГрупповойРезерв+Символы.ПС+Текст;
		КонецЕсли;
		Результат.Вставить("КоэффициентЗагруженностиОборудования",Строка.КоэффициентЗагруженностиОборудованияИтоговый);
		
	КонецЦикла;          
	</details>
	Результат.Вставить("ГрупповойРезерв",ГрупповойРезерв);
	Возврат Результат;
	</details>


## &НаКлиенте Процедура ВписатьСсылкуИзФормыВыбораЗаказа(ТД) 
  <details>
    <summary>
      Код  </summary>
    
    
	
	ФормаВыбораЗаказа = ПолучитьФорму("Документ.Выработка.Форма.ФормаВыбораЗаказа", Новый Структура("Счет",ТД.НомерСчета));
	ТД.СсылкаНаЗаказ=ФормаВыбораЗаказа.ОткрытьМодально(); 
	
	
</details>

## &НаКлиенте Процедура ИзменениеГрупповойГалки() 
  <details>
    <summary>
      Код  </summary>
    
    
	ТД = ТекущийЭлемент.ТекущиеДанные;
	Если ТД.Групповой=Истина 
		тогда 	
		СтандартнаяОбработка=Ложь;  
		ПараметрыФормы = Новый Структура("Ключ,ВидОперации,МаркоРазмер,Сечение,НаименованиеОборудования,ГрупповойРезерв,ТолькоПросмотр");                 
		ПараметрыФормы.Ключ = 1;  
		ПараметрыФормы.ТолькоПросмотр = не Элементы.ОбновитьРасчеты.Доступность;  
		
		Если не ТекущийЭлемент.ТекущиеДанные.ГрупповойРезерв="" тогда
			ЗаполнитьЗначенияСвойств(ПараметрыФормы,ТД);
			ПараметрыФормы.НаименованиеОборудования = ТД.Оборудование;	
			ПараметрыФормы.Ключ = 0;		
		КонецЕсли;
		Форма = ПолучитьФорму("Документ.Выработка.Форма.ФормаИнфаГруппЗаказов", ПараметрыФормы);
		РезультатФормы=Форма.ОткрытьМодально();    
		Если не РезультатФормы=неопределено тогда     
			ЗаполнитьЗначенияСвойств(ТД,РезультатФормы);
			ТД.Оборудование=РезультатФормы.НаименованиеОборудования;
			ОбновитьРасчеты(неопределено);             
			ЭтотОбъект.Записать();
		КонецЕсли;
		
	КонецЕсли;
	
	
	//Если Групповой резерв на выходе <>"" тогда у галки только просмотр = истина
	
</details>

## Функция МассивМатериалов(РезФормы) 
  <details>
    <summary>
      Код  </summary>
    
    
	МассивМатериалов 					= Новый Массив();
	МассивМатериалов.Добавить(РезФормы.Материал1);
	МассивМатериалов.Добавить(РезФормы.Материал2);
	МассивМатериалов.Добавить(РезФормы.Материал3);
	МассивМатериалов.Добавить(РезФормы.Материал4);
	МассивМатериалов.Добавить(РезФормы.Материал5);
	Возврат МассивМатериалов;
	</details>

## Функция НахождениеМинимальнойЛинейнойСкоростиПоМатериалу(Оборудование, ВидОперации, МассивМатериалов) 
	 
  <details>
    <summary>
      Код  </summary>
    
    
	ТЗСкоростей = Новый ТаблицаЗначений;
	ТЗСкоростей.Колонки.Добавить("ЛинейнаяСкорость");
	ТЗСкоростей.Колонки.Добавить("Материал");
	
	ТзОтсутствующихСкоростей = Новый ТаблицаЗначений;
	ТзОтсутствующихСкоростей.Колонки.Добавить("Материал");
	
	Для каждого Материал из МассивМатериалов Цикл 
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ
		|	ЛинейныеСкоростиОборудований.НаименованиеОборудования КАК НаименованиеОборудования,
		|	ЛинейныеСкоростиОборудований.ВидОперации КАК ВидОперации,
		|	ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования,
		|	ЛинейныеСкоростиОборудований.Материал КАК Материал
		|ИЗ
		|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
		|ГДЕ
		|	ЛинейныеСкоростиОборудований.Материал = &Материал
		|	И ЛинейныеСкоростиОборудований.НаименованиеОборудования = &Оборудование
		|	И ЛинейныеСкоростиОборудований.ВидОперации = &ВидОперации";
		
		Запрос.УстановитьПараметр("Материал", Материал);
		Запрос.УстановитьПараметр("Оборудование", Оборудование);
		Запрос.УстановитьПараметр("ВидОперации", ВидОперации);
		
		РезультатЗапроса = Запрос.Выполнить();
		Выборка = РезультатЗапроса.Выбрать();
		Если не Материал.Наименование = "" и РезультатЗапроса.Выгрузить().Количество()=0 тогда
			НовСтр = ТзОтсутствующихСкоростей.Добавить();	
			НовСтр.Материал = Материал;	
		КонецЕсли;
		
		Пока Выборка.Следующий() Цикл
			СтрокаТЗСкоростей = ТЗСкоростей.Добавить();	
			СтрокаТЗСкоростей.ЛинейнаяСкорость = Выборка.ЛинейнаяСкоростьОборудования;
			СтрокаТЗСкоростей.Материал         = Выборка.Материал;			
		КонецЦикла;		
	КонецЦикла;
	
	Попытка
		Для j = 0 По ТЗСкоростей.Количество() - 1 Цикл                               	
			Для i = 0 По ТЗСкоростей.Количество() - 2 Цикл 			            
				Если ТЗСкоростей[i].ЛинейнаяСкорость > ТЗСкоростей[i + 1].ЛинейнаяСкорость Тогда 
					ТЗСкоростей.Сдвинуть(ТЗСкоростей[i + 1], -1);                              
				КонецЕсли; 
			КонецЦикла;                                                                    	
		КонецЦикла;
	Исключение
	КонецПопытки;
	Если ТзСкоростей.Количество() тогда	
		Возврат ТЗСкоростей[0].Материал
	Иначе                              
		Для каждого Стр из ТзОтсутствующихСкоростей цикл
			Сообщить("Линейная скорость на оборудовании "+ Оборудование + " для материала " + Стр.Материал + " не найдена. Вид Операции - "+ВидОперации);	
		КонецЦикла;
	КонецЕсли;
	
	
	</details>

## Функция ПолучитьИсполнение(Ссылка)
	 
  <details>
    <summary>
      Код  </summary>
    
    Возврат Ссылка.ИсполнениеЖилы
	</details>

## Процедура ОтработатьКнопкуПроверено(ОтработатьКнопку = истина)
 
  <details>
    <summary>
      Код  </summary>
    
    	Кнопка = Элементы.ФормаПровереноКоманда;  
	Кнопка.Пометка = Объект.Проверено;   
	Если ОтработатьКнопку тогда
		Кнопка.Пометка = не Кнопка.Пометка;
		Объект.Проверено = Кнопка.Пометка; 
		
	КонецЕсли;                
	
	ДоступностьПриПроверено(Объект.Проверено,Ложь);
	Кнопка.Заголовок = ?(Кнопка.Пометка = истина,"Проверено","Не проверено");
	Кнопка.ЦветТекста =?(Кнопка.Пометка = истина,ЦветаСтиля.ЦветАкцента,ЦветаСтиля.ЦветОсобогоТекста); 
	Модифицированность = ОтработатьКнопку;        
</details>

## Процедура ДоступностьПриПроверено(Переменная,Признак=Истина)    
	 
  <details>
    <summary>
      Код  </summary>
    
    Если Признак тогда
		Элементы.ФормаПровереноКоманда.Доступность	 		= НЕ Переменная;	
	КонецЕсли;
	Элементы.ФормаЗаполнитьОтходы.Доступность 			= НЕ Переменная;	
	Элементы.ФормаИзменитьФорму.Доступность 			= НЕ Переменная;	
	Элементы.ОбновитьРасчеты.Доступность 				= НЕ Переменная;	
	Элементы.Страницы.ТолькоПросмотр 					=    Переменная;	
	Элементы.РеквизитыИДеньги.ТолькоПросмотр 			=    Переменная;	
	
	
</details>

## Процедура ДоступАдмина()     
	 
  <details>
    <summary>
      Код  </summary>
    
    Если РольДоступна("Администратор") тогда
		
		Для каждого Элемент из Элементы Цикл   
			Попытка
				Если ТипЗНЧ(Элемент)= Тип("ПолеФормы") тогда
					Элемент.ТолькоПросмотр = Ложь;	            
				КонецЕсли;
			Исключение
				
			КонецПопытки;
		КонецЦикла;	
	КонецЕсли;
</details> 

## &НаКлиенте Процедура ПоказатьРасценки(Команда)            
	
 
  <details>
    <summary>
      Код  </summary>
    
    	Элементы.ВолочильщикПоказатьРасценки.Пометка 			= НЕ Элементы.ВолочильщикПоказатьРасценки.Пометка; 
	Элементы.ВолочильщикМультивайерПоказатьРасценки.Пометка = НЕ Элементы.ВолочильщикМультивайерПоказатьРасценки.Пометка;
	Элементы.СкрутчикПоказатьРасценки.Пометка 				= НЕ Элементы.СкрутчикПоказатьРасценки.Пометка;
	Элементы.ОпрессовщикПоказатьРасценки.Пометка 			= НЕ Элементы.ОпрессовщикПоказатьРасценки.Пометка;  
	
	Элементы.ОпрессовщикРасценкаЗаСменуПластиката.Видимость	 	= Элементы.ОпрессовщикПоказатьРасценки.Пометка;
	Элементы.ОпрессовщикРасценкаЗаКМ.Видимость 					= Элементы.ОпрессовщикПоказатьРасценки.Пометка;
	Элементы.ОпрессовщикРасценкаЗаСменуИнструмента.Видимость 	= Элементы.ОпрессовщикПоказатьРасценки.Пометка;
	Элементы.ОпрессовщикРасценкаЗаСменуЦвета.Видимость 			= Элементы.ОпрессовщикПоказатьРасценки.Пометка;
	
	Элементы.ВолочильщикМультивайерРасценкаЗаСменуКатушекНаПриемнике.Видимость 	= Элементы.ВолочильщикМультивайерПоказатьРасценки.Пометка;
	Элементы.ВолочильщикМультивайерРасценкаЗаСменуВолок.Видимость 				= Элементы.ВолочильщикМультивайерПоказатьРасценки.Пометка;
	Элементы.ВолочильщикМультивайерРасценкаЗаСменуКорзин.Видимость 				= Элементы.ВолочильщикМультивайерПоказатьРасценки.Пометка;
	Элементы.ВолочильщикМультивайерРасценкаЗаКМ.Видимость 						= Элементы.ВолочильщикМультивайерПоказатьРасценки.Пометка;
	
	Элементы.СкрутчикРасценкаЗаКМ.Видимость 							= Элементы.СкрутчикПоказатьРасценки.Пометка;
	Элементы.СкрутчикРасценкаЗаСнятиеЗаряднойКатушки.Видимость 			= Элементы.СкрутчикПоказатьРасценки.Пометка;
	Элементы.СкрутчикРасценкаЗаУстановкуЗаряднойКатушки.Видимость 		= Элементы.СкрутчикПоказатьРасценки.Пометка;
	Элементы.СкрутчикРасценкаЗаСнятиеКатушкиБрониЭкрана.Видимость 		= Элементы.СкрутчикПоказатьРасценки.Пометка;
	Элементы.СкрутчикРасценкаЗаУстановкуКатушкиБрониЭкрана.Видимость 	= Элементы.СкрутчикПоказатьРасценки.Пометка;


	Элементы.ВолочильщикРасценкаЗаСменкуКатушекНаПриемнике.Видимость 	= Элементы.ВолочильщикПоказатьРасценки.Пометка;
	Элементы.ВолочильщикРасценкаЗаПереходНаМаркоразмер.Видимость 		= Элементы.ВолочильщикПоказатьРасценки.Пометка;
	Элементы.ВолочильщикРасценкаЗаСменуБунта.Видимость 					= Элементы.ВолочильщикПоказатьРасценки.Пометка;
	Элементы.ВолочильщикРасценкаЗаКМ.Видимость 							= Элементы.ВолочильщикПоказатьРасценки.Пометка;
</details>

## &НаКлиенте Процедура ПоказатьВсеЭлементыПриИзменении(Элемент)
	 
  <details>
    <summary>
      Код  </summary>
    
    ПоказатьВсеЭлементыПриИзмененииНаСервере();
</details>

## &НаСервере Процедура ПоказатьВсеЭлементыПриИзмененииНаСервере() 
	 
  <details>
    <summary>
      Код  </summary>
    
    Если РольДоступна("Администратор") тогда
		Для каждого Элемент из Элементы Цикл   
			Попытка				
				Если ТипЗНЧ(Элемент)= Тип("ПолеФормы") тогда
					Элемент.Видимость = ПоказатьВсеЭлементы;	            
				КонецЕсли;
			Исключение
			КонецПопытки;
		КонецЦикла;	
	КонецЕсли;
</details>

## &НаСервере Процедура ПроверитьНаличиеСсылокНаЗаказы()
	 
  <details>
    <summary>
      Код  </summary>
    
    ТЧ = СтрЗаменить(СтрЗаменить(СтрЗаменить(Объект.ВыборВыработки,"(",""),")","")," ","");
	Если не РольДоступна("Администратор") и Объект.Дата<Дата("20240416") тогда 
		Для каждого СтрТЧ из Объект[ТЧ] цикл
			Если ЗначениеЗаполнено(СтрТЧ.НомерСчета) тогда	
				Если не ЗначениеЗаполнено(СтрТЧ.СсылкаНаЗаказ) тогда	
					ДоступностьПриПроверено(Истина);
					Прервать;
				КонецЕсли;
			КонецЕсли;
		КонецЦикла;  
	КонецЕсли;		

</details> 

## &НаКлиенте Процедура НажатиеНаГрупповой(Поле,Элемент)
	 
  <details>
    <summary>
      Код  </summary>
    
    Если Поле.Имя = "ОпрессовщикГрупповой" или
		Поле.Имя = "ВолочильщикМультивайерГрупповой" или
		Поле.Имя = "СкрутчикГрупповой" или
		Поле.Имя = "ВолочильщикГрупповой" тогда
		Если Элемент.ТекущиеДанные.Групповой тогда 
			ИзменениеГрупповойГалки(); 	
		КонецЕсли;
	КонецЕсли;
</details>

## &НаКлиенте Процедура ОпрессовщикВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	 
  <details>
    <summary>
      Код  </summary>
    
    НажатиеНаГрупповой(Поле,Элемент);
</details>

## &НаКлиенте Процедура ВолочильщикВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	 
  <details>
    <summary>
      Код  </summary>
    
    НажатиеНаГрупповой(Поле,Элемент);
</details>

## &НаКлиенте Процедура СкрутчикВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	 
  <details>
    <summary>
      Код  </summary>
    
    НажатиеНаГрупповой(Поле,Элемент);
</details>

## &НаКлиенте Процедура ВолочильщикМультивайерВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	 
  <details>
    <summary>
      Код  </summary>
    
    НажатиеНаГрупповой(Поле,Элемент);
</details>

