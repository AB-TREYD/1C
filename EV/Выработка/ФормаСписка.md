


## &НаКлиенте Процедура СоздатьНовуюЗапись(Команда)
 
<details>
 <summary> 
    Код  </summary>

	
	Если ВыборВыработки <> "" и не ВыборВыработки= "ВыбратьВсе" тогда
		СтруктураПараметров = Новый Структура;
		СтруктураПараметров.Вставить("ВыборВыработки",Строка(ВыборВыработки));
		СтруктураПараметров.Вставить("СозданиеОткрытие", Истина);
		ОткрытьФорму("Документ.Выработка.Форма.ФормаДокумента",СтруктураПараметров);
	Иначе
		Сообщить("Выберите категорию работника");
	КонецЕсли;
	


</details>




## &НаСервере Процедура ОтфильтроватьНаСервере(ВыборВыработки)

<details>
 <summary> 
    Код  </summary>

	// В зависимости от значения ВыборВыработки настраивает отображение динамического списка
	
	Выбор=Строка(ВыборВыработки);
	Если Выбор = "Волочильщик"  Тогда 		 
		Список.Отбор.Элементы.Очистить();
		НашЗапрос = "ВЫБРАТЬ
		|	Выработка.Ссылка КАК Ссылка,
		|	Выработка.ВерсияДанных КАК ВерсияДанных,
		|	Выработка.ПометкаУдаления КАК ПометкаУдаления,
		|	Выработка.Номер КАК Номер,
		|	Выработка.Дата КАК Дата,
		|	Выработка.Проведен КАК Проведен,
		|	Выработка.ФИО КАК ФИО,
		|	Выработка.ВыборВыработки КАК ВыборВыработки,
		|	Выработка.КатегорияРаботника КАК КатегорияРаботника
		|ИЗ
		|	Документ.Выработка КАК Выработка
		|ГДЕ
		|	Выработка.КатегорияРаботника = &КатегорияРаботника";
		Список.ТекстЗапроса = НашЗапрос;
		Список.ОсновнаяТаблица = Список.ОсновнаяТаблица;
		Список.ДинамическоеСчитываниеДанных = Истина;	
		Список.Параметры.УстановитьЗначениеПараметра("КатегорияРаботника",Выбор);
	ИначеЕсли  Выбор = "Опрессовщик"  Тогда 		 
		Список.Отбор.Элементы.Очистить();
		НашЗапрос = "ВЫБРАТЬ
		|	Выработка.Ссылка КАК Ссылка,
		|	Выработка.ВерсияДанных КАК ВерсияДанных,
		|	Выработка.ПометкаУдаления КАК ПометкаУдаления,
		|	Выработка.Номер КАК Номер,
		|	Выработка.Дата КАК Дата,
		|	Выработка.Проведен КАК Проведен,
		|	Выработка.ФИО КАК ФИО,
		|	Выработка.ВыборВыработки КАК ВыборВыработки,
		|	Выработка.КатегорияРаботника КАК КатегорияРаботника
		|ИЗ
		|	Документ.Выработка КАК Выработка
		|ГДЕ
		|	Выработка.КатегорияРаботника = &КатегорияРаботника";
		Список.ТекстЗапроса = НашЗапрос;
		Список.ОсновнаяТаблица = Список.ОсновнаяТаблица;
		Список.ДинамическоеСчитываниеДанных = Истина;	
		Список.Параметры.УстановитьЗначениеПараметра("КатегорияРаботника",Выбор);
		
	ИначеЕсли  Выбор = "Скрутчик"  Тогда 		 
		Список.Отбор.Элементы.Очистить();
		НашЗапрос = "ВЫБРАТЬ
		|	Выработка.Ссылка КАК Ссылка,
		|	Выработка.ВерсияДанных КАК ВерсияДанных,
		|	Выработка.ПометкаУдаления КАК ПометкаУдаления,
		|	Выработка.Номер КАК Номер,
		|	Выработка.Дата КАК Дата,
		|	Выработка.Проведен КАК Проведен,
		|	Выработка.ФИО КАК ФИО,
		|	Выработка.ВыборВыработки КАК ВыборВыработки,
		|	Выработка.КатегорияРаботника КАК КатегорияРаботника
		|ИЗ
		|	Документ.Выработка КАК Выработка
		|ГДЕ
		|	Выработка.КатегорияРаботника = &КатегорияРаботника";
		Список.ТекстЗапроса = НашЗапрос;
		Список.ОсновнаяТаблица = Список.ОсновнаяТаблица;
		Список.ДинамическоеСчитываниеДанных = Истина;	
		Список.Параметры.УстановитьЗначениеПараметра("КатегорияРаботника",Выбор);
	ИначеЕсли  Выбор = "Волочильщик (мультивайер)"  Тогда 		 
		Список.Отбор.Элементы.Очистить();
		НашЗапрос = "ВЫБРАТЬ
		|	Выработка.Ссылка КАК Ссылка,
		|	Выработка.ВерсияДанных КАК ВерсияДанных,
		|	Выработка.ПометкаУдаления КАК ПометкаУдаления,
		|	Выработка.Номер КАК Номер,
		|	Выработка.Дата КАК Дата,
		|	Выработка.Проведен КАК Проведен,
		|	Выработка.ФИО КАК ФИО,
		|	Выработка.ВыборВыработки КАК ВыборВыработки,
		|	Выработка.КатегорияРаботника КАК КатегорияРаботника
		|ИЗ
		|	Документ.Выработка КАК Выработка
		|ГДЕ
		|	Выработка.КатегорияРаботника = &КатегорияРаботника";
		Список.ТекстЗапроса = НашЗапрос;
		Список.ОсновнаяТаблица = Список.ОсновнаяТаблица;
		Список.ДинамическоеСчитываниеДанных = Истина;	
		Список.Параметры.УстановитьЗначениеПараметра("КатегорияРаботника",Выбор);
	ИначеЕсли  Выбор = "ВыбратьВсе"  Тогда 		 
		Список.Отбор.Элементы.Очистить();
		НашЗапрос = "ВЫБРАТЬ
		|	Выработка.Ссылка КАК Ссылка,
		|	Выработка.ВерсияДанных КАК ВерсияДанных,
		|	Выработка.ПометкаУдаления КАК ПометкаУдаления,
		|	Выработка.Номер КАК Номер,
		|	Выработка.Дата КАК Дата,
		|	Выработка.Проведен КАК Проведен,
		|	Выработка.ФИО КАК ФИО,
		|	Выработка.ВыборВыработки КАК ВыборВыработки,
		|	Выработка.КатегорияРаботника КАК КатегорияРаботника
		|ИЗ
		|	Документ.Выработка КАК Выработка";
		Список.ТекстЗапроса = НашЗапрос;
		Список.ОсновнаяТаблица = Список.ОсновнаяТаблица;
		Список.ДинамическоеСчитываниеДанных = Истина;	
	КонецЕсли;	  	 	  


</details>

 


## &НаКлиенте Процедура Отфильтровать(Команда);

<details>
 <summary> 
    Код  </summary>

	Если ВыборВыработки <> "" Тогда
		ОтобразитьЗакрытыеДаты=Ложь;		  
		ОтфильтроватьНаСервере(ВыборВыработки);     
	КонецЕсли;


</details>





## Функция  ОпределитьНомерОперации(СсылкаНаЗаказ,ВидОперации);    

<details>
 <summary> 
    Код  </summary>
	а = 	Метаданные;
	//Для Каждого метпер Из Метаданные.Перечисления.СостоянияРаботникаОрганизации.ЗначенияПеречисления Цикл 
	ВидОп = Перечисления.ВидОперации;
	Волочение	  								=0;
	ВолочениеМультивайер                        =0;
	СкруткаТПЖ                                  =0;
	СкруткаСтренги                              =0;               
	ОбщаяСкрутка               	                =0;
	ОбщаяСкрутка6кВ                             =0;
	Заполнение                                  =0;
	ОболочкаПлоский                             =0;
	ОболочкаКруглый                             =0;
	Изоляция                                    =0;
	ОбмоткаАлюмофлексом                         =0;
	Обмотка1Слой                                =0;
	Обмотка2Слоя                                =0;
	ОбмоткаБроней                               =0;
	ОбмоткаПроволочнойБронёй                    =0;
	ОбмоткаПроволочнымЭкраном                   =0;
	ЗаполнениеИОболочка                         =0;    
	ОболочкаШлангом								=0;
	ОболочкаПлоскийШлангом						=0;
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЗВП_Этапы.Ссылка КАК Ссылка,
	|	ЗВП_Этапы.НомерСтроки КАК НомерСтроки,
	|	ЗВП_Этапы.НомерЭтапа КАК НомерЭтапа,
	|	ЗВП_Этапы.НазваниеОборудования КАК НазваниеОборудования,
	|	ЗВП_Этапы.ВидОперации КАК ВидОперации,
	|	ЗВП_Этапы.ВремяВыполненияЗаказаМинут КАК ВремяВыполненияЗаказаМинут,
	|	ЗВП_Этапы.РасчетноеВремяЗапуска КАК РасчетноеВремяЗапуска,
	|	ЗВП_Этапы.РасчетноеВремяОкончанияЭтапа КАК РасчетноеВремяОкончанияЭтапа,
	|	ЗВП_Этапы.ВыбранныйБарабан КАК ВыбранныйБарабан,
	|	ЗВП_Этапы.ПлюсовойКабель КАК ПлюсовойКабель,
	|	ЗВП_Этапы.Ссылка.НомерСчета КАК НомерСчета,
	|	ЗВП_Этапы.Ссылка.IDZak КАК IDZak,
	|	ЗВП_Этапы.Ссылка.Сечение КАК Сечение,
	|	ЗВП_Этапы.Ссылка.ДиаметрПроволоки КАК ДиаметрПроволоки,
	|	ЗВП_Этапы.Ссылка.ДиаметрПроволокиДляПотребностиВМеталле КАК ДиаметрПроволокиДляПотребностиВМеталле,
	|	ЗВП_Этапы.Ссылка.МаркаЗаказаИзЕРП КАК МаркаЗаказаИзЕРП
	|ИЗ
	|	Документ.ЗаказыВПроизводство.ЭтапыИОборудование КАК ЗВП_Этапы
	|ГДЕ
	|	ЗВП_Этапы.Ссылка = &СсылкаНаЗаказ";
	Запрос.УстановитьПараметр("СсылкаНаЗаказ", СсылкаНаЗаказ);
	
	РезультатЗапроса = Запрос.Выполнить();	
	ВДЗ = РезультатЗапроса.Выбрать();	
	Пока ВДЗ.Следующий() Цикл		  			
		Если ВДЗ.ВидОперации=ВидОп.ВолочениеМультивайер тогда
			ВолочениеМультивайер=ВолочениеМультивайер+1;
		ИначеЕсли ВДЗ.ВидОперации = ВидОп.Волочение			
			тогда	       
			Волочение=Волочение+1;
		ИначеЕсли ВДЗ.ВидОперации = ВидОп.СкруткаТПЖ 		
			тогда		
			СкруткаТПЖ=СкруткаТПЖ+1;			
		ИначеЕсли ВДЗ.ВидОперации = ВидОп.СкруткаСтренги 	
			тогда         
			СкруткаСтренги=СкруткаСтренги+1; 
		ИначеЕсли ВДЗ.ВидОперации = ВидОп.ОбщаяСкрутка      
			тогда            
			ОбщаяСкрутка=ОбщаяСкрутка+1;         
		ИначеЕсли ВДЗ.ВидОперации = ВидОп.ОбщаяСкрутка6кВ     
			тогда                      
			ОбщаяСкрутка6кВ=ОбщаяСкрутка6кВ+1;
		ИначеЕсли ВДЗ.ВидОперации = ВидОп.ОбмоткаАлюмофлексом  
			тогда        
			ОбмоткаАлюмофлексом=ОбмоткаАлюмофлексом+1;
		ИначеЕсли ВДЗ.ВидОперации = ВидОп.Обмотка1Слой        
			тогда     
			Обмотка1Слой=Обмотка1Слой+1;              
		ИначеЕсли ВДЗ.ВидОперации = ВидОп.Обмотка2Слоя        
			тогда      
			Обмотка2Слоя=Обмотка2Слоя+1;
		ИначеЕсли ВДЗ.ВидОперации = ВидОп.ОбмоткаБроней        
			тогда       
			ОбмоткаБроней=ОбмоткаБроней+1;
		ИначеЕсли ВДЗ.ВидОперации = ВидОп.ОбмоткаПроволочнойБронёй 
			тогда      
			ОбмоткаПроволочнойБронёй=ОбмоткаПроволочнойБронёй+1;
		ИначеЕсли ВДЗ.ВидОперации = ВидОп.ОбмоткаПроволочнымЭкраном	
			тогда	   
			ОбмоткаПроволочнымЭкраном=ОбмоткаПроволочнымЭкраном+1;
		ИначеЕсли ВДЗ.ВидОперации = ВидОп.Изоляция                
			тогда      
			Изоляция =Изоляция+1;                 
		ИначеЕсли ВДЗ.ВидОперации = ВидОп.ОболочкаКруглый        
			тогда      
			ОболочкаКруглый=ОболочкаКруглый+1;    
		ИначеЕсли ВДЗ.ВидОперации = ВидОп.ОболочкаПлоский        
			тогда     
			ОболочкаПлоский=ОболочкаПлоский+1;        
		ИначеЕсли ВДЗ.ВидОперации = ВидОп.Заполнение             
			тогда      
			Заполнение=Заполнение+1;	  
		ИначеЕсли ВДЗ.ВидОперации = ВидОп.ЗаполнениеИОболочка	
			тогда		
			ЗаполнениеИОболочка=ЗаполнениеИОболочка+1;	
		ИначеЕсли ВДЗ.ВидОперации = ВидОп.ОболочкаШлангом             
			тогда      
			ОболочкаШлангом=ОболочкаШлангом+1;	  			
		ИначеЕсли ВДЗ.ВидОперации = ВидОп.ОболочкаПлоскийШлангом             
			тогда      
			ОболочкаПлоскийШлангом=ОболочкаПлоскийШлангом+1;	  		
		КонецЕсли;	
	КонецЦикла;
	
	Если 	Волочение	<2 и ВидОперации=ВидОп.Волочение тогда	
		Результат=1;
	ИначеЕсли ВолочениеМультивайер	<2 и ВидОперации=ВидОп.ВолочениеМультивайер тогда
		Результат=1;
	ИначеЕсли СкруткаТПЖ	<2 и			ВидОперации=ВидОп.СкруткаТПЖ тогда		
		Результат=1;
	ИначеЕсли СкруткаСтренги	<2 и              ВидОперации=ВидОп.СкруткаСтренги тогда
		Результат=1;
	ИначеЕсли ОбщаяСкрутка	<2 и			ВидОперации=ВидОп.ОбщаяСкрутка тогда
		Результат=1;
	ИначеЕсли ОбщаяСкрутка6кВ	<2 и			ВидОперации=ВидОп.ОбщаяСкрутка6кВ тогда			
		Результат=1;
	ИначеЕсли Заполнение	<2 и			ВидОперации=ВидОп.Заполнение тогда		
		Результат=1;
	ИначеЕсли ОболочкаПлоский	<2 и			ВидОперации=ВидОп.ОболочкаПлоский тогда
		Результат=1;
	ИначеЕсли ОболочкаКруглый	<2 и			ВидОперации=ВидОп.ОболочкаКруглый          тогда
		Результат=1;
	ИначеЕсли Изоляция	<2 и ВидОперации=ВидОп.Изоляция                        тогда
		Результат=1;
	ИначеЕсли ОбмоткаАлюмофлексом	<2 и			ВидОперации=ВидОп.ОбмоткаАлюмофлексом      тогда
		Результат=1;
	ИначеЕсли Обмотка1Слой	<2 и ВидОперации=ВидОп.Обмотка1Слой                    тогда
		Результат=1;
	ИначеЕсли Обмотка2Слоя	<2 и ВидОперации=ВидОп.Обмотка2Слоя                      тогда
		Результат=1;
	ИначеЕсли ОбмоткаБроней	<2 и ВидОперации=ВидОп.ОбмоткаБроней                     тогда
		Результат=1;
	ИначеЕсли ОбмоткаПроволочнойБронёй	<2 и ВидОперации=ВидОп.ОбмоткаПроволочнойБронёй        тогда
		Результат=1;
	ИначеЕсли ОбмоткаПроволочнымЭкраном	<2 и ВидОперации=ВидОп.ОбмоткаПроволочнымЭкраном         тогда
		Результат=1;
	ИначеЕсли ЗаполнениеИОболочка	<2 и	ВидОперации=ВидОп.ЗаполнениеИОболочка      тогда
		Результат=1;
	ИначеЕсли 	ОболочкаШлангом	<2 и ВидОперации=ВидОп.ОболочкаШлангом тогда
		Результат=1;
	ИначеЕсли ОболочкаПлоскийШлангом <2 и ВидОперации=ВидОп.ОболочкаПлоскийШлангом тогда
		Результат=1;
	иначе 	Результат=0;      //Результат 1 = одна операция, результат 0 = 2 и больше подобных операций
	КонецЕсли;			
	Возврат Результат;
</details>



## &НаСервере Процедура ОбновитьРасчетыНаСервере(ДатаС,ДатаПо)

<details>
 <summary> 
    Код  </summary>

	ФРМ = ФормированиеРабочихМассивов;
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	Выработка.Ссылка КАК Ссылка
	|ИЗ
	|	Документ.Выработка КАК Выработка
	|ГДЕ
	|	Выработка.Дата >= &ДатаC
	|	И Выработка.Дата <= &ДатаПо
	|	И Выработка.ЗакрытаяДата = ЛОЖЬ";	
	Запрос.УстановитьПараметр("ДатаC", ДатаС);
	Запрос.УстановитьПараметр("ДатаПо",КонецДня(ДатаПо));
	РезультатЗапроса = Запрос.Выполнить();	
	Выборка = РезультатЗапроса.Выбрать();
	ТекстСообщения = "Отчет об обновлении выработки" + Символы.ПС;    
	ТекстСообщения = ТекстСообщения+"---------------------------------------------------------------" + Символы.ПС;
	ТекстСообщения = ТекстСообщения+"---------------------------------------------------------------" + Символы.ПС;
	
	Пока Выборка.Следующий() Цикл	
		Попытка
			Если Выборка.Ссылка.ЗакрытаяДата=Ложь тогда    
				Док = Документы.Выработка.НайтиПоНомеру(Выборка.Ссылка.Номер).ПолучитьОбъект();	
				ТЧ = СтрЗаменить(СтрЗаменить(СтрЗаменить(Док.ВыборВыработки,"(",""),")","")," ","");
				
				ФИО=Док.ФИО;
				Коэф=ФРМ.КоэфЗаРазряд(ФИО);				
				
				
				Для каждого СтрТЧ из Док[ТЧ] цикл  	
					Если ЗначениеЗаполнено(СтрТЧ.СсылкаНаЗаказ) тогда
						Если СтрТЧ.ВидОперации.Пустая() или СтрТЧ.НомерСчета=неопределено тогда
							ТекстСообщения = ТекстСообщения+("Проверьте заполненность ""Вида операции"" и ""Номера счета"" в одной из строк Выработки #"+ Выборка.Ссылка.Номер)+ Символы.ПС;	
						иначе			                                    
							
							Если СтрТЧ.Групповой = ложь и СтрТЧ.ГрупповойРезерв <> "" тогда  
								

## #Область   пресс_70_90

<details>
 <summary> 
    Код  </summary>
								Если ТЧ = "Опрессовщик" тогда
									//тут будет пересчет 70/90пресса									
									ДанныеПресс7090=ФРМ.ОбновитьВыработку7090пресс(СтрТЧ.ГрупповойРезерв,Док.ФИО,СтрТЧ.СсылкаНаЗаказ);
									ЗаполнитьЗначенияСвойств(СтрТЧ,ДанныеПресс7090);
									СтрТЧ.РасценкаЗаКм=ДанныеПресс7090.Цена/СтрТЧ.КоличествовКм;	 
									Денюжки = ВернутьДенюжки(СтрТЧ.НомерСтроки,ТЧ,2,Коэф, Док);
									СтрТЧ.ИтоговаяСумма_Вариант2			= Денюжки.Итог;
									СтрТЧ.ИтоговаяСуммаСРазрядом_Вариант2  = Денюжки.ИтогСразрядом; 	
								Иначе
									ТекстСообщения = ТекстСообщения+"Выработка #" +Выборка.Ссылка.Номер+ " неправильно заполнена"+ Символы.ПС;
								КонецЕсли;
								

</details>


							Иначе
								Попытка							
									Попытка
										ФРМ.ПерезаписатьЗаказ(СтрТЧ.СсылкаНаЗаказ);    								
									Исключение
										ТекстСообщения = ТекстСообщения+("Не удалось перезаписать заказ #"+ СтрТЧ.НомерСчета+" Выработка #"+ Выборка.Ссылка.Номер)+ Символы.ПС;    	
									КонецПопытки; 
									ТекДанные = Новый Структура("ВидОперации,НомерОперации,НомерСчета,НомерСтроки,Оборудование,СсылкаНаЗаказ");
									ЗаполнитьЗначенияСвойств(ТекДанные,СтрТЧ);
									Если 		Нрег(ТЧ) = "волочильщик" тогда
										ФРМ.ВолочильщикНомерСчетаПриИзмененииНаСервере(ТекДанные, Док); ПризнакДенежек = 4;	
									ИначеЕсли   Нрег(ТЧ) = "волочильщикмультивайер" тогда
										ФРМ.ВолочильщикМультивайерНомерСчетаПриИзмененииНаСервере(ТекДанные,док); ПризнакДенежек = 1;	
									ИначеЕсли   Нрег(ТЧ) = "опрессовщик" тогда
										ФРМ.ОпрессовщикНомерСчетаПриИзмененииНаСервере(ТекДанные,док); ПризнакДенежек = 2;	
									ИначеЕсли   Нрег(ТЧ) = "скрутчик" тогда
										ФРМ.СкрутчикНомерСчетаПриИзмененииНаСервере(ТекДанные,док); ПризнакДенежек = 3;
									КонецЕсли;
									
									СтрТЧ.КоэффициентСмены=ФРМ.ПоискКоэффициентаЗаСмену(СтрТЧ.Оборудование);							
									Если СтрТЧ.Групповой= ложь тогда								
										СтрТЧ.КоэффициентЗагруженностиОборудования=ФРМ.РасчетКоэФЗагрОборуд(СтрТЧ.Групповой,СтрТЧ.ВидОперации,СтрТЧ.Оборудование,СтрТЧ.НомерОперации,неопределено,СтрТЧ.СсылкаНаЗаказ);
									КонецЕсли;
									Денюжки = ВернутьДенюжки(СтрТЧ.НомерСтроки,ТЧ,ПризнакДенежек,Коэф,Док);
									СтрТЧ.ИтоговаяСумма_Вариант2			= Денюжки.Итог;
									СтрТЧ.ИтоговаяСуммаСРазрядом_Вариант2  = Денюжки.ИтогСразрядом; 		
									ТекстСообщения = ТекстСообщения+("Запись #"+ СтрТЧ.НомерСчета+" Выработки #"+ Выборка.Ссылка.Номер +" пересчитана") + Символы.ПС;
								Исключение
									ТекстСообщения = ТекстСообщения+("Запись #"+ СтрТЧ.НомерСчета+" Выработки #"+ Выборка.Ссылка.Номер +" не пересчитана") + Символы.ПС;
								КонецПопытки;	     
								
							КонецЕсли;					
						КонецЕсли;          
					Иначе
						ТекстСообщения = ТекстСообщения+("Пересчет  Выработки #"+Выборка.Ссылка.Номер+ " не выполнен. Отсутствуют ссылки на заказы.")+Символы.ПС;				
						Прервать;
					КонецЕсли;
				КонецЦикла;	
				//КонецЦикла;							
				Док.Записать();	
				Док.Записать(РежимЗаписиДокумента.Проведение);
				//ТекстСообщения = ТекстСообщения+("Сохранение  Выработки #"+Выборка.Ссылка.Номер+ " прошло успешно")+Символы.ПС;				
				ТекстСообщения = ТекстСообщения+"---------------------------------------------------------------"+Символы.ПС;					
			Иначе
				ТекстСообщения = ТекстСообщения+("Выработка #"+ Выборка.Ссылка.Номер + " недоступна для редактирования, т.к. находится в закрытом периоде. ")+Символы.ПС;								
				ТекстСообщения = ТекстСообщения+"---------------------------------------------------------------"+Символы.ПС;	
			КонецЕсли;
		Исключение
			ТекстСообщения = ТекстСообщения+("Не удается провести документ "+ "Выработка #"+ Выборка.Ссылка.Номер + " (Возможно помечен на удаление, попробуйте вручную)")+Символы.ПС;
			ТекстСообщения = ТекстСообщения+"---------------------------------------------------------------"+Символы.ПС;	
		КонецПопытки;
	КонецЦикла;
	Если Выборка.Количество()=0 тогда 
		ТекстСообщения = ("Не найдено ни одной выработки для редактирования, возможно, введенная дата попадает под закрытый период."); 			
	КонецЕсли;
	Сообщить(ТекстСообщения);


</details>




## &НаКлиенте Процедура ОбновитьРасчеты(Команда)

<details>
 <summary> 
    Код  </summary>

	
	ОбновитьРасчетыНаСервере(ДатаС,ДатаПо);     
	ОбновитьИнтерфейс();


</details>







## &НаКлиенте   Процедура ПриОткрытии(Отказ)       

<details>
 <summary> 
    Код  </summary>

	ДатаДляЗакрытия = НачалоМесяца(ДобавитьМесяц(ТекущаяДата(),-2));
	ДатаС=НачалоМесяца(ДобавитьМесяц(ТекущаяДата(),-1));
	ДатаПо=КонецМесяца(ДобавитьМесяц(ТекущаяДата(),-1));
	Список.Параметры.УстановитьЗначениеПараметра("ОтобразитьЗакрытыеДаты", ЭтаФорма.ОтобразитьЗакрытыеДаты);


</details>





## &НаСервере Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

<details>
 <summary> 
    Код  </summary>

	//Роли
	Если РольДоступна("РаботникЦКПП") тогда
		Элементы.Группа2.Видимость=Ложь;
		Элементы.Группа3.Видимость=Ложь;
		
	КонецЕсли;  
	


</details>






## Функция  ВернутьДенюжки(НомерСтроки,ТЧ,Признак,Коэф,Док)

<details>
 <summary> 
    Код  </summary>
	Массив = Новый массив;                                           
	Массив.Добавить(Док[ТЧ][НомерСтроки-1]);
	Денюжки = ФормированиеРабочихМассивов.ДенюжкиВыработки(Признак,Док[ТЧ].Выгрузить(Массив),Коэф); 
	Возврат Денюжки
</details>

//Открытие/Закрытие дат


## #Область  
<details>
 <summary> 
    Код  </summary>
 ЗакрытиеДат  



## &НаКлиенте   
<details>
 <summary> 
    Код  </summary>

Процедура ЗакрытиеМесяца(Команда)     
	ЗакрытиеМесяцаНаСервере(ДатаДляЗакрытия);     	
	ОбновитьИнтерфейс();


</details>

                


## &НаСервере Процедура ЗакрытиеМесяцаНаСервере(ДатаДляЗакрытия)     

<details>
 <summary> 
    Код  </summary>

	МесяцДляЗакрытия=ДатаДляЗакрытия;
	НачальныйДеньМесяца=НачалоМесяца(МесяцДляЗакрытия);
	КонечныйДеньМесяца=КонецМесяца(МесяцДляЗакрытия);
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	Выработка.Ссылка КАК Ссылка
	|ИЗ
	|	Документ.Выработка КАК Выработка
	|ГДЕ
	|	Выработка.Дата >= &ДатаC
	|	И Выработка.Дата <= &ДатаПо
	|	И Выработка.ЗакрытаяДата = ЛОЖЬ";
	
	Запрос.УстановитьПараметр("ДатаC", НачалоДня(НачальныйДеньМесяца));
	Запрос.УстановитьПараметр("ДатаПо",КонецДня(КонечныйДеньМесяца));
	РезультатЗапроса = Запрос.Выполнить();	
	ВДЗ = РезультатЗапроса.Выбрать();	
	
	Пока ВДЗ.Следующий() Цикл	  
		Док = ВДЗ.Ссылка.ПолучитьОбъект();		
		Док.ЗакрытаяДата=Истина;  
		Док.Записать();
	КонецЦикла;   
	
	//ПРОСТОИ
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ПростойСотрудников.Ссылка КАК Ссылка
	|ИЗ
	|	Документ.ПростойСотрудников КАК ПростойСотрудников
	|ГДЕ
	|	ПростойСотрудников.ЗакрытаяДата = ЛОЖЬ
	|	И ПростойСотрудников.Дата >= &ДатаC
	|	И ПростойСотрудников.Дата <= &ДатаПо";
	
	Запрос.УстановитьПараметр("ДатаC", НачалоДня(НачальныйДеньМесяца));
	Запрос.УстановитьПараметр("ДатаПо",КонецДня(КонечныйДеньМесяца));
	РезультатЗапроса = Запрос.Выполнить();	
	ВДЗ = РезультатЗапроса.Выбрать();	
	
	Пока ВДЗ.Следующий() Цикл	  
		Док = ВДЗ.Ссылка.ПолучитьОбъект();		
		Док.ЗакрытаяДата=Истина;  
		Док.Записать();
	КонецЦикла;   
	
	


</details>




## &НаСервере Процедура ОткрытиеМесяцаНаСервере(ДатаДляЗакрытия)    

<details>
 <summary> 
    Код  </summary>

	
	МесяцДляОткрытия=ДатаДляЗакрытия;
	НачальныйДеньМесяца=НачалоМесяца(МесяцДляОткрытия);
	КонечныйДеньМесяца=КонецМесяца(МесяцДляОткрытия);
	
	Запрос = Новый Запрос;                    	
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	Выработка.Ссылка КАК Ссылка
	|ИЗ
	|	Документ.Выработка КАК Выработка
	|ГДЕ
	|	Выработка.Дата >= &ДатаC
	|	И Выработка.Дата <= &ДатаПо
	|	И Выработка.ЗакрытаяДата = ИСТИНА";
	Запрос.УстановитьПараметр("ДатаC", НачалоДня(НачальныйДеньМесяца));
	Запрос.УстановитьПараметр("ДатаПо",КонецДня(КонечныйДеньМесяца));
	РезультатЗапроса = Запрос.Выполнить();	
	ВДЗ = РезультатЗапроса.Выбрать();	
	
	Пока ВДЗ.Следующий() Цикл	  
		Док = ВДЗ.Ссылка.ПолучитьОбъект();		
		Док.ЗакрытаяДата=ложь;
		Док.Записать();
	КонецЦикла;
	
	
	//ПРОСТОИ
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ПростойСотрудников.Ссылка КАК Ссылка
	|ИЗ
	|	Документ.ПростойСотрудников КАК ПростойСотрудников
	|ГДЕ
	|	ПростойСотрудников.ЗакрытаяДата = ИСТИНА
	|	И ПростойСотрудников.Дата >= &ДатаC
	|	И ПростойСотрудников.Дата <= &ДатаПо";
	
	Запрос.УстановитьПараметр("ДатаC", НачалоДня(НачальныйДеньМесяца));
	Запрос.УстановитьПараметр("ДатаПо",КонецДня(КонечныйДеньМесяца));
	РезультатЗапроса = Запрос.Выполнить();	
	ВДЗ = РезультатЗапроса.Выбрать();	
	
	Пока ВДЗ.Следующий() Цикл	  
		Док = ВДЗ.Ссылка.ПолучитьОбъект();		
		Док.ЗакрытаяДата=ложь;
		Док.Записать();
	КонецЦикла;
	
	
	
	
	
	


</details>






## &НаКлиенте   Процедура ОткрытиеМесяца(Команда)


<details>
 <summary> 
    Код  </summary>

	ОткрытиеМесяцаНаСервере(ДатаДляЗакрытия);  
	
	ОбновитьИнтерфейс();
	


</details>





## &НаКлиенте   
<details>
 <summary> 
    Код  </summary>

Процедура ОтобразитьЗакрытыеДатыПриИзменении(Элемент)
	ВыборВыработки="";	 	  	
	Элементы.ОткрытиеМесяца.Видимость = ОтобразитьЗакрытыеДаты;
	ОтобразитьЗакрытыеДатыПриИзмененииНаСервере();     
	ОбновитьИнтерфейс();	
	


</details>




## &НаСервере
<details>
 <summary> 
    Код  </summary>

Процедура ОтобразитьЗакрытыеДатыПриИзмененииНаСервере()
	Список.Отбор.Элементы.Очистить();
	НашЗапрос = "ВЫБРАТЬ
	|	Выработка.Ссылка КАК Ссылка,
	|	Выработка.ВерсияДанных КАК ВерсияДанных,
	|	Выработка.ПометкаУдаления КАК ПометкаУдаления,
	|	Выработка.Номер КАК Номер,
	|	Выработка.Дата КАК Дата,
	|	Выработка.Проведен КАК Проведен,
	|	Выработка.ФИО КАК ФИО,
	|	Выработка.ВыборВыработки КАК ВыборВыработки,
	|	Выработка.ЗакрытаяДата КАК ЗакрытаяДата,
	|	Выработка.КатегорияРаботника КАК КатегорияРаботника,
	|	Выработка.Проверено КАК Проверено
	|ИЗ
	|	Документ.Выработка КАК Выработка
	|ГДЕ
	|	Выработка.ЗакрытаяДата = &ОтобразитьЗакрытыеДаты";        
	
	Список.ТекстЗапроса = НашЗапрос;
	Список.ОсновнаяТаблица = Список.ОсновнаяТаблица;
	Список.ДинамическоеСчитываниеДанных = Истина;	
	Список.Параметры.УстановитьЗначениеПараметра("ОтобразитьЗакрытыеДаты", ЭтаФорма.ОтобразитьЗакрытыеДаты);  
	//очистка уо
	УсловноеОформление.Элементы.Очистить();
	//уо    1         
	
	ЭлементУсловногоОформления = УсловноеОформление.Элементы.Добавить();
	ЭлементОтбора = ЭлементУсловногоОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Список.ЗакрытаяДата"); // имя поля
	ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно; // либо задаем свой
	ЭлементОтбора.ПравоеЗначение = Истина;
	ЭлементОтбора.Использование = Истина;
	ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра("ЦветФона", Новый Цвет(204,204,204));
	ЭлементУсловногоОформления.Использование = Истина;
	ПолеДляОформления="Список";
	ПолеОформления = ЭлементУсловногоОформления.Поля.Элементы.Добавить();
	ПолеОформления.Поле = Новый ПолеКомпоновкиДанных(ПолеДляОформления);
	ПолеОформления.Использование = Истина;
	////уо   2
	ЭлементУсловногоОформления = УсловноеОформление.Элементы.Добавить();	
	ПолеДляОформления="Список";
	ПолеОформления = ЭлементУсловногоОформления.Поля.Элементы.Добавить();
	ПолеОформления.Поле = Новый ПолеКомпоновкиДанных(ПолеДляОформления);
	ПолеОформления.Использование = Истина;	
	ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра("ЦветФона", Новый Цвет(68,163,72));
	ЭлементУсловногоОформления.Использование = Истина;
	//
	ЭлементОтбора = ЭлементУсловногоОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Список.Проверено"); // имя поля
	ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно; // либо задаем свой
	ЭлементОтбора.ПравоеЗначение = Истина;
	ЭлементОтбора.Использование = Истина;
	// УО 3  
	ЭлементУсловногоОформления = УсловноеОформление.Элементы.Добавить();
	ЭлементОтбора = ЭлементУсловногоОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Список.ЗакрытаяДата"); // имя поля
	ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно; // либо задаем свой
	ЭлементОтбора.ПравоеЗначение = Истина;
	ЭлементОтбора.Использование = Истина;
	ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра("Текст","ЗАКРЫТО");
	ЭлементУсловногоОформления.Использование = Истина;
	ПолеДляОформления="Номер";
	ПолеОформления = ЭлементУсловногоОформления.Поля.Элементы.Добавить();
	ПолеОформления.Поле = Новый ПолеКомпоновкиДанных(ПолеДляОформления);
	ПолеОформления.Использование = Истина;
	


</details>





</details>






## &НаКлиенте Процедура ЗаполнитьОтходы(Команда)

<details>
 <summary> 
    Код  </summary>

	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("Оборудование1",Неопределено);  
	ПараметрыФормы.Вставить("ФИОСотрудника1", Неопределено);
	ОткрытьФормуМодально("Справочник.НоменклатураОборудований.Форма.ЗаписьОтходов", ПараметрыФормы);


</details>




##
<details>
  <summary>
    Код  </summary>


</details>
