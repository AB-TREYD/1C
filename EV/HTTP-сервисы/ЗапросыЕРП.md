## Функция anjposterp(Запрос)
HTTP сервис
<details>
  <summary>
    Код
  </summary>

```
	Ответ = Новый HTTPСервисОтвет(200);
	Ответ.Заголовки.Вставить("Content-type","application/html; charset=utf-8");
	Возврат Ответ;
```
</details>

## Функция anjGET(Запрос) 

Записывает в файлик спецификацию

<details>
  <summary>Код</summary>

  ```  
	Ответ = Новый HTTPСервисОтвет(200);
	Ответ.Заголовки.Вставить("Content-type","text/xml; charset=utf-8");
	а = СокрЛП(Запрос.ПараметрыЗапроса.Получить("a"));
	б = СокрЛП(Запрос.ПараметрыЗапроса.Получить("b"));    
	
	Попытка
		с = СокрЛП(Запрос.ПараметрыЗапроса.Получить("c"));    
	Исключение  
		с = ложь;
	КонецПопытки;
	Если с="ЗапросСТребованиемПроизводственногоНорматива" тогда
		идЗаказа=а;		
		Документ = Документы.ЗаказыВПроизводство.НайтиПоРеквизиту("IDZAK",стрЗаменить(идЗаказа,Символ(32),Символ(160)));
		Если Документ =Документы.ЗаказыВПроизводство.ПустаяСсылка() тогда
			Документ = Документы.ЗаказыВПроизводство.НайтиПоРеквизиту("IDZAK",стрЗаменить(Идзаказа,Символ(160),Символ(32)));
		КонецЕсли;
		идЗаказа=Документ.IDZak;
		НомерСчета = Документ.НомерСчета;
		ДанныеОтсутствуют="Производственный"; 
		Если Документ.н_ПровереноПлановымОтделом тогда
			ВозвратСпецификации=Истина;
		Иначе
			ВозвратСпецификации=Ложь;
		КонецЕсли;
	иначеЕсли с="ЗапросСТребованиемНормативаЭталона" тогда
		IdzakЗаказаИзЕРП=б;  //Это созданный ранее заказ из Ерп
		ПервоначальныйЗаказ = Документы.ЗаказыВПроизводство.НайтиПоРеквизиту("IDZAK",стрЗаменить(IdzakЗаказаИзЕРП,Символ(32),Символ(160)));
		Если ПервоначальныйЗаказ =Документы.ЗаказыВПроизводство.ПустаяСсылка() тогда
			ПервоначальныйЗаказ = Документы.ЗаказыВПроизводство.НайтиПоРеквизиту("IDZAK",стрЗаменить(IdzakЗаказаИзЕРП,Символ(160),Символ(32)));
		КонецЕсли;	                                                		
		идЗаказа = ПервоначальныйЗаказ.IDZak;	
		ДанныеОтсутствуют="Эталонный";  
		Если ПервоначальныйЗаказ.н_ПровереноТехнологами тогда
			ВозвратСпецификации=Истина; 
			
		Иначе
			ВозвратСпецификации=Ложь;   
			Выборка=новый таблицаЗначений;
		КонецЕсли;
	Иначе
		ДанныеОтсутствуют=Ложь;
		идЗаказа = ЕРПОбмен.ВернутьСтроку(а,б,,);
	КонецЕсли;	
	//Открытие XML
	ЗаписьXML = Новый ЗаписьXML;
	ЗаписьXML.ОткрытьФайл("\\192.168.99.2\obmen\ExpertV\anj.xml"); 
	ЗаписьXML.ЗаписатьОбъявлениеXML();
	ЗаписьXML.ЗаписатьНачалоЭлемента("Материалы"); 
	
	Если ВозвратСпецификации тогда	    
		Запрос   =  Новый Запрос();
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	Спецификация.НормаНа1КМ КАК НормаНа1КМ,
		|	Спецификация.IDZak КАК IDZak,
		|	Спецификация.НомерЭтапа КАК НомерЭтапа,
		|	Спецификация.НаименованиеМатериала КАК Наименование,
		|	Спецификация.ПривязкаКERP КАК ПривязкаКERP, 
		|	Спецификация.НаименованиеМатериала.ПривязкаКERPНовая КАК ПривязкаКERPНовая,
		|	Спецификация.ВидОперации КАК ВидОперации
		|ИЗ
		|	РегистрСведений.н_Спецификация КАК Спецификация
		|ГДЕ
		|	Спецификация.НомерЭтапа <> ""Расчётный""
		|	И Спецификация.ВидОперации <> &ВолочениеМультик   
		|	И Спецификация.ПризнакСпецификации =  &Признак
		|	И Спецификация.IDZak = &IDZak
		|
		|УПОРЯДОЧИТЬ ПО
		|	НомерЭтапа";	
		Запрос.УстановитьПараметр("IDZak", идЗаказа);	
		Если ДанныеОтсутствуют="Эталонный" тогда
			Запрос.УстановитьПараметр("Признак", Перечисления.н_ПризнакСпецификации.Эталон);	            
		Иначе
			Запрос.УстановитьПараметр("Признак", Перечисления.н_ПризнакСпецификации.Производственная);	
		КонецЕсли;
		Запрос.УстановитьПараметр("ВолочениеМультик", Перечисления.ВидОперации.ВолочениеМультивайер);
		РезультатЗапроса = Запрос.Выполнить();
		Выборка = РезультатЗапроса.Выбрать();
		Если Выборка.Количество()=0 тогда
			Запрос   =  Новый Запрос();
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	НоменклатураМатериалов.ПривязкаКERP КАК ПривязкаКERP,
			|	НоменклатураМатериалов.ПривязкаКERPНовая КАК ПривязкаКERPНовая,
			
			|	НоменклатураМатериалов.Наименование КАК Наименование,
			|	ПотребностиПоМатериалам.НормаНа1КМ КАК НормаНа1КМ,
			|	ПотребностиПоМатериалам.НомерЭтапа КАК НомерЭтапа,   
			|	ПотребностиПоМатериалам.ВидОперации КАК ВидОперации,
			
			|	ПотребностиПоМатериалам.IDZak КАК IDZak
			|ИЗ
			|	Справочник.НоменклатураМатериалов КАК НоменклатураМатериалов
			|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПотребностиПоМатериалам КАК ПотребностиПоМатериалам
			|		ПО НоменклатураМатериалов.Ссылка = ПотребностиПоМатериалам.НаименованиеМатериала
			|ГДЕ
			|	ПотребностиПоМатериалам.IDZak = &IDZak
			|	И ПотребностиПоМатериалам.НомерЭтапа <> ""Расчётный""
			|	И ПотребностиПоМатериалам.ВидОперации <> &ВолочениеМультик";
			
			Запрос.УстановитьПараметр("IDZak", идЗаказа);
			Запрос.УстановитьПараметр("ВолочениеМультик", Перечисления.ВидОперации.ВолочениеМультивайер);
			РезультатЗапроса = Запрос.Выполнить();               	
			Выборка = РезультатЗапроса.Выбрать(); 
		КонецЕсли;
		Пока Выборка.Следующий() Цикл
			ЗаписьXML.ЗаписатьНачалоЭлемента("Значения");
			Если не Документы.ЗаказыВПроизводство.НайтиПоРеквизиту("idzak",идЗаказа).н_ИспользоватьНовуюКодировкуМатериала тогда
				ЗаписьXML.ЗаписатьАтрибут("ПривязкаКERP",Выборка.ПривязкаКERP);
			иначе 
				ЗаписьXML.ЗаписатьАтрибут("ПривязкаКERP",Выборка.ПривязкаКERPНовая);				
			КонецЕсли;	
			КоэфСпец = Документы.ЗаказыВПроизводство.НайтиПоРеквизиту("idzak",идЗаказа); //30.11.2023
			КоэфСпец = ?(КоэфСпец<>0,КоэфСпец,1);                                        //30.11.2023
			ЗаписьXML.ЗаписатьАтрибут("Наименование",Строка(Выборка.Наименование));
			ЗаписьXML.ЗаписатьАтрибут("НормаНа1КМ",Строка(Выборка.НормаНа1КМ*КоэфСпец)); //30.11.2023
			ЗаписьXML.ЗаписатьАтрибут("НомерЭтапа",Строка(Выборка.НомерЭтапа));  
			ЗаписьXML.ЗаписатьАтрибут("ВидОперации",Строка(Выборка.ВидОперации));
			
			ЗаписьXML.ЗаписатьКонецЭлемента();	
		КонецЦикла;      
		Если Выборка.Количество()=0 тогда                          //Потребности нет - записывает 
			ЗаписьXML.ЗаписатьАтрибут("ДанныеОтсутствуют",ДанныеОтсутствуют);   		
		КонецЕсли;  				
	Иначе
		ЗаписьXML.ЗаписатьАтрибут("ДанныеОтсутствуют",ДанныеОтсутствуют); 	
	конецЕсли;
	ЗаписьXML.ЗаписатьКонецЭлемента();
	СтрXML = ЗаписьXML.Закрыть();
	
	
	т  = Новый ТекстовыйДокумент;
	т.Прочитать("\\192.168.99.2\obmen\ExpertV\anj.xml");    //\\192.168.99.2\obmen\ExpertV
	текстXML = т.ПолучитьТекст();
	
	Ответ.УстановитьТелоИзСтроки(текстXML,КодировкаТекста.UTF8,ИспользованиеByteOrderMark.НеИспользовать);	
	Возврат Ответ;

```
</details>
