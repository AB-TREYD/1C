## Функция ZSZ(Запрос)
<details>
<summary> Код </summary>

        
    	Ответ = Новый HTTPСервисОтвет(200);
    	IDZak = СокрЛП(Запрос.ПараметрыЗапроса.Получить("a"));    
    	Если IDZak="ЗаказПомеченНаУдаление" тогда 
    		ТЗ_из_ЕРП=ПолучитьТЗ_ЕРП_Заказов();      
    	Иначе			
    		ТЗ_из_ЕРП=ПолучитьТЗ_ЕРП_Заказов();                           	
    		Если СтрНайти(Тз_из_ЕРП[0].НомерСчета,"ТД1--033856") тогда //Костыль. 26,10,23
    			Возврат Ответ;
    		КонецЕсли;
    		Если ТЗ_из_ЕРП.Количество()>0 тогда
    			
    			ТЗ_из_ЕВ=ПолучитьТЗ_ЕВ_Заказов(Лев(Тз_из_ЕРП[0].НомерСчета,11));
    			
    			Если ТЗ_ИЗ_ЕВ.Количество()>0 тогда
    				
    				СравнениеЗаказов_ЕРП_И_ЕВ(ТЗ_из_ЕРП,ТЗ_из_ЕВ);
    			КонецЕсли;
    		КонецЕсли; 	
    	КонецЕсли;
    	Возврат Ответ;
    КонецФункции



</details>

## Функция ПолучитьТЗ_ЕРП_Заказов()
<details>
<summary> Код </summary>
  
    	XMLФайл = Новый ЧтениеXML;
    	XMLФайл.ОткрытьФайл("\\192.168.99.2\obmen\test2.xml");
    	ТабЗнач = Новый ТаблицаЗначений;
    	ТабЗнач.Колонки.Добавить("НомерСчета");
    	ТабЗнач.Колонки.Добавить("Номенклатура");
    	ТабЗнач.Колонки.Добавить("IDZAK");
    	ТабЗнач.Колонки.Добавить("Дата");  	
    	ТабЗнач.Колонки.Добавить("Проверено");  
    	ТабЗнач.Колонки.Добавить("Количество");  	
    	
    	
    	Пока XMLФайл.Прочитать() Цикл	
    		Если XMLФайл.ТипУзла = ТипУзлаXML.НачалоЭлемента и XMLФайл.Имя = "Заказ" тогда 
    			СтрТЗERP=ТабЗнач.Добавить();
    			СтрТЗERP.НомерСчета= XMLФайл.ЗначениеАтрибута(0);
    			Номенклатура=XMLФайл.ЗначениеАтрибута(3);  			
    			Номенклатура=ЕРПОбмен.ПолучитьДанные(Номенклатура,"","","","","","","","","","","");
    			СтрТЗERP.Номенклатура= Номенклатура.Марка;
    			IDZAK= XMLФайл.ЗначениеАтрибута(1);	
    			СтрТЗERP.Дата=Строка(XMLФайл.ЗначениеАтрибута(2)); 
    			СтрТЗERP.IDZAK=стрЗаменить(idzak,Символ(160),Символ(32)); 
    			СтрТЗERP.Количество=число(XMLФайл.ЗначениеАтрибута(4)); 
    		ИначеЕсли XMLФайл.ТипУзла = ТипУзлаXML.НачалоЭлемента и XMLФайл.Имя = "ЗаказНаУдаление" тогда	
    			НомерСчета= XMLФайл.ЗначениеАтрибута(0);
    			IDZAK= XMLФайл.ЗначениеАтрибута(1);	
    			IDZAK=стрЗаменить(idzak,Символ(32),Символ(160)); 			
    			Документ=Документы.ЗаказыВПроизводство.НайтиПоРеквизиту("idzak",idzak);
    			Если документ=документы.ЗаказыВПроизводство.ПустаяСсылка() тогда
    				Документ=Документы.ЗаказыВПроизводство.НайтиПоРеквизиту("НомерСчета",НомерСчета);										
    			КонецЕсли;                                                                                                  
    			Если не документ=документы.ЗаказыВПроизводство.ПустаяСсылка() тогда
    				Документ=Документ.ПолучитьОбъект();
    				Если не Документ.ссылка.ПометкаУдаления=Истина тогда
    					Документ.Записать(РежимЗаписиДокумента.ОтменаПроведения);     
    					Документ.ПометкаУдаления=Истина;
    					Документ.Записать();			        
    					//ЕСЛИ ЕСТЬ КРЫЖИК НЕБРАТЬВРАБОТУ в сгруп заказе то ставим его и метим на удаление сгруп заказ...
    
    					//МетимНаУдалениеДокументИзСгруппированныеЗаказы....код был украден откуда-то...
    					Запрос = Новый Запрос;
    					Запрос.Текст="ВЫБРАТЬ
    					|	СгруппированныеЗаказы.Ссылка КАК Ссылка,
    					|	СгруппированныеЗаказы.НомерГруппы КАК НомерГруппы,
    					|	СгруппированныеЗаказы.Номер КАК Номер,
    					|	СгруппированныеЗаказы.ИнормацияОЗаказахВГруппе.(
    					|		IDZak КАК IDZak
    					|	) КАК ИнормацияОЗаказахВГруппе
    					|ИЗ
    					|	Документ.СгруппированныеЗаказы КАК СгруппированныеЗаказы
    					|ГДЕ
    					|	СгруппированныеЗаказы.ИнормацияОЗаказахВГруппе.IDZak = &IDZak";    
    					Запрос.УстановитьПараметр("IDZak", Документ.IDZak);
    					РезультатЗапроса = Запрос.Выполнить();
    					Выборка = РезультатЗапроса.Выбрать();
    					Пока Выборка.Следующий() Цикл
    						Если Выборка.НомерГруппы <> 0 Тогда
    							//Искомый заказ внутри групппы	
    						Иначе
    							//Искомый заказ - заказ-одиночка
    							УдаляемыйДокументИзСгруппированныеЗаказы = Документы.СгруппированныеЗаказы.НайтиПоНомеру(Выборка.Номер).ПолучитьОбъект();
    							Попытка                                     //НеБратьВРаботу //10.11.2023
    								УдаляемыйДокументИзСгруппированныеЗаказы.НеБратьВРаботу = Истина;
    								УдаляемыйДокументИзСгруппированныеЗаказы.Записать();
    								УдаляемыйДокументИзСгруппированныеЗаказы.ПометкаУдаления = истина;
    								УдаляемыйДокументИзСгруппированныеЗаказы.Записать();
    							Исключение
    							КонецПопытки;
    						КонецЕсли;
    					КонецЦикла;
    
    				КонецЕсли;
    			КонецЕсли;
    		КонецЕсли;
    	КонецЦикла; 
    	Возврат ТабЗнач;
    	
    	

</details>

 
