# ФормаИсправления

## ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

Происходит заполнение данных таблицы на основе элементов массива (переданного из файла и залитого в параметры) и списка заказов из Expert V через две вложенные процедуры: ЗаполнитьТаблицу(...) и СинхронизацияСExcelНаСервере(...)  
Происходит условное оформление полей табличной части

```
ЗаполнитьТаблицу(СинхронизацияСExcelНаСервере(Параметры.МассивИзЭксель).Итог);   
ЭлементУсловногоОформления = УсловноеОформление.Элементы.Добавить();
ЭлементОтбора = ЭлементУсловногоОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Список.Исправлено"); 
ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно; 
ЭлементОтбора.ПравоеЗначение = Истина;
ЭлементОтбора.Использование = Истина;
ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра("ЦветФона",  WebЦвета.ЗеленаяЛужайка);
ЭлементУсловногоОформления.Использование = Истина;
ПолеДляОформления="Список";
ПолеОформления = ЭлементУсловногоОформления.Поля.Элементы.Добавить();
ПолеОформления.Поле = Новый ПолеКомпоновкиДанных(ПолеДляОформления);
ПолеОформления.Использование = Истина;
Если РольДоступна("Администратор") тогда
	Элементы.СписокИсправлено.Видимость = истина;
	Элементы.СписокСсылкаСгруп.Видимость = истина;
	Элементы.СписокПризнак.Видимость = истина;
	Элементы.ТехнологическаяЦепочкаСсылкаЗаказВПроизводство.Видимость = истина;
	Элементы.ТехнологическаяЦепочкаНомерСтроки.Видимость = истина;
КонецЕсли;
```
## ЗаполнитьТаблицу(СписокКЗагрузкеАтрибут)

Заполняет признаками ТЧ из сформированного списка к загрузке, полученного из функции СинхронизацияСExcelНаСервере(...) 
4 признака записи в ТЧ (только те, в которых присутствуют какие-то ошибки:   
- Оборудование не совпадает между EV и Excel (признак 1)
- Заказ Excel отсутствует в EV (признак 2)
- Заказ EV отсутствует в Excel (признак 3)
- Заказ EV ещё на проверке (признак 4)
```
СписокКЗагрузке = СписокКЗагрузкеАтрибут;
СписокКЗагрузке.Колонки.Добавить("ОписаниеОшибки");
СписокКЗагрузке.Колонки.Добавить("Исправлено");    
НайденныеСтроки = СписокКЗагрузке.НайтиСтроки(Новый Структура("Признак",1));
Для каждого Строка из НайденныеСтроки цикл
Строка.ОписаниеОшибки = "Оборудование не совпадает между EV и Excel";
КонецЦикла;
НайденныеСтроки = СписокКЗагрузке.НайтиСтроки(Новый Структура("Признак",2));
Для каждого Строка из НайденныеСтроки цикл
	Строка.ОписаниеОшибки = "Заказ Excel отсутствует в EV";
КонецЦикла;
НайденныеСтроки = СписокКЗагрузке.НайтиСтроки(Новый Структура("Признак",3));
Для каждого Строка из НайденныеСтроки цикл
	Строка.ОписаниеОшибки = "Заказ EV отсутствует в Excel";
КонецЦикла;
НайденныеСтроки = СписокКЗагрузке.НайтиСтроки(Новый Структура("Признак",4));
Для каждого Строка из НайденныеСтроки цикл
	Строка.ОписаниеОшибки = "Заказ EV ещё на проверке";
КонецЦикла;
Список.Загрузить(СписокКЗагрузке );
```
# СинхронизацияСExcelНаСервере(МассивИзЭксель)

Возвращает результат сравнения двух списков: из Excel (загруженный ранее из файла в параметры формы) и из Expert V (который уже в наличии в программе)
Основной код выполняется в функции СравнениеСписковExcelИEV(...), куда передаются оба массива
```
ТаблицаExcel = ПолучитьТаблицуExcel(МассивИзЭксель); 
ТаблицаEV = ПолучитьТаблицуEV();	
РезультатСравнения = СравнениеСписковExcelИEV(ТаблицаExcel, ТаблицаEV);
Возврат РезультатСравнения
```

# СравнениеСписковExcelИEV(ТаблицаExcel, ТаблицаEV)

