# Процедуры

## Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
Процедура вызывает при создании документа на сервере процедуру (УстановитьУсловноеОформлениеСписка()) для заполнения самописного списка
```
 УстановитьУсловноеОформлениеСписка();
```

## Процедура УстановитьУсловноеОформлениеСписка() 
Заполняет СписокЗаказов
```
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	СгруппированныеЗаказыСклад.Номеклатура КАК Номеклатура,
	|	СгруппированныеЗаказыСклад.НомерСчета КАК НомерСчета,
	|	СгруппированныеЗаказыСклад.ДатаВыходаЗаказа КАК ДатаВыходаЗаказа,
	|	СгруппированныеЗаказыСклад.КоличествоПоЗаказу КАК КоличествоПоЗаказу,
	|	СгруппированныеЗаказыСклад.ПрозводствоСЛиний КАК ПрозводствоСЛиний,
	|	СгруппированныеЗаказыСклад.ВноситьВПечать КАК ВноситьВПечать,
	|	СгруппированныеЗаказыСклад.КлКоробокДляЗаполнения КАК КлКоробокДляЗаполнения,
	|	СгруппированныеЗаказыСклад.Ссылка КАК Ссылка,
	|	СгруппированныеЗаказыСклад.ЗаказПолностьюУпакован КАК ЗаказПолностьюУпакован,
	|	СгруппированныеЗаказыСклад.УпакованоФакт КАК УпакованоФакт
	|ИЗ
	|	Документ.СгруппированныеЗаказыСклад КАК СгруппированныеЗаказыСклад
	|
	|УПОРЯДОЧИТЬ ПО
	|	ДатаВыходаЗаказа";
	
	РезультатЗапроса = Запрос.Выполнить();
	                                                                               
	ЭтаФорма.СписокЗаказов.Загрузить(РезультатЗапроса.Выгрузить());
	

    ЭлементОформления = УсловноеОформление.Элементы.Добавить();
	ЭлементОформления.Представление = "СозданПрограммно";
	
	ЭлементОтбора = ЭлементОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ЭлементОтбора.ЛевоеЗначение  = Новый ПолеКомпоновкиДанных("СписокЗаказов.КлКоробокДляЗаполнения");
	ЭлементОтбора.ВидСравнения   = ВидСравненияКомпоновкиДанных.Больше;
	ЭлементОтбора.ПравоеЗначение  = 0; 
	ЭлементОформления.Оформление.УстановитьЗначениеПараметра(Новый ПараметрКомпоновкиДанных("ЦветФона"), Новый цвет (255,165,0));
	
	ПолеОформления = ЭлементОформления.Поля.Элементы.Добавить();             	
	ПолеОформления.Поле = Новый ПолеКомпоновкиДанных("СписокЗаказов"); 
	
	//Заказ полностью упакован
	ЭлементОформления = УсловноеОформление.Элементы.Добавить();
	ЭлементОформления.Представление = "СозданПрограммно";
	
	ЭлементОтбора = ЭлементОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ЭлементОтбора.ЛевоеЗначение  = Новый ПолеКомпоновкиДанных("СписокЗаказов.КоличествоПоЗаказу");
	ЭлементОтбора.ВидСравнения   = ВидСравненияКомпоновкиДанных.Равно;
	ЭлементОтбора.ПравоеЗначение  = Новый ПолеКомпоновкиДанных("СписокЗаказов.УпакованоФакт");
	ЭлементОформления.Оформление.УстановитьЗначениеПараметра(Новый ПараметрКомпоновкиДанных("ЦветФона"), Новый цвет (34,139,34));
	
	ПолеОформления = ЭлементОформления.Поля.Элементы.Добавить();             	
	ПолеОформления.Поле = Новый ПолеКомпоновкиДанных("СписокЗаказов");

```

## Процедура ВызватьФормуВыбораКоробок(Команда)
Кнопка на форме, которая открывает форму для выбора, какие коробки будут заполняться.
Вызывает: ЗаполнитьСтруктуруЗаказами
```
	ЗаказыДляВыбораКоробок = ЗаполнитьСтруктуруЗаказами();
	ОткрытьФорму("Документ.СгруппированныеЗаказыСклад.Форма.ФормаВыбораКоробокДляПечати", ЗаказыДляВыбораКоробок, ЭтаФорма,,,,,РежимОткрытияОкнаФормы.БлокироватьВесьИнтерфейс);
```

## Функция ЗаполнитьСтруктуруЗаказами()
Отбераются нужные строчки из списка для дальнейшей передачи
```	
	ВозвратСтруктуры = Новый Структура;
	
	МассивСЗаказами = Новый Массив;
	
	Отбор = Новый Структура;
	Отбор.Вставить("РазбивкаВРучную", Истина); 
	СтрокиДляЗаполнения = СписокЗаказов.НайтиСтроки(Отбор);
	
	ВозвратСтруктуры.Вставить("РазбивкаВРучную", Истина);
	
	Если СтрокиДляЗаполнения.Количество() = 0 Тогда
		ВозвратСтруктуры.РазбивкаВРучную = Ложь;
	Иначе
		Для Каждого Стр Из СтрокиДляЗаполнения Цикл 
			
			СтрокаВМассиве = Новый Структура;
			
			СтрокаВМассиве.Вставить("Номенклатура",    Стр.Номеклатура);
			СтрокаВМассиве.Вставить("НомерСчета",      Стр.НомерСчета);
			СтрокаВМассиве.Вставить("Ссылка",          Стр.Ссылка);
			СтрокаВМассиве.Вставить("РазбивкаВРучную", Истина);
			
			МассивСЗаказами.Добавить(СтрокаВМассиве); 
			
			Стр.РазбивкаВРучную = Ложь;
			
		КонецЦикла;
				
	КонецЕсли; 
	
	Отбор = Новый Структура;
	Отбор.Вставить("ВноситьВПечать", Истина); 
	СтрокиДляЗаполнения = СписокЗаказов.НайтиСтроки(Отбор); 		
	
	Для Каждого Стр Из СтрокиДляЗаполнения Цикл 
		
		СтрокаВМассиве = Новый Структура;
		
		СтрокаВМассиве.Вставить("Номенклатура",    Стр.Номеклатура);
		СтрокаВМассиве.Вставить("НомерСчета",      Стр.НомерСчета);
		СтрокаВМассиве.Вставить("Ссылка",          Стр.Ссылка);
		СтрокаВМассиве.Вставить("РазбивкаВРучную", Ложь);
		
		МассивСЗаказами.Добавить(СтрокаВМассиве); 
		
		Стр.ВноситьВПечать = Ложь;
		
	КонецЦикла;
		
	ВозвратСтруктуры.Вставить("Заказы", МассивСЗаказами);
	
	Возврат ВозвратСтруктуры; 
```

##  Процедура СписокЗаказовВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
Декоративные моментики
```
	Если Поле.Имя = "СписокЗаказовВноситьВПечать"  тогда
		Элемент.ТекущиеДанные.ВноситьВПечать = Не Элемент.ТекущиеДанные.ВноситьВПечать;	
	КонецЕсли;
	Если Поле.Имя = "СписокЗаказовРазбивкаВРучную"  тогда
		Элемент.ТекущиеДанные.РазбивкаВРучную = Не Элемент.ТекущиеДанные.РазбивкаВРучную;	
	КонецЕсли;
```

## Процедура ОбновитьСписок(Команда)
Обновление списка при нажатии на кнопку
```
	УстановитьУсловноеОформлениеСписка()
```
