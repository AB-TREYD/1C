

##
<details>
  <summary>Код</summary>
  
</details>


## &НаСервере Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)      


- Пересчитывает итоги
- включает админу Видимость Крыжика **толькопросмотр**
- если документ уже закрыт:
          - включает только просмотр
          - показывает статусы отправленных
                


<details>
  <summary>Код</summary>
  


        
        	ДатаНочь 		= Дата(Строка(Год(ТекущаяДата())), Строка(Месяц(ТекущаяДата())), Строка(День(ТекущаяДата())), "00","00","01");
        	ДатаДень 		= Дата(Строка(Год(ТекущаяДата())), Строка(Месяц(ТекущаяДата())), Строка(День(ТекущаяДата())), "07","30","00");
        	ДатаНочьНочь 	= Дата(Строка(Год(ТекущаяДата())), Строка(Месяц(ТекущаяДата())), Строка(День(ТекущаяДата())), "19","30","00");
        	ДатаДеньДень 	= Дата(Строка(Год(ТекущаяДата())), Строка(Месяц(ТекущаяДата())), Строка(День(ТекущаяДата())), "23","59","59");
        	
        	Если Объект.Дата=ДАТА(1,1,1) тогда 
        		Если (ТекущаяДата() > ДатаНочь) и (ТекущаяДата() < ДатаДень) тогда Объект.Дата=ТекущаяДата()-86400; Объект.День = Истина; Объект.Ночь=Ложь; КонецЕсли;              // 00:00 - 7:30 
        		Если (ТекущаяДата() > ДатаДень) и (ТекущаяДата() < ДатаНочьНочь) тогда  Объект.День = Истина; Объект.Ночь=Ложь; Объект.Дата = ТекущаяДата(); КонецЕсли;             // 7:30 - 19:30
        		Если (ТекущаяДата() > ДатаНочьНочь) и (ТекущаяДата() < ДатаДеньДень) тогда  Объект.Ночь = Истина;  Объект.День = Ложь; Объект.Дата = ТекущаяДата(); КонецЕсли;      // 19:30 - 00:00	
        	КонецЕсли;
        	
        	
        	Если Объект.Работники.Количество()=0 тогда 
        		НоваяСтрока = Объект.Работники.Добавить(); 	
        		Запрос = Новый Запрос;
        		Запрос.Текст = 
        		"ВЫБРАТЬ
        		|	СписокСотрудниковИзЕРП.Ссылка КАК Ссылка,
        		|	СписокСотрудниковИзЕРП.Наименование КАК Наименование
        		|ИЗ
        		|	Справочник.СписокСотрудниковИзЕРП КАК СписокСотрудниковИзЕРП
        		|ГДЕ
        		|	СписокСотрудниковИзЕРП.Наименование = &Наименование";
        		
        		Запрос.УстановитьПараметр("Наименование", ПользователиИнформационнойБазы.ТекущийПользователь().ПолноеИмя);
        		
        		
        		РезультатЗапроса = Запрос.Выполнить();
        		
        		ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
        		
        		Пока ВыборкаДетальныеЗаписи.Следующий() Цикл   
        			НоваяСтрока.ФИО  = Справочники.СписокСотрудниковИзЕРП.НайтиПоНаименованию(ПользователиИнформационнойБазы.ТекущийПользователь().ПолноеИмя);
        			НоваяСтрока.ТолькоПросмотр = Истина;     
        		КонецЦикла;  
        		НоваяСтрока = Объект.Работники.Добавить();
        	КонецЕсли;
        	ЗагрузитьТабличнуюЧастьВТаблицыЗагружено();
        	
        	Если Объект.Дата=0 									тогда Объект.Дата=ТекущаяДата(); КонецЕсли;
        	Если Объект.Работники.Количество()=0 				тогда ДобавитьСтрокиВТаблицу(Объект.Работники,3); КонецЕсли;
        	Если Объект.КристаллизаторыВРаботе.Количество()=0 	тогда ДобавитьСтрокиВТаблицу(Объект.КристаллизаторыВРаботе,10); КонецЕсли;
        	Если Объект.Продукция.Количество()=0 				тогда ДобавитьСтрокиВТаблицу(Объект.Продукция,1); КонецЕсли;    
        	Если Объект.БракКатанки.Количество()=0 				тогда ДобавитьСтрокиВТаблицу(Объект.БракКатанки,1); КонецЕсли;    	
        	Если Объект.Загружено.Количество()=0 				тогда ДобавитьСтрокиВТаблицу(Объект.Загружено,10); КонецЕсли;
        	Если Объект.ЗамерТемпературыКонтрольный.Количество()=0 	тогда ДобавитьСтрокиВТаблицу(Объект.ЗамерТемпературыКонтрольный,3); КонецЕсли;
        	Если Объект.Обслуживание.Количество()=0 				тогда ДобавитьСтрокиВТаблицу(Объект.Обслуживание,3); КонецЕсли;
        	Если Объект.ДопРаботыПоУчастку.Количество()=0 			тогда ДобавитьСтрокиВТаблицу(Объект.ДопРаботыПоУчастку,3); КонецЕсли;
        	
        	
        	Если РольДоступна("НачальникЦПМ") или РольДоступна("НачСменыЦПМ") или РольДоступна("Администратор") тогда     
        		Элементы.ПродукцияКомментарий.Видимость=Истина;
        		Элементы.ПродукцияСклад.Видимость=Истина;
        	КонецЕсли;
        	
        	Если не (РольДоступна("НачальникЦПМ") или РольДоступна("НачСменыЦПМ")) тогда     
        		Элементы.ФормаЗакрытьСмену.Видимость = Объект.Проведен;
        		Элементы.ПродукцияСклад.Видимость =Ложь;		
        	КонецЕсли;
        	Если РольДоступна("Администратор") тогда
        		Элементы.ПродукцияСклад.Видимость = Истина;            
        		Элементы.ФормаЗакрытьСмену.Видимость = Объект.Проведен;  
        		Элементы.Загружено.Видимость=Истина;
        		
        	КонецЕсли;	
        	Элементы.ТолькоПросмотр.Видимость = РольДоступна("Администратор"); 
        	Если РольДоступна("ПлавильщикЦПМ") тогда
        		Элементы.Номер.Видимость=Ложь;      
        		Элементы.Дата.ТолькоПросмотр=Истина;
        		Элементы.День.ТолькоПросмотр=Истина;
        		Элементы.Ночь.ТолькоПросмотр=Истина;
        		Элементы.Мастер.ТолькоПросмотр=Истина;    
        		Элементы.РаботникиТолькоПросмотр.Видимость=Ложь;  
        		
        	КонецЕсли;
        	ПересчитатьИтоги_Загружено(); 
        	ПересчитатьИтоги_Продукция();  
        	
        	Если Объект.ТолькоПросмотрПереключатель тогда 
        		ВключитьТолькоПросмотр(Объект.ТолькоПросмотрПереключатель);
        		ПоставитьГалочкиПриНаличииДокументаERP();	
        		ВидимостьДокументаERP();       
        		Элементы.ФормаЗакрытьСмену.Видимость = не Объект.ТолькоПросмотрПереключатель;
        	КонецЕсли;
        	
        	
        КонецПроцедуры

</details>



## &НаСервере Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)

<details>
  <summary>Код</summary>
  

        
        
        	Элементы.ФормаЗакрытьСмену.Видимость = (ПараметрыЗаписи.РежимЗаписи = РежимЗаписиДокумента.Проведение);	
        КонецПроцедуры
        Процедура ПоставитьГалочкиПриНаличииДокументаERP()
        	НужноСообщить = Ложь;
        	Для каждого стр из Объект.Продукция цикл
        		Если Стр.Вес <> 0 тогда                      
        			Если Стр.Наличие_ПБЗ_ERP<>"" и Стр.Наличие_Сборки_ERP<>"" тогда
        				Стр.НаличиеДокумента_в_ERP = БиблиотекаКартинок.ОформлениеЗнакФлажок;
        			Иначе      
        				НужноСообщить = Истина;
        				Стр.НаличиеДокумента_в_ERP = БиблиотекаКартинок.ОформлениеЗнакКрест;
        			КонецЕсли;
        		КонецЕсли;
        	КонецЦикла;         
        	Если НужноСообщить тогда Сообщить("С отправкой документов в ERP произошла ошибка. Сообщите в IT-отдел") КонецЕсли;
        КонецПроцедуры

</details>



##  Процедура ВидимостьДокументаERP()

<details>
  <summary>Код</summary>
  
          	Элементы.ПродукцияНаличиеДокумента_в_ERP.Видимость = Объект.ТолькоПросмотрПереключатель;
          КонецПроцедуры

</details>





## Только_просмотр

<details>
  <summary>Только_просмотр</summary>




## &НаКлиенте Процедура ТолькоПросмотрПриИзменении(Элемент)

<details>
  <summary>Код</summary>
        
      	ПоставитьГалочкиПриНаличииДокументаERP();	
      	Элементы.ФормаЗакрытьСмену.Видимость = не Объект.ТолькоПросмотрПереключатель;	
      	ВключитьТолькоПросмотр(Объект.ТолькоПросмотрПереключатель);   
      	ВидимостьДокументаERP();
      КонецПроцедуры

</details>


## Процедура ВключитьТолькоПросмотр(ТолькоПросмотр)

<details>
  <summary>Код</summary>
      
          ЭтотОбъект.КоманднаяПанель.Доступность	  = не ТолькоПросмотр;
        	Элементы.ВсеЭлементы.ТолькоПросмотр 	  = ТолькоПросмотр;
        КонецПроцедуры
</details>

  
</details>


 ## Нераспределенное
 

  <details>
    <summary>Нераспределенное</summary>
          
  ## &НаКлиенте Процедура ДеньПриИзменении(Элемент)
      <details>
      <summary>Код</summary>

                Если Объект.День=Истина тогда
              		Объект.Ночь=Ложь;
              	Иначе Объект.Ночь=Истина;
              	КонецЕсли;
              КонецПроцедуры

      </details>


## &НаКлиенте Процедура НочьПриИзменении(Элемент)


  <details>
    <summary>Код</summary>
        
        	Если Объект.Ночь=Истина тогда
        		Объект.День=Ложь;
        	Иначе Объект.День=Истина;
        	КонецЕсли;	
        КонецПроцедуры
            
</details>

## &Процедура ДобавитьСтрокиВТаблицу(Таблица,КоличествоСтрок)
 
  <details>
    <summary>Код</summary>
        
        Для кол=1 по КоличествоСтрок цикл
      		НоваяСтрока=Таблица.Добавить();		
      	КонецЦикла;	
      КонецПроцедуры
               
</details>


## &НаКлиенте Процедура ПродукцияДиаметрПродукцииПриИзменении(Элемент)

 
  <details>
    <summary>Код</summary>

      Если Элемент.Родитель.ТекущиеДанные.Склад = "" тогда 
    		Элемент.Родитель.ТекущиеДанные.Склад = Элементы.ПродукцияСклад.СписокВыбора[0];	
    	КонецЕсли;
    КонецПроцедуры
  
  </details>    
 
 ## 	&НаКлиенте Процедура РаботникиФИОНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)

 
  <details>
    <summary>Код</summary>
      
        НовыйСписокВыбора=ЗаполнитьСписок();
      	Элементы.РаботникиФИО.СписокВыбора.ЗагрузитьЗначения(НовыйСписокВыбора.Список);	
      КонецПроцедуры

  </details>    


 ## Функция  ЗаполнитьСписок()

 
  <details>
    <summary>Код</summary>

          Результат=Новый структура; 
        	СписокСотрудников = Новый Массив;
        	Результат.Вставить("Список", СписокСотрудников);
        	
        	Запрос = Новый Запрос;
        	Запрос.Текст = 
        	"ВЫБРАТЬ
        	|	СписокСотрудниковИзЕРП.Наименование КАК Наименование,
        	|	СписокСотрудниковИзЕРП.Должность КАК Должность,
        	|	СписокСотрудниковИзЕРП.Ссылка КАК Ссылка
        	|ИЗ
        	|	Справочник.СписокСотрудниковИзЕРП КАК СписокСотрудниковИзЕРП
        	|ГДЕ
        	|	СписокСотрудниковИзЕРП.Должность = &Должность
        	|	И СписокСотрудниковИзЕРП.ПометкаУдаления = &ПометкаУдаления";
        	
        	Запрос.УстановитьПараметр("Должность", Перечисления.Профессии.ПлавильщикМеталловИСплавов);       
        	Запрос.УстановитьПараметр("ПометкаУдаления", Ложь);  
        	
        	РезультатЗапроса = Запрос.Выполнить();
        	
        	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
        	
        	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
        		СписокСотрудников.Добавить(ВыборкаДетальныеЗаписи.Ссылка);  
        	КонецЦикла;
        	
        	Возврат Результат;	
        КонецФункции

  </details>    


## &НаКлиенте Процедура ЗагруженоСырьеНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)

  <details>
    <summary>Код</summary>

        НовыйСписокВыбора=ЗаполнитьСписокСырье();
      	Элементы.ЗагруженоСырье.СписокВыбора.ЗагрузитьЗначения(НовыйСписокВыбора.Список);	
      КонецПроцедуры 
      
  </details>    


## &НаКлиенте Процедура ЗагруженоеСырьеСырьеНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)

  <details>
    <summary>Код</summary>
          
            	НовыйСписокВыбора=ЗаполнитьСписокСырье();
            	Элементы.ЗагруженоеСырьеСырье.СписокВыбора.ЗагрузитьЗначения(НовыйСписокВыбора.Список);	
            КонецПроцедуры

  </details>    


## Функция  ЗаполнитьСписокСырье()

 
  <details>
    <summary>Код</summary>

            Результат=Новый структура; 
          	СписокСырье = Новый Массив;
          	Результат.Вставить("Список", СписокСырье);
          	
          	Запрос = Новый Запрос;
          	Запрос.Текст = 
          	"ВЫБРАТЬ
          	|	ШиныЦПМ.Ссылка КАК Ссылка,
          	|	ШиныЦПМ.Сырье КАК Сырье,
          	|	ШиныЦПМ.ПометкаУдаления КАК ПометкаУдаления
          	|ИЗ
          	|	Справочник.ШиныЦПМ КАК ШиныЦПМ
          	|ГДЕ
          	|	ШиныЦПМ.Сырье = &Сырье
          	|	И ШиныЦПМ.ПометкаУдаления = &ПометкаУдаления";
          	
          	Запрос.УстановитьПараметр("Сырье", Истина);       
          	Запрос.УстановитьПараметр("ПометкаУдаления", Ложь);  
          	
          	РезультатЗапроса = Запрос.Выполнить();
          	
          	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
          	
          	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
          		СписокСырье.Добавить(ВыборкаДетальныеЗаписи.Ссылка);  
          	КонецЦикла;
          	
          	Возврат Результат;	
          КонецФункции
  
  </details>    



## &НаКлиенте Процедура ЗагруженоОтходыНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)

 
  <details>
    <summary>Код</summary>

            НовыйСписокВыбора=ЗаполнитьСписокОтходы();
          	Элементы.ЗагруженоОтходы.СписокВыбора.ЗагрузитьЗначения(НовыйСписокВыбора.Список);
          КонецПроцедуры
  </details>    

## &НаКлиенте Процедура ЗагруженныеОтходыОтходыНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)

 
  <details>
    <summary>Код</summary>
  
          НовыйСписокВыбора=ЗаполнитьСписокОтходы();
        	Элементы.ЗагруженныеОтходыОтходы.СписокВыбора.ЗагрузитьЗначения(НовыйСписокВыбора.Список);	
        КонецПроцедуры   
        
  </details>    
  

 ## Функция  ЗаполнитьСписокОтходы()

 
  <details>
    <summary>Код</summary>
      
              Результат=Новый структура; 
            	СписокОтходы = Новый Массив;
            	Результат.Вставить("Список", СписокОтходы);
            	
            	Запрос = Новый Запрос;
            	Запрос.Текст = 
            	"ВЫБРАТЬ
            	|	ШиныЦПМ.Ссылка КАК Ссылка,
            	|	ШиныЦПМ.ПометкаУдаления КАК ПометкаУдаления,
            	|	ШиныЦПМ.Отходы КАК Отходы
            	|ИЗ
            	|	Справочник.ШиныЦПМ КАК ШиныЦПМ
            	|ГДЕ
            	|	ШиныЦПМ.ПометкаУдаления = &ПометкаУдаления
            	|	И ШиныЦПМ.Отходы = &Отходы";
            	
            	Запрос.УстановитьПараметр("Отходы", Истина);       
            	Запрос.УстановитьПараметр("ПометкаУдаления", Ложь);  
            	
            	РезультатЗапроса = Запрос.Выполнить();
            	
            	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
            	
            	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
            		СписокОтходы.Добавить(ВыборкаДетальныеЗаписи.Ссылка);  
            	КонецЦикла;
            	
            	Возврат Результат;	
            КонецФункции
  </details>    

</details>    


## Итоги

- Пересчитывает итоги во всех таблицах где нужны итоги
- Событие - при изменении
- Если есть разница сервер/клиент тогда обновляет итоги и ставит отметку об изменениях на форме.


 
<details>
    <summary>Код</summary>

  ## &НаКлиенте Процедура ЗагруженоПриИзменении(Элемент)
  
  <details>
    <summary>Код</summary>
      
            	ПересчитатьИтоги_Загружено();  
        КонецПроцедуры
      
  </details>    

## Процедура ПересчитатьИтоги_Загружено()

 
  <details>
    <summary>Код</summary>
  
          Объект.ИтогоОтходы = Объект.Загружено.Итог("ВесОтходы");;
        	Объект.ИтогоСырье  = Объект.Загружено.Итог("ВесСырья");
        	Объект.ИтогоСырьеОтходы = Объект.ИтогоСырье + Объект.ИтогоОтходы;
        	ИтогДО = Объект.ИтогоСырьеОтходыМФ;	
        	Объект.ИтогоСырьеОтходыМФ = Объект.ИтогоСырье + Объект.ИтогоОтходы + Объект.Загружено.Итог("МФ");
        	Если Объект.ИтогоСырьеОтходыМФ <> ИтогДО тогда ЭтаФорма.Модифицированность = истина КонецЕсли;
        КонецПроцедуры

  </details>    



## &НаКлиенте Процедура ПродукцияПриИзменении(Элемент)  

 
  <details>
    <summary>Код</summary>

              ПересчитатьИтоги_Продукция();
          КонецПроцедуры  

  </details>    

## Процедура ПересчитатьИтоги_Продукция()       

 
  <details>
    <summary>Код</summary>

          ИтогДО = Объект.ИтогоВесПродукции;	
        	Объект.ИтогоВесПродукции=Объект.Продукция.Итог("Вес"); 
        	Если Объект.ИтогоВесПродукции <> ИтогДО тогда ЭтаФорма.Модифицированность = истина КонецЕсли;;
        КонецПроцедуры

  </details>    

## &НаКлиенте   Процедура БракКатанкиПриИзменении(Элемент)

 
  <details>
    <summary>Код</summary>

            
          	ПересчитатьИтоги_Брак(); 
          КонецПроцедуры  
          
  </details>    
  

## Процедура ПересчитатьИтоги_Брак()       

 
  <details>
    <summary>Код</summary>

            ИтогДО = Объект.ИтогоВесБрака;	
          	Объект.ИтогоВесБрака=Объект.БракКатанки.Итог("Вес"); 
          	Если Объект.ИтогоВесБрака <> ИтогДО тогда ЭтаФорма.Модифицированность = истина КонецЕсли;;
          КонецПроцедуры
          
  </details>    
         
</details>   



## Загрузка_выгрузка_Таблиц_ЗАГРУЖЕНО  
 
<details>
    <summary>Код</summary>


## &НаКлиенте Процедура ЗагруженоеСырьеПриИзменении(Элемент)

 
  <details>
    <summary>Код</summary>
    
          	ВыгрузитьТаблицуЗагруженоВТабличнуюЧасть();
          	ПересчитатьИтоги_Загружено();    
          КонецПроцедуры
      
  </details>    

## &НаКлиенте Процедура ЗагруженныеОтходыПриИзменении(Элемент)

 
  <details>
    <summary>Код</summary>
    
              ВыгрузитьТаблицуЗагруженоВТабличнуюЧасть();ПересчитатьИтоги_Загружено();
          КонецПроцедуры
        
  </details>    

## &НаКлиенте Процедура ЗагруженоеМФПриИзменении(Элемент)
 
  <details>
    <summary>Код</summary>
    
              	ВыгрузитьТаблицуЗагруженоВТабличнуюЧасть();ПересчитатьИтоги_Загружено();
          КонецПроцедуры  
          
  </details>    



## &НаКлиенте Процедура ВыгрузитьТаблицуЗагруженоВТабличнуюЧасть()

 
  <details>
    <summary>Код</summary>
                
                  Объект.Загружено.Очистить();
                	Если ЭтаФорма.ЗагруженоеСырье.Количество()<>0 тогда
                		Для каждого СтрокаТЧ из ЭтаФорма.ЗагруженоеСырье цикл
                			Для каждого НоваяСтрока из Объект.Загружено цикл
                				Если Строка(НоваяСтрока.Сырье)="" тогда
                					НоваяСтрока.Сырье=СтрокаТЧ.Сырье;  
                					НоваяСтрока.ПризнакСырье=СтрокаТЧ.Признак;
                					НоваяСтрока.ВесСырья=СтрокаТЧ.Вес;
                					ДанныеЗаписаны=Истина; 
                					Прервать;
                				КонецЕсли; 
                				ДанныеЗаписаны=Ложь;
                			КонецЦикла;	
                			Если ДанныеЗаписаны<>Истина тогда
                				НоваяСтрока=Объект.Загружено.Добавить();  
                				НоваяСтрока.Сырье=СтрокаТЧ.Сырье;  
                				НоваяСтрока.ПризнакСырье=СтрокаТЧ.Признак;
                				НоваяСтрока.ВесСырья=СтрокаТЧ.Вес;  
                				ДанныеЗаписаны=Ложь;
                			КонецЕсли; 			
                			
                		КонецЦикла;		
                	КонецЕсли;    
                	Если ЭтаФорма.ЗагруженныеОтходы.Количество()<>0 тогда
                		Для каждого СтрокаТЧ из ЭтаФорма.ЗагруженныеОтходы цикл
                			Для каждого НоваяСтрока из Объект.Загружено цикл
                				Если Строка(НоваяСтрока.Отходы)="" тогда
                					НоваяСтрока.Отходы=СтрокаТЧ.Отходы;  
                					НоваяСтрока.ПризнакОтходы=СтрокаТЧ.Признак;
                					НоваяСтрока.ВесОтходы=СтрокаТЧ.Вес;
                					ДанныеЗаписаны=Истина; 
                					Прервать;
                				КонецЕсли; 
                				ДанныеЗаписаны=Ложь;
                			КонецЦикла;	
                			Если ДанныеЗаписаны<>Истина тогда
                				НоваяСтрока=Объект.Загружено.Добавить();  
                				НоваяСтрока.Отходы=СтрокаТЧ.Отходы;  
                				НоваяСтрока.ПризнакОтходы=СтрокаТЧ.Признак;
                				НоваяСтрока.ВесОтходы=СтрокаТЧ.Вес;  
                				
                			КонецЕсли; 					
                		КонецЦикла;	
                		
                	КонецЕсли;
                	Если ЭтаФорма.ЗагруженоеМФ.Количество()<>0 тогда
                		Для каждого СтрокаТЧ из ЭтаФорма.ЗагруженоеМФ цикл 		
                			Для каждого НоваяСтрока из Объект.Загружено цикл
                				Если НоваяСтрока.МФ=0 тогда
                					НоваяСтрока.МФ=СтрокаТЧ.Вес;  
                					ДанныеЗаписаны=Истина; 
                					Прервать;
                				КонецЕсли; 
                				ДанныеЗаписаны=Ложь;
                			КонецЦикла;	
                			Если ДанныеЗаписаны<>Истина тогда
                				НоваяСтрока=Объект.Загружено.Добавить();  
                				НоваяСтрока.МФ=СтрокаТЧ.Вес;  
                				ДанныеЗаписаны=Ложь;
                			КонецЕсли; 			
                			
                		КонецЦикла;	
                	КонецЕсли;
                КонецПроцедуры

  </details>    



## &НаКлиенте Процедура ВыгрузитьТаблицуОтходыЗагруженоВТабличнуюЧасть()

 
  <details>
    <summary>Код</summary>
      
            	Если ЭтаФорма.ЗагруженныеОтходы.Количество()<>0 тогда
            		Для каждого СтрокаТЧ из ЭтаФорма.ЗагруженныеОтходы цикл
            			Отбор=НоВый Структура();
            			Отбор.Вставить("Отходы", СтрокаТЧ.Отходы);
            			НайденныеСтроки=Объект.Загружено.НайтиСтроки(Отбор);
            			Если НайденныеСтроки.Количество()>0 тогда 
            				Для каждого НоваяСтрока из НайденныеСтроки цикл
            					Объект.Загружено[НоваяСтрока.НомерСтроки-1].ВесОтходы=СтрокаТЧ.Вес; 
            					Объект.Загружено[НоваяСтрока.НомерСтроки-1].ПризнакОтходы=СтрокаТЧ.Признак;
            				КонецЦикла;    
            			иначе
            				Для каждого НоваяСтрока из Объект.Загружено цикл
            					Если Строка(НоваяСтрока.Отходы)="" тогда
            						НоваяСтрока.Отходы=СтрокаТЧ.Отходы;  
            						НоваяСтрока.ПризнакОтходы=СтрокаТЧ.Признак;
            						НоваяСтрока.ВесОтходы=СтрокаТЧ.Вес;
            						ДанныеЗаписаны=Истина; 
            						Прервать;
            					КонецЕсли;                
            				КонецЦикла;	
            				Если Не ДанныеЗаписаны тогда
            					НоваяСтрока=Объект.Загружено.Добавить();  
            					НоваяСтрока.Отходы=СтрокаТЧ.Отходы;  
            					НоваяСтрока.ПризнакОтходы=СтрокаТЧ.Признак;
            					НоваяСтрока.ВесОтходы=СтрокаТЧ.Вес;  
            					ДанныеЗаписаны=Ложь;
            				КонецЕсли; 			
            			КонецЕсли; 		
            		КонецЦикла;		
            	КонецЕсли;
            	
            КонецПроцедуры 
      
  </details>    



## &НаКлиенте Процедура ВыгрузитьТаблицуМФЗагруженоВТабличнуюЧасть()

 
  <details>
    <summary>Код</summary>
              
              	Если ЭтаФорма.ЗагруженоеМФ.Количество()<>0 тогда
              		Для каждого СтрокаТЧ из ЭтаФорма.ЗагруженоеМФ цикл        			
              			Для каждого НоваяСтрока из Объект.Загружено цикл
              				Если НоваяСтрока.МФ=0 тогда
              					НоваяСтрока.МФ=СтрокаТЧ.Вес;  
              					ДанныеЗаписаны=Истина; 
              					Прервать;
              				КонецЕсли;                
              			КонецЦикла;	
              			Если Не ДанныеЗаписаны тогда
              				НоваяСтрока=Объект.Загружено.Добавить();  
              				НоваяСтрока.МФ=СтрокаТЧ.Вес;  
              				ДанныеЗаписаны=Ложь;
              			КонецЕсли; 			        			
              		КонецЦикла;	
              	КонецЕсли;        	
              КонецПроцедуры 


  </details>    

## Процедура ЗагрузитьТабличнуюЧастьВТаблицыЗагружено()

 
  <details>
    <summary>Код</summary>

      
          	Если Объект.Загружено.Количество()<>0 тогда 
          		Для каждого СтрокаТЧ из объект.Загружено цикл
          			Если СтрокаТЧ.Сырье<>Справочники.ШиныЦПМ.ПустаяСсылка() тогда
          				НоваяСтрока=ЭтаФорма.ЗагруженоеСырье.Добавить();   
          				НоваяСтрока.Сырье=СтрокаТЧ.Сырье;
          				НоваяСтрока.Признак=СтрокаТЧ.ПризнакСырье;
          				НоваяСтрока.Вес=СтрокаТЧ.ВесСырья;
          			КонецЕсли;
          			Если СтрокаТЧ.Отходы<>Справочники.ШиныЦПМ.ПустаяСсылка() тогда
          				НоваяСтрока=ЭтаФорма.ЗагруженныеОтходы.Добавить();   
          				НоваяСтрока.Отходы=СтрокаТЧ.Отходы;
          				НоваяСтрока.Признак=СтрокаТЧ.ПризнакОтходы;
          				НоваяСтрока.Вес=СтрокаТЧ.ВесОтходы;
          			КонецЕсли;	
          			Если СтрокаТЧ.МФ<>0 тогда
          				НоваяСтрока=ЭтаФорма.ЗагруженоеМФ.Добавить();   
          				НоваяСтрока.Вес=СтрокаТЧ.МФ;
          			КонецЕсли;
          		КонецЦикла;
          	КонецЕсли;
          КонецПроцедуры

  </details>    
</details>                   

## Закрытие_смены_И_Отправка


- При нажатии на кнопку спрашивает подтверждение
- После нажатия закрывает доступ к форме
- Ставит ТолькоПросмотр = истина (признак для отправки)
- потом формирует идзаки для продукции,
- Проводит док(В перед записью в модуле объекта код отправляющий в ерп)
- Отображает статус наличия документов в ерп(только что созданных)



 
<details>
    <summary>Код</summary>

## &НаКлиенте Процедура ЗакрытьСмену(Команда)

 
  <details>
    <summary>Код</summary>

        	Режим = РежимДиалогаВопрос.ДаНет;  		
        	Ответ = Вопрос("После закрытия смены Вы не сможете изменять этот документ. Закрыть смену?", Режим,0);     	
        	Ответ = ?(КодВозвратаДиалога.Да=Ответ,истина,ложь);  
        	Если Ответ тогда
        
        		ВключитьТолькоПросмотр(Истина);	 
        		Объект.ТолькоПросмотрПереключатель = истина;           
        		ФормироватьIDZAK();                                               			
        		ПараметрыЗаписи = Новый Структура; ПараметрыЗаписи.Вставить("РежимЗаписи", РежимЗаписиДокумента.Проведение);
        		ЭтаФорма.Записать(ПараметрыЗаписи);
        		ПоставитьГалочкиПриНаличииДокументаERP();    
        		ВидимостьДокументаERP();  
        		
        	Иначе
        		Отказ = не Ответ;
        	КонецЕсли;
        	
        КонецПроцедуры
      
  </details>    


  
## Процедура ФормироватьIdzak()

 
  <details>
    <summary>Код</summary>    

    
      	Для каждого стр из Объект.Продукция цикл    
      		Если Стр.idzak = "" тогда
      			Стр.idzak = ФормированиеРабочихМассивов.ФормированиеIDZak("");	
      		КонецЕсли;
      	КонецЦикла;
      КонецПроцедуры
      
  </details>    

</details>    








