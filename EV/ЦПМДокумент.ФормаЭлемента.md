# Процедуры
## Кнопка ЗаполнитьДень

## Заполнить
процедуры ЗаполнитьНаСервере(День), пересчет выработки дневной смены. День=Истина

<details> <summary> Код</summary> 

  ```
ЗаполнитьНаСервере(Истина); 
	
	Объект.ВолочильщикиДень[0].МетражФакт=Объект.КонформДень.Итог("Метраж");
	Объект.ВолочильщикиДень[0].ВесФакт=Объект.КонформДень.Итог("Вес");
	Объект.ВолочильщикиДень[1].МетражФакт=Объект.ВытяжнойСтанДень.Итог("Метраж"); 	
	Объект.ВолочильщикиДень[1].ВесФакт=Объект.ВытяжнойСтанДень.Итог("Вес"); 
	Объект.ПлавильщикиДень[0].ШихтаФакт=Объект.СработаноШихтыДень;
	
	
	
	Для каждого СтрокаТЧ из Объект.ВолочильщикиДень цикл
		
	КонецЦикла;
	
	Для каждого СтрокаТЧ из Объект.ВолочильщикиДеньСписок цикл
		ВолочильщикиДеньСписокКоличествоЧасовПриИзменении(СтрокаТЧ);
		Коэффициент=1;
		ПосчитатьКоличествоСотрудниковДень();      
		ПосчитатьСтавкуПоФактуВолочильщики();
	КонецЦикла;		
	
	Для каждого СтрокаТЧ из Объект.ПлавильщикиДеньСписок цикл
		ПлавильщикиДеньСписокКоличествоЧасовПриИзменении(СтрокаТЧ);
		Коэффициент=1;
		ПосчитатьСтавкуПоФактуПлавильщики() ;  
		ПосчитатьВыработкуСменыДень();
	КонецЦикла;
```
</details>

## Кнопка ЗаполнитьНочь

## ЗаполнитьНочь

Вызов процедуры ЗаполнитьНаСервере(День), пересчет выработки Ночная Смена День=Ложь
<details> <summary> Код</summary> 

  ```
ЗаполнитьНаСервере(Ложь);//Ночь 
	Объект.ВолочильщикиНочь[0].МетражФакт=Объект.КонформНочь.Итог("Метраж");
	Объект.ВолочильщикиНочь[0].ВесФакт=Объект.КонформНочь.Итог("Вес");
	Объект.ВолочильщикиНочь[1].МетражФакт=Объект.ВытяжнойСтанНочь.Итог("Метраж");
	Объект.ВолочильщикиНочь[1].ВесФакт=Объект.ВытяжнойСтанНочь.Итог("Вес");     
	Объект.ПлавильщикиНочь[0].ШихтаФакт=Объект.СработаноШихтыНочь;
	
	Для каждого СтрокаТЧ из Объект.ВолочильщикиДень цикл
		
	КонецЦикла;
	
	Для каждого СтрокаТЧ из Объект.ВолочильщикиНочьСписок цикл
		ВолочильщикиНочьСписокКоличествоЧасовПриИзменении(СтрокаТЧ);
		Коэффициент=1;
		ПосчитатьКоличествоСотрудниковДень();      
		ПосчитатьСтавкуПоФактуВолочильщики();
	КонецЦикла;
	Для каждого СтрокаТЧ из Объект.ПлавильщикиДеньСписок цикл
		ПлавильщикиДеньСписокКоличествоЧасовПриИзменении(СтрокаТЧ);
		Коэффициент=1;
		ПосчитатьСтавкуПоФактуПлавильщики() ;  
		ПосчитатьВыработкуСменыДень();
	КонецЦикла;
	Для каждого СтрокаТЧ из Объект.ПлавильщикиНочьСписок цикл
		ПлавильщикиНочьСписокКоличествоЧасовПриИзменении(СтрокаТЧ);
		Коэффициент=1;
		ПосчитатьСтавкуПоФактуПлавильщики() ;  
		ПосчитатьВыработкуСменыНочь();
	КонецЦикла;
```

</details>

## ЗаполнитьНаСервере 

 Вызов процедур 
```
  ЗаполнитьКонформ(День); 
	ЗаполнитьСтан(День);  
	ЗаполнитьШихта(День)
```
 
## ЗаполнитьКонформ(День)
Заполнение данных из документа "Сменное задание конформ" для дневной или ночной смены, День=истина - дневная смена, День=ложь, ночная смена
<details> <summary> Код</summary> 

  ```
  Если День тогда
		Для каждого ЭлементКонформ из Объект.КонформДень цикл
			ЭлементКонформ.Метраж=0;
			ЭлементКонформ.Вес=0;		
		КонецЦикла;
	Иначе 
		Для каждого ЭлементКонформ из Объект.КонформНочь цикл
			ЭлементКонформ.Метраж=0;
			ЭлементКонформ.Вес=0;		
		КонецЦикла; 
	КонецЕсли;	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	СменноеЗаданиеКонформ.Дата КАК Дата,
	|	СменноеЗаданиеКонформ.День КАК День,
	|	СменноеЗаданиеКонформЗаданиеМастера.Номенклатура КАК Номенклатура,
	|	СменноеЗаданиеКонформЗаданиеМастера.ДлинаПоФакту КАК ДлинаПоФакту,
	|	СменноеЗаданиеКонформЗаданиеМастера.ВесПоФакту КАК ВесПоФакту,
	|	СменноеЗаданиеКонформ.Волочильщик КАК Волочильщик
	|ИЗ
	|	Документ.СменноеЗаданиеКонформ.ЗаданиеМастера КАК СменноеЗаданиеКонформЗаданиеМастера
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.СменноеЗаданиеКонформ КАК СменноеЗаданиеКонформ
	|		ПО СменноеЗаданиеКонформЗаданиеМастера.Ссылка = СменноеЗаданиеКонформ.Ссылка
	|ГДЕ
	|	СменноеЗаданиеКонформ.Дата = НачалоПериода(&Дата,ДЕНЬ)
	|	И СменноеЗаданиеКонформ.День = &День";
	
	Запрос.УстановитьПараметр("Дата", Объект.ДатаДокумента);
	Запрос.УстановитьПараметр("День", День);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	НомерСтроки=1;//Для заполнения смены
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		Если день тогда
			Отбор=НоВый Структура();
			Отбор.Вставить("Продукция", ВыборкаДетальныеЗаписи.Номенклатура);
			НайденныеСтроки=Объект.КонФормДень.НайтиСтроки(Отбор); 
			Если НайденныеСтроки.Количество()=0 тогда
				НоваяСтрока=Объект.КонформДень.Добавить();
				НоваяСтрока.Продукция=ВыборкаДетальныеЗаписи.Номенклатура;
				НоваяСтрока.Метраж=ВыборкаДетальныеЗаписи.ДлинаПоФакту;
				НоваяСтрока.Вес=ВыборкаДетальныеЗаписи.ВесПоФакту;    			
			Иначе
				Для каждого ЭлементТЧ из НайденныеСтроки цикл
					Объект.КонформДень[ЭлементТЧ.НомерСтроки-1].Метраж=ЭлементТЧ.Метраж+ВыборкаДетальныеЗаписи.ДлинаПоФакту;  
					Объект.КонформДень[ЭлементТЧ.НомерСтроки-1].Вес=ЭлементТЧ.Вес+ВыборкаДетальныеЗаписи.ВесПоФакту;				
				КонецЦикла;
			КонецЕсли;
			Отбор=НоВый Структура();
			Отбор.Вставить("ФИО", ВыборкаДетальныеЗаписи.Волочильщик);
			НайденныеСтроки=Объект.ВолочильщикиДеньСписок.НайтиСтроки(Отбор); 
			Если НайденныеСтроки.Количество()=0 тогда 
				
				Для каждого СтрокаТЧ из Объект.ВолочильщикиДеньСписок цикл
					Если СтрокаТЧ.ФИО=Справочники.СписокСотрудниковИзЕРП.ПустаяСсылка() тогда
						
						СтрокаТЧ.ФИО=ВыборкаДетальныеЗаписи.Волочильщик; 
						СтрокаТЧ.СтавкаПоРазряду=ПолучитьСтавкуПоРазряду(СтрокаТЧ.ФИО);  
						СтрокаТЧ.КоличествоЧасов=12;  
						//ВолочильщикиДеньСписокКоличествоЧасовПриИзменении(Элемент);
						СтрокаТЧ.Коэффициент=1;
						//ПосчитатьКоличествоСотрудниковДень();      
						//ПосчитатьСтавкуПоФактуВолочильщики();  
						Прервать;
					КонецЕсли;
				КонецЦикла;
			КонецЕсли;	
			
		иначе  
			Отбор=НоВый Структура();
			Отбор.Вставить("Продукция", ВыборкаДетальныеЗаписи.Номенклатура);
			НайденныеСтроки=Объект.КонФормНочь.НайтиСтроки(Отбор); 
			Если НайденныеСтроки.Количество()=0 тогда
				НоваяСтрока=Объект.КонформНочь.Добавить();
				НоваяСтрока.Продукция=ВыборкаДетальныеЗаписи.Номенклатура;
				НоваяСтрока.Метраж=ВыборкаДетальныеЗаписи.ДлинаПоФакту;
				НоваяСтрока.Вес=ВыборкаДетальныеЗаписи.ВесПоФакту;    			
			Иначе
				Для каждого ЭлементТЧ из НайденныеСтроки цикл
					Объект.КонформНочь[ЭлементТЧ.НомерСтроки-1].Метраж=ЭлементТЧ.Метраж+ВыборкаДетальныеЗаписи.ДлинаПоФакту;  
					Объект.КонформНочь[ЭлементТЧ.НомерСтроки-1].Вес=ЭлементТЧ.Вес+ВыборкаДетальныеЗаписи.ВесПоФакту;				
				КонецЦикла;
			КонецЕсли; 
			Отбор=НоВый Структура();
			Отбор.Вставить("ФИО", ВыборкаДетальныеЗаписи.Волочильщик);
			НайденныеСтроки=Объект.ВолочильщикиНочьСписок.НайтиСтроки(Отбор); 
			Если НайденныеСтроки.Количество()=0 тогда 
				
				Для каждого СтрокаТЧ из Объект.ВолочильщикиНочьСписок цикл
					Если СтрокаТЧ.ФИО=Справочники.СписокСотрудниковИзЕРП.ПустаяСсылка() тогда
						
						СтрокаТЧ.ФИО=ВыборкаДетальныеЗаписи.Волочильщик; 
						СтрокаТЧ.СтавкаПоРазряду=ПолучитьСтавкуПоРазряду(СтрокаТЧ.ФИО);  
						СтрокаТЧ.КоличествоЧасов=12;  
						СтрокаТЧ.Коэффициент=1;						
						Прервать;
					КонецЕсли;
				КонецЦикла;
			КонецЕсли;			
		КонецЕсли; 	
	КонецЦикла;
```

</details>

## ЗаполнитьСтан(День)
Заполнение данных из документа "Сменное задание стан" для дневной или ночной смены, День=истина - дневная смена, День=ложь, ночная смена


<details>
  <summary> Код</summary> 
  
  ```
Если День тогда
		Для каждого ЭлементКонформ из Объект.ВытяжнойСтанДень цикл
			ЭлементКонформ.Метраж=0;
			ЭлементКонформ.Вес=0;		
		КонецЦикла;
	Иначе 
		Для каждого ЭлементКонформ из Объект.ВытяжнойСтанНочь цикл
			ЭлементКонформ.Метраж=0;
			ЭлементКонформ.Вес=0;		
		КонецЦикла; 
	КонецЕсли;
	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	СменноеЗаданиеСтан.Дата КАК Дата,
	|	СменноеЗаданиеСтан.День КАК День,
	|	СменноеЗаданиеСтанВолочильныйСтан.Номенклатура КАК Номенклатура,
	|	СменноеЗаданиеСтанВолочильныйСтан.Сделано КАК Сделано,
	|	СменноеЗаданиеСтанВолочильныйСтан.ВесГодного КАК ВесГодного,
	|	СменноеЗаданиеСтанПлавильщики.ФИО КАК ФИО
	|ИЗ
	|	Документ.СменноеЗаданиеСтан.ВолочильныйСтан КАК СменноеЗаданиеСтанВолочильныйСтан
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.СменноеЗаданиеСтан КАК СменноеЗаданиеСтан
	|			ПРАВОЕ СОЕДИНЕНИЕ Документ.СменноеЗаданиеСтан.Плавильщики КАК СменноеЗаданиеСтанПлавильщики
	|			ПО СменноеЗаданиеСтанПлавильщики.Ссылка = СменноеЗаданиеСтан.Ссылка
	|		ПО СменноеЗаданиеСтанВолочильныйСтан.Ссылка = СменноеЗаданиеСтан.Ссылка
	|ГДЕ
	|	СменноеЗаданиеСтан.Дата = НачалоПериода(&Дата,ДЕНЬ)
	|	И СменноеЗаданиеСтан.День = &День";
	
	Запрос.УстановитьПараметр("Дата", НачалоДня(Объект.ДатаДокумента));
	Запрос.УстановитьПараметр("День", День);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		Если день тогда
			Отбор=НоВый Структура();
			Отбор.Вставить("Продукция", ВыборкаДетальныеЗаписи.Номенклатура);
			НайденныеСтроки=Объект.ВытяжнойСтанДень.НайтиСтроки(Отбор); 
			Если НайденныеСтроки.Количество()=0 тогда
				НоваяСтрока=Объект.ВытяжнойСтанДень.Добавить();
				НоваяСтрока.Продукция=ВыборкаДетальныеЗаписи.Номенклатура;
				НоваяСтрока.Метраж=ВыборкаДетальныеЗаписи.Сделано;
				НоваяСтрока.Вес=ВыборкаДетальныеЗаписи.ВесГодного;    			
			Иначе
				Для каждого ЭлементТЧ из НайденныеСтроки цикл
					Объект.ВытяжнойСтанДень[ЭлементТЧ.НомерСтроки-1].Метраж=ЭлементТЧ.Метраж+ВыборкаДетальныеЗаписи.Сделано;  
					Объект.ВытяжнойСтанДень[ЭлементТЧ.НомерСтроки-1].Вес=ЭлементТЧ.Вес+ВыборкаДетальныеЗаписи.ВесГодного;				
				КонецЦикла;
			КонецЕсли;
			//Добавление сотрудника
			Отбор=НоВый Структура();
			Отбор.Вставить("ФИО", ВыборкаДетальныеЗаписи.ФИО);
			НайденныеСтроки=Объект.ПлавильщикиДеньСписок.НайтиСтроки(Отбор); 
			Если НайденныеСтроки.Количество()=0 тогда				
				Для каждого СтрокаТЧ из Объект.ПлавильщикиДеньСписок цикл
					Если СтрокаТЧ.ФИО=Справочники.СписокСотрудниковИзЕРП.ПустаяСсылка() тогда
						СтрокаТЧ.ФИО=ВыборкаДетальныеЗаписи.ФИО; 
						СтрокаТЧ.СтавкаПоРазряду=ПолучитьСтавкуПоРазряду(СтрокаТЧ.ФИО);  
						СтрокаТЧ.КоличествоЧасов=12;  
						//ВолочильщикиДеньСписокКоличествоЧасовПриИзменении(Элемент);
						СтрокаТЧ.Коэффициент=1;
						//ПосчитатьКоличествоСотрудниковДень();      
						//ПосчитатьСтавкуПоФактуВолочильщики();  
						Прервать;
					КонецЕсли;
				КонецЦикла;
			КонецЕсли;
		иначе  
			Отбор=НоВый Структура();
			Отбор.Вставить("Продукция", ВыборкаДетальныеЗаписи.Номенклатура);
			НайденныеСтроки=Объект.ВытяжнойСтанНочь.НайтиСтроки(Отбор); 
			Если НайденныеСтроки.Количество()=0 тогда
				НоваяСтрока=Объект.ВытяжнойСтанНочь.Добавить();
				НоваяСтрока.Продукция=ВыборкаДетальныеЗаписи.Номенклатура;
				НоваяСтрока.Метраж=ВыборкаДетальныеЗаписи.Сделано;
				НоваяСтрока.Вес=ВыборкаДетальныеЗаписи.ВесГодного;    			
			Иначе
				Для каждого ЭлементТЧ из НайденныеСтроки цикл
					Объект.ВытяжнойСтанНочь[ЭлементТЧ.НомерСтроки-1].Метраж=ЭлементТЧ.Метраж+ВыборкаДетальныеЗаписи.Сделано;  
					Объект.ВытяжнойСтанНочь[ЭлементТЧ.НомерСтроки-1].Вес=ЭлементТЧ.Вес+ВыборкаДетальныеЗаписи.ВесГодного;				
				КонецЦикла;
			КонецЕсли;
			//Добавление сотрудника
			Отбор=НоВый Структура();
			Отбор.Вставить("ФИО", ВыборкаДетальныеЗаписи.ФИО);
			НайденныеСтроки=Объект.ПлавильщикиНочьСписок.НайтиСтроки(Отбор); 
			Если НайденныеСтроки.Количество()=0 тогда				
				Для каждого СтрокаТЧ из Объект.ПлавильщикиНочьСписок цикл
					Если СтрокаТЧ.ФИО=Справочники.СписокСотрудниковИзЕРП.ПустаяСсылка() тогда
						СтрокаТЧ.ФИО=ВыборкаДетальныеЗаписи.ФИО; 
						СтрокаТЧ.СтавкаПоРазряду=ПолучитьСтавкуПоРазряду(СтрокаТЧ.ФИО);  
						СтрокаТЧ.КоличествоЧасов=12;  
						СтрокаТЧ.Коэффициент=1;
						Прервать;
					КонецЕсли;
				КонецЦикла;
			КонецЕсли;
			
		КонецЕсли;
		
	КонецЦикла;
  
```
</details>

## ЗаполнитьШихта
Заполнение данных из документа "Учет материала" для дневной или ночной смены, День= истина - дневная смена, День=ложь, ночная смена
<details>
  <summary> Код</summary> 
  
  ```
Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЦПМ_УчетМатериалаЗагружено.Ссылка КАК Ссылка,
	|	ЦПМ_УчетМатериалаЗагружено.ВесСырья КАК ВесСырья,
	|	ЦПМ_УчетМатериалаЗагружено.ВесОтходы КАК ВесОтходы,
	|	ЦПМ_УчетМатериала.Дата КАК Дата,
	|	ЦПМ_УчетМатериала.День КАК День
	|ИЗ
	|	Документ.ЦПМ_УчетМатериала.Загружено КАК ЦПМ_УчетМатериалаЗагружено
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЦПМ_УчетМатериала КАК ЦПМ_УчетМатериала
	|		ПО ЦПМ_УчетМатериалаЗагружено.Ссылка = ЦПМ_УчетМатериала.Ссылка
	|ГДЕ
	|	ЦПМ_УчетМатериала.Дата = НачалоПериода(&Дата,ДЕНЬ)
	|	И ЦПМ_УчетМатериала.День = &День";
	
	Запрос.УстановитьПараметр("Дата", НачалоДня(Объект.ДатаДокумента));
	Запрос.УстановитьПараметр("День", День);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Вес=0;
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		Вес=Вес+ВыборкаДетальныеЗаписи.ВесСырья+ВыборкаДетальныеЗаписи.ВесОтходы;		
	КонецЦикла;	
	Если День тогда
		Объект.СработаноШихтыДень=Вес;
	Иначе 
		Объект.СработаноШихтыНочь=Вес;
	КонецЕсли;

```
</details>

## Роли
Особых ролей не требует
