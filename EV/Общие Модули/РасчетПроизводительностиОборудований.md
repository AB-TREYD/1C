## Расчет чистой производительности
<details>
  <summary>Расчет чистой производительности</summary>
  
 
  ## Функция  РасчетЧистойПроизводительности(НомерЭтапа, ДанныеПоЭтапам, ПараметрыЗаказа) Экспорт  
<details>
  <summary> Код </summary>

      //НомерЭтапа - это НЕ индекс массива, отличается на +1	
    	ВидОперации = ДанныеПоЭтапам[НомерЭтапа-1][15];                    
    	НазваниеОборудования = ДанныеПоЭтапам[НомерЭтапа-1][1];
    	НашСправочник = Справочники.НоменклатураОборудований.НайтиПоНаименованию(НазваниеОборудования).ПолучитьОбъект();
    
    	Для каждого СтрокаТЧ из НашСправочник.ВидыОпераций Цикл
    		Если СтрокаТЧ.ВидОперации = ВидОперации Тогда
    			КодФуРасМат = СтрокаТЧ.КодФункцииРассчётаМатериалов;		
    			Прервать;
    		КонецЕсли;	
    	КонецЦикла;	                    
    	
    	
    	
    	
    	Если КодФуРасМат = 0 Тогда
    		Сообщить("Ошибка 60: Нет функции расчета чистой производительности. Общие модули: РасчетПроизводительностиОборудований->РасчетЧистойПроизводительности->" + НазваниеОборудования + " IDZak " + ПараметрыЗаказа[0]);
    	ИначеЕсли КодФуРасМат = "1" Тогда	//ОбмоткаАлюмофлексом КодФуРасМат = 1;      	
    		Производительность = РасчетЧистойПроизводительности_01(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа); 
    	ИначеЕсли КодФуРасМат = "2" Тогда	//ОбмоткаБроней КодФуРасМат = 2;
    		Производительность = РасчетЧистойПроизводительности_02(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа);  
    	ИначеЕсли КодФуРасМат = "3" Тогда	//Волочение КодФуРасМат = 3;
    		Производительность = РасчетЧистойПроизводительности_03(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа);  
    	ИначеЕсли КодФуРасМат = "4" Тогда	//Заполнение КодФуРасМат = 4;
    		Производительность = РасчетЧистойПроизводительности_04(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа); 			
    	ИначеЕсли КодФуРасМат = "5" или КодФуРасМат = "22"Тогда //Изоляция КодФуРасМат = 5; //Изоляция3слоя КодФуРасМат = 22;  
    		//ВНИМАНИЕ!!!!!!!!!!!! ВЫНЕСТИ В ОТДЕЛЬНУЮ ФУНКЦИЮ И ДОРАБОТАТЬ С УЧЕТОМ РАЗДЕЛЕНИЯ ДЛЯ 70 И 90 ПРЕССА!!! 
    		Производительность = РасчетЧистойПроизводительности_05_22(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа); 			
    	ИначеЕсли КодФуРасМат = "6" или КодФуРасМат = "21" или КодФуРасМат = "19" Тогда   
    		//ОболочкаКруглый КодФуРасМат = 6;	//ЗаполнениеИОболочка КодФуРасМат = 21;	//ОболочкаШлангом КодФуРасМат = 19;
    		Производительность = РасчетЧистойПроизводительности_06_21_19(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа,КодФуРасМат); 	
    	ИначеЕсли КодФуРасМат = "7" Тогда	//ОболочкаПлоский КодФуРасМат = 7;	
    		Производительность = РасчетЧистойПроизводительности_07(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа); 	
    	ИначеЕсли КодФуРасМат = "20" Тогда	//ОболочкаПлоскийШлангом КодФуРасМат = 20;
    		Производительность = РасчетЧистойПроизводительности_20(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа); 		
    	ИначеЕсли КодФуРасМат = "8" Тогда   //ОбщаяСкрутка КодФуРасМат = 8;
    		Производительность = РасчетЧистойПроизводительности_08(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа); 	
    	ИначеЕсли КодФуРасМат = "9" Тогда   //СкруткаТПЖ КодФуРасМат = 9;			
    		Производительность = РасчетЧистойПроизводительности_09(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа); 	
    	ИначеЕсли КодФуРасМат = "10" Тогда
    		Производительность = РасчетЧистойПроизводительности_10(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа); 
    	ИначеЕсли КодФуРасМат = "11" Тогда //Обмотка1Слой КодФуРасМат = 11;
    		Производительность = РасчетЧистойПроизводительности_11(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа); 
    	ИначеЕсли КодФуРасМат = "12" Тогда //Мультик КодФуРасМат = 12;	
    		Производительность = РасчетЧистойПроизводительности_12(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа); 
    	ИначеЕсли КодФуРасМат = "13" Тогда //СкруткаСтренги КодФуРасМат = 13;		
    		Производительность = РасчетЧистойПроизводительности_13(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа); 
    	ИначеЕсли КодФуРасМат = "15" Тогда	//Обмотка2Слоя КодФуРасМат = 15;		
    		Производительность = РасчетЧистойПроизводительности_15(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа); 
    	ИначеЕсли КодФуРасМат = "17" Тогда //ОбмоткаПроволочнымЭкраном КодФуРасМат = 17;		
    		Производительность = РасчетЧистойПроизводительности_17(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа); 
    	ИначеЕсли КодФуРасМат = "18" Тогда  //ОбщаяСкрутка6кВ КодФуРасМат = 18;
    		Производительность = РасчетЧистойПроизводительности_18(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа); 
    	ИначеЕсли КодФуРасМат = "16" Тогда	//ОбмоткаПроволочнойБронёй КодФуРасМат = 16;
    		Производительность = РасчетЧистойПроизводительности_16(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа); 
    	ИначеЕсли КодФуРасМат = "30" Тогда	//Изоляция2слоя КодФуРасМат = 30;    
    		Производительность = РасчетЧистойПроизводительности_30(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа); 
    	ИначеЕсли КодФуРасМат = "31" Тогда	//ИзготовлениеСердечника КодФуРасМат = 31;    
    		Производительность = РасчетЧистойПроизводительности_31(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа);
    	ИначеЕсли КодФуРасМат = "32" Тогда	//ОбщаяСкруткаСЛентообмоткой 	КодФуРасМат = 32;   
    		Производительность = РасчетЧистойПроизводительности_32(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа);
    	ИначеЕсли КодФуРасМат = "33" Тогда  //ИзоляцияСердечника КодФуРасМат = 33;  	
    		Производительность = РасчетЧистойПроизводительности_33(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа);
    	КонецЕсли;
    	
    	
    	Возврат Производительность;
    КонецФункции 
</details>
  
  ##  Функция РасчетЧистойПроизводительности_СкруткаСтренги(ПараметрыЗаказа,ДанныеПоЭтапам,НомерЭтапа) экспорт

<details>
  <summary>Код</summary>

      Стр= Новый Структура;
    	Стр.Вставить("НаименованиеОперацииПоисковое",Перечисления.ВидОперации.СкруткаТПЖ);//в справочнике заведена производительность под СтруткуТПЖ, см. строку ниже
    	Стр.Вставить("НаименованиеОперации",ДанныеПоЭтапам[НомерЭтапа-1][15]);
    	Стр.Вставить("НазваниеОборудования",ДанныеПоЭтапам[НомерЭтапа-1][1]);
    	Стр.Вставить("IDZak",ПараметрыЗаказа[0]);
    	Стр.Вставить("КолЗарСтренг",Число(ПараметрыЗаказа[10]+ПараметрыЗаказа[78]));
    	Стр.Вставить("НомерЭтапа",Строка(ДанныеПоЭтапам[НомерЭтапа-1][2]));
    	Стр.Вставить("НомерСчёта",ПараметрыЗаказа[24]);
    	Стр.Вставить("КоличествоКилометров",ДанныеПоЭтапам[НомерЭтапа-1][5]);
    	Стр.Вставить("КоличествоПроволоки",ПараметрыЗаказа[10]*ПараметрыЗаказа[11]+ПараметрыЗаказа[78]*ПараметрыЗаказа[79]);    	
    	Стр.Вставить("НаименованиеОперации2",ДанныеПоЭтапам[НомерЭтапа-2][15]);
    	Стр.Вставить("НазваниеОборудования2",ДанныеПоЭтапам[НомерЭтапа-2][1]);
    	Стр.Вставить("НомерЭтапа2",Строка(ДанныеПоЭтапам[НомерЭтапа-2][2]));
    	
    	Если ДанныеПоЭтапам[НомерЭтапа-1][18]=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой тогда //Кабель плюсовой
    		Стр.Вставить("КоличествоЖил",ПараметрыЗаказа[38]);                                                             
    		ДиаметрПроволокиИзПараметровЗаказа = Справочники.СправочникДиаметрыПроволки.НайтиПоНаименованию(Число(ПараметрыЗаказа[36])); 
    	ИначеЕсли ДанныеПоЭтапам[НомерЭтапа-1][18]=Перечисления.ОсновнойПлюсовойСуммарный.Спомогательный тогда
    		Стр.Вставить("КоличествоЖил",ПараметрыЗаказа[84]);                                 
    		ДиаметрПроволокиИзПараметровЗаказа = Справочники.СправочникДиаметрыПроволки.НайтиПоНаименованию(Число(ПараметрыЗаказа[93])); 
    	Иначе	
    		Стр.Вставить("КоличествоЖил",ПараметрыЗаказа[2]);       
    		ДиаметрПроволокиИзПараметровЗаказа = Справочники.СправочникДиаметрыПроволки.НайтиПоНаименованию(Число(ПараметрыЗаказа[3])); 
    	КонецЕсли;
    	Стр.Вставить("ДиаметрПроволоки",ДанныеПоЭтапам[НомерЭтапа-1][3]);//Берём данные с предыдущего этапа, на конец этапа
    	
    	Производительность = 0;
    	//ШагСкрутки:
    	//КоэфициентШагаСкрутки
    	КоэфШагаСкрутки = 18;
    	//ДиамертПоСкруткеПервогоПовива
    	ШагСкрутки = Стр.ДиаметрПроволоки * КоэфШагаСкрутки;		
    	Запрос = Новый Запрос;
    	Запрос.Текст = 
    	"ВЫБРАТЬ
    	|	ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования,
    	|	ЛинейныеСкоростиОборудований.ДиаметрПроволокиОт КАК ДиаметрПроволокиОт,
    	|	ЛинейныеСкоростиОборудований.ДиаметрПроволоки КАК ДиаметрПроволоки,
    	|	ЛинейныеСкоростиОборудований.КоличествоПроволоки КАК КоличествоПроволоки
    	|ИЗ
    	|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
    	|ГДЕ
    	|	ЛинейныеСкоростиОборудований.НаименованиеОборудования = &НаименованиеОборудования
    	|	И ЛинейныеСкоростиОборудований.ВидОперации = &НаименованиеОперации
    	|	И ЛинейныеСкоростиОборудований.ДиаметрПроволоки = &ДиаметрПроволоки
    	|	И ЛинейныеСкоростиОборудований.КоличествоПроволоки = &КоличествоПроволоки";		
    	Запрос.УстановитьПараметр("НаименованиеОборудования", Стр.НазваниеОборудования);
    	Запрос.УстановитьПараметр("НаименованиеОперации", Стр.НаименованиеОперацииПоисковое);
    	Запрос.УстановитьПараметр("ДиаметрПроволоки", ДиаметрПроволокиИзПараметровЗаказа);
    	Запрос.УстановитьПараметр("КоличествоПроволоки", Стр.КоличествоПроволоки);
    	РезультатЗапроса = Запрос.Выполнить();
    	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
    	НормаРасходаНайдена = Ложь;
    	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
    		СкоростьПервогоФонаря = ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;	
    		НормаРасходаНайдена  = Истина;	
    	КонецЦикла;		
    	Если НормаРасходаНайдена = Ложь Тогда
    		Сообщить("Ошибка 613: Не найдена скорость первого фонаря в Производительность оборудования: " + Стр.НазваниеОборудования + " название операции:" + Строка(ДанныеПоЭтапам[НомерЭтапа-1][15]));
    		Стр.Вставить("ЧистоеВремя",0);
    		Стр.Вставить("Производительность",0);
    		Производительность = Стр;
    		Возврат Производительность;	
    	Иначе
    	КонецЕсли;                                      		
    	ЛинейнаяСкорость = 2 * СкоростьПервогоФонаря * ШагСкрутки / 1000;//Данную скорость надо записывать в документ, для проверки в будущем с фактическими скоростями из SCADA		
    	Стр.Вставить("ЛинейнаяСкорость",ЛинейнаяСкорость);
    	Стр.Вставить("ОсновнойПлюсовой",ДанныеПоЭтапам[НомерЭтапа-1][18]);     //01,09,23
    	Производительность = ПоискПроизводительностиСУчетомРазбивкиЗаказа_СкруткаСтренги(Стр);	
    	Возврат Производительность; //Структура
    КонецФункции 
</details>

##  Функция РасчетЧистойПроизводительности_ОбщаяСкрутка(НомерЭтапа, ДанныеПоЭтапам, ПараметрыЗаказа) //КодФуРасМат = 8

<details>
<summary>Код</summary>  
  
    	НаименованиеОперации = Перечисления.ВидОперации.ОбщаяСкрутка;
    	НазваниеОборудования = ДанныеПоЭтапам[НомерЭтапа-1][1];
    	ВидОперации = ДанныеПоЭтапам[НомерЭтапа-1][15];
    	КоличествоЖил = ПараметрыЗаказа[2];
    	КоличествоКилометров = ДанныеПоЭтапам[НомерЭтапа-1][5];
    	Производительность = 0;
    	Запрос = Новый Запрос;	
    	Если НазваниеОборудования.Наименование = "Крутильная машина № 006 Бугель ХМ 1000/1+5" Тогда  //ПРОВЕРИТЬ!!!!!!!!!!!!!!!!!!
    		//В справочнике берем сразу линейную скорость (метры в минуту), единую для всех
    		Запрос.Текст = 
    		"ВЫБРАТЬ
    		|	ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования
    		|ИЗ
    		|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
    		|ГДЕ
    		|	ЛинейныеСкоростиОборудований.НаименованиеОборудования = &НаименованиеОборудования
    		|	И ЛинейныеСкоростиОборудований.ВидОперации = &НаименованиеОперации";		
    		Запрос.УстановитьПараметр("НаименованиеОборудования", НазваниеОборудования);
    		Запрос.УстановитьПараметр("НаименованиеОперации", НаименованиеОперации);
    		РезультатЗапроса = Запрос.Выполнить();
    		ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
    		НормаРасходаНайдена = Ложь;
    		Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
    			ЛинейнаяСкорость = ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
    			НормаРасходаНайдена  = Истина;	
    		КонецЦикла;			
     	ИначеЕсли НазваниеОборудования.Наименование = "Крутильная машина № 007 Бугель ХМ 1600/1+5" Тогда  //ПРОВЕРИТЬ!!!!
    		//В справочнике берем линейную скорость (метры в минуту), в зависимости от сечения
    		Сечение = Число(ПараметрыЗаказа[4]);
    		Запрос.Текст = 
    		"ВЫБРАТЬ
    		|	ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования
    		|ИЗ
    		|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
    		|ГДЕ
    		|	ЛинейныеСкоростиОборудований.НаименованиеОборудования = &НаименованиеОборудования
    		|	И ЛинейныеСкоростиОборудований.Сечение = &СечениеДо
    		|	И ЛинейныеСкоростиОборудований.ВидОперации = &НаименованиеОперации";		
    		Если Сечение < 51 Тогда
    			Запрос.УстановитьПараметр("СечениеДо", 50);
    		Иначе
    			Запрос.УстановитьПараметр("СечениеДо", 1000);
    		КонецЕсли;
    		Запрос.УстановитьПараметр("НаименованиеОборудования", НазваниеОборудования);
    		Запрос.УстановитьПараметр("НаименованиеОперации", НаименованиеОперации);
    		РезультатЗапроса = Запрос.Выполнить();
    		ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
    		НормаРасходаНайдена = Ложь;
    		Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
    			ЛинейнаяСкорость = ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
    			НормаРасходаНайдена  = Истина;	
    		КонецЦикла;	
    	Иначе 
    		//тут расчёт ведется от оборотов первого фонаря
    		Запрос.Текст = 
    		"ВЫБРАТЬ
    		|	ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования
    		|ИЗ
    		|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
    		|ГДЕ
    		|	ЛинейныеСкоростиОборудований.НаименованиеОборудования = &НаименованиеОборудования
    		|	И ЛинейныеСкоростиОборудований.ВидОперации = &НаименованиеОперации";		
    		Запрос.УстановитьПараметр("НаименованиеОборудования", НазваниеОборудования);
    		Запрос.УстановитьПараметр("НаименованиеОперации", НаименованиеОперации);    
    		
    		//Двойная скрутка №40
    		Если НазваниеОборудования.Наименование = "Крутильная машина № 040 Двойной скрутки типа SH-BS1250" Тогда
    			
    			Запрос.Текст=Запрос.Текст +Символы.ПС+ "	И ЛинейныеСкоростиОборудований.Материал = &ИспользуемыйМеталл"+Символы.ПС +" И ЛинейныеСкоростиОборудований.Сечение = &Сечение";			Если СтрНайти(нрег(ДанныеПоЭтапам[0][20].Наименование),"алюм") тогда
    				ИспользуемыйМеталл = Справочники.НоменклатураМатериалов.НайтиПоКоду("000000007");//алюм	
    			Иначе
    				ИспользуемыйМеталл = Справочники.НоменклатураМатериалов.НайтиПоКоду("000000024");	//медь	
    			КонецЕсли; 	
    			Запрос.УстановитьПараметр("ИспользуемыйМеталл",ИспользуемыйМеталл);
    			Запрос.УстановитьПараметр("Сечение",число(ПараметрыЗаказа[4]));
    			
    		КонецЕсли;
    		
    		
    		
    		РезультатЗапроса = Запрос.Выполнить();
    		ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
    		НормаРасходаНайдена = Ложь;
    		Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
    			СкоростьПервогоФонаря = ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
    			НормаРасходаНайдена  = Истина;	
    		КонецЦикла;		
    		Если НормаРасходаНайдена = Ложь Тогда
    			Сообщить("Ошибка 68: Не найдена скорость первого фонаря в Производительность оборудования: " + НазваниеОборудования + " название операции:" + НаименованиеОперации);
    			Возврат Производительность;	
    		Иначе
    		КонецЕсли;
    		//ШагСкрутки:
    		//КоэфициентШагаСкрутки
    		КоэфШагаСкрутки = 22;     //???????????????????????ПОЧЕМУ всегда 22?????????????
    		//ДиамертПоСкруткеПервогоПовива	
    		ЦентрЖгут = ПараметрыЗаказа[67];
    		
    		Если ДанныеПоЭтапам[НомерЭтапа][18]=Перечисления.ОсновнойПлюсовойСуммарный.Суммарный тогда
    			//КоличествоЖилСуммарный=Число(ПараметрыЗаказа[2])+Число(ПараметрыЗаказа[38]);
    			//КоэффициентДляПервогоФонаря = Справочники.ДиаметрыПоСкрутке.НайтиПоНаименованию(КоличествоЖилСуммарный).КоэффициентДляПервогоФонаря;
    			//+21,09,22
    			ДиамНачОсновной = Число(ДанныеПоЭтапам[ПараметрыЗаказа[42]][3]);
    			ДиамНачПлюсовой = Число(ДанныеПоЭтапам[ПараметрыЗаказа[41]][3]);
    			ДиамНачВспомогательный = Число(ДанныеПоЭтапам[ПараметрыЗаказа[41]][3]);
    			КолЖилПлюсовой = Число(ПараметрыЗаказа[38]);
    			КолЖилОсновной = Число(ПараметрыЗаказа[2]);
    			КолЖилВспомогательный = Число(ПараметрыЗаказа[2]);
    			ОбщееКолЖил = КолЖилПлюсовой + КолЖилОсновной + КолЖилВспомогательный;  
    			ДиаметрПроволоки = Число(((ДиамНачОсновной * КолЖилОсновной)+(ДиамНачПлюсовой * КолЖилПлюсовой)+(ДиамНачВспомогательный * КолЖилВспомогательный)+ЦентрЖгут)/ОбщееКолЖил);   					
    			КоэффициентДляПервогоФонаря = Справочники.ДиаметрыПоСкрутке.НайтиПоНаименованию(ОбщееКолЖил).КоэффициентДляПервогоФонаря;
    			//-21,09
    			
    		Иначе
    			КоличествоЖил = ПараметрыЗаказа[2];
    			ДиаметрПроволоки = (ДанныеПоЭтапам[НомерЭтапа-2][3]+ЦентрЖгут);
    			Если ЦентрЖгут>0 тогда ДиаметрПроволоки = ДиаметрПроволоки/число(КоличествоЖил)+1 КонецЕсли;
    			КоэффициентДляПервогоФонаря = Справочники.ДиаметрыПоСкрутке.НайтиПоНаименованию(КоличествоЖил).КоэффициентДляПервогоФонаря;
    		КонецЕсли;		
    		ДиамертПоСкруткеПервогоПовива = ДиаметрПроволоки * КоэффициентДляПервогоФонаря;
    		ШагСкрутки = ДиамертПоСкруткеПервогоПовива * КоэфШагаСкрутки;		
    		ЛинейнаяСкорость = СкоростьПервогоФонаря * ШагСкрутки / 1000;//Данную скорость надо записывать в документ, для проверки в будущем с фактическими скоростями из SCADA, метры в минуту для бугеля 1000		
    	Конецесли;	
    	Если НормаРасходаНайдена Тогда
    		Производительность = (КоличествоКилометров * 1000) / ЛинейнаяСкорость;
    	Иначе
    		Сообщить("Ошибка 68: Не найдена линейная скорость, метры в минуту," + " название операции:" + НаименованиеОперации);
    	КонецЕсли;	
    	Возврат Производительность;
    КонецФункции
</details>

  ##  Функция РасчетЧистойПроизводительности_Изоляция(НомерЭтапа, ДанныеПоЭтапам, ПараметрыЗаказа,ДлинаКускаИзВыработки) экспорт

  
<details>
<summary>Код</summary>
 
        //Определяем последовательно потребность на 1КМ каждого из материалов, далее находим в справочнике НормуРасхода и Считаем время, за которое мы должны изготовить кабель
      	//Выполняем эту операцию по каждому материалу,сравнивая полученные времена, возвращая самое длительное время
      	Стр= Новый Структура;
      	Стр.Вставить("НаименованиеОперации",ДанныеПоЭтапам[НомерЭтапа-1][15]);
      	Стр.Вставить("НазваниеОборудования",ДанныеПоЭтапам[НомерЭтапа-1][1]);
      	Стр.Вставить("IDZak",ПараметрыЗаказа[0]);
      	Стр.Вставить("НомерЭтапа",Строка(ДанныеПоЭтапам[НомерЭтапа-1][2]));
      	Стр.Вставить("НомерСчёта",ПараметрыЗаказа[24]);
      	Стр.Вставить("КоличествоКилометров",ДанныеПоЭтапам[НомерЭтапа-1][5]);
      	Если ДанныеПоЭтапам[НомерЭтапа-1][18]=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой тогда //Кабель плюсовой
      		Стр.Вставить("КоличествоЖил",ПараметрыЗаказа[38]);
      		ИспЖил = Справочники.ИсполнениеЖилы.НайтиПоНаименованию(ПараметрыЗаказа[39]);
      	ИначеЕсли ДанныеПоЭтапам[НомерЭтапа-1][18]=Перечисления.ОсновнойПлюсовойСуммарный.Спомогательный тогда //Кабель плюсовой
      		Стр.Вставить("КоличествоЖил",ПараметрыЗаказа[84]);   
      		ИспЖил = Справочники.ИсполнениеЖилы.НайтиПоНаименованию(ПараметрыЗаказа[86]);
      	Иначе
      		Стр.Вставить("КоличествоЖил",ПараметрыЗаказа[2]);      
      		ИспЖил = Справочники.ИсполнениеЖилы.НайтиПоНаименованию(ПараметрыЗаказа[7]);
      	КонецЕсли;
      	
      	Производительность = 0;
      	Запрос = Новый Запрос;
      	Запрос.Текст = 
      	"ВЫБРАТЬ
      	|	ПотребностиПоМатериалам.НормаНа1КМ КАК НормаНа1КМ,
      	|	ПотребностиПоМатериалам.НаименованиеМатериала КАК НаименованиеМатериала,
      	|	ПотребностиПоМатериалам.ПлюсовойКабель КАК ПлюсовойКабель
      	|ИЗ
      	|	РегистрСведений.ПотребностиПоМатериалам КАК ПотребностиПоМатериалам
      	|ГДЕ
      	|	ПотребностиПоМатериалам.IDZak = &IDZak
      	|	И ПотребностиПоМатериалам.НомерЭтапа = &НомерЭтапа";		
      	Запрос.УстановитьПараметр("IDZak", Строка(Стр.IDZak));
      	Запрос.УстановитьПараметр("НомерЭтапа", Стр.НомерЭтапа);
      	РезультатЗапроса = Запрос.Выполнить();
      	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
      	Если ВыборкаДетальныеЗаписи.Количество()>0 Тогда	
      		//Один, два, или три материала
      		Пока ВыборкаДетальныеЗаписи.Следующий() Цикл     		                                                  			
      			Если ДанныеПоЭтапам[НомерЭтапа-1][18]=ВыборкаДетальныеЗаписи.ПлюсовойКабель тогда
      				Стр.Вставить("Материал", ВыборкаДетальныеЗаписи.НаименованиеМатериала);
      				Стр.Вставить("НормаНа1КМ", ВыборкаДетальныеЗаписи.НормаНа1КМ);                                  			
      				Стр.Вставить("ИсполнениеЖилы", ИспЖил);  //Должна быть ссылка
      				Если Стр.НазваниеОборудования.Наименование = "Экструзионная линия № 009 ХМ 70/25" или Стр.НазваниеОборудования.Наименование = "Экструзионная линия № 001 ХМ 90/25" Тогда
      					//70 или 90 пресс        
      					Стр.Вставить("ДлинаКускаИзВыработки",ДлинаКускаИзВыработки);
      					Стр.Вставить("ОсновнойПлюсовой",ДанныеПоЭтапам[НомерЭтапа-1][18]);   //01,09,23
      					Производительность = РасчетЧистогоВремениИзоляции70или90пресс(Стр);	   
      				Иначе
      					Стр.Вставить("НормаРасходаМатериала",ПоискНормыРасходаИзоляции(Стр));                                  			
      					Если Стр.НормаРасходаМатериала = 0 Тогда
      					ИначеЕсли Производительность = 0 Тогда
      						Производительность = ((Стр.НормаНа1КМ/Стр.НормаРасходаМатериала)*Стр.КоличествоКилометров)/Стр.КоличествоЖил;
      					Иначе
      						ЗатратыВремениСледующегоМатериала = ((Стр.НормаНа1КМ/Стр.НормаРасходаМатериала)*Стр.КоличествоКилометров)/Стр.КоличествоЖил; 	
      						Если ЗатратыВремениСледующегоМатериала > Производительность Тогда
      							Производительность = ЗатратыВремениСледующегоМатериала;
      						КонецЕсли;
      					КонецЕсли;
      				КонецЕсли;
      			КонецЕсли;						
      		КонецЦикла;		
      	Иначе
      		Сообщить("Ошибка 65.1: Не найдена норма на 1 КМ на ИЗОЛЯЦИИ в Потребностях по материалам, перезапишите заказ " + Стр.НомерСчёта);		
      	КонецЕсли; 	
      	Возврат Производительность;
      КонецФункции
</details>

##  Функция РасчетЧистогоВремениИзоляции70или90пресс(Стр) Экспорт

  
<details>
<summary>Код</summary>
  
        //ТД1--004833/3
      	//Материал всегда один
      	Производительность = 0;         
      	Если стр.ДлинаКускаИзВыработки>0 тогда
      		ТЧкуски=Новый таблицаЗначений;
      		ТЧкуски.Колонки.Добавить("ДлинаКуска");	
      		ТЧКуски.Вставить(0).ДлинаКуска=стр.ДлинаКускаИзВыработки;   
      		стр.Вставить("ТЧкуски",ТчКуски);
      		ЕстьКуски=Истина;
      	иначе
      		ЕстьКуски = ПолучитьТаблицуЗначенийКусковЗаказа(Стр);        
      	КонецЕсли;	
      	Если ЕстьКуски Тогда
      		Для каждого Кусок из Стр.ТЧКуски Цикл
      			Если Кусок.ДлинаКуска > 3 Тогда
      				Стр.Вставить("РазмерКусков",0);					
      			Иначе
      				Стр.Вставить("РазмерКусков",3);		
      			КонецЕсли;
      			Стр.Вставить("НормаРасходаМатериала",ПоискНормыРасходаИзоляции(Стр));
      			Если Не Стр.НормаРасходаМатериала = 0 Тогда
      				ЧистоеВремяИзготовленияКуска =((Стр.НормаНа1КМ/Стр.НормаРасходаМатериала)*Кусок.ДлинаКуска)/Стр.КоличествоЖил; 
      			Иначе                           
      				ЧистоеВремяИзготовленияКуска = 0;
      				Сообщить("Ошибка 65.2: Не найдена норма расхода в Производительность оборудования: " + Стр.НазваниеОборудования + " название операции:" + Стр.НаименованиеОперации + " наименомание материала: " + Стр.Материал);
      			КонецЕсли;
      			Производительность = Производительность + ЧистоеВремяИзготовленияКуска;			
      		КонецЦикла;
      	Иначе
      	КонецЕсли;
      	Возврат Производительность;
      КонецФункции
</details>

  ##  Функция РасчетЧистойПроизводительности_СкруткаСердечника(ПараметрыЗаказа,ДанныеПоЭтапам,НомерЭтапа) экспорт

<details>
<summary>Код</summary>
  
      Стр= Новый Структура;
    	Стр.Вставить("НаименованиеОперацииПоисковое",Перечисления.ВидОперации.СкруткаТПЖ);//в справочнике заведена производительность под СтруткуТПЖ, см. строку ниже
    	Стр.Вставить("НаименованиеОперации",ДанныеПоЭтапам[НомерЭтапа-1][15]);
    	Стр.Вставить("НазваниеОборудования",ДанныеПоЭтапам[НомерЭтапа-1][1]);
    	Стр.Вставить("IDZak",ПараметрыЗаказа[0]);
    	Стр.Вставить("КолЗарСтренг",Число(ПараметрыЗаказа[10]+ПараметрыЗаказа[78]));
    	Стр.Вставить("НомерЭтапа",Строка(ДанныеПоЭтапам[НомерЭтапа-1][2]));
    	Стр.Вставить("НомерСчёта",ПараметрыЗаказа[24]);
    	Стр.Вставить("КоличествоКилометров",ДанныеПоЭтапам[НомерЭтапа-1][5]);
    	Стр.Вставить("КоличествоПроволоки",ПараметрыЗаказа[10]*ПараметрыЗаказа[11]+ПараметрыЗаказа[78]*ПараметрыЗаказа[79]);    	
    	Стр.Вставить("НаименованиеОперации2",ДанныеПоЭтапам[НомерЭтапа-2][15]);
    	Стр.Вставить("НазваниеОборудования2",ДанныеПоЭтапам[НомерЭтапа-2][1]);
    	Стр.Вставить("НомерЭтапа2",Строка(ДанныеПоЭтапам[НомерЭтапа-2][2]));
    	
    	
    	Если ДанныеПоЭтапам[НомерЭтапа-1][18]=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой тогда //Кабель плюсовой
    		Стр.Вставить("КоличествоЖил",ПараметрыЗаказа[38]);                                                             
    		ДиаметрПроволокиИзПараметровЗаказа = Справочники.СправочникДиаметрыПроволки.НайтиПоНаименованию(Число(ПараметрыЗаказа[36])); 
    	ИначеЕсли ДанныеПоЭтапам[НомерЭтапа-1][18]=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой тогда //Кабель плюсовой
    		Стр.Вставить("КоличествоЖил",ПараметрыЗаказа[84]);                                 
    		ДиаметрПроволокиИзПараметровЗаказа = Справочники.СправочникДиаметрыПроволки.НайтиПоНаименованию(Число(ПараметрыЗаказа[93])); 
    	Иначе	
    		Стр.Вставить("КоличествоЖил",ПараметрыЗаказа[2]);       
    		ДиаметрПроволокиИзПараметровЗаказа = Справочники.СправочникДиаметрыПроволки.НайтиПоНаименованию(Число(ПараметрыЗаказа[3])); 
    	КонецЕсли;
    	Стр.Вставить("ДиаметрПроволоки",ДанныеПоЭтапам[НомерЭтапа-1][3]);//Берём данные с предыдущего этапа, на конец этапа
    	
    	Производительность = 0;
    	//ШагСкрутки:
    	//КоэфициентШагаСкрутки
    	КоэфШагаСкрутки = 18;
    	//ДиамертПоСкруткеПервогоПовива
    	ШагСкрутки = Стр.ДиаметрПроволоки * КоэфШагаСкрутки;		
    	Запрос = Новый Запрос;
    	Запрос.Текст = 
    	"ВЫБРАТЬ
    	|	ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования,
    	|	ЛинейныеСкоростиОборудований.ДиаметрПроволокиОт КАК ДиаметрПроволокиОт,
    	|	ЛинейныеСкоростиОборудований.ДиаметрПроволоки КАК ДиаметрПроволоки,
    	|	ЛинейныеСкоростиОборудований.КоличествоПроволоки КАК КоличествоПроволоки
    	|ИЗ
    	|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
    	|ГДЕ
    	|	ЛинейныеСкоростиОборудований.НаименованиеОборудования = &НаименованиеОборудования
    	|	И ЛинейныеСкоростиОборудований.ВидОперации = &НаименованиеОперации
    	|	И ЛинейныеСкоростиОборудований.ДиаметрПроволоки = &ДиаметрПроволоки
    	|	И ЛинейныеСкоростиОборудований.КоличествоПроволоки = &КоличествоПроволоки";		
    	Запрос.УстановитьПараметр("НаименованиеОборудования", Стр.НазваниеОборудования);
    	Запрос.УстановитьПараметр("НаименованиеОперации", Стр.НаименованиеОперацииПоисковое);
    	Запрос.УстановитьПараметр("ДиаметрПроволоки", ДиаметрПроволокиИзПараметровЗаказа);
    	Запрос.УстановитьПараметр("КоличествоПроволоки", Стр.КоличествоПроволоки);
    	РезультатЗапроса = Запрос.Выполнить();
    	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
    	НормаРасходаНайдена = Ложь;
    	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
    		СкоростьПервогоФонаря = ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;	
    		НормаРасходаНайдена  = Истина;	
    	КонецЦикла;		
    	Если НормаРасходаНайдена = Ложь Тогда
    		Сообщить("Ошибка 613: Не найдена скорость первого фонаря в Производительность оборудования: " + Стр.НазваниеОборудования + " название операции:" + Строка(ДанныеПоЭтапам[НомерЭтапа-1][15]));
    		Стр.Вставить("ЧистоеВремя",0);
    		Стр.Вставить("Производительность",0);
    		Производительность = Стр;
    		Возврат Производительность;	
    	Иначе
    	КонецЕсли;                                      		
    	ЛинейнаяСкорость = 2 * СкоростьПервогоФонаря * ШагСкрутки / 1000;//Данную скорость надо записывать в документ, для проверки в будущем с фактическими скоростями из SCADA		
    	Стр.Вставить("ЛинейнаяСкорость",ЛинейнаяСкорость);
    	Стр.Вставить("ОсновнойПлюсовой",ДанныеПоЭтапам[НомерЭтапа-1][18]);     //01,09,23
    	Производительность = ПоискПроизводительностиСУчетомРазбивкиЗаказа_СкруткаСтренги(Стр);	
    	Возврат Производительность; //Структура
    КонецФункции 
</details>

## Область Функции_расчета
<details>
  <summary>Код</summary>
         
//	-|- Справка по кодам Функций расчета материалов

//	-|-	ОбмоткаАлюмофлексом  		= 1;

//	-|-	ОбмоткаБроней 				= 2;			

//	-|-	Волочение 					= 3;

//	-|-	Заполнение 					= 4;

//	-|-	Изоляция 					= 5;

//	-|-	ОболочкаКруглый 			= 6;

//	-|-	ОболочкаПлоский 			= 7;	

//	-|-	ОбщаяСкрутка 				= 8;	

//	-|-	СкруткаТПЖ 					= 9;	

//	-|-	Обмотка1Слой 				= 11;

//	-|-	ВолочениеМультивайер 		= 12;	

//	-|-	СкруткаСтренги 				= 13;		

//	-|-	Обмотка2Слоя 				= 15;

//	-|-	ОбмоткаПроволочнойБронёй 	= 16;

//	-|-	ОбмоткаПроволочнымЭкраном 	= 17;

//	-|-	ОбщаяСкрутка6кВ 			= 18;

//	-|-	ОболочкаШлангом 			= 19;

//	-|-	ОболочкаПлоскийШлангом 		= 20;

//	-|-	ЗаполнениеИОболочка 		= 21;

//	-|-	Изоляция3слоя 				= 22;  

//	-|-	Изоляция2слоя 				= 30;    

//	-|-	ИзготовлениеСердечника 		= 31;    

//	-|-	ОбщаяСкруткаСЛентообмоткой 	= 32;   

//	-|-	ИзоляцияСердечника 			= 33;  

## Функция РасчетЧистойПроизводительности_01(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа)  

<details>
<summary>Код</summary>

      НазваниеОборудования = ДанныеПоЭтапам[НомерЭтапа-1][1];
    	ВидОперации = ДанныеПоЭтапам[НомерЭтапа-1][15];
    	КоличествоКилометров = ДанныеПоЭтапам[НомерЭтапа-1][5];
    	Запрос = Новый Запрос;
    	
    	Если ВидОперации = Перечисления.ВидОперации.ОбмоткаАлюмофлексом И НазваниеОборудования = Справочники.НоменклатураОборудований.НайтиПоНаименованию("Крутильная машина № 007 Бугель ХМ 1600/1+5")  Тогда
    		Если ПараметрыЗаказа[7] = "мс" Тогда
    			ИсполнениеЖилы = Справочники.ИсполнениеЖилы.НайтиПоНаименованию("мк");
    		Иначе
    			ИсполнениеЖилы = Справочники.ИсполнениеЖилы.НайтиПоНаименованию(ПараметрыЗаказа[7]);
    		КонецЕсли;
    		Запрос.Текст = 
    		"ВЫБРАТЬ
    		|	ВЫБОР
    		|		КОГДА &ПараметрыЗаказаСечение МЕЖДУ ЛинейныеСкоростиОборудований.СечениеОт И ЛинейныеСкоростиОборудований.Сечение
    		|			ТОГДА ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования
    		|	ИНАЧЕ 0
    		|	КОНЕЦ КАК ЛинейнаяСкоростьОборудования
    		|ИЗ
    		|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
    		|ГДЕ
    		|	ЛинейныеСкоростиОборудований.НаименованиеОборудования = &НаименованиеОборудования
    		|	И ЛинейныеСкоростиОборудований.ВидОперации = &НаименованиеОперации
    		|	И ЛинейныеСкоростиОборудований.ИсполнениеЖилы = &ИсполнениеЖилы";		
    		Запрос.УстановитьПараметр("НаименованиеОборудования", НазваниеОборудования);
    		Запрос.УстановитьПараметр("НаименованиеОперации", ВидОперации);
    		Запрос.УстановитьПараметр("ПараметрыЗаказаСечение",Число(ПараметрыЗаказа[4]));
    		Запрос.УстановитьПараметр("ИсполнениеЖилы",ИсполнениеЖилы);
    		РезультатЗапроса = Запрос.Выполнить().Выгрузить();
    		РезультатЗапроса.Сортировать("ЛинейнаяСкоростьОборудования УБЫВ");
    		ЛинейнаяСкорость = РезультатЗапроса[0].ЛинейнаяСкоростьОборудования;
    		ЛинейнаяСкоростьНайдена = Ложь;
    		Если ЛинейнаяСкорость <> 0 Тогда
    			ЛинейнаяСкоростьНайдена  = Истина;
    		КонецЕсли;
    	Иначе
    		НаименованиеОперации = Перечисления.ВидОперации.ОбмоткаАлюмофлексом;	
    		Запрос.Текст = 
    		"ВЫБРАТЬ
    		|	ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования
    		|ИЗ
    		|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
    		|ГДЕ
    		|	ЛинейныеСкоростиОборудований.НаименованиеОборудования = &НаименованиеОборудования
    		|	И ЛинейныеСкоростиОборудований.ВидОперации = &НаименованиеОперации";
    		Запрос.УстановитьПараметр("НаименованиеОборудования", НазваниеОборудования);	
    		Запрос.УстановитьПараметр("НаименованиеОперации", НаименованиеОперации);
    		РезультатЗапроса = Запрос.Выполнить();
    		ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
    		ЛинейнаяСкоростьНайдена = Ложь;
    		Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
    			ЛинейнаяСкорость = ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
    			ЛинейнаяСкоростьНайдена  = Истина;	
    		КонецЦикла;			
    	КонецЕсли;
    	Если ЛинейнаяСкоростьНайдена = Ложь Тогда
    		Сообщить("Ошибка 61: Общие модули. Расчёт производительности оборудований. РегистрСведений ВолочениеСкорости. Не найдена линейная скорость оборудования " + НазваниеОборудования + "Вид операции: " + НаименованиеОперации);
    	Иначе
    		Производительность = Окр(КоличествоКилометров/(ЛинейнаяСкорость/1000)); //время выполнения в минутах
    		Возврат Производительность;
    		
    	КонецЕсли;		
    КонецФункции
</details>

## Функция РасчетЧистойПроизводительности_02(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа) 


<details>
<summary>Код</summary>

        //НомерЭтапа - это НЕ индекс массива, отличается на +1	
      	НазваниеОборудования = ДанныеПоЭтапам[НомерЭтапа-1][1];
      	КоличествоКилометров = ДанныеПоЭтапам[НомерЭтапа-1][5];
      	Запрос = Новый Запрос;
      	
      	//Бронеобмотчик
      	НаименованиеОперации = Перечисления.ВидОперации.ОбмоткаБроней;	
      	ШиринаБрони = Число(Прав(ДанныеПоЭтапам[НомерЭтапа-1][20].Наименование, 2));
      	Запрос.Текст = 
      	"ВЫБРАТЬ
      	|	ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования
      	|ИЗ
      	|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
      	|ГДЕ
      	|	ЛинейныеСкоростиОборудований.НаименованиеОборудования = &НаименованиеОборудования
      	|	И ЛинейныеСкоростиОборудований.ВидОперации = &НаименованиеОперации		
      	|	И ЛинейныеСкоростиОборудований.ШиринаБрони = &ШиринаБрони";
      	Запрос.УстановитьПараметр("НаименованиеОборудования", НазваниеОборудования);	
      	Запрос.УстановитьПараметр("НаименованиеОперации", НаименованиеОперации);
      	Запрос.УстановитьПараметр("ШиринаБрони", ШиринаБрони);
      	РезультатЗапроса = Запрос.Выполнить();
      	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
      	ЛинейнаяСкоростьНайдена = Ложь;
      	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
      		ЛинейнаяСкорость = ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
      		ЛинейнаяСкоростьНайдена  = Истина;	
      	КонецЦикла;		
      	Если ЛинейнаяСкоростьНайдена = Ложь Тогда
      		Сообщить("Ошибка 62: Общие модули. Расчёт производительности оборудований. РегистрСведений ВолочениеСкорости. Не найдена линейная скорость волочения " + НазваниеОборудования);
      	Иначе
      		Производительность = Окр(КоличествоКилометров/(ЛинейнаяСкорость/1000)); //время выполнения в минутах
      		Возврат Производительность;
      	КонецЕсли;	
      	
      КонецФункции   
</details>


## Функция РасчетЧистойПроизводительности_03(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа)  


<details>
<summary>Код</summary>
 
      //Волочение // метров в секунду
    	//24,01,22
    	//НомерЭтапа - это НЕ индекс массива, отличается на +1	
    	НазваниеОборудования = ДанныеПоЭтапам[НомерЭтапа-1][1];	
    	КоличествоКилометров = ДанныеПоЭтапам[НомерЭтапа-1][5];
    	Запрос = Новый Запрос;
    	Если ПараметрыЗаказа[22] = "" или ПараметрыЗаказа[22] = "0" Тогда
    		ДиаметрПроволоки = Справочники.СправочникДиаметрыПроволки.НайтиПоНаименованию("2,08"); //изменено 29.09.2021, было: ПараметрыЗаказа[3];	
    	Иначе
    		ДиаметрПроволоки = Справочники.СправочникДиаметрыПроволки.НайтиПоНаименованию(ПараметрыЗаказа[22]); //диаметр проволки для расчета потребности в металле, дальше - обычный
    	КонецЕсли; 
    	//Если плюсовой
    	Если ДанныеПоЭтапам[НомерЭтапа-1][18]	=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой тогда
    		Если ПараметрыЗаказа[37] = "" или ПараметрыЗаказа[37] = "0" Тогда
    			ДиаметрПроволокиПлюсовой = Справочники.СправочникДиаметрыПроволки.НайтиПоНаименованию("2,080"); 
    		Иначе
    			ДиаметрПроволокиПлюсовой = Справочники.СправочникДиаметрыПроволки.НайтиПоНаименованию(СтрЗаменить(ПараметрыЗаказа[37],".",",")); 
    		КонецЕсли;
    	КонецЕсли;
    	
    	//++Данилова 21.12 Если вспомогательный
    	Если ДанныеПоЭтапам[НомерЭтапа-1][18]	=Перечисления.ОсновнойПлюсовойСуммарный.Спомогательный тогда
    		ДиаметрПроволокиВспомогательный = Справочники.СправочникДиаметрыПроволки.НайтиПоНаименованию("2,050");
    	КонецЕсли;
    	//-Данилова
    	
    	//-24,01,22
    	Запрос.Текст = 
    	"ВЫБРАТЬ
    	|	ЛинейныеСкоростиОборудованийСрезПоследних.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования
    	|ИЗ
    	|	РегистрСведений.ЛинейныеСкоростиОборудований.СрезПоследних КАК ЛинейныеСкоростиОборудованийСрезПоследних
    	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.СправочникДиаметрыПроволки КАК СправочникДиаметрыПроволки
    	|		ПО ЛинейныеСкоростиОборудованийСрезПоследних.ДиаметрПроволоки = СправочникДиаметрыПроволки.Ссылка
    	|ГДЕ
    	|	ЛинейныеСкоростиОборудованийСрезПоследних.НаименованиеОборудования = &НаименованиеОборудования И
    	|	ЛинейныеСкоростиОборудованийСрезПоследних.Материал.НаименованиеИзERP подобно &Материал И
    	|	ЛинейныеСкоростиОборудованийСрезПоследних.ДиаметрПроволоки = &ДиаметрПроволоки";		
    	Запрос.УстановитьПараметр("Материал", ДанныеПоЭтапам[НомерЭтапа-1][20].НаименованиеИзERP); //Тут используемый материал на этапе + 20.09.2021
    	Запрос.УстановитьПараметр("НаименованиеОборудования", НазваниеОборудования);				
    	Если ДанныеПоЭтапам[НомерЭтапа-1][18]	=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой тогда   
    		Запрос.УстановитьПараметр("ДиаметрПроволоки", ДиаметрПроволокиПлюсовой);             
    	ИначеЕсли ДанныеПоЭтапам[НомерЭтапа-1][18]	=Перечисления.ОсновнойПлюсовойСуммарный.Спомогательный тогда
    		Запрос.УстановитьПараметр("ДиаметрПроволоки", ДиаметрПроволокиВспомогательный);			
    	ИначеЕсли ДанныеПоЭтапам[НомерЭтапа-1][18]=Перечисления.ОсновнойПлюсовойСуммарный.Основной или ДанныеПоЭтапам[НомерЭтапа-1][18]=Перечисления.ОсновнойПлюсовойСуммарный.ПустаяСсылка() тогда
    		Запрос.УстановитьПараметр("ДиаметрПроволоки", ДиаметрПроволоки); 
    	КонецЕсли;				
    	РезультатЗапроса = Запрос.Выполнить();
    	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
    	ЛинейнаяСкоростьНайдена = Ложь;
    	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
    		ЛинейнаяСкорость = ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
    		ЛинейнаяСкоростьНайдена = Истина;	
    	КонецЦикла;
    	Если ЛинейнаяСкоростьНайдена = Ложь Тогда
    		Сообщить("Ошибка 63: Общие модули. Расчёт производительности оборудований. РегистрСведений ВолочениеСкорости. Не найдена линейная скорость волочения " + НазваниеОборудования);
    	Иначе
    		Производительность = Окр(((КоличествоКилометров)/((ЛинейнаяСкорость*60/1000)*60))*60,2); //время выполнения в минутах
    		Возврат Производительность;	
    	КонецЕсли;	 
    КонецФункции
</details>

## Функция РасчетЧистойПроизводительности_04(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа)  


<details>
<summary>Код</summary>
  
      	//НомерЭтапа - это НЕ индекс массива, отличается на +1	
      	НазваниеОборудования = ДанныеПоЭтапам[НомерЭтапа-1][1];	
      	КоличествоКилометров = ДанныеПоЭтапам[НомерЭтапа-1][5];
      	Запрос = Новый Запрос;	
      	НаименованиеОперации = Перечисления.ВидОперации.Заполнение;
      	IDZak = ПараметрыЗаказа[0];
      	Запрос.Текст = 
      	"ВЫБРАТЬ
      	|	ПотребностиПоМатериалам.НормаНа1КМ КАК НормаНа1КМ,
      	|	ПотребностиПоМатериалам.НаименованиеМатериала КАК НаименованиеМатериала
      	|ИЗ
      	|	РегистрСведений.ПотребностиПоМатериалам КАК ПотребностиПоМатериалам
      	|ГДЕ
      	|	ПотребностиПоМатериалам.IDZak = &IDZak
      	|	И ПотребностиПоМатериалам.НомерЭтапа = &НомерЭтапа";		
      	Запрос.УстановитьПараметр("IDZak", Строка(IDZak));
      	
      	Если ПараметрыЗаказа[29]=Истина тогда
      		Запрос.УстановитьПараметр("НомерЭтапа", Строка(ДанныеПоЭтапам[НомерЭтапа-1][2]));
      	Иначе
      		Запрос.УстановитьПараметр("НомерЭтапа", Строка(НомерЭтапа));
      	КонецЕсли;
      	РезультатЗапроса = Запрос.Выполнить();
      	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
      	НормаНа1КгНайдена = Ложь;
      	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
      		Материал = ВыборкаДетальныеЗаписи.НаименованиеМатериала;
      		НормаНа1Кг = ВыборкаДетальныеЗаписи.НормаНа1КМ;
      		НормаНа1КгНайдена = Истина;			
      	КонецЦикла;		
      	Если НормаНа1КгНайдена = Ложь Тогда
      		Сообщить("Ошибка 64.1: Не найдена норма на 1 КГ в Потребностях по материалам, перезапишите заказ " + IDZak);
      	Иначе
      	КонецЕсли;
      	//Теперь находим нормуРасхода материала на оборудовании из РегистраСведений.ЛинейныеСкоростиОборудований
      	Запрос.Текст = 
      	"ВЫБРАТЬ
      	|	ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования
      	|ИЗ
      	|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
      	|ГДЕ
      	|	ЛинейныеСкоростиОборудований.НаименованиеОборудования = &НаименованиеОборудования
      	|	И ЛинейныеСкоростиОборудований.ВидОперации = &НаименованиеОперации
      	|	И ЛинейныеСкоростиОборудований.Материал.НаименованиеИзERP подобно &Материал";		
      	Запрос.УстановитьПараметр("НаименованиеОборудования", НазваниеОборудования);
      	Запрос.УстановитьПараметр("НаименованиеОперации", НаименованиеОперации);
      	Запрос.УстановитьПараметр("Материал", Материал.НаименованиеИзERP);
      	РезультатЗапроса = Запрос.Выполнить();
      	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
      	НормаРасходаНайдена = Ложь;
      	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
      		НормаРасходаМатериала = ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
      		НормаРасходаНайдена  = Истина;	
      	КонецЦикла;		
      	Если НормаРасходаНайдена = Ложь Тогда
      		Сообщить("Ошибка 64.2: Не найдена норма расхода в Производительность оборудования: " + НазваниеОборудования + " название операции:" + НаименованиеОперации + " наименомание материала: " + Материал);
      	Иначе
      	КонецЕсли;
      	//Считаем Производительность: НормаНа1Кг(кг/км)/НормаРасходаМатериала(кг/мин)*ДлинаЗаказа(км)
      	Производительность = (НормаНа1Кг/НормаРасходаМатериала)*КоличествоКилометров;		
      	Возврат Производительность;
      КонецФункции
</details>

## Функция РасчетЧистойПроизводительности_05_22(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа)  


<details>
<summary>Код</summary>
 
        //изоляция //метры в минуту
      	//По номеру этапа и айди заказа найдём запись РегистрыСведений.ПотребностиПоМатериалам и возьмем там норму
      	Производительность = РасчетЧистойПроизводительности_Изоляция(НомерЭтапа, ДанныеПоЭтапам, ПараметрыЗаказа,0);   
      	Возврат Производительность;
      КонецФункции
      
</details>

## Функция РасчетЧистойПроизводительности_06_21_19(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа,КодФуРасМат)  


<details>
<summary>Код</summary>
  
    	//НомерЭтапа - это НЕ индекс массива, отличается на +1	
    	НазваниеОборудования = ДанныеПоЭтапам[НомерЭтапа-1][1];		
    	КоличествоКилометров = ДанныеПоЭтапам[НомерЭтапа-1][5];
    	Запрос = Новый Запрос;
    	Если КодФуРасМат = "21" тогда
    		НаименованиеОперации = Перечисления.ВидОперации.ЗаполнениеИОболочка;
    	ИначеЕсли КодФуРасМат = "19" тогда
    		НаименованиеОперации = Перечисления.ВидОперации.ОболочкаШлангом;
    	Иначе
    		НаименованиеОперации = Перечисления.ВидОперации.ОболочкаКруглый; 
    	КонецЕсли;
    	//Оболочка Не Плоский, или Оболочка и Заполнение не плоский
    	//Тут может быть два материала!!!!!!		
    	//По номеру этапа и айди заказа найдём запись РегистрыСведений.ПотребностиПоМатериалам и возьмем там норму
    	IDZak = ПараметрыЗаказа[0];		
    	Запрос.Текст = 
    	"ВЫБРАТЬ
    	|	ПотребностиПоМатериалам.НормаНа1КМ КАК НормаНа1КМ,
    	|	ПотребностиПоМатериалам.НаименованиеМатериала КАК НаименованиеМатериала
    	|ИЗ
    	|	РегистрСведений.ПотребностиПоМатериалам КАК ПотребностиПоМатериалам
    	|ГДЕ
    	|	ПотребностиПоМатериалам.IDZak = &IDZak
    	|	И ПотребностиПоМатериалам.НомерЭтапа = &НомерЭтапа";		
    	Запрос.УстановитьПараметр("IDZak", Строка(IDZak));
    	Запрос.УстановитьПараметр("НомерЭтапа", Строка(ДанныеПоЭтапам[НомерЭтапа-1][2]));
    	РезультатЗапроса = Запрос.Выполнить();
    	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
    	НормаНа1КгНайдена = Ложь;		
    	Если ВыборкаДетальныеЗаписи.Количество() > 1 тогда
    		//Материалов на этапе больше 1 		
    		Производительность = 0;
    		Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
    			НормаНа1Кг = ВыборкаДетальныеЗаписи.НормаНа1КМ;
    			Материал = ВыборкаДетальныеЗаписи.НаименованиеМатериала;
    			ЗапросНормРасходаМатериалаПоОборудованиям = Новый Запрос;
    			ЗапросНормРасходаМатериалаПоОборудованиям.Текст = 
    			"ВЫБРАТЬ
    			|	ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования,
    			|	ЛинейныеСкоростиОборудований.Материал КАК Материал
    			|ИЗ
    			|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
    			|ГДЕ
    			|	ЛинейныеСкоростиОборудований.НаименованиеОборудования = &НаименованиеОборудования
    			|	И ЛинейныеСкоростиОборудований.ВидОперации = &НаименованиеОперации
    			|	И ЛинейныеСкоростиОборудований.Материал = &Материал";		
    			ЗапросНормРасходаМатериалаПоОборудованиям.УстановитьПараметр("НаименованиеОборудования", НазваниеОборудования);
    			ЗапросНормРасходаМатериалаПоОборудованиям.УстановитьПараметр("НаименованиеОперации", НаименованиеОперации);
    			ЗапросНормРасходаМатериалаПоОборудованиям.УстановитьПараметр("Материал", Материал);
    			РезультатЗапросНормРасходаМатериалаПоОборудованиям = ЗапросНормРасходаМатериалаПоОборудованиям.Выполнить();
    			ВыборкаДетальныеЗаписиЗапросНормРасходаМатериалаПоОборудованиям = РезультатЗапросНормРасходаМатериалаПоОборудованиям.Выбрать();
    			НормаРасходаНайдена = Ложь;
    			Пока ВыборкаДетальныеЗаписиЗапросНормРасходаМатериалаПоОборудованиям.Следующий() Цикл
    				Материал = ВыборкаДетальныеЗаписиЗапросНормРасходаМатериалаПоОборудованиям.Материал;
    				НормаРасходаМатериала = ВыборкаДетальныеЗаписиЗапросНормРасходаМатериалаПоОборудованиям.ЛинейнаяСкоростьОборудования;
    				НормаРасходаНайдена  = Истина;	
    			КонецЦикла;		
    			Если НормаРасходаНайдена = Ложь Тогда
    				Сообщить("Ошибка 66.1: Не найдена норма расхода в Производительность оборудования: " + НазваниеОборудования + " название операции:" + НаименованиеОперации + " наименомание материала: " + Материал);
    				Возврат Производительность;	
    			Иначе
    			КонецЕсли;
    			//Считаем Производительность: НормаНа1Кг(кг/км)/НормаРасходаМатериала(кг/мин)*ДлинаЗаказа(км)
    			Если Производительность = 0 Тогда 
    				Производительность = (НормаНа1Кг/НормаРасходаМатериала)*ДанныеПоЭтапам[НомерЭтапа-1][5]; //Проверить!!!!!!!!!!!!!!!!!!!!???????????		
    			Иначе
    				//считаем 2 материал:
    				Если Производительность > (НормаНа1Кг/НормаРасходаМатериала)*КоличествоКилометров Тогда 
    				Иначе
    					Производительность = (НормаНа1Кг/НормаРасходаМатериала)*КоличествоКилометров;
    				КонецЕсли;					
    			КонецЕсли;    			
    		КонецЦикла;
    	Иначе                                                               			
    		//сначала тут заполнение, а потом сюда приходит оболочка, если они делаются отдельно
    		Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
    			Материал = ВыборкаДетальныеЗаписи.НаименованиеМатериала;
    			НормаНа1Кг = ВыборкаДетальныеЗаписи.НормаНа1КМ;
    			НормаНа1КгНайдена = Истина;	
    		КонецЦикла;
    		Если НормаНа1КгНайдена = Ложь Тогда
    			Сообщить("Ошибка 66.2: Не найдена норма на 1 КГ в Потребностях по материалам, перезапишите заказ " + IDZak);
    			Возврат Производительность;	
    		Иначе
    		КонецЕсли;
    		//Теперь находим нормуРасхода материала на оборудовании из РегистраСведений.ЛинейныеСкоростиОборудований
    		Запрос.Текст = 
    		"ВЫБРАТЬ
    		|	ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования
    		|ИЗ
    		|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
    		|ГДЕ
    		|	ЛинейныеСкоростиОборудований.НаименованиеОборудования = &НаименованиеОборудования
    		|	И ЛинейныеСкоростиОборудований.ВидОперации = &НаименованиеОперации
    		|	И ЛинейныеСкоростиОборудований.Материал.НаименованиеИзERP подобно &Материал";		
    		Запрос.УстановитьПараметр("НаименованиеОборудования", НазваниеОборудования);
    		Запрос.УстановитьПараметр("НаименованиеОперации", НаименованиеОперации);
    		Запрос.УстановитьПараметр("Материал", Материал.НаименованиеИзERP);
    		РезультатЗапроса = Запрос.Выполнить();
    		ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
    		НормаРасходаНайдена = Ложь;
    		Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
    			НормаРасходаМатериала = ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
    			НормаРасходаНайдена  = Истина;	
    		КонецЦикла;		
    		Если НормаРасходаНайдена = Ложь Тогда
    			Сообщить("Ошибка 66.3: Не найдена норма расхода в Производительность оборудования: " + НазваниеОборудования + " название операции:" + НаименованиеОперации + " наименомание материала: " + Материал);
    			Возврат Производительность;	
    		Иначе
    		КонецЕсли;
    		//Считаем Производительность: НормаНа1Кг(кг/км)/НормаРасходаМатериала(кг/мин)*ДлинаЗаказа(км)
    		Производительность = (НормаНа1Кг/НормаРасходаМатериала)*КоличествоКилометров; //Проверить!!!!!!!!!!!!!!!!!!!!???????????		
    	КонецЕсли;	  
    	Возврат Производительность;
	
    КонецФункции  
</details>

## Функция РасчетЧистойПроизводительности_07(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа)  

<details>
<summary>Код</summary>
  
    	//НомерЭтапа - это НЕ индекс массива, отличается на +1	
    	НазваниеОборудования = ДанныеПоЭтапам[НомерЭтапа-1][1];
    	КоличествоКилометров = ДанныеПоЭтапам[НомерЭтапа-1][5];
    	Запрос = Новый Запрос;
    	//Оболочка плоский		
    	//По номеру этапа и айди заказа найдём запись РегистрыСведений.ПотребностиПоМатериалам и возьмем там норму
    	НаименованиеОперации = Перечисления.ВидОперации.ОболочкаПлоский;
    	IDZak = ПараметрыЗаказа[0];
    	Запрос.Текст = 
    	"ВЫБРАТЬ
    	|	ПотребностиПоМатериалам.НормаНа1КМ КАК НормаНа1КМ,
    	|	ПотребностиПоМатериалам.НаименованиеМатериала КАК НаименованиеМатериала
    	|ИЗ
    	|	РегистрСведений.ПотребностиПоМатериалам КАК ПотребностиПоМатериалам
    	|ГДЕ
    	|	ПотребностиПоМатериалам.IDZak = &IDZak
    	|	И ПотребностиПоМатериалам.НомерЭтапа = &НомерЭтапа";		
    	Запрос.УстановитьПараметр("IDZak", Строка(IDZak));
    	Запрос.УстановитьПараметр("НомерЭтапа", Строка(НомерЭтапа));
    	РезультатЗапроса = Запрос.Выполнить();
    	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
    	НормаНа1КгНайдена = Ложь;
    	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
    		Материал = ВыборкаДетальныеЗаписи.НаименованиеМатериала;
    		НормаНа1Кг = ВыборкаДетальныеЗаписи.НормаНа1КМ;
    		НормаНа1КгНайдена = Истина;	
    	КонецЦикла;		
    	Если НормаНа1КгНайдена = Ложь Тогда
    		Сообщить("Ошибка 67.1: Не найдена норма на 1 КГ в Потребностях по материалам, перезапишите заказ " + IDZak);
    	КонецЕсли;
    	//Теперь находим нормуРасхода материала на оборудовании из РегистраСведений.ЛинейныеСкоростиОборудований
    	Запрос.Текст = 
    	"ВЫБРАТЬ
    	|	ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования
    	|ИЗ
    	|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
    	|ГДЕ
    	|	ЛинейныеСкоростиОборудований.НаименованиеОборудования = &НаименованиеОборудования
    	|	И ЛинейныеСкоростиОборудований.ВидОперации = &НаименованиеОперации
    	|	И ЛинейныеСкоростиОборудований.Материал.НаименованиеИзERP подобно &Материал";		
    	Запрос.УстановитьПараметр("НаименованиеОборудования", НазваниеОборудования);
    	Запрос.УстановитьПараметр("НаименованиеОперации", НаименованиеОперации);
    	Запрос.УстановитьПараметр("Материал", Материал.НаименованиеИзERP);
    	РезультатЗапроса = Запрос.Выполнить();
    	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
    	НормаРасходаНайдена = Ложь;
    	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
    		НормаРасходаМатериала = ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
    		НормаРасходаНайдена  = Истина;	
    	КонецЦикла;		
    	Если НормаРасходаНайдена = Ложь Тогда
    		Сообщить("Ошибка 67.2: Не найдена норма расхода в Производительность оборудования: " + НазваниеОборудования + " название операции:" + НаименованиеОперации + " наименомание материала: " + Материал);
    	КонецЕсли;
    	//Считаем Производительность: НормаНа1Кг(кг/км)/НормаРасходаМатериала(кг/мин)*ДлинаЗаказа(км)
    	Производительность = (НормаНа1Кг/НормаРасходаМатериала)*КоличествоКилометров; //Проверить!!!!!!!!!!!!!!!!!!!!???????????	
    	Возврат Производительность;
    КонецФункции
</details>

##  Функция РасчетЧистойПроизводительности_08(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа)  


<details>
<summary>Код</summary>
    	
          Производительность = РасчетЧистойПроизводительности_ОбщаяСкрутка(НомерЭтапа, ДанныеПоЭтапам, ПараметрыЗаказа);
        	Возврат Производительность;
        КонецФункции
        
</details>

## Функция РасчетЧистойПроизводительности_09(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа) 


<details>
<summary>Код</summary>
  
    	
      //НомерЭтапа - это НЕ индекс массива, отличается на +1	
      НазваниеОборудования = ДанныеПоЭтапам[НомерЭтапа-1][1];
      ВидОперации = ДанныеПоЭтапам[НомерЭтапа-1][15];
      КоличествоКилометров = ДанныеПоЭтапам[НомерЭтапа-1][5];
      Запрос = Новый Запрос;
      
      
      //Скрутка ТПЖ (скрутка медь)  
      //Рассчитаем линейную скорость
      //Сначала скорость первого фонаря, в запросе линейная скорость это Скорость первого фонаря
      НаименованиеОперации = Перечисления.ВидОперации.СкруткаТПЖ;
      Запрос.Текст = 
      "ВЫБРАТЬ
      |	ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования,
      |	ЛинейныеСкоростиОборудований.ДиаметрПроволоки КАК ДиаметрПроволоки,
      |	ЛинейныеСкоростиОборудований.ДиаметрПроволокиОт КАК ДиаметрПроволокиОт
      |ИЗ
      |	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
      |ГДЕ
      |	ЛинейныеСкоростиОборудований.НаименованиеОборудования = &НаименованиеОборудования
      |	И ЛинейныеСкоростиОборудований.ВидОперации = &НаименованиеОперации";		
      Запрос.УстановитьПараметр("НаименованиеОборудования", НазваниеОборудования);
      Запрос.УстановитьПараметр("НаименованиеОперации", НаименованиеОперации);              
      //Если оборудование ДС 40 тогда отбор по диаметру ОТ и ДО
      
      Если НазваниеОборудования.Наименование = "Крутильная машина № 040 Двойной скрутки типа SH-BS1250" Тогда
        Запрос.Текст=Запрос.Текст +Символы.ПС+ 
        "	И ЛинейныеСкоростиОборудований.Материал = &ИспользуемыйМеталл";
        Если СтрНайти(нрег(ДанныеПоЭтапам[0][20].Наименование),"алюм") тогда
          ИспользуемыйМеталл = Справочники.НоменклатураМатериалов.НайтиПоКоду("000000007");//алюм	
        Иначе
          ИспользуемыйМеталл = Справочники.НоменклатураМатериалов.НайтиПоКоду("000000024");	//медь	
        КонецЕсли; 	
        
        Запрос.УстановитьПараметр("ИспользуемыйМеталл",ИспользуемыйМеталл);			
      КонецЕсли;
      
      КоличествоПроволочныхЖил=ПараметрыЗаказа[9];                       
      ДиаметрДляСкоростиПервогоФонаря = число(ПараметрыЗаказа[3]);
      Если ДанныеПоЭтапам[НомерЭтапа-1][18]=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой тогда
        КоличествоПроволочныхЖил=ПараметрыЗаказа[33];	                
        ДиаметрДляСкоростиПервогоФонаря = число(ПараметрыЗаказа[36]);
      ИначеЕсли ДанныеПоЭтапам[НомерЭтапа-1][18]=Перечисления.ОсновнойПлюсовойСуммарный.Спомогательный тогда
        КоличествоПроволочныхЖил=ПараметрыЗаказа[88];	
        ДиаметрДляСкоростиПервогоФонаря = число(ПараметрыЗаказа[93]);
      КонецЕсли;
    
      
      РезультатЗапроса = Запрос.Выполнить();
      ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
      НормаРасходаНайдена = Ложь;
      Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
        Если НазваниеОборудования.Наименование = "Крутильная машина № 040 Двойной скрутки типа SH-BS1250" Тогда
          Если ДиаметрДляСкоростиПервогоФонаря >= число(ВыборкаДетальныеЗаписи.ДиаметрПроволокиОт.Наименование) и ДиаметрДляСкоростиПервогоФонаря <= число(ВыборкаДетальныеЗаписи.ДиаметрПроволоки.Наименование) тогда
            СкоростьПервогоФонаря = ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
            НормаРасходаНайдена  = Истина;	           
            Прервать;
          КонецЕсли;
        Иначе
          СкоростьПервогоФонаря = ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
          НормаРасходаНайдена  = Истина;  			
        КонецЕсли; 
      КонецЦикла;		
      Если НормаРасходаНайдена = Ложь Тогда
        Сообщить("Ошибка 69: Не найдена скорость первого фонаря в Производительность оборудования: " + НазваниеОборудования + " название операции:" + НаименованиеОперации);
      КонецЕсли;
      //ШагСкрутки:
      //КоэфициентШагаСкрутки 
      
      Если КоличествоПроволочныхЖил = 7 тогда			
        КоэфШагаСкрутки = 22;//18; 14.02.2023
      ИначеЕсли КоличествоПроволочныхЖил = 19 Тогда
        КоэфШагаСкрутки = 22;
      ИначеЕсли КоличествоПроволочныхЖил = 37 Тогда
        КоэфШагаСкрутки = 22;//26; 14.02.2023
      ИначеЕсли КоличествоПроволочныхЖил = 58 Тогда
        КоэфШагаСкрутки = 22;//26; 14.02.2023
      Иначе
        КоэфШагаСкрутки = 1;
        Сообщить("Ошибка 6001: Общий модуль РасчётПроизводительностиОборудований, не найден коэффициент шага скрутки");			
      КонецЕсли; 
      КоэфШагаСкрутки = 22;
      //ДиамертПоСкруткеПервогоПовива
      ДиаметрПроволоки = ДанныеПоЭтапам[НомерЭтапа-2][3]; //Берём данные с предыдущего этапа, на конец этапа
      //КоэффициентДляПервогоФонаря = Справочники.ДиаметрыПоСкрутке.НайтиПоНаименованию(КоличествоЖил).КоэффициентДляПервогоФонаря;		
      //05,05,22
      КоэффициентДляПервогоФонаря = Справочники.ДиаметрыПоСкрутке.НайтиПоНаименованию(КоличествоПроволочныхЖил).КоэффициентДляПервогоФонаря;
      //Ветка на плюсовой
      Если ДанныеПоЭтапам[НомерЭтапа-1][18]=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой тогда                                           
        //КоэффициентДляПервогоФонаря = Справочники.ДиаметрыПоСкрутке.НайтиПоНаименованию(КоличествоЖилПлюсовой).КоэффициентДляПервогоФонаря;					
        //05,05,22
        КоэффициентДляПервогоФонаря = Справочники.ДиаметрыПоСкрутке.НайтиПоНаименованию(КоличествоПроволочныхЖил).КоэффициентДляПервогоФонаря;					
      КонецЕсли;		                 
      Если КоэффициентДляПервогоФонаря=0 тогда Сообщить("Не найден ""Коэффициент для первого фонаря"", проверьте справочник ""Диаметры по скрутке"" на существование позиции с параметром ""Число проволок, стренг или жил"" = "+КоличествоПроволочныхЖил) КонецЕсли; 
      ДиамертПоСкруткеПервогоПовива = ДиаметрПроволоки * КоэффициентДляПервогоФонаря;
      ШагСкрутки = ДиамертПоСкруткеПервогоПовива * КоэфШагаСкрутки;
      ЛинейнаяСкорость = СкоростьПервогоФонаря * ШагСкрутки / 1000;//Данную скорость надо записывать в документ, для проверки в будущем с фактическими скоростями из SCADA		
      Производительность = КоличествоКилометров*1000 / ЛинейнаяСкорость;	       
      Возврат Производительность 
    КонецФункции
</details>

## Функция РасчетЧистойПроизводительности_10(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа) 


<details>
<summary>Код</summary>  
        	
          НазваниеОборудования = ДанныеПоЭтапам[НомерЭтапа-1][1];
        	Сообщить("Ошибка 610: Нет функции расчета чистой производительности. Общие модули: РасчетПроизводительностиОборудований->РасчетЧистойПроизводительности->" + НазваниеОборудования);
        КонецФункции
        
</details>

## Функция РасчетЧистойПроизводительности_11(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа) 


<details>
<summary>Код</summary>
  
      //НомерЭтапа - это НЕ индекс массива, отличается на +1	
    	НазваниеОборудования = ДанныеПоЭтапам[НомерЭтапа-1][1];
    	ВидОперации = ДанныеПоЭтапам[НомерЭтапа-1][15];
    	КоличествоКилометров = ДанныеПоЭтапам[НомерЭтапа-1][5];
    	Запрос = Новый Запрос;
    	
    	
    	//Лентообмотчики
    	НаименованиеОперации = Перечисления.ВидОперации.Обмотка1Слой;
    	Запрос.Текст = 
    	"ВЫБРАТЬ
    	|	ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования
    	|ИЗ
    	|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
    	|ГДЕ
    	|	ЛинейныеСкоростиОборудований.НаименованиеОборудования = &НаименованиеОборудования
    	|	И ЛинейныеСкоростиОборудований.ВидОперации = &НаименованиеОперации";		
    	Запрос.УстановитьПараметр("НаименованиеОборудования", НазваниеОборудования);
    	Запрос.УстановитьПараметр("НаименованиеОперации", НаименованиеОперации);
    	РезультатЗапроса = Запрос.Выполнить();
    	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
    	ЛинейнаяСкоростьНайдена = Ложь;
    	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
    		ЛинейнаяСкорость = ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
    		ЛинейнаяСкоростьНайдена  = Истина;	
    	КонецЦикла;		
    	Если ЛинейнаяСкоростьНайдена = Ложь Тогда
    		Сообщить("Ошибка 611: Общие модули. Расчёт производительности оборудований. РегистрСведений ВолочениеСкорости. Не найдена линейная скорость оборудования " + НазваниеОборудования + "Вид операции: :" + НаименованиеОперации);
    	Иначе
    		Производительность = Окр(КоличествоКилометров/(ЛинейнаяСкорость/1000)); //время выполнения в минутах
    		Возврат Производительность;
    	КонецЕсли;	
    КонецФункции
</details>

## Функция РасчетЧистойПроизводительности_12(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа) 


<details>
  <summary>Код</summary>
	
      	//НомерЭтапа - это НЕ индекс массива, отличается на +1	
      	НазваниеОборудования = ДанныеПоЭтапам[НомерЭтапа-1][1];
      	КоличествоКилометров = ДанныеПоЭтапам[НомерЭтапа-1][5];
      	Запрос = Новый Запрос;
      	//Мультик
      	ДиаметрПроволоки = Справочники.СправочникДиаметрыПроволки.НайтиПоНаименованию(ПараметрыЗаказа[3]); //
      	Если ДанныеПоЭтапам[НомерЭтапа-1][18]=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой тогда
      		ДиаметрПроволокиПлюсовой = Справочники.СправочникДиаметрыПроволки.НайтиПоНаименованию(ПараметрыЗаказа[36]);
      	ИначеЕсли ДанныеПоЭтапам[НомерЭтапа-1][18]=Перечисления.ОсновнойПлюсовойСуммарный.Спомогательный тогда
      		ДиаметрПроволокиВспомогательный= Справочники.СправочникДиаметрыПроволки.НайтиПоНаименованию(ПараметрыЗаказа[93]);
      	КонецЕсли;//
      	Запрос.Текст = 
      	"ВЫБРАТЬ
      	|	ЛинейныеСкоростиОборудованийСрезПоследних.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования
      	|ИЗ
      	|	РегистрСведений.ЛинейныеСкоростиОборудований.СрезПоследних КАК ЛинейныеСкоростиОборудованийСрезПоследних
      	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.СправочникДиаметрыПроволки КАК СправочникДиаметрыПроволки
      	|		ПО ЛинейныеСкоростиОборудованийСрезПоследних.ДиаметрПроволоки = СправочникДиаметрыПроволки.Ссылка
      	|ГДЕ
      	|	ЛинейныеСкоростиОборудованийСрезПоследних.НаименованиеОборудования = &НаименованиеОборудования И
      	|	ЛинейныеСкоростиОборудованийСрезПоследних.ДиаметрПроволоки = &ДиаметрПроволоки";		
      	Запрос.УстановитьПараметр("НаименованиеОборудования", НазваниеОборудования);
      	Запрос.УстановитьПараметр("ДиаметрПроволоки", ДиаметрПроволоки);
      	//Ветка на плюсовой
      	Если 		ДанныеПоЭтапам[НомерЭтапа-1][18] = Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой тогда
      		Запрос.УстановитьПараметр("ДиаметрПроволоки", ДиаметрПроволокиПлюсовой);
      	ИначеЕсли 	ДанныеПоЭтапам[НомерЭтапа-1][18] = Перечисления.ОсновнойПлюсовойСуммарный.Спомогательный тогда
      		Запрос.УстановитьПараметр("ДиаметрПроволоки", ДиаметрПроволокиВспомогательный);			
      	КонецЕсли;
      	РезультатЗапроса = Запрос.Выполнить();
      	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
      	ЛинейнаяСкоростьНайдена = Ложь;
      	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
      		ЛинейнаяСкорость = ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
      		ЛинейнаяСкоростьНайдена = Истина;	
      	КонецЦикла;
      	Если ЛинейнаяСкоростьНайдена = Ложь Тогда
      		Сообщить("Ошибка 612: Общие модули. Расчёт производительности оборудований. РегистрСведений ВолочениеСкорости. Не найдена линейная скорость волочения " + НазваниеОборудования + "; диаметр проволоки: " + ДиаметрПроволоки);
      	Иначе
      		Производительность = Окр(((КоличествоКилометров)/((ЛинейнаяСкорость*60/1000)*60))*60,2); //время выполнения в минутах
      		Возврат Производительность;
      	КонецЕсли;
      КонецФункции
      
</details>

## Функция РасчетЧистойПроизводительности_13(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа)  

<details>
<summary>Код</summary>
  
          Производительность = РасчетЧистойПроизводительности_СкруткаСтренги(ПараметрыЗаказа,ДанныеПоЭтапам,НомерЭтапа); 	   
        	Возврат Производительность;
        КонецФункции
  
</details>

## Функция РасчетЧистойПроизводительности_15(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа)   

<details>
<summary>Код</summary>
  
    	//НомерЭтапа - это НЕ индекс массива, отличается на +1	
    	НазваниеОборудования = ДанныеПоЭтапам[НомерЭтапа-1][1];
    	ВидОперации = ДанныеПоЭтапам[НомерЭтапа-1][15];
    	КоличествоКилометров = ДанныеПоЭтапам[НомерЭтапа-1][5];
    	Запрос = Новый Запрос;
    	//Лентообмотчики
    	НаименованиеОперации = Перечисления.ВидОперации.Обмотка2Слоя;
    	Запрос.Текст = 
    	"ВЫБРАТЬ
    	|	ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования
    	|ИЗ
    	|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
    	|ГДЕ
    	|	ЛинейныеСкоростиОборудований.НаименованиеОборудования = &НаименованиеОборудования
    	|	И ЛинейныеСкоростиОборудований.ВидОперации = &НаименованиеОперации";		
    	Запрос.УстановитьПараметр("НаименованиеОборудования", НазваниеОборудования);
    	Запрос.УстановитьПараметр("НаименованиеОперации", НаименованиеОперации);
    	РезультатЗапроса = Запрос.Выполнить();
    	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
    	ЛинейнаяСкоростьНайдена = Ложь;
    	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
    		ЛинейнаяСкорость = ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
    		ЛинейнаяСкоростьНайдена  = Истина;	
    	КонецЦикла;		
    	Если ЛинейнаяСкоростьНайдена = Ложь Тогда
    		Сообщить("Ошибка 615: Общие модули. Расчёт производительности оборудований. РегистрСведений ВолочениеСкорости. Не найдена линейная скорость оборудования " + НазваниеОборудования + "Вид операции: :" + НаименованиеОперации);
    	Иначе
    		Производительность = Окр(КоличествоКилометров/(ЛинейнаяСкорость/1000)); //время выполнения в минутах
    		Возврат Производительность
    	КонецЕсли;
    	
    	
    КонецФункции
</details>

## Функция РасчетЧистойПроизводительности_16(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа) 


<details>
<summary>Код</summary>
  
    	//НомерЭтапа - это НЕ индекс массива, отличается на +1	
    	НазваниеОборудования = ДанныеПоЭтапам[НомерЭтапа-1][1];
    	ВидОперации = ДанныеПоЭтапам[НомерЭтапа-1][15];
    	КоличествоКилометров = ДанныеПоЭтапам[НомерЭтапа-1][5];
    	Запрос = Новый Запрос;
    	//Обмотка проволочной бронёй   //Драмтвистер
    	НаименованиеОперации = Перечисления.ВидОперации.ОбмоткаПроволочнойБронёй;
    	Запрос.Текст = 
    	"ВЫБРАТЬ
    	|	ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования
    	|ИЗ
    	|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
    	|ГДЕ
    	|	ЛинейныеСкоростиОборудований.НаименованиеОборудования = &НаименованиеОборудования
    	|	И ЛинейныеСкоростиОборудований.ВидОперации = &НаименованиеОперации
    	|	И ЛинейныеСкоростиОборудований.ДиаметрПроволокиОт <= &Диаметр
    	|	И ЛинейныеСкоростиОборудований.ДиаметрПроволоки >= &Диаметр";
    	Запрос.УстановитьПараметр("НаименованиеОборудования", НазваниеОборудования);
    	Запрос.УстановитьПараметр("НаименованиеОперации", ВидОперации);            
    	Запрос.УстановитьПараметр("Диаметр", Справочники.СправочникДиаметрыПроволки.НайтиПоНаименованию(ДанныеПоЭтапам[НомерЭтапа-1][20].Толщина));          
    	//выбираем исходя из толщины проволоки брони!
    	РезультатЗапроса = Запрос.Выполнить().Выгрузить(); 
    	ЛинейнаяСкоростьНайдена = Ложь;                                      
    	Если РезультатЗапроса.Количество() тогда  
    		ЛинейнаяСкорость = РезультатЗапроса[0].ЛинейнаяСкоростьОборудования;  
    	Иначе ЛинейнаяСкорость=0;
    	КонецЕсли;
    	Если ЛинейнаяСкорость <> 0 Тогда
    		ЛинейнаяСкоростьНайдена  = Истина;
    	КонецЕсли;
    	Если ЛинейнаяСкоростьНайдена = Ложь Тогда
    		Сообщить("Ошибка 616: Общие модули. Расчёт производительности оборудований. РегистрСведений ВолочениеСкорости. Не найдена линейная скорость оборудования " + НазваниеОборудования + "Вид операции: :" + НаименованиеОперации);		
    	Иначе 
    		Производительность = Окр(КоличествоКилометров/(ЛинейнаяСкорость/1000)); //время выполнения в минутах
    		Возврат Производительность;
    		
    	КонецЕсли;	 
    	
    КонецФункции
</details>

## Функция РасчетЧистойПроизводительности_17(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа) 

<details>
<summary>Код</summary>  
	
    	//НомерЭтапа - это НЕ индекс массива, отличается на +1	
    	НазваниеОборудования = ДанныеПоЭтапам[НомерЭтапа-1][1];
    	ВидОперации = ДанныеПоЭтапам[НомерЭтапа-1][15];
    	КоличествоКилометров = ДанныеПоЭтапам[НомерЭтапа-1][5];
    	Запрос = Новый Запрос;
    	//Обмотка проволочным экраном
    	НаименованиеОперации = Перечисления.ВидОперации.ОбмоткаПроволочнымЭкраном;
    	Запрос.Текст = 
    	"ВЫБРАТЬ
    	|	ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования
    	|ИЗ
    	|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
    	|ГДЕ
    	|	ЛинейныеСкоростиОборудований.НаименованиеОборудования = &НаименованиеОборудования
    	|	И ЛинейныеСкоростиОборудований.ВидОперации = &НаименованиеОперации";		
    	Запрос.УстановитьПараметр("НаименованиеОборудования", НазваниеОборудования);
    	Запрос.УстановитьПараметр("НаименованиеОперации", НаименованиеОперации);
    	РезультатЗапроса = Запрос.Выполнить();
    	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
    	НормаРасходаНайдена = Ложь;
    	ЛинейнаяСкоростьНайдена  = Ложь;	
    	
    	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
    		ЛинейнаяСкорость = ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
    		ЛинейнаяСкоростьНайдена  = Истина;	
    	КонецЦикла;		
    	
    	Если ЛинейнаяСкоростьНайдена = Ложь Тогда
    		Сообщить("Ошибка 617: Общие модули. Расчёт производительности оборудований. РегистрСведений ВолочениеСкорости. Не найдена линейная скорость оборудования " + НазваниеОборудования + "Вид операции: :" + НаименованиеОперации);
    	Иначе 
    		Производительность = Окр(КоличествоКилометров/(ЛинейнаяСкорость/1000)); //время выполнения в минутах
    		Возврат Производительность;
    	КонецЕсли;	 
    	
    КонецФункции

</details>

## Функция РасчетЧистойПроизводительности_18(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа) 


<details>
<summary>Код</summary>  
	
      //НомерЭтапа - это НЕ индекс массива, отличается на +1	
    	НазваниеОборудования = ДанныеПоЭтапам[НомерЭтапа-1][1];
    	ВидОперации = ДанныеПоЭтапам[НомерЭтапа-1][15];
    	
    	КоличествоЖил = ПараметрыЗаказа[2];
    	КоличествоКилометров = ДанныеПоЭтапам[НомерЭтапа-1][5];
    	Запрос = Новый Запрос;
    	Если ПараметрыЗаказа[29]=Истина тогда //Кабель плюсовой
    		КоличествоЖилПлюсовой = ПараметрыЗаказа[38];
    	КонецЕсли;
    	//Пока как на драмтвистере, однако потом надо переделывать и сравнивать производительность по скрутке, и брать, что меньше!!!!!!!!!!!!!!!
    	//Общая скрутка (скрутка изол)
    	//Сначала скорость первого фонаря, в запросе линейная скорость это Скорость первого фонаря
    	НаименованиеОперации = Перечисления.ВидОперации.ОбщаяСкрутка6кВ;
    	Запрос.Текст = 
    	"ВЫБРАТЬ
    	|	ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования
    	|ИЗ
    	|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
    	|ГДЕ
    	|	ЛинейныеСкоростиОборудований.НаименованиеОборудования = &НаименованиеОборудования
    	|	И ЛинейныеСкоростиОборудований.ВидОперации = &НаименованиеОперации";		
    	Запрос.УстановитьПараметр("НаименованиеОборудования", НазваниеОборудования);
    	Запрос.УстановитьПараметр("НаименованиеОперации", НаименованиеОперации);
    	РезультатЗапроса = Запрос.Выполнить();
    	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
    	НормаРасходаНайдена = Ложь;
    	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
    		СкоростьПервогоФонаря = ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
    		НормаРасходаНайдена  = Истина;	
    	КонецЦикла;		
    	Если НормаРасходаНайдена = Ложь Тогда
    		Сообщить("Ошибка 68: Не найдена скорость первого фонаря в Производительность оборудования: " + НазваниеОборудования + " название операции:" + НаименованиеОперации);
    	КонецЕсли;
    	//ШагСкрутки:
    	//КоэфициентШагаСкрутки
    	КоэфШагаСкрутки = 22;
    	//ДиамертПоСкруткеПервогоПовива
    	КоличествоЖил = ПараметрыЗаказа[2];
    	ДиаметрПроволоки = ДанныеПоЭтапам[НомерЭтапа-2][3]; //Берём данные с предыдущего этапа, на конец этапа		
    	КоэффициентДляПервогоФонаря = Справочники.ДиаметрыПоСкрутке.НайтиПоНаименованию(КоличествоЖил).КоэффициентДляПервогоФонаря;		
    	//Ветка на плюсовой 
    	Если ДанныеПоЭтапам[НомерЭтапа-1][18]=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой тогда                                           
    		КоэффициентДляПервогоФонаря = Справочники.ДиаметрыПоСкрутке.НайтиПоНаименованию(КоличествоЖилПлюсовой).КоэффициентДляПервогоФонаря;					
    	ИначеЕсли ДанныеПоЭтапам[НомерЭтапа-1][18]=Перечисления.ОсновнойПлюсовойСуммарный.Спомогательный тогда                                           
    		КоэффициентДляПервогоФонаря = Справочники.ДиаметрыПоСкрутке.НайтиПоНаименованию(ПараметрыЗаказа[84]).КоэффициентДляПервогоФонаря;					
    	КонецЕсли;
    	ДиамертПоСкруткеПервогоПовива = ДиаметрПроволоки * КоэффициентДляПервогоФонаря;                                            		
    	ШагСкрутки = ДиамертПоСкруткеПервогоПовива * КоэфШагаСкрутки;
    	ЛинейнаяСкорость = СкоростьПервогоФонаря * ШагСкрутки / 1000;//Данную скорость надо записывать в документ, для проверки в будущем с фактическими скоростями из SCADA		
    	Производительность = (КоличествоКилометров * 1000) / ЛинейнаяСкорость;	
    	Возврат Производительность;
    КонецФункции
</details>

## Функция РасчетЧистойПроизводительности_20(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа) 

<details>
<summary>Код</summary>  
	
        //НомерЭтапа - это НЕ индекс массива, отличается на +1	
        
      	НазваниеОборудования = ДанныеПоЭтапам[НомерЭтапа-1][1];
      	ВидОперации = ДанныеПоЭтапам[НомерЭтапа-1][15];
      	КоличествоКилометров = ДанныеПоЭтапам[НомерЭтапа-1][5];
      	Запрос = Новый Запрос;
      	
      	
      	//Оболочка плоский		
      	//По номеру этапа и айди заказа найдём запись РегистрыСведений.ПотребностиПоМатериалам и возьмем там норму
      	НаименованиеОперации = Перечисления.ВидОперации.ОболочкаПлоский;
      	IDZak = ПараметрыЗаказа[0];
      	Запрос.Текст = 
      	"ВЫБРАТЬ
      	|	ПотребностиПоМатериалам.НормаНа1КМ КАК НормаНа1КМ,
      	|	ПотребностиПоМатериалам.НаименованиеМатериала КАК НаименованиеМатериала
      	|ИЗ
      	|	РегистрСведений.ПотребностиПоМатериалам КАК ПотребностиПоМатериалам
      	|ГДЕ
      	|	ПотребностиПоМатериалам.IDZak = &IDZak
      	|	И ПотребностиПоМатериалам.НомерЭтапа = &НомерЭтапа";		
      	Запрос.УстановитьПараметр("IDZak", Строка(IDZak));
      	Запрос.УстановитьПараметр("НомерЭтапа", Строка(НомерЭтапа));
      	РезультатЗапроса = Запрос.Выполнить();
      	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
      	НормаНа1КгНайдена = Ложь;
      	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
      		Материал = ВыборкаДетальныеЗаписи.НаименованиеМатериала;
      		НормаНа1Кг = ВыборкаДетальныеЗаписи.НормаНа1КМ;
      		НормаНа1КгНайдена = Истина;	
      	КонецЦикла;		
      	Если НормаНа1КгНайдена = Ложь Тогда
      		Сообщить("Ошибка 67.1: Не найдена норма на 1 КГ в Потребностях по материалам, перезапишите заказ " + IDZak);
      	КонецЕсли;
      	//Теперь находим нормуРасхода материала на оборудовании из РегистраСведений.ЛинейныеСкоростиОборудований
      	Запрос.Текст = 
      	"ВЫБРАТЬ
      	|	ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования
      	|ИЗ
      	|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
      	|ГДЕ
      	|	ЛинейныеСкоростиОборудований.НаименованиеОборудования = &НаименованиеОборудования
      	|	И ЛинейныеСкоростиОборудований.ВидОперации = &НаименованиеОперации
      	|	И ЛинейныеСкоростиОборудований.Материал.НаименованиеИзERP подобно &Материал";		
      	Запрос.УстановитьПараметр("НаименованиеОборудования", НазваниеОборудования);
      	Запрос.УстановитьПараметр("НаименованиеОперации", НаименованиеОперации);
      	Запрос.УстановитьПараметр("Материал", Материал.НаименованиеИзERP);
      	РезультатЗапроса = Запрос.Выполнить();
      	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
      	НормаРасходаНайдена = Ложь;
      	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
      		НормаРасходаМатериала = ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
      		НормаРасходаНайдена  = Истина;	
      	КонецЦикла;		
      	Если НормаРасходаНайдена = Ложь Тогда
      		Сообщить("Ошибка 67.2: Не найдена норма расхода в Производительность оборудования: " + НазваниеОборудования + " название операции:" + НаименованиеОперации + " наименомание материала: " + Материал);
      	КонецЕсли;
      	//Считаем Производительность: НормаНа1Кг(кг/км)/НормаРасходаМатериала(кг/мин)*ДлинаЗаказа(км)
      	Производительность = (НормаНа1Кг/НормаРасходаМатериала)*КоличествоКилометров; //Проверить!!!!!!!!!!!!!!!!!!!!???????????	
      	Возврат Производительность;
      КонецФункции
      
</details>

## Функция РасчетЧистойПроизводительности_30(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа) //+

<details>
<summary>Код</summary>  
	
      Стр= Новый Структура;
      
    	Стр.Вставить("НаименованиеОперации",ДанныеПоЭтапам[НомерЭтапа-1][15]);
    	Стр.Вставить("НазваниеОборудования",ДанныеПоЭтапам[НомерЭтапа-1][1]);
    	Стр.Вставить("IDZak",ПараметрыЗаказа[0]);
    	Стр.Вставить("НомерЭтапа",Строка(ДанныеПоЭтапам[НомерЭтапа-1][2]));
    	Стр.Вставить("НомерСчёта",ПараметрыЗаказа[24]);
    	Стр.Вставить("КоличествоКилометров",ДанныеПоЭтапам[НомерЭтапа-1][5]);
    	Если ДанныеПоЭтапам[НомерЭтапа-1][18]=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой тогда //Кабель плюсовой
    		Стр.Вставить("КоличествоЖил",ПараметрыЗаказа[38]);
    		ИспЖил = Справочники.ИсполнениеЖилы.НайтиПоНаименованию(ПараметрыЗаказа[39]);
    	ИначеЕсли ДанныеПоЭтапам[НомерЭтапа-1][18]=Перечисления.ОсновнойПлюсовойСуммарный.Спомогательный тогда //Кабель плюсовой
    		Стр.Вставить("КоличествоЖил",ПараметрыЗаказа[84]);   
    		ИспЖил = Справочники.ИсполнениеЖилы.НайтиПоНаименованию(ПараметрыЗаказа[86]);
    	Иначе
    		Стр.Вставить("КоличествоЖил",ПараметрыЗаказа[2]);      
    		ИспЖил = Справочники.ИсполнениеЖилы.НайтиПоНаименованию(ПараметрыЗаказа[7]);
    	КонецЕсли;
    	Производительность = 0;
    	Запрос = Новый Запрос;
    	Запрос.Текст = 
    	"ВЫБРАТЬ
    	|	ПотребностиПоМатериалам.НормаНа1КМ КАК НормаНа1КМ,
    	|	ПотребностиПоМатериалам.НаименованиеМатериала КАК НаименованиеМатериала,
    	|	ПотребностиПоМатериалам.ПлюсовойКабель КАК ПлюсовойКабель
    	|ИЗ
    	|	РегистрСведений.ПотребностиПоМатериалам КАК ПотребностиПоМатериалам
    	|ГДЕ
    	|	ПотребностиПоМатериалам.IDZak = &IDZak
    	|	И ПотребностиПоМатериалам.НомерЭтапа = &НомерЭтапа
    	|	И ПотребностиПоМатериалам.ПлюсовойКабель = &ПлюсовойКабель";		
    	Запрос.УстановитьПараметр("IDZak", Строка(Стр.IDZak));
    	Запрос.УстановитьПараметр("НомерЭтапа", Стр.НомерЭтапа);     
    	Запрос.УстановитьПараметр("ПлюсовойКабель", ДанныеПоЭтапам[НомерЭтапа-1][18]);
    	РезультатЗапроса = Запрос.Выполнить();
    	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
    	Если ВыборкаДетальныеЗаписи.Количество()>0 Тогда	
    		//Один, два, или три материала
    		Пока ВыборкаДетальныеЗаписи.Следующий() Цикл     		                                                  			
    			Стр.Вставить("Материал", ВыборкаДетальныеЗаписи.НаименованиеМатериала);
    			Стр.Вставить("НормаНа1КМ", ВыборкаДетальныеЗаписи.НормаНа1КМ);                                  			
    			Стр.Вставить("ИсполнениеЖилы", ИспЖил );  //Должна быть ссылка
    			Стр.Вставить("НормаРасходаМатериала",ПоискНормыРасходаИзоляции(Стр));                                  			
    			Если Стр.НормаРасходаМатериала = 0 Тогда
    			ИначеЕсли Производительность = 0 Тогда
    				Производительность = ((Стр.НормаНа1КМ/Стр.НормаРасходаМатериала)*Стр.КоличествоКилометров)/Стр.КоличествоЖил;
    			Иначе
    				ЗатратыВремениСледующегоМатериала = ((Стр.НормаНа1КМ/Стр.НормаРасходаМатериала)*Стр.КоличествоКилометров)/Стр.КоличествоЖил; 	
    				Если ЗатратыВремениСледующегоМатериала > Производительность Тогда
    					Производительность = ЗатратыВремениСледующегоМатериала;
    				КонецЕсли;
    			КонецЕсли;
    		КонецЦикла;		
    	КонецЕсли; 	               
    	
    	
    	Возврат Производительность;
    	
    КонецФункции
</details>

## Функция РасчетЧистойПроизводительности_31(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа) 


<details>
<summary>Код</summary>  
   
      Если ДанныеПоЭтапам[НомерЭтапа-1][1] = Справочники.НоменклатураОборудований.НайтиПоНаименованию("Крутильная машина № 025/1, 025/2, 025/3, 025/4 стренги SNJ 630/500") тогда
        		Производительность = РасчетЧистойПроизводительности_СкруткаСтренги(ПараметрыЗаказа,ДанныеПоЭтапам,НомерЭтапа); 	   
        		Возврат Производительность;
      Иначе
        
      КонецЕсли;
    КонецФункции
    
</details>

## Функция РасчетЧистойПроизводительности_32(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа) 


<details>
<summary>Код</summary>

        Производительность = РасчетЧистойПроизводительности_ОбщаяСкрутка(НомерЭтапа, ДанныеПоЭтапам, ПараметрыЗаказа);
      	Возврат Производительность;  //Ставим общую скрутку так как лентообмотка имеет такую же производительность(потому что стоит сразу после скрутки)
      КонецФункции
      
</details>

## Функция РасчетЧистойПроизводительности_33(ДанныеПоЭтапам,НомерЭтапа,ПараметрыЗаказа) 


<details>
<summary>Код</summary>  
	
        Производительность = РасчетЧистойПроизводительности_СкруткаСердечника(ПараметрыЗаказа,ДанныеПоЭтапам,НомерЭтапа);
      	Возврат Производительность;	
      КонецФункции
      
</details>
  
#КонецОбласти






</details>
#КонецОбласти
  
</details>
