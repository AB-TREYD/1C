## Процедура СозданиеДокумента(Структ) Экспорт 
<details>
  <summary>
    Код
  </summary>
  
        Перем видИсполнения; 
        	//создали документ
        	НовыйДокумент = Документы.ЗаказыВПроизводство.СоздатьДокумент(); 
        	//IDZak
        	НовыйДокумент.IDZak = ФормированиеIDZak("");  
        	Структ.вставить("idzak",НовыйДокумент.IDZak);
        	Если Структ.Свойство("Заказ") тогда
        		НовыйДокумент.НоменклатураERP = Структ.Заказ;
        	КонецЕсли;  
        	НовыйДокумент.Толеранс=Структ.Толеранс; 
        	IDZak = НовыйДокумент.IDZak;   
        	//
	 	Если Структ.Свойство("IDZAKAZA") тогда
			НовыйДокумент.IDZakaza = Структ.IDZakaza;   	
		КонецЕсли;

        	НовыйДокумент.КоэффициентСпецификации = 1; //30.11.2023
        	//данные номенклатуры ерп
        	НовыйДокумент.Артикул = "000100131"; //? 
        	НовыйДокумент.н_ИспользоватьНовуюКодировкуМатериала=Истина;  //используем новую кодировку
        	НовыйДокумент.ДобавленИзЕРП = 						Структ.ДобавленИзЕРП;
        	НовыйДокумент.КомментарийИзERP = 					Структ.Комментарий;
        	НовыйДокумент.Дата = ТекущаяДата();     
        	ДатаВыходаПоЗаказу = ?(Структ.ДатаВыходаПоЗаказу = Null,ТекущаяДата(),Структ.ДатаВыходаПоЗаказу);                          
        	НовыйДокумент.ДатаВыпускаПоЗаказу = 				ДатаВыходаПоЗаказу;
        	НовыйДокумент.ДатаПриоритета = 						ДатаВыходаПоЗаказу;
        	НовыйДокумент.КоличествоКилометровПоЗаказу = 		Структ.КоличествоКилометровПоЗаказу;	
        	НовыйДокумент.КоличествоКилометровВПроизводство = 	Структ.КоличествоКилометровПоЗаказу;
        	НовыйДокумент.НомерСчета = ?(Структ.НомерСчёта = "","Тест",Структ.НомерСчёта);                          
        	НовыйДокумент.КоэффициентКонвертации=				Структ.КоэффициентКонвертации; 	
        	НовыйДокумент.Тип = 								Структ.Тип; //провод, силовой, кабель и тому подобные    
        	НовыйДокумент.МаркаЗаказа = 						Структ.Марка; 
        	НовыйДокумент.Расширение = 							Структ.РасширениеМарки;  
        	НовыйДокумент.ПлюсовойКабель = 						Структ.ПлюсовойКабель;
        	НовыйДокумент.ВариантИсполнения= 					Структ.ВариантИсполнения; 
        	НовыйДокумент.ПроцентСкидки = 						структ.ПроцентСкидки;
        	НовыйДокумент.СтатусЗаказа =                        Перечисления.СтатусыПроизводства.Вграфике;
        	НовыйДокумент.КомментНеСтандарт =                   Структ.КомментНеСтандарт;   
        	НовыйДокумент.НеСтандарт =                          Структ.БулевоНеСтандарт;
        	Если СтрНайти(нрег(НовыйДокумент.НомерСчета),"бз") тогда
        		НовыйДокумент.СтатусЗаказа =                    Перечисления.СтатусыПроизводства.НаИспытании;
        	КонецЕсли;
        	Если ПроверкаНаМонашоваНеСтандарт(НовыйДокумент.НоменклатураERP) Тогда  
        		НовыйДокумент.ВариантИсполнения = Справочники.ВидИсполнения.НайтиПоНаименованию("Монашов");
          		НовыйДокумент.НеСтандарт = Ложь;
        	КонецЕсли;            
        	
        	НамоткаПримечание =?(структ.Примечание="",Структ.Намотка,Структ.Примечание+";"+Структ.Намотка);
        	
        	Если Структ.ЕдиницаИзмеренияЗаказа=Перечисления.ЕдиницаИзмеренияЗаказа.ПустаяСсылка() тогда
        		Структ.ЕдиницаИзмеренияЗаказа=Перечисления.ЕдиницаИзмеренияЗаказа.Км;			
        	КонецЕсли;	 
        	Ltx = ЕстьLTX(НовыйДокумент.МаркаЗаказа + НовыйДокумент.Расширение);   //плюсовой 
        	Структ.Вставить("Ltx",Ltx);          
        	
        	Если Структ.Свойство("СечениеЭкрана") тогда			
        		СечениеЭкранаИЛенты = Справочники.СправочникСечений.НайтиПоНаименованию(Структ.СечениеЭкрана); //было СечениеЭкранаИЛенты=СечениеЭкранаИЛенты; Структ передает значение СечениеЭкранаИЛенты, а значение передаваемое в функцию всегда равно пустой строке
        		Если СечениеЭкранаИЛенты = Справочники.СправочникСечений.ПустаяСсылка() или СечениеЭкранаИЛенты = Справочники.СправочникСечений.Найтипокоду("000000028") тогда
        			СечениеЭкранаИЛенты = Справочники.СправочникСечений.НайтиПоКоду("000000025");
        		КонецЕсли;	
        	Иначе  
        		СечениеЭкранаИЛенты = Справочники.СправочникСечений.НайтиПоКоду("000000025");
        	КонецЕсли;	 
        	Если Лев(НовыйДокумент.МаркаЗаказа,1) = "А"  или СтрНайти(НовыйДокумент.МаркаЗаказа,"СИП")>0 Тогда //Нужен для определения конструкции!
        		ИспользуемыйМеталл = Справочники.НоменклатураМатериалов.НайтиПоКоду("000000007");//алюм	
        	Иначе
        		ИспользуемыйМеталл = Справочники.НоменклатураМатериалов.НайтиПоКоду("000000024");	//медь	
        	КонецЕсли; 	
        	Структ.Вставить("ИспользуемыйМеталл",ИспользуемыйМеталл);
        	НовыйДокумент.ПримечаниеИНамоткаИзERP=				НамоткаПримечание;
        	НовыйДокумент.ЕдиницаИзмеренияЗаказа=				структ.ЕдиницаИзмеренияЗаказа;	
        	НовыйДокумент.СечениеЭкранаИЛенты = 				СечениеЭкранаИЛенты;	
        	
        	ПроверкаСправочников(структ); //++
        	Если структ.плюсовойКабель тогда
        		НовыйДокумент.КоличествоЖилПлюсовой = 	Справочники.СправочникКоличествоЖил.НайтиПоНаименованию(Структ.КоличествоЖилПлюсовой);
        		НовыйДокумент.СечениеПлюсовой 		=	Справочники.СправочникСечений.НайтиПоНаименованию(Структ.СечениеПлюсовой);
        		Если НовыйДокумент.СечениеПлюсовой 	= 	Справочники.СправочникСечений.ПустаяСсылка() тогда
        			НовыйДокумент.СечениеПлюсовой 	=	Справочники.СправочникСечений.НайтиПоНаименованию(СтрЗаменить(Структ.СечениеПлюсовой,",0",""));
        		КонецЕсли;
        		НовыйДокумент.ИсполнениеЖилыПлюсовой = 	Справочники.ИсполнениеЖилы.НайтиПоНаименованию(Структ.ИсполнениеЖилыПлюсовой);
        	КонецЕсли;
        	НовыйДокумент.Напряжение = 		Справочники.СправочникНапряжений.НайтиПоНаименованию(Структ.Напряжение);	
        	НовыйДокумент.ИсполнениеЖилы = 	Справочники.ИсполнениеЖилы.НайтиПоНаименованию(Структ.ИсполнениеЖилы);
        	НовыйДокумент.NPE = 			Справочники.СправочникNPE.НайтиПоНаименованию(Структ.NPE);
        	НовыйДокумент.КоличествоЖил = 	Справочники.СправочникКоличествоЖил.НайтиПоНаименованию(Структ.КоличествоЖил);
        	НовыйДокумент.Сечение = 		Справочники.СправочникСечений.НайтиПоНаименованию(Строка(число(Структ.Сечение)));//для исключения ошибок типа сечение = "4,0" 
        	
        	//Данилова 01.08.2023 Для загрузки сечения=1000     //РЕФАКТОРИНГ!!!!!!!!!!!!!!!!!!!!ЭТО КОСТЫЛЬ!!!!!!!!!
        	Если Структ.Сечение="1000" тогда
        		  НовыйДокумент.Сечение =   Справочники.СправочникСечений.НайтиПоНаименованию("1000");
        	КонецЕсли;
        	//-Данилова	
        	
        	Если НовыйДокумент.Тип = Перечисления.ТипПродукции.Отходы тогда //отходы
        		НовыйДокумент.МаркаЗаказаИзЕРП = "Отходы";
        		НовыйДокумент.МаркаЗаказа	   = НовыйДокумент.НоменклатураERP;   
        		НовыйДокумент.н_ПровереноПлановымОтделом = истина;
        		НовыйДокумент.СтатусЗаказа 	   = Перечисления.СтатусыПроизводства.Изготовлен;
         	КонецЕсли;
        	
        	Если строка(новыйДокумент.Напряжение)="" 
        		или строка(новыйДокумент.ИсполнениеЖилы)="" 
        		или строка(новыйДокумент.NPE)="" 
        		или строка(новыйДокумент.КоличествоЖил)="" или строка(новыйДокумент.КоличествоЖил)="0"  	
        		или строка(новыйДокумент.Сечение)="" или строка(новыйДокумент.Сечение)="0"
        		тогда  
        		Структ.Вставить("НеХватаетОсновныхПараметров",Истина);
        	Иначе 
        		Если строка(новыйДокумент.ВариантИсполнения)="" тогда    
        			НеХватаетВариантаИсполнения=Истина;                 
        		Иначе                                                  
        			НеХватаетВариантаИсполнения=Ложь;                   
        		КонецЕсли;                                              
        		Структ.Вставить("НеХватаетОсновныхПараметров",Ложь);
        	КонецЕсли;
        	Если Структ.ПлюсовойКабель тогда		
        		Если строка(новыйДокумент.КоличествоЖилПлюсовой)="" или строка(новыйДокумент.КоличествоЖилПлюсовой)="0"  	
        			или строка(новыйДокумент.СечениеПлюсовой)="" или строка(новыйДокумент.СечениеПлюсовой)="0"  
        			или строка(новыйДокумент.ИсполнениеЖилыПлюсовой)="" 
        			тогда
        			Структ.Вставить("НеХватаетОсновныхПараметров",Истина);   
        		КонецЕсли;   
        	КонецЕсли;
        	//марка                          
        	НовыйДокумент.МаркаЗаказа=?(Структ.LTX=истина,ЕслиLTXистина(структ),НовыйДокумент.МаркаЗаказа);
        	Структ.Марка=НовыйДокумент.МаркаЗаказа;
        	//
        	
        	Структ.Вставить("Гибкий",ЭтоГибкий(НовыйДокумент.НоменклатураERP));  
        	НовыйДокумент.Гибкий = Структ.Гибкий; 
        	Структ.Вставить("FR",ЕстьFR(Структ.Марка));
        	
        	Если не Структ.НеХватаетОсновныхПараметров тогда  
        		//Параметры Кабеля
        		ПараметрыКабеля=ПолучитьПараметрыКабеля(Структ);
        		
        		Если НовыйДокумент.ВариантИсполнения.Наименование = "Монашов" Тогда
        			ПараметрыКабеля.Вставить("ВариантИсполнения",Справочники.ВидИсполнения.НайтиПоНаименованию("Монашов"));
        		Иначе
        			ПараметрыКабеля.Вставить("ВариантИсполнения",Справочники.ВидИсполнения.НайтиПоНаименованию("Эталон"));
        		КонецЕсли; 
        		
        		ПараметрыКабеля.Вставить("НоменклатураERP",НовыйДокумент.НоменклатураERP); 
        		
        		НовыйДокумент.РазновидностьКабеля = ПоискРазновидностиКабеля(ПараметрыКабеля,ложь);     
        		Если Структ.ПлюсовойКабель тогда 
        			НовыйДокумент.РазновидностьКабеляПлюсовой = ПоискРазновидностиКабеля(ПараметрыКабеля,истина);
        		КонецЕсли;
        		
        		ПроцентСкидки = ?(Структ.ПроцентСкидки = "",0,Структ.ПроцентСкидки);
        		Если НовыйДокумент.РазновидностьКабеля = 2 или число(ПроцентСкидки)<0 Тогда         
        			ПараметрыКабеля.ПроцентСкидкиОт = 0;
        			ПараметрыКабеля.ПроцентСкидкиДо = 0;
        			ПараметрыКабеля.ПроцентСкидки = 0;    
        		Иначе
        			ПараметрыКабеля.ПроцентСкидки = Число(Окр(ПроцентСкидки)); 
        			ПараметрыКабеля.ПроцентСкидкиОт = Число(Окр(ПроцентСкидки));
        			ПараметрыКабеля.ПроцентСкидкиДо = Число(Окр(ПроцентСкидки));
        		КонецЕсли;
        		//
        		
 ## #Область  
 <details> 
   <summary> 
     Код  </summary>
 Конструкция 
        		//Обнуляем т.к. до этого он уже предзаполнен!   (из-за поиска разновидности кабеля)	
        		ПараметрыКабеля=ОчиститьКонструкциюПараметровКабеля(ПараметрыКабеля,Ложь);	
        		//Эталон    					                                                   
        		
        		Если НовыйДокумент.ВариантИсполнения.Наименование = "Монашов" Тогда
        			ПараметрыКабеля.Вставить("ВариантИсполнения",Справочники.ВидИсполнения.НайтиПоНаименованию("Монашов"));
        		Иначе
        			ПараметрыКабеля.Вставить("ВариантИсполнения",Справочники.ВидИсполнения.НайтиПоНаименованию("Эталон"));
        		КонецЕсли;
        		
        		ПараметрыКабеля = ПоискКонструкцииИДиаметраКабеля(ПараметрыКабеля,Ложь);	
        		НовыйДокумент.н_ДиаметрПроволокиЭталон = 						СтрЗаменить(ПараметрыКабеля.ДиаметрПроволоки,".",","); 							
        		НовыйДокумент.н_ДиаметрПроволокиДляПотребностиВМеталлеЭталон = 	СтрЗаменить(ПараметрыКабеля.ДиаметрПроволкиДляРасчётаПотребностиМеталла,".",","); 
        		НовыйДокумент.н_КоличествоЗарядныхКатушекНаСтренгеЭталон = 		ПараметрыКабеля.КоличествоЗарядныхКатушекНаСтренге;
        		НовыйДокумент.н_КоличествоПроволокНаОднойКатушкеЭталон = 		ПараметрыКабеля.КоличествоПроволокНаОднойКатушке;
        		НовыйДокумент.н_КоличествоПроволокВЖилеЭталон =  				ПараметрыКабеля.КоличествоПроволокВЖиле;          
        		//+Данилова 01.08.2023
        		НовыйДокумент.н_КоличествоЗарядныхКатушекНаСтренгеЭталонДоп = 		ПараметрыКабеля.КоличествоЗарядныхКатушекНаСтренгеДоп;
        		НовыйДокумент.н_КоличествоПроволокНаОднойКатушкеЭталонДоп = 		ПараметрыКабеля.КоличествоПроволокНаОднойКатушкеДоп;
        		//-Данилова
        		НовыйДокумент.ДиаметрТПЖЭталон = 								ПараметрыКабеля.ДиаметрТПЖ;   
        		НовыйДокумент.ФактическоеСечениеЭталон = 						ПараметрыКабеля.ФактическоеСечение;
        		НовыйДокумент.ЭквивалентныйДиаметрЭталон =						ПараметрыКабеля.ЭквивалентныйДиаметр;		
        		НовыйДокумент.ДиаметрЦентральногоЖгутаЭталон =                  ПараметрыКабеля.ДиаметрЦентральногоЖгута;   
        		НовыйДокумент.ВысотаСегментаЭталон =                            ПараметрыКабеля.ВысотаСегмента;		        
        		
        		ПараметрыКабеля=ОчиститьКонструкциюПараметровКабеля(ПараметрыКабеля,Ложь);	
        		
        		Если Структ.ПлюсовойКабель тогда
        			//ПлюсовойЭталон
        			ПараметрыКабеля = ПоискКонструкцииИДиаметраКабеля(ПараметрыКабеля,Истина);
        			НовыйДокумент.н_ДиаметрПроволокиПлюсовойЭталон = 						СтрЗаменить(ПараметрыКабеля.ДиаметрПроволокиПлюсовой,".",","); 										
        			НовыйДокумент.н_ДиаметрПроволокиДляПотребностиВМеталлеПлюсовойЭталон = 	СтрЗаменить(ПараметрыКабеля.ДиаметрПроволкиДляРасчётаПотребностиМеталлаПлюсовой,".",",");
        			НовыйДокумент.н_КоличествоЗарядныхКатушекНаСтренгеПлюсовойЭталон =  	ПараметрыКабеля.КоличествоЗарядныхКатушекНаСтренгеПлюсовой;  
        			НовыйДокумент.н_КоличествоПроволокНаОднойКатушкеПлюсовойЭталон =		ПараметрыКабеля.КоличествоПроволокНаОднойКатушкеПлюсовой;   
        			//+Данилова 01.08.2023
        			НовыйДокумент.н_КоличествоЗарядныхКатушекНаСтренгеПлюсовойЭталонДоп =  	ПараметрыКабеля.КоличествоЗарядныхКатушекНаСтренгеПлюсовойДоп;  
        			НовыйДокумент.н_КоличествоПроволокНаОднойКатушкеПлюсовойЭталонДоп =		ПараметрыКабеля.КоличествоПроволокНаОднойКатушкеПлюсовойДоп;   
        			//-Данилова
        			НовыйДокумент.н_КоличествоПроволокВЖилеПлюсовойЭталон =  				ПараметрыКабеля.КоличествоПроволокВЖилеПлюсовой;    
        			НовыйДокумент.ДиаметрТПЖПлюсовойЭталон = 								ПараметрыКабеля.ДиаметрТПЖПлюсовой;                              	
        			НовыйДокумент.ФактическоеСечениеПлюсовойЭталон = 						ПараметрыКабеля.ФактическоеСечениеПлюсовой;
        			
        			НовыйДокумент.ВысотаСегментаПлюсовойЭталон = 							0; 		//Ставцев 12.10.23
        			НовыйДокумент.ЭквивалентныйДиаметрПлюсовойЭталон = 						ПараметрыКабеля.ЭквивалентныйДиаметр;	//Ставцев 12.10.23
        			ПараметрыКабеля=ОчиститьКонструкциюПараметровКабеля(ПараметрыКабеля,Истина)	
        			
        		КонецЕсли;  	       
        		Если НеХватаетВариантаИсполнения=ложь тогда // если нет варианта исполнения не означает что конструкция не должна найтись по эталону!
        			//факт						
        			ПараметрыКабеля.Вставить("ВариантИсполнения",Структ.ВариантИсполнения);  
        			ПараметрыКабеля = ПоискКонструкцииИДиаметраКабеля(ПараметрыКабеля,Ложь);
        			НовыйДокумент.ДиаметрПроволоки = 						СтрЗаменить(ПараметрыКабеля.ДиаметрПроволоки,".",",");	          
        			НовыйДокумент.ДиаметрПроволокиДляПотребностиВМеталле = 	СтрЗаменить(ПараметрыКабеля.ДиаметрПроволкиДляРасчётаПотребностиМеталла,".",",");		
        			НовыйДокумент.КоличествоЗарядныхКатушекНаСтренге =  	ПараметрыКабеля.КоличествоЗарядныхКатушекНаСтренге;
        			НовыйДокумент.КоличествоПроволокНаОднойКатушке = 		ПараметрыКабеля.КоличествоПроволокНаОднойКатушке;
        			//+Данилова 01.08.2023
                    НовыйДокумент.КоличествоЗарядныхКатушекНаСтренгеДоп =  	ПараметрыКабеля.КоличествоЗарядныхКатушекНаСтренгеДоп;
        			НовыйДокумент.КоличествоПроволокНаОднойКатушкеДоп = 		ПараметрыКабеля.КоличествоПроволокНаОднойКатушкеДоп; 
        			//-Данилова
        			НовыйДокумент.КоличествоПроволокВЖиле =  				ПараметрыКабеля.КоличествоПроволокВЖиле;
        			НовыйДокумент.ДиаметрТПЖ = 								ПараметрыКабеля.ДиаметрТПЖ;
        			НовыйДокумент.ФактическоеСечение = 						ПараметрыКабеля.ФактическоеСечение;
        			НовыйДокумент.ЭквивалентныйДиаметр =						ПараметрыКабеля.ЭквивалентныйДиаметр;		
        			НовыйДокумент.ДиаметрЦентральногоЖгута =                  ПараметрыКабеля.ДиаметрЦентральногоЖгута;   
        			НовыйДокумент.ВысотаСегмента =                            ПараметрыКабеля.ВысотаСегмента;		        
        			Если Структ.ПлюсовойКабель тогда		
        				//Плюсовой факт
        				ПараметрыКабеля = ПоискКонструкцииИДиаметраКабеля(ПараметрыКабеля,Истина);			
        				НовыйДокумент.ДиаметрПроволокиПлюсовой= 						СтрЗаменить(ПараметрыКабеля.ДиаметрПроволокиПлюсовой,".",",");  	
        				НовыйДокумент.ДиаметрПроволокиДляПотребностиВМеталлеПлюсовой = 	СтрЗаменить(ПараметрыКабеля.ДиаметрПроволкиДляРасчётаПотребностиМеталлаПлюсовой,".",",");
        				НовыйДокумент.КоличествоЗарядныхКатушекНаСтренгеПлюсовой =  	ПараметрыКабеля.КоличествоЗарядныхКатушекНаСтренгеПлюсовой;
        				НовыйДокумент.КоличествоПроволокНаОднойКатушкеПлюсовой = 		ПараметрыКабеля.КоличествоПроволокНаОднойКатушкеПлюсовой;
        				//+Данилова 01.08.2023 
        				НовыйДокумент.КоличествоЗарядныхКатушекНаСтренгеПлюсовойДоп =  	ПараметрыКабеля.КоличествоЗарядныхКатушекНаСтренгеПлюсовойДоп;
        				НовыйДокумент.КоличествоПроволокНаОднойКатушкеПлюсовойДоп = 	ПараметрыКабеля.КоличествоПроволокНаОднойКатушкеПлюсовойДоп;
        				//-Данилова
        				НовыйДокумент.КоличествоПроволокВЖилеПлюсовой =  				ПараметрыКабеля.КоличествоПроволокВЖилеПлюсовой;
        				НовыйДокумент.ДиаметрТПЖПлюсовой = 								ПараметрыКабеля.ДиаметрТПЖПлюсовой;
        				НовыйДокумент.ФактическоеСечениеПлюсовой = 						ПараметрыКабеля.ФактическоеСечениеПлюсовой;
        				
        				НовыйДокумент.ВысотаСегментаПлюсовой = 							0;          //Ставцев 12.10.23
        				НовыйДокумент.ЭквивалентныйДиаметрПлюсовой = 					0;    //Ставцев 12.10.23
        
        			КонецЕсли;  	  
        			//3-4 поток ставим ноль в волоку! 16,03,23
        			Если НовыйДокумент.РазновидностьКабеля = 3 или НовыйДокумент.РазновидностьКабеля = 4 тогда
        				НовыйДокумент.ДиаметрПроволокиДляПотребностиВМеталлеПлюсовой = 	0;
        				НовыйДокумент.ДиаметрПроволокиДляПотребностиВМеталле = 	0;
        				НовыйДокумент.н_ДиаметрПроволокиДляПотребностиВМеталлеПлюсовойЭталон = 0;
        				НовыйДокумент.н_ДиаметрПроволокиДляПотребностиВМеталлеЭталон = 	0;
        			КонецЕсли;  
        			
        			
</details>                                           
        			
        			//Марка    
        			Если СтрНайти(Строка(Структ.Марка),"Стренга медная ТПЖ") Тогда
        				НоваяМаркаЗаказаИзЕРП = Структ.Марка;
        				НоваяМаркаЗаказа = "Стренга медная ТПЖ";
        			ИначеЕсли Структ.Марка= "Проволока медная" Тогда  
        				НоваяМаркаЗаказаИзЕРП = Структ.Марка; 
        				НоваяМаркаЗаказа = "Проволока медная"; 
        			Иначе
        				Если НовыйДокумент.ДобавленИзЕРП тогда
        					Если НовыйДокумент.ПлюсовойКабель Тогда
        						НоваяМаркаЗаказаИзЕРП = Структ.Марка+" "+ Структ.КоличествоЖил + "х" + Структ.Сечение+"+"+Структ.КоличествоЖилПлюсовой+"х"+Структ.СечениеПлюсовой;
        					Иначе
        						НоваяМаркаЗаказаИзЕРП= Структ.Марка + " " + Структ.КоличествоЖил + "х" + Структ.Сечение;
        					КонецЕсли;	
        				Иначе
        					Если НовыйДокумент.ПлюсовойКабель Тогда
        						НоваяМаркаЗаказаИзЕРП = Структ.Марка;
        					Иначе
        						НоваяМаркаЗаказаИзЕРП= Структ.Марка + " " + Структ.КоличествоЖил + "х" + Структ.Сечение;
        					КонецЕсли;	
        				КонецЕсли;
        			КонецЕсли;     
        			//марка
        			НовыйДокумент.МаркаЗаказаИзЕРП=НоваяМаркаЗаказаИзЕРП;
        			НовыйДокумент.МаркаЗаказа = ?(НоваяМаркаЗаказа = Null,НоваяМаркаЗаказа,НовыйДокумент.МаркаЗаказа);                          
        			структ.Марка = НовыйДокумент.МаркаЗаказа;   
        			//		
        			//Цвета
        			НовыйДокумент.ЦветаЗаказа.Загрузить(ПолучитьЦветаИзСправочника(Структ));   	 	 
        			//Надо внести информацию в справочник при его открытии пользователем (Модуль формы объекта При Открытии)
        			
        			//тех цепочки
        			ЕстьЗапись = Ложь;
        			ТчОборудование = НовыйДокумент.ЭтапыИОборудование;
        			ТчОборудованиеЭталон = НовыйДокумент.ЭтапыИОборудованиеЭталон;
        			
        			Если НовыйДокумент.ВариантИсполнения.Наименование = "Монашов" Тогда                            
        				НайтиТехЦепочку_НОВАЯ(структ.Марка,ПараметрыКабеля, ТчОборудованиеЭталон,"Производственная");
        			Иначе
        				НайтиТехЦепочку_НОВАЯ(структ.Марка,ПараметрыКабеля, ТчОборудованиеЭталон,"Эталон");
        			КонецЕсли;
        			
        			ЕстьЗапись=НайтиТехЦепочку_НОВАЯ(структ.Марка,ПараметрыКабеля,ТчОборудование,"Производственная");
        			Если Структ.ПлюсовойКабель тогда
        				ТчОборудование.Сортировать("ПлюсовойКабель Возр");
        				ТчОборудованиеЭталон.Сортировать("ПлюсовойКабель Возр");
        			КонецЕсли;  
        			НовыйДокумент.ЭтапыИОборудование.Загрузить(ТчОборудование.Выгрузить());          		
        			НовыйДокумент.ЭтапыИОборудованиеЭталон.Загрузить(ТчОборудованиеЭталон.Выгрузить());  
        			
        		КонецЕсли;
        	КонецЕсли;
        	НовыйДокумент.Записать();               
        	НашДокумент = Документы.ЗаказыВПроизводство.НайтиПоНомеру(НовыйДокумент.Номер).ПолучитьОбъект();	
        	НашДокумент.Записать();
        	Если НашДокумент.Тип = Перечисления.ТипПродукции.Отходы или  НашДокумент.Тип = Перечисления.ТипПродукции.Полуфабрикат тогда //отходы
        		ДобавлениеПроверкаИОтправкаОтходов(НашДокумент.Ссылка);
        	КонецЕсли;	
        	
        	

</details>

## Процедура СозданиеДокументаЦПМ(Структ) Экспорт 

<details>
  <summary>
    Код
  </summary>
  
        НовыйДокумент = Документы.ЗаказыВПроизводствоЦПМ.СоздатьДокумент(); 
        	//IDZak   
        	НовыйДокумент.Дата = ТекущаяДата();
        	НовыйДокумент.IDZak = ФормированиеIDZak("");  
        	Структ.вставить("idzak",НовыйДокумент.IDZak);
        	НовыйДокумент.НомерСчета= Структ.НомерСчёта;
        	НовыйДокумент.НоменклатураERP = Структ.Заказ;    
        	//Данилова 27.09
        	
        	Если СтрНайти(Структ.Заказ, "(м)")>0 тогда 
        		Шина=СтрЗаменить(Структ.Заказ, " (м)", "");
        		НовыйДокумент.Продукция=Справочники.ШиныЦПМ.НайтиПоНаименованию(Шина);		
        	КонецЕсли;	                                                              
        	Если СтрНайти(Структ.Заказ, "(кг)")>0 тогда 
        		Шина=СтрЗаменить(Структ.Заказ, " (кг)","");
        		НовыйДокумент.Продукция=Справочники.ШиныЦПМ.НайтиПоНаименованию(Шина);		
        	КонецЕсли;
        	//-Данилова
        	НовыйДокумент.Менеджер = Структ.Менеджер;         
        	НовыйДокумент.Длина    = 4;  
        	
        	МассивРазмера = СтрРазделить(строка(Структ.Заказ)," ");
        		Для каждого Названия из МассивРазмера Цикл
        			Если СтрНайти(Названия, "х") > 0 тогда
        				Размер = Названия; 	
        			КонецЕсли;		
        		КонецЦикла;
        		
        	Позиция=СтрНайти(Размер,"х");   
        		
        	НовыйДокумент.Высота = Лев(Размер, Позиция-1);         
        	НовыйДокумент.Ширина = Прав(Размер, СтрДлина(Размер)-Позиция);         
        	НовыйДокумент.ДатаВыходаПоПлану= Структ.ДатаВыходаПоЗаказу;         
        	НовыйДокумент.Цвет = Структ.Цвет;
        	НовыйДокумент.Статус = Перечисления.СтатусыПроизводства.Вграфике;    
        	НовыйДокумент.ЕдиницаИзмеренияЗаказа = Структ.ЕдиницаИзмеренияЗаказа;
        	НовыйДокумент.Примечание=Структ.Комментарий;     
        	НовыйДокумент.ПримечаниеДляПлановика=Структ.Комментарий+Структ.Намотка;
        	ДлинаЗаказа = Число(Структ.ДлинаЗаказа);
        	Если СтрНайти(нрег(НовыйДокумент.НоменклатураERP),"пруток") или СтрНайти(нрег(НовыйДокумент.НоменклатураERP),"катанка") тогда
        		НовыйДокумент.Ширина = ?(Структ.Сечение=0,1,Структ.Сечение);         
        		НовыйДокумент.Высота = ?(Структ.Сечение=0,1,Структ.Сечение);         
        	КонецЕсли;
        	
        	НовыйДокумент.КоличествоПоЗаказу = ДлинаЗаказа;      
        	Площадь=НовыйДокумент.Высота*НовыйДокумент.Ширина;
        	
        	Если НовыйДокумент.ЕдиницаИзмеренияЗаказа = Перечисления.ЕдиницаИзмеренияЗаказа.Кг тогда     
        		
        		Если (ДлинаЗаказа>=2000) и (ДлинаЗаказа <3500) и (Площадь <=0.00016) тогда
        			 МассаСТолерансом = ДлинаЗаказа*1.04;           
        			НовыйДокумент.УчтенныйТолеранс = 4;
        		ИначеЕсли	ДлинаЗаказа <2000 тогда
        			МассаСТолерансом = ДлинаЗаказа*1.05;           
        			НовыйДокумент.УчтенныйТолеранс = 5;
        		ИначеЕсли ДлинаЗаказа >=2000 и	ДлинаЗаказа <10000 тогда
        			МассаСТолерансом = ДлинаЗаказа*1.03;                                   
        			НовыйДокумент.УчтенныйТолеранс = 3;
        		Иначе
        			МассаСТолерансом = ДлинаЗаказа;
        		КонецЕсли;
        			
        		
        		
        		ДлинаВМетрах=Окр(ДлинаЗаказа/0.008989/(НовыйДокумент.Высота*НовыйДокумент.Ширина));  
        		КоличествоШин=Окр(ДлинаВметрах/НовыйДокумент.Длина)-1; 
        		ДлинаВМетрах=КоличествоШин*НовыйДокумент.Длина;
        		
        		Пока ДлинаЗаказа<МассаСТолерансом цикл
        			КоличествоШин=КоличествоШин+1;
        			ДлинаВМетрах=КоличествоШин*НовыйДокумент.Длина;
        			ДлинаЗаказа=ДлинаВМетрах*0.008989*(НовыйДокумент.Высота*НовыйДокумент.Ширина); 			
        		КонецЦикла;    
        		
        		Если ДлинаЗаказа>МассаСТолерансом тогда
        			КоличествоШин=КоличествоШин-1;
        			ДлинаВМетрах=КоличествоШин*НовыйДокумент.Длина;
        			ДлинаЗаказа=ДлинаВМетрах*0.008989*(НовыйДокумент.Высота*НовыйДокумент.Ширина); 			
        		КонецЕсли;
        		//Длина = ДлинаЗаказа;  
        		Если (МассаСТолерансом-ДлинаЗаказа)/ДлинаЗаказа>0.15 тогда
        			КоличествоШин=КоличествоШин+1;
        			ДлинаВМетрах=КоличествоШин*НовыйДокумент.Длина;
        			ДлинаЗаказа=ДлинаВМетрах*0.008989*(НовыйДокумент.Высота*НовыйДокумент.Ширина); 			
        		КонецЕсли;
        		
        	Иначе                           
        		
        		ДлинаМ = ДлинаЗаказа;  
        	КонецЕсли;  
        	
        	
        	
        	 
        	 
        	//++Данилова 06.10
        	Если НовыйДокумент.ЕдиницаИзмеренияЗаказа = Перечисления.ЕдиницаИзмеренияЗаказа.М тогда    
        		 НовыйДокумент.ЗаданиеКМ=ДлинаМ;
        		 НовыйДокумент.ЗаданиеКГ=ДлинаМ*0.008989*(НовыйДокумент.Высота*НовыйДокумент.Ширина);
        		 НовыйДокумент.Задание=ДлинаМ/4;  
        		 НовыйДокумент.ЗаданиеЗаготовкиКм=ДлинаМ;
        		 НовыйДокумент.ЗаданиеЗаготовкиКг=ДлинаМ*0.008989*(НовыйДокумент.Высота*НовыйДокумент.Ширина);
        		 НовыйДокумент.ЗаданиеЗаготовкиШт=ДлинаМ/4;  
        	 ИначеЕсли НовыйДокумент.ЕдиницаИзмеренияЗаказа = Перечисления.ЕдиницаИзмеренияЗаказа.Кг тогда
        		 НовыйДокумент.Задание=КоличествоШин;
        			НовыйДокумент.ЗаданиеКМ=КоличествоШин*НовыйДокумент.Длина;
        			НовыйДокумент.ЗаданиеКг=НовыйДокумент.ЗаданиеКМ*0.008989*(НовыйДокумент.Высота*НовыйДокумент.Ширина); 
        			НовыйДокумент.ЗаданиеЗаготовкиШт=КоличествоШин;  
        			НовыйДокумент.ЗаданиеЗаготовкиКм=КоличествоШин*НовыйДокумент.Длина;
        			НовыйДокумент.ЗаданиеЗаготовкиКг=НовыйДокумент.ЗаданиеКМ*0.008989*(НовыйДокумент.Высота*НовыйДокумент.Ширина);       		 
        	  КонецЕсли;  
        	 НовыйДокумент.ПометкаУдаления=Ложь;
        	///-Данилова    
        	НовыйДокумент.Записать(); 
        	
        	////++Минайкин 29.09.23
        	//Если СтрНайти(нрег(НовыйДокумент.НоменклатураERP),"шина") Тогда
        	//	Запрос = Новый Запрос;
        	//	Запрос.Текст = 
        	//	"ВЫБРАТЬ
        	//	|	ЗаказыВПроизводствоЦПМ.НоменклатураERP КАК НоменклатураERP,
        	//	|	ЗаказыВПроизводствоЦПМ.Ссылка КАК Ссылка,
        	//	|	ЗаказыВПроизводствоЦПМ.Задание КАК Задание,
        	//	|	ЗаказыВПроизводствоЦПМ.ДатаВыходаПоПлану КАК ДатаВыходаПоПлану,
        	//	|	ЗаказыВПроизводствоЦПМ.НомерСчета КАК НомерСчета,
        	//	|	ЗаказыВПроизводствоЦПМ.Примечание КАК Примечание
        	//	|ИЗ
        	//	|	Документ.ЗаказыВПроизводствоЦПМ КАК ЗаказыВПроизводствоЦПМ
        	//	|ГДЕ
        	//	|	ЗаказыВПроизводствоЦПМ.НомерСчета ПОДОБНО &НомерСчета";
        	//	
        	//	ПозицияСлэш = СтрНайти(Структ.НомерСчёта, "/");
        	//	НомерСчёта = Лев(Структ.НомерСчёта, ПозицияСлэш - 1); 
        	//	
        	//	Запрос.УстановитьПараметр("НомерСчета", НомерСчёта + "%");
        	//	
        	//	РезультатЗапроса = Запрос.Выполнить();
        	//	
        	//	Если РезультатЗапроса.Выгрузить().Количество() = Структ.ВсегоПозицийВЗаказе Тогда 
        	//		РазбивкаЗаказаДляЗаполненияВКоробки(РезультатЗапроса.Выгрузить());
        	//		//СозданиеДокументаСборкиКоробок(РезультатЗапроса.Выгрузить(), НомерСчёта);
        	//		СозданиеПозицийСгруппированныхЗаказовСклада(РезультатЗапроса.Выгрузить(), НомерСчёта);
        	//	КонецЕсли; 
        	//КонецЕсли;
        	////--


	
 </details>

	
	
 
 ## Функция НахождениеКодаФункцииРассчётаМатериалов(КодФуРасМат, НазваниеОборудованияНаше, ВидОперации, НазваниеОборудованияВСправочнике) Экспорт

 <details> 
   <summary> 
     Код  </summary>



	Если Строка(ВидОперации) = "" Тогда
		НазваниеОборудованияВСправочнике = Справочники.НоменклатураОборудований.НайтиПоНаименованию(НазваниеОборудованияНаше);
		КодФуРасМат = НазваниеОборудованияВСправочнике.КодФункцииРассчётаМатериалов;
	Иначе
		Если ВидОперации = Перечисления.ВидОперации.ОбмоткаАлюмофлексом Тогда 
			КодФуРасМат = 1;
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.ОбмоткаБроней Тогда 
			КодФуРасМат = 2;			
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.Волочение Тогда 
			КодФуРасМат = 3;
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.Заполнение Тогда 
			КодФуРасМат = 4;
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.Изоляция Тогда 
			КодФуРасМат = 5;
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.ОболочкаКруглый Тогда 
			КодФуРасМат = 6;
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.ЗаполнениеИОболочка Тогда 
			КодФуРасМат = 21;	
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.ОболочкаПлоский Тогда 
			КодФуРасМат = 7;	
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.ОбщаяСкрутка Тогда 
			КодФуРасМат = 8;	
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.СкруткаТПЖ Тогда 
			КодФуРасМат = 9;	
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.Обмотка1Слой Тогда 
			КодФуРасМат = 11;
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.ВолочениеМультивайер Тогда 
			КодФуРасМат = 12;	
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.СкруткаСтренги Тогда 
			КодФуРасМат = 13;		
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.Обмотка2Слоя Тогда 
			КодФуРасМат = 15;
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.ОбмоткаПроволочнойБронёй Тогда 
			КодФуРасМат = 16;
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.ОбмоткаПроволочнымЭкраном Тогда 
			КодФуРасМат = 17;
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.ОбщаяСкрутка6кВ Тогда 
			КодФуРасМат = 18;
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.ОболочкаШлангом Тогда
			КодФуРасМат = 19;
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.ОболочкаПлоскийШлангом Тогда
			КодФуРасМат = 20;
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.ОболочкаПлоскийШлангом Тогда
			КодФуРасМат = 21;
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.Изоляция3слоя Тогда
			КодФуРасМат = 22;  
			//Миликен			
			//Шахтный
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.Изоляция2слоя Тогда
			КодФуРасМат = 30;    
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.ИзготовлениеСердечника Тогда
			КодФуРасМат = 31;    
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.ОбщаяСкруткаСЛентообмоткой Тогда
			КодФуРасМат = 32;   
		ИначеЕсли ВидОперации = Перечисления.ВидОперации.ИзоляцияСердечника Тогда
			КодФуРасМат = 33;  	
			//
		Иначе
			Сообщить("Не найден вид операции");
		КонецЕсли;
	КонецЕсли;	
	Возврат КодФуРасМат;	


</details>

















































 ## #Область  Выработка
 <details> 
   <summary> 
     Код  </summary>
 

 ## Функция ПроверитьКоличествоЗаказов(НомерСчета) экспорт //+01.02.23

 <details> 
   <summary> 
     Код  </summary>
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЗаказыВПроизводство.Ссылка КАК Ссылка
	|ИЗ
	|	Документ.ЗаказыВПроизводство КАК ЗаказыВПроизводство
	|ГДЕ
	|	ЗаказыВПроизводство.НомерСчета = &НомерСчета";
	Запрос.УстановитьПараметр("НомерСчета",НомерСчета);
	РезультатЗапроса = Запрос.Выполнить();
	Возврат РезультатЗапроса.Выгрузить();

</details>


 ## Функция РасчетРасценокЗаТехнологическуюОперацию(РасценкаЗаСмену,ДлительностьОднойОперации) Экспорт

 <details> 
   <summary> 
     Код  </summary>
	Если ДлительностьОднойОперации=0 или ДлительностьОднойОперации=неопределено тогда
		Результат = 0; 
	иначе
		Результат =РасценкаЗаСмену/(720/ДлительностьОднойОперации);
		Возврат Результат;
	КонецЕсли;

</details>


 ## Функция РасчетРасценокЗаКМ(РасценкаЗаСмену, ДлинаКон,ВремяИзготовленияПоЗаказу) Экспорт

 <details> 
   <summary> 
     Код  </summary>
	Если ВремяИзготовленияПоЗаказу=0 тогда
		Сообщить("ВремяИзготовленияПоЗаказу	не найдено!");
		Результат=0;
		Возврат Результат;
	иначе
		Результат=РасценкаЗаСмену/((720*ДлинаКон)/ВремяИзготовленияПоЗаказу);	
		Возврат результат; 
	КонецЕсли

</details>


 ## Функция ПоискМатериалаИДлиныКонечной(СсылкаНаЗаказ,ВидОперации,НаименованиеОборудования,НомерОперации)           экспорт

 <details> 
   <summary> 
     Код  </summary>
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЗВП_ЭТАПЫ.Материал1 КАК Материал1,
	|	ЗВП_ЭТАПЫ.Материал2 КАК Материал2,
	|	ЗВП_ЭТАПЫ.Материал3 КАК Материал3,
	|	ЗВП_ЭТАПЫ.Материал4 КАК Материал4,
	|	ЗВП_ЭТАПЫ.Материал5 КАК Материал5,
	|	ЗВП_ЭТАПЫ.НомерЭтапа КАК НомерЭтапа	
	|ИЗ
	|	Документ.ЗаказыВПроизводство.ЭтапыИОборудование КАК ЗВП_ЭТАПЫ
	|ГДЕ
	|	ЗВП_ЭТАПЫ.Ссылка = &СсылкаНаЗаказ
	|	И ЗВП_ЭТАПЫ.ВидОперации = &ВидОперации
	|	И ЗВП_ЭТАПЫ.НазваниеОборудования.Наименование = &НазваниеОборудования
	|	И ЗВП_ЭТАПЫ.Ссылка.ПометкаУдаления = ЛОЖЬ";     //добавлено условие 05.12.2023
	Запрос.УстановитьПараметр("СсылкаНаЗаказ", СсылкаНаЗаказ);
	Запрос.УстановитьПараметр("ВидОперации", ВидОперации);
	Запрос.УстановитьПараметр("НазваниеОборудования", НаименованиеОборудования);
	РезультатЗапроса = Запрос.Выполнить();				
	ВДЗ = РезультатЗапроса.Выбрать();				
	Счетчик=0;
	
	Пока ВДЗ.Следующий() Цикл	
		Счетчик = Счетчик+1;
		Если ВДЗ.Количество()=1 и номерОперации=2 или Счетчик = НомерОперации тогда									                         
			Результат=Новый Структура("ДлинаКон,Материал1,Материал2,Материал3,Материал4,Материал5");					
			Результат.Вставить("ДлинаКон", ОпределитьДлинаКонечная(НаименованиеОборудования,ВидОперации,ВДЗ.НомерЭтапа,СсылкаНаЗаказ.IDZak,НомерОперации));									
			ЗаполнитьЗначенияСвойств(Результат,ВДЗ);
			Прервать;
		КонецЕсли;
	КонецЦикла;		
	Возврат Результат

</details>


 ## Функция ОпределитьДлинаКонечная(НаименованиеОборудования,ВидОперации,НомерЭтапа,IDZak,НомерОперации)     экспорт

 <details> 
   <summary> 
     Код  </summary>
	НомОп  = НомерОперации;
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ДанныеПоЭтапам.ДлинаКон КАК ДлинаКон,
	|	ДанныеПоЭтапам.НомерЭтапа КАК НомерЭтапа,
	|	ДанныеПоЭтапам.ВидОперации КАК ВидОперации,
	|	ДанныеПоЭтапам.НаименованиеОборудования КАК НаименованиеОборудования,
	|	ДанныеПоЭтапам.IDZak КАК IDZak,
	|	ДанныеПоЭтапам.ПлюсовойКабель КАК ПлюсовойКабель
	|ИЗ
	|	РегистрСведений.ДанныеПоЭтапам КАК ДанныеПоЭтапам
	|ГДЕ
	|	ДанныеПоЭтапам.IDZak = &IDZak
	|	И ДанныеПоЭтапам.НаименованиеОборудования.Наименование = &НаименованиеОборудования
	|	И ДанныеПоЭтапам.ВидОперации = &ВидОперации";	
	Запрос.УстановитьПараметр("IDZak", Строка(IDZak));
	Запрос.УстановитьПараметр("ВидОперации", ВидОперации);
	Запрос.УстановитьПараметр("НаименованиеОборудования", Строка(НаименованиеОборудования));
	Запрос.УстановитьПараметр("НомерЭтапа", НомерЭтапа);
	РезультатЗапроса = Запрос.Выполнить();	
	Выборка = РезультатЗапроса.Выбрать();  
	Счетчик=0;   
	Если НомОп>1 тогда
		ОсновнойПлюсовой=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой;
	Иначе
		ОсновнойПлюсовой=Перечисления.ОсновнойПлюсовойСуммарный.Основной;		
	КонецЕсли;
	//Не найдет для плюсового если на одинаковых этапах основной/плюсовой разные оборудования
	//
	Пока Выборка.Следующий() Цикл                                  
		Если Выборка.ПлюсовойКабель = Перечисления.ОсновнойПлюсовойСуммарный.ПустаяСсылка() тогда   //14.08.23
			ОсновнойПлюсовой = Перечисления.ОсновнойПлюсовойСуммарный.ПустаяСсылка();              //14.08.23
		КонецЕсли;                                                                                //14.08.23
		Если РезультатЗапроса.выгрузить().Количество() = 1 тогда                                 //14.08.23
			НомОп = 1;	                                                                        //14.08.23
		КонецЕсли;                                                                             //14.08.23
		
		Счетчик=Счетчик+1;
		Если Выборка.ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.ПустаяСсылка() тогда
			Если Счетчик = НомОп тогда	                           //обычный кабель
				ДлинаКон=Выборка.ДлинаКон;	
			КонецЕсли;		
		Иначе
			Если 			Выборка.ПлюсовойКабель = ОсновнойПлюсовой тогда          //основной/плюсовой
				ДлинаКон =	Выборка.ДлинаКон;                    
			ИначеЕсли 		Выборка.ПлюсовойКабель = Перечисления.ОсновнойПлюсовойСуммарный.Суммарный и НомОп = 1 тогда     //суммарный
				ДлинаКон = 	Выборка.ДлинаКон;                    
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;	  
	Возврат ДлинаКон;    
	
	Если ДлинаКон=Неопределено тогда
		Сообщить("Длина конечная не обнаружена! IDZak #"+idzak+" ВидОперации: " + ВидОперации + " НомерЭтапа: " + номерЭтапа + " Оборудование: " + НаименованиеОборудования);
	КонецЕсли;

</details>


 ## Функция РасчетРасценкиЗаСмену(Оборудование) экспорт//Расценка за смену и коэффициент 

 <details> 
   <summary> 
     Код  </summary>
	Запрос2 = Новый Запрос;                            
	Запрос2.Текст = 
	"ВЫБРАТЬ
	|	НоменклатураОборудований.Наименование КАК Наименование,
	|	НоменклатураОборудований.РасценкаЗаСмену КАК РасценкаЗаСмену,
	|	НоменклатураОборудований.Коэффициент КАК Коэффициент
	|ИЗ
	|	Справочник.НоменклатураОборудований КАК НоменклатураОборудований
	|ГДЕ
	|	НоменклатураОборудований.Наименование = &Наименование";
	
	Запрос2.УстановитьПараметр("Наименование", Строка(Оборудование));
	РезультатЗапроса2= Запрос2.Выполнить();
	ВыборкаДетальныеЗаписи2 = РезультатЗапроса2.Выбрать();                              
	Результат = новый Структура; 
	Пока ВыборкаДетальныеЗаписи2.Следующий() Цикл			
		Если ВыборкаДетальныеЗаписи2.РасценкаЗаСмену=0 
			тогда						
			Сообщить("Расценка за смену для оборудования #"+Оборудование+ " равна 0!");	
			Результат.Вставить("РасценкаЗаСмену", 0);				
			Возврат Результат			
		иначе
			Результат.Вставить("РасценкаЗаСмену", ВыборкаДетальныеЗаписи2.РасценкаЗаСмену);			
			Возврат Результат;				
		КонецЕсли;			
	КонецЦикла;		
	

</details>


 ## Функция ПараметрыДляРасчетаИзЗаказа(СсылкаНаЗаказ,ВидОперации,НаименованиеОборудования, НомерОперации) экспорт//находит сечение, конечную длину, материалы, время изготовления по заказу, номер документа

 <details> 
   <summary> 
     Код  </summary>
	//В этой функции будем находить нужные нам параметры из заказа		
	Если СсылкаНаЗаказ=неопределено  или ВидОперации=неопределено или НаименованиеОборудования=неопределено тогда
		сообщить("Проверьте номер счета, вид операции или наименование оборудования")
	иначе
		Рез = Новый Структура("Материал1,Материал2,Материал3,Материал4,Материал5,ДлинаКон");	 
		Если номерОперации>1 тогда
			ОсновнойПлюсовой=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой;
		Иначе
			ОсновнойПлюсовой=Перечисления.ОсновнойПлюсовойСуммарный.Основной;		
		КонецЕсли;	
		Если ЗначениеЗаполнено(СсылкаНаЗаказ) = ложь тогда
		Иначе
			Запрос2 = Новый Запрос;
			Запрос2.Текст =      
			"ВЫБРАТЬ
			|	ЗВП_ДопОпНаЭтапах.ЗатратыВремениНаОперацию КАК ЗатратыВремениНаОперацию,
			|	ЗВП_ДопОпНаЭтапах.ВидОперации КАК ВидОперации,
			|	ЗВП_ДопОпНаЭтапах.НаименованиеОперации КАК НаименованиеОперации,
			|	ЗВП_ДопОпНаЭтапах.Ссылка КАК Ссылка,
			|	ЗВП_ДопОпНаЭтапах.Плюсовой КАК Плюсовой
			|ИЗ
			|	Документ.ЗаказыВПроизводство.ДополнительныеОперацииНаЭтапах КАК ЗВП_ДопОпНаЭтапах
			|ГДЕ
			|	ЗВП_ДопОпНаЭтапах.Ссылка.Ссылка = &СсылкаНаЗаказ
			|	И ЗВП_ДопОпНаЭтапах.НаименованиеОперации = &НаименованиеОперации
			|	И ЗВП_ДопОпНаЭтапах.НазваниеОборудования.Наименование = &НазваниеОборудования
			|	И ЗВП_ДопОпНаЭтапах.ВидОперации = &ВидОперации";
			
			Запрос2.УстановитьПараметр("СсылкаНаЗаказ", СсылкаНаЗаказ);
			Запрос2.УстановитьПараметр("НазваниеОборудования", НаименованиеОборудования);
			Запрос2.УстановитьПараметр("ВидОперации", ВидОперации);
			Запрос2.УстановитьПараметр("НаименованиеОперации", Перечисления.НаименованиеОперации.ПустаяСсылка());
			РезультатЗапроса2 = Запрос2.Выполнить();			
			
			Если 	ВидОперации = Перечисления.ВидОперации.Волочение 
				или ВидОперации = Перечисления.ВидОперации.ВолочениеМультивайер
				или ВидОперации = Перечисления.ВидОперации.СкруткаТПЖ 
				или ВидОперации = Перечисления.ВидОперации.СкруткаСтренги 
				или ВидОперации = Перечисления.ВидОперации.ОбщаяСкрутка
				или ВидОперации = Перечисления.ВидОперации.ОбщаяСкрутка6кВ
				или ВидОперации = Перечисления.ВидОперации.ОбмоткаАлюмофлексом
				или ВидОперации = Перечисления.ВидОперации.Обмотка1Слой
				или ВидОперации = Перечисления.ВидОперации.Обмотка2Слоя
				или ВидОперации = Перечисления.ВидОперации.ОбмоткаБроней
				или ВидОперации = Перечисления.ВидОперации.ОбмоткаПроволочнойБронёй
				или ВидОперации = Перечисления.ВидОперации.ОбмоткаПроволочнымЭкраном				
				тогда
				//Волочильщик	/ волочильщик - мультик					
				Выборка2= РезультатЗапроса2.Выбрать();	
				Пока Выборка2.Следующий() Цикл
					Материалы=ФормированиеРабочихМассивов.ПоискМатериалаИДлиныКонечной(СсылкаНаЗаказ,ВидОперации,НаименованиеОборудования,НомерОперации);  
					Рез.Вставить("Сечение",СгенерироватьМаркуЗаказаИзЕРП(Выборка2.Ссылка)); //в выработке, везде, кроме Изоляции тут будет МаркаИзЕРП   
					Рез.Вставить("ВремяИзготовленияПоЗаказу", Выборка2.ЗатратыВремениНаОперацию);	
					Рез.Вставить("НомерДокумента", Выборка2.Ссылка.Номер);	
					ЗаполнитьЗначенияСвойств(Рез,Материалы);
				КонецЦикла;
				//Опрессовщик								
			ИначеЕсли ВидОперации = Перечисления.ВидОперации.Изоляция 
				или ВидОперации = Перечисления.ВидОперации.ОболочкаКруглый 
				или ВидОперации = Перечисления.ВидОперации.ОболочкаПлоский
				или ВидОперации = Перечисления.ВидОперации.Заполнение
				или ВидОперации = Перечисления.ВидОперации.ЗаполнениеИОболочка 
				или ВидОперации = Перечисления.ВидОперации.ОболочкаПлоскийШлангом
				или ВидОперации = Перечисления.ВидОперации.ОболочкаШлангом
				или ВидОперации = Перечисления.ВидОперации.Изоляция3слоя
				тогда								
				
				Выборка2= РезультатЗапроса2.Выбрать();	
				Пока Выборка2.Следующий() Цикл
					
					Рез.Вставить("ВремяИзготовленияПоЗаказу", Выборка2.ЗатратыВремениНаОперацию);	
					Рез.Вставить("НомерДокумента", Выборка2.Ссылка.Номер);	
					Рез.Вставить("ВидИсполнения", Выборка2.Ссылка.ВариантИсполнения);							
					Если Выборка2.ВидОперации = Перечисления.ВидОперации.Изоляция тогда     
						Сеч = ?(ОсновнойПлюсовой = Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой,Выборка2.Ссылка.СечениеПлюсовой,Выборка2.Ссылка.Сечение);
						Сечение="1х"+Строка(Сеч);						
						
					иначе                                                           
						Сечение= СгенерироватьМаркуЗаказаИзЕРП(Выборка2.Ссылка);
					КонецЕсли;												
					Рез.Вставить("Сечение",Сечение);							
					Материалы=ПоискМатериалаИДлиныКонечной(СсылкаНаЗаказ,ВидОперации,НаименованиеОборудования,НомерОперации);
					ЗаполнитьЗначенияСвойств(Рез,Материалы);
					
				КонецЦикла;					
				
			КонецЕсли; 
		КонецЕсли;  
		Возврат Рез;
		
	КонецЕсли;
	

</details>

 ## Функция СгенерироватьМаркуЗаказаИзЕРП(Ссылка)  экспорт

 <details> 
   <summary> 
     Код  </summary>
	Марка = Ссылка.МаркаЗаказа;
	Если СтрНайти(Ссылка.МаркаЗаказа," ")<>0 тогда
		Марка = ЛЕВ(Марка,СтрНайти(Марка," "));
	КонецЕсли;                      	
	Если Ссылка.ПлюсовойКабель Тогда	
		Если Ссылка.Тип = Перечисления.ТипПродукции.КабельШахтный тогда
			НоваяМарка = Марка +" "+ строка(Ссылка.КоличествоЖил) + "х" + строка(Ссылка.Сечение)+"+"+строка(Ссылка.КоличествоЖилПлюсовой)+"х"+Строка(Ссылка.СечениеПлюсовой)+"+"+строка(Ссылка.КоличествоЖилВспомогательный)+"х"+Строка(Ссылка.СечениеВспомогательный);
		Иначе
			НоваяМарка = Марка +" "+ строка(Ссылка.КоличествоЖил) + "х" + строка(Ссылка.Сечение)+"+"+строка(Ссылка.КоличествоЖилПлюсовой)+"х"+Строка(Ссылка.СечениеПлюсовой);
		КонецЕсли;  
	Иначе
		НоваяМарка = Марка + " " + Строка(Ссылка.КоличествоЖил) + "х" + строка(Ссылка.Сечение);
	КонецЕсли;
	Возврат СтрЗаменить(НоваяМарка,",0","")

</details>


 ## Функция НайтиДлительностьОпераций1(Оборудование, ВидОперации, Операции,ИсполнениеЖилы = "")	экспорт //Возвращает Массив с доп операциями и временем

 <details> 
   <summary> 
     Код  </summary>
Операция = Перечисления.ВидОперации; 
ДопОп 	 = Перечисления.НаименованиеОперации;
Драм	 = ?(Строка(Оборудование)="Крутильная машина № 017 Драмтвистер  JPD-2500",Истина,Ложь); 

//Вписываем волочение для мультика и волочилка описание причины в процедуре мультика при изм ном счета	
ВидОп 	= ?(ВидОперации = Операция.ВолочениеМультивайер, Операция.Волочение, ВидОперации);
//Только для обмотки бронёй такое наименование...
Операции[1][0] 	= ?(ВидОп = Операция.ОбмоткаБроней, ДопОп.УстановкаКатушкиВОтдатчик, Операции[1][0]);

Для индекс=0 По Операции.Количество()-1 цикл                                                                        
Если не ВидОп = Операция.Изоляция и Операции[индекс][0] = ДопОп.СменаЦвета 				тогда Продолжить КонецЕсли;
Если 	Драм тогда      //если драм тогда проверяем нужные ли нам это операции, если да тогда ничего здесь не делаем, иначе Продолжить
Если не(Операция.ОбмоткаПроволочнойБронёй = ВидОп	или Операция.ОбмоткаПроволочнымЭкраном = ВидОп )тогда
	Если Операции[индекс][0] = ДопОп.УстановкаКатушекСПроволочнымЭкраномБроней	тогда Операции[индекс][1]=0; Продолжить КонецЕсли;
	Если Операции[индекс][0] = ДопОп.СнятиеПустыхКатушекИзПодЭкранаБрони		тогда Операции[индекс][1]=0; Продолжить КонецЕсли;
КонецЕсли;   
Иначе   	//если не драм то вообще Продолжить
Если Операции[индекс][0] = ДопОп.УстановкаКатушекСПроволочнымЭкраномБроней	тогда Операции[индекс][1]=0; Продолжить КонецЕсли;
Если Операции[индекс][0] = ДопОп.СнятиеПустыхКатушекИзПодЭкранаБрони		тогда Операции[индекс][1]=0; Продолжить КонецЕсли;
КонецЕсли;
Запрос = Новый Запрос;
Запрос.Текст = 
"ВЫБРАТЬ
|	ДополнительныеОперацииНаЭтапах.ЗначениеПараметра КАК ЗначениеПараметра,
|	ДополнительныеОперацииНаЭтапах.НаименованиеОперации КАК НаименованиеОперации,
|	ДополнительныеОперацииНаЭтапах.ВидОперации КАК ВидОперации,
|	ДополнительныеОперацииНаЭтапах.НаименованиеОборудования КАК НаименованиеОборудования,
|	ДополнительныеОперацииНаЭтапах.УчитыватьПриРасчётеЗП КАК УчитыватьПриРасчётеЗП
|ИЗ
|	РегистрСведений.ДополнительныеОперацииНаЭтапах КАК ДополнительныеОперацииНаЭтапах
|ГДЕ
|		ДополнительныеОперацииНаЭтапах.ВидОперации 				= &ВидОперации
|	  И ДополнительныеОперацииНаЭтапах.УчитыватьПриРасчётеЗП	= ИСТИНА
|	  И ДополнительныеОперацииНаЭтапах.НаименованиеОперации		= &НаименованиеОперации
|	  И ДополнительныеОперацииНаЭтапах.НаименованиеОборудования	= &НаименованиеОборудования";

Если Драм и ВидОп = Перечисления.ВидОперации.ОбщаяСкрутка тогда 
Запрос.Текст = Запрос.Текст + "  И ДополнительныеОперацииНаЭтапах.ИсполнениеЖилы	= &Исполн"; 
Запрос.УстановитьПараметр("Исполн", ИсполнениеЖилы);		
КонецЕсли;
Запрос.УстановитьПараметр("ВидОперации", 				ВидОп);		
Запрос.УстановитьПараметр("НаименованиеОборудования",	Оборудование);
Запрос.УстановитьПараметр("НаименованиеОперации", 		Операции[индекс][0]);

РезультатЗапроса 	= Запрос.Выполнить();		
ТЗ 					= РезультатЗапроса.Выгрузить();		
Операции[индекс][1] = ?(ТЗ.Количество()>=1,ТЗ[0].ЗначениеПараметра,0);     //всегда должна быть 1 запись				
Если ТЗ.Количество()<1 тогда Сообщить("Длительность операции "+Операции[индекс][0]+" для " + ВидОп + " на оборудование " + Оборудование + " не обнаружена!"+символы.ПС+"Расценка за эту операцию приравнена к 0.") КонецЕсли;;		
КонецЦикла;	           
Возврат Операции;



</details> 


 ## Функция НайтиНаименованияОпераций(Признак)	экспорт //Возврат массив с наименованиями операций

 <details> 
   <summary> 
     Код  </summary>
Операция  = Перечисления.ВидОперации;
ДопОп  = Перечисления.НаименованиеОперации;
Результат = Новый структура;
// признаки:
// 1 - Опрессовщик
// 2 - Скрутчик
// 3 - Волочильщик-мультик
// 4 - Волочильщик
// 5 - 70/90

Если 		Признак = 1 тогда       
Результат = Новый массив(3,2);

Результат[0][0]=ДопОп.СменаЦвета;
Результат[1][0]=ДопОп.СменаПластиката;
Результат[2][0]=ДопОп.СменаИнструмента;
ИначеЕсли 	Признак = 2 тогда                       
Результат = Новый массив(4,2);            
Результат[0][0]=ДопОп.СнятиеЗаряднойКатушки;
Результат[1][0]=ДопОп.УстановкаЗаряднойКатушки;   
Результат[2][0]=ДопОп.СнятиеПустыхКатушекИзПодЭкранаБрони;//
Результат[3][0]=ДопОп.УстановкаКатушекСПроволочнымЭкраномБроней;//

ИначеЕсли 	Признак = 3 тогда                       
Результат = Новый массив(4,2); 
Результат[0][0]=ДопОп.СменаКатушкиНаПриёмнике;
Результат[1][0]=ДопОп.ЗаменаВолоки;
Результат[2][0]=ДопОп.СменаКорзин;
Результат[3][0]=ДопОп.ПереходНаМаркоРазмер;
ИначеЕсли 	Признак = 4 тогда 	                    
Результат = Новый массив(3,2);   
Результат[0][0]=ДопОп.СменаКатушкиНаПриёмнике;
Результат[1][0]=ДопОп.СменаБунта;
Результат[2][0]=ДопОп.ПереходНаМаркоРазмер;
ИначеЕсли 	Признак = 5 тогда                       
Результат = Новый массив(5,2);   
Результат[0][0]=ДопОп.СменаКатушкиНаПриёмнике;
Результат[1][0]=ДопОп.СменаЦвета;
Результат[2][0]=ДопОп.СменаПластиката;
Результат[3][0]=ДопОп.СменаИнструмента;
Результат[4][0]=ДопОп.СменаКатушкиНаОтдатчике;
КонецЕсли;
Возврат Результат;

</details>	


 ## Функция НайтиЛинейнуюСкорость(Оборудование,ВидОперации,Маркоразмер,Материал,Сечение) экспорт  //Находит линейную скорость оборудования 

 <details> 
   <summary> 
     Код  </summary>
	ВидОп=ВидОперации;//вид операции в эту функцию
	Если Материал = Неопределено Тогда МатериалВЗапрос = Справочники.НоменклатураМатериалов.НайтиПоКоду("") Иначе МатериалВЗапрос=Материал КонецЕсли;
	Если ВидОперации=Перечисления.ВидОперации.ОбмоткаБроней или ВидОперации=Перечисления.ВидОперации.ОбщаяСкрутка тогда МатериалВЗапрос = Справочники.НоменклатураМатериалов.НайтиПоКоду("") КонецЕсли;
	Если ВидОперации=Перечисления.ВидОперации.СкруткаСтренги тогда ВидОп=Перечисления.ВидОперации.СкруткаТПЖ КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЛинейныеСкоростиОборудований.Период КАК Период,
	|	ЛинейныеСкоростиОборудований.НаименованиеОборудования КАК НаименованиеОборудования,
	|	ЛинейныеСкоростиОборудований.ВидОперации КАК ВидОперации,
	|	ЛинейныеСкоростиОборудований.Материал КАК Материал,
	|	ЛинейныеСкоростиОборудований.ДиаметрПроволоки КАК ДиаметрПроволоки,
	|	ЛинейныеСкоростиОборудований.ДиаметрПроволокиОт КАК ДиаметрПроволокиОт,
	|	ЛинейныеСкоростиОборудований.НомерОборудования КАК НомерОборудования,
	|	ЛинейныеСкоростиОборудований.РазмерКусков КАК РазмерКусков,
	|	ЛинейныеСкоростиОборудований.БратьВРаботу КАК БратьВРаботу,
	|	ЛинейныеСкоростиОборудований.Сечение КАК Сечение,
	|	ЛинейныеСкоростиОборудований.ШиринаБрони КАК ШиринаБрони,
	|	ЛинейныеСкоростиОборудований.КоличествоПроволоки КАК КоличествоПроволоки,
	|	ЛинейныеСкоростиОборудований.ИсполнениеЖилы КАК ИсполнениеЖилы,
	|	ЛинейныеСкоростиОборудований.СечениеОт КАК СечениеОт,
	|	ЛинейныеСкоростиОборудований.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования,
	|	ЛинейныеСкоростиОборудований.ЕдиницыИзмерения КАК ЕдиницыИзмерения
	|ИЗ
	|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинейныеСкоростиОборудований
	|ГДЕ
	|	ЛинейныеСкоростиОборудований.ВидОперации = &ВидОперации
	|	И ЛинейныеСкоростиОборудований.НаименованиеОборудования = &НаименованиеОборудования
	|	И ЛинейныеСкоростиОборудований.Материал = &Материал";
	Если СтрНайти(Строка(Оборудование),"1600") тогда                                                      //+10,05,23 Ставцев
		Запрос.Текст=Запрос.Текст+символы.ПС+"	И ЛинейныеСкоростиОборудований.Сечение >= &СечениеДО";		   
		//Вырезаем сечение из маркиЕРП            
		Если ВидОп=Перечисления.ВидОперации.ОбмоткаАлюмофлексом тогда
			МатериалВЗапрос=Справочники.НоменклатураМатериалов.ПустаяСсылка();	
		КонецЕсли;
		Если стрНайти(нрег(Сечение),"х")>0 тогда//ищем ХЭ
			СимволХ=стрНайти(нрег(Сечение),"х",НаправлениеПоиска.СКонца);//ХЭ
		Иначе
			СимволХ=стрНайти(нрег(Сечение),"x",НаправлениеПоиска.СКонца);//ИКС
		КонецЕсли;
		СечениеВЗапрос=	СтрЗаменить(Сред(Сечение,СимволХ+1,3),"+","");
		Запрос.УстановитьПараметр("СечениеДО", Число(СечениеВЗапрос));  //-   
	ИначеЕсли Оборудование.Наименование =  "Крутильная машина № 040 Двойной скрутки типа SH-BS1250"  тогда
		МатериалВЗапрос=Справочники.НоменклатураМатериалов.НайтиПоКоду("000000024");	
	КонецЕсли; 
	//Если ВидОп=Перечисления.ВидОперации.ОбмоткаБроней тогда
	//	Запрос.Текст=стрзаменить(Запрос.Текст,"КАК Материал","КАК Материал, ЛинейныеСкоростиОборудований.ШиринаБрони КАК ШиринаБрони");
	//
	//КонецЕсли;
	Запрос.УстановитьПараметр("НаименованиеОборудования", Оборудование);
	Запрос.УстановитьПараметр("ВидОперации", ВидОп);	
	
	Запрос.УстановитьПараметр("Материал", МатериалВЗапрос);
	РезультатЗапроса = Запрос.Выполнить();
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();    //пересмотреть условие
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл					
		//пресс                                                               
		Если ВидОп = Перечисления.ВидОперации.Изоляция 
			или ВидОп = Перечисления.ВидОперации.ОболочкаКруглый 
			или ВидОп = Перечисления.ВидОперации.ОболочкаПлоский
			или ВидОп = Перечисления.ВидОперации.Заполнение
			или ВидОп = Перечисления.ВидОперации.ЗаполнениеИОболочка
			или ВидОп = Перечисления.ВидОперации.ОболочкаШлангом
			или ВидОп = Перечисления.ВидОперации.ОболочкаПлоскийШлангом
			или ВидОп = Перечисления.ВидОперации.Изоляция3слоя //Минайкин 
			тогда				 						
			Если ВыборкаДетальныеЗаписи.ВидОперации=ВидОп 
				и ВыборкаДетальныеЗаписи.НаименованиеОборудования=Оборудование
				и ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования<>0 
				и ВыборкаДетальныеЗаписи.Материал=МатериалВЗапрос
				тогда												
				Результат=ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
				Возврат результат;						
			КонецЕсли;
			//скрутка						
		ИначеЕсли ВидОп = Перечисления.ВидОперации.СкруткаТПЖ 						
			или ВидОп = Перечисления.ВидОперации.СкруткаСтренги 
			или ВидОп = Перечисления.ВидОперации.ОбщаяСкрутка
			или ВидОп = Перечисления.ВидОперации.ОбщаяСкрутка6кВ
			или ВидОп = Перечисления.ВидОперации.ОбмоткаАлюмофлексом
			или ВидОп = Перечисления.ВидОперации.Обмотка1Слой
			или ВидОп = Перечисления.ВидОперации.Обмотка2Слоя
			или ВидОп = Перечисления.ВидОперации.ОбмоткаБроней
			или ВидОп = Перечисления.ВидОперации.ОбмоткаПроволочнойБронёй
			или ВидОп = Перечисления.ВидОперации.ОбмоткаПроволочнымЭкраном										
			тогда		
			Если ВыборкаДетальныеЗаписи.НаименованиеОборудования.Наименование =  "Крутильная машина № 040 Двойной скрутки типа SH-BS1250"  тогда
				Если стрНайти(нрег(Сечение),"х")>0 тогда//ищем ХЭ
					СимволХ=стрНайти(нрег(Сечение),"х",НаправлениеПоиска.СКонца);//ХЭ
				Иначе
					СимволХ=стрНайти(нрег(Сечение),"x",НаправлениеПоиска.СКонца);//ИКС
				КонецЕсли;
				СечениеВЗапрос=	СтрЗаменить(Сред(Сечение,СимволХ+1,3),"+","");
				//Это страх, надо переделать функцию , но пока так
				Если ВыборкаДетальныеЗаписи.ВидОперации=ВидОп тогда
					Если ВидОп=Перечисления.ВидОперации.ОбщаяСкрутка   
						и строка(ВыборкадетальныеЗаписи.Сечение) = СечениеВЗапрос 
						тогда
						Результат=ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
						Возврат результат;
						
					ИначеЕсли  ВидОп=Перечисления.ВидОперации.СкруткаТПЖ тогда      
						Если не (ВыборкаДетальныеЗаписи.ДиаметрПроволоки.Наименование="" или ВыборкаДетальныеЗаписи.ДиаметрПроволокиОТ.Наименование="") тогда
							Если МаркоРазмер<=Число(ВыборкаДетальныеЗаписи.ДиаметрПроволоки.Наименование)
								и 
								МаркоРазмер>=Число(ВыборкаДетальныеЗаписи.ДиаметрПроволокиОТ.Наименование) 
								тогда             
								Результат=ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
								Возврат результат;	
							КонецЕсли;
						КонецЕсли;
					КонецЕсли;
					//и ВыборкаДетальныеЗаписи.Материал=МатериалВЗапрос	
					//НУЖНО ДОБАВИТЬ СЮДА РАЗДЕЛЕНИЕ МЕТАЛЛОВ АЛЮМ/МЕДЬ
					
				КонецЕсли;
				
				
			Иначе
				Если ВыборкаДетальныеЗаписи.ВидОперации=ВидОп 
					и ВыборкаДетальныеЗаписи.НаименованиеОборудования=Оборудование
					и ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования<>0 
					и ВыборкаДетальныеЗаписи.Материал=МатериалВЗапрос				
					тогда	
					Если ВидОп = Перечисления.ВидОперации.ОбмоткаБроней тогда
						Если СтрНайти(Материал,ВыборкаДетальныеЗаписи.ШиринаБрони) тогда 
							Результат=ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;  
							Возврат результат;													
							
						КонецЕсли;
					Иначе
						Результат=ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;      
						Возврат результат;													
					КонецЕсли;                                                 
				КонецЕсли;
				
			КонецЕсли;
			//Волочилка   
		ИначеЕсли ВидОп = Перечисления.ВидОперации.Волочение 												
			тогда		                                            
			//+30.12.22
			Если МаркоРазмер=0 тогда МаркоРазмер=1.8 КонецЕсли; //+31.01 новый размер
			//-
			Если ВыборкаДетальныеЗаписи.ВидОперации=ВидОп 
				и ВыборкаДетальныеЗаписи.НаименованиеОборудования=Оборудование
				и ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования<>0 
				и ВыборкаДетальныеЗаписи.ДиаметрПроволоки=Справочники.СправочникДиаметрыПроволки.НайтиПоНаименованию(МаркоРазмер)						
				и ВыборкаДетальныеЗаписи.Материал=МатериалВЗапрос
				тогда												
				Результат=ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
				Возврат результат;							
			КонецЕсли;	
			//Мультиваер							
		ИначеЕсли ВидОп = Перечисления.ВидОперации.ВолочениеМультивайер						
			тогда				
			Если ВыборкаДетальныеЗаписи.ВидОперации=ВидОп 							
				и ВыборкаДетальныеЗаписи.НаименованиеОборудования=Оборудование						
				и ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования<>0 
				и ВыборкаДетальныеЗаписи.ДиаметрПроволоки=Справочники.СправочникДиаметрыПроволки.НайтиПоНаименованию(МаркоРазмер)						
				тогда																			
				Результат=ВыборкаДетальныеЗаписи.ЛинейнаяСкоростьОборудования;
				Возврат результат;			
				
			КонецЕсли;	
		КонецЕсли															
	КонецЦикла;             
	Если МаркоРазмер=0 тогда 
		Сообщить("Маркоразмер = 0, линейная скорость не может быть найдена");		
	иначе		
		Сообщить("Линейная скорость оборудования "+Строка(Оборудование)+"("+ВидОп+")"+" для материала: "+Строка(МатериалВЗапрос) +" не найдена!");	
	КонецЕсли;

</details>


 ## Функция НайтиЛСкорость(СсылкаНаЗаказ,ИсходныйМатериал,ВидОп,Оборуд,номерОперации=1) экспорт    

 <details> 
   <summary> 
     Код  </summary>
	Операция 	= Перечисления.ВидОперации;	
	Док 		= СсылкаНаЗаказ;
	Материал 	= ИсходныйМатериал;
	Бугель1600	=?(Строка(Оборуд)="Крутильная машина № 007 Бугель ХМ 1600/1+5",Истина,Ложь);  
	Драм 		=?(Строка(Оборуд)="Крутильная машина № 017 Драмтвистер  JPD-2500",Истина,Ложь); 
	ДС			=?(Строка(Оборуд)="Крутильная машина № 040 Двойной скрутки типа SH-BS1250",Истина,Ложь);  
	
	Если ВидОп=Операция.Волочение тогда // только волочение. //++
		Если НомерОперации=1 тогда //если ДиамПровДляПотрВМеталле = 0 тогда это мультик, иначе без мультика
			Диам = ?(число(Док.ДиаметрПроволокиДляПотребностиВМеталле) = 0,1.8,Док.ДиаметрПроволоки); //+31.01.2024
		Иначе      //плюсовой\не плюсовой
			Диам = ?(число(Док.ДиаметрПроволокиДляПотребностиВМеталле) = 0,1.8,Док.ДиаметрПроволокиПлюсовой);//+31.01.2024
		КонецЕсли;
	Иначе //всё остальное. Если Плюсовой - тогда плюсовой диам, иначе - обычный диам   
		Диам = ?(НомерОперации=2,Док.ДиаметрПроволокиПлюсовой,Док.ДиаметрПроволоки);
	КонецЕсли;    
	
	Сечение = Док.Сечение;     
	КолПров = Док.КоличествоЗарядныхКатушекНаСтренге*Док.КоличествоПроволокНаОднойКатушке;
	
	Если ДС тогда         
		Диам = Число(Диам);
		//НомОп всегда либо 1 либо 2, 2 - плюсовой... тут подходит...
		Материал = Док.ЭтапыИОборудование.НайтиСтроки(Новый Структура("ВидОперации",Операция.Волочение))[НомерОперации-1].Материал1;
		Материал = ?(СтрНайти(Материал,"алюм")>0,Справочники.НоменклатураМатериалов.НайтиПоКоду("000000007"),Справочники.НоменклатураМатериалов.НайтиПоКоду("000000024")); 
	КонецЕсли;
	ЛС = 0;    //скорость, может быть в оборотах
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЛинСкор.Период КАК Период,
	|	ЛинСкор.НаименованиеОборудования КАК Оборуд,
	|	ЛинСкор.ВидОперации КАК ВидОп,
	|	ЛинСкор.Материал КАК Материал,
	|	ЛинСкор.ДиаметрПроволоки КАК ДиамДО,
	|	ЛинСкор.ДиаметрПроволокиОт КАК ДиамОТ,
	|	ЛинСкор.БратьВРаботу КАК БратьВРаботу,
	|	ЛинСкор.Сечение КАК СечДО,
	|	ЛинСкор.ШиринаБрони КАК ШиринаБрони,
	|	ЛинСкор.КоличествоПроволоки КАК КолПров,
	|	ЛинСкор.СечениеОт КАК СечОТ,
	|	ЛинСкор.ЛинейнаяСкоростьОборудования КАК ЛинейнаяСкоростьОборудования,
	|	ЛинСкор.ЕдиницыИзмерения КАК ЕдиницыИзмерения,
	|	ЛинСкор.ИсполнениеЖилы КАК ИспЖилы
	|ИЗ
	|	РегистрСведений.ЛинейныеСкоростиОборудований КАК ЛинСкор
	|ГДЕ
	|	ЛинСкор.НаименованиеОборудования = &Оборудование
	|	И ЛинСкор.ВидОперации = &ВидОперации";	
	Запрос.УстановитьПараметр("Оборудование",Оборуд);
	Запрос.УстановитьПараметр("ВидОперации",ВидОп);
	РезультатЗапроса = Запрос.Выполнить();
	ПараметрыПоискаЛС = Символы.ПС+"Параметры поиска:"+Символы.ПС+" Вид операции: "+ ВидОп;
	
	ТЗ = РезультатЗапроса.Выгрузить();
	//ОБЩАЯ СКРУТКА- ДС////////////////////////////////////////////////////		
	Если ВидОп=Операция.ОбщаяСкрутка и ДС тогда   //++   
		Отбор = ТЗ.НайтиСтроки(Новый Структура("СечДО, Материал",Число(Сечение.Наименование),Материал));
		Если	 Отбор.Количество()=1 тогда
			ЛС = Отбор[0].ЛинейнаяСкоростьОборудования;
		КонецЕсли;  
		ПараметрыПоискаЛС = ПараметрыПоискаЛС +символы.ПС+ "Материал: "+ Материал + символы.ПС+ "Сечение: "+ Сечение;
		//СКРУТКА ТПЖ- ДС////////////////////////////////////////////////////			
	ИначеЕсли ВидОп=Операция.СкруткаТПЖ и ДС тогда //++ 
		Для каждого Скорость из ТЗ цикл
			Если не (Скорость.ДиамОТ.Наименование="" или Скорость.ДиамДО.Наименование="") тогда
				Если 	Диам>=Число(Скорость.ДиамОТ.Наименование)
					и 	Диам<=Число(Скорость.ДиамДО.Наименование) 
					И	Материал=Скорость.Материал тогда    
					ЛС=Скорость.ЛинейнаяСкоростьОборудования; Прервать;
				КонецЕсли;
			КонецЕсли;
		КонецЦикла;      
		ПараметрыПоискаЛС = ПараметрыПоискаЛС +символы.ПС+ "Диаметр: "+ Диам+символы.ПС+ "Материал: "+ Материал;
		//АЛЮМОФЛЕКС- БУГЕЛЬ////////////////////////////////////////////////////		
	ИначеЕсли ВидОп= Операция.ОбмоткаАлюмофлексом и Бугель1600 тогда //++
		ИспЖилы=?(Док.ИсполнениеЖилы.Наименование="мс","мк",Док.ИсполнениеЖилы.Наименование);
		Запрос.Текст=Запрос.Текст+символы.ПС+"	И ЛинейныеСкоростиОборудований.ИсполнениеЖилы.наименование = &ИспЖилы";		   
		Запрос.Текст=Запрос.Текст+символы.ПС+"	И &Сечение МЕЖДУ ЛинейныеСкоростиОборудований.СечениеОт И ЛинейныеСкоростиОборудований.Сечение";		   
		Запрос.УстановитьПараметр("Сечение",Число(Сечение.Наименование));
		Запрос.УстановитьПараметр("ИспЖилы",ИспЖилы);
		ТЗ = Запрос.Выполнить().Выгрузить();
		
		Если	 ТЗ.Количество()=1 тогда
			ЛС = ТЗ[0].ЛинейнаяСкоростьОборудования;    		
		КонецЕсли;             
		ПараметрыПоискаЛС = ПараметрыПоискаЛС +символы.ПС+ "Сечение: "+ Сечение+символы.ПС+ "Исполнение жилы: " + ИспЖилы ;
		//ОБЩАЯ СКРУТКА - БУГЕЛЬ////////////////////////////////////////////////////	
	ИначеЕсли ВидОп= Операция.ОбщаяСкрутка		и Бугель1600 тогда     //++
		Сечение = ?(Число(Сечение.Наименование)>50,1000,50);
		
		Отбор = ТЗ.НайтиСтроки(Новый Структура("СечДО",Сечение));
		Если	 Отбор.Количество()=1 тогда
			ЛС = Отбор[0].ЛинейнаяСкоростьОборудования;
		КонецЕсли;  
		ПараметрыПоискаЛС = ПараметрыПоискаЛС +символы.ПС+ "Сечение: "+ Сечение;
		//ВОЛОЧЕНИЕ////////////////////////////////////////////////////			
	ИначеЕсли  ВидОп = Операция.Волочение тогда       //++
		Диам = Справочники.СправочникДиаметрыПроволки.НайтиПоНаименованию(СтрЗаменить(строка(Диам),".",","));
		Отбор = ТЗ.НайтиСтроки(Новый Структура("ДиамДО,Материал",Диам,Материал));
		Если	 Отбор.Количество()=1 тогда
			ЛС = Отбор[0].ЛинейнаяСкоростьОборудования;
		КонецЕсли;                
		ПараметрыПоискаЛС = ПараметрыПоискаЛС +символы.ПС+ "Диаметр: "+ Диам+символы.ПС+ "Материал: "+ Материал;
		//ВОЛОЧЕНИЕ-МУЛЬТИК////////////////////////////////////////////////////			
		
	ИначеЕсли ВидОп = Операция.ВолочениеМультивайер тогда	//++			
		Диам = Справочники.СправочникДиаметрыПроволки.НайтиПоНаименованию(Диам);
		Отбор = ТЗ.НайтиСтроки(Новый Структура("ДиамДО",Диам));
		Если	 Отбор.Количество()=1 тогда
			ЛС = Отбор[0].ЛинейнаяСкоростьОборудования;    		
		КонецЕсли;            
		ПараметрыПоискаЛС = ПараметрыПоискаЛС +символы.ПС+ "Диаметр: "+ Диам;        
		//СКРУТКА СТРЕНГИ////////////////////////////////////////////////////			
	ИначеЕсли ВидОп = Операция.СкруткаСтренги тогда  //++          
		Диам = Справочники.СправочникДиаметрыПроволки.НайтиПоНаименованию(Диам);
		Запрос.УстановитьПараметр("ВидОперации",Операция.СкруткаТПЖ);
		ТЗ = Запрос.Выполнить().Выгрузить();
		Отбор = ТЗ.НайтиСтроки(Новый Структура("ДиамДО,КолПров",Диам,КолПров));
		Если	 Отбор.Количество()=1 тогда
			ЛС = Отбор[0].ЛинейнаяСкоростьОборудования;    		
		КонецЕсли;             
		ПараметрыПоискаЛС = ПараметрыПоискаЛС +символы.ПС+ "Диаметр: "+ Диам+символы.ПС+ "Количество проволочек: "+ КолПров;
		//ОБМОТКА АЛЮМФОЛЕКСОМ////////////////////////////////////////////////////				
	ИначеЕсли ВидОп=Операция.ОбмоткаАлюмофлексом тогда    //++
		Отбор = ТЗ.НайтиСтроки(Новый Структура("Материал",Справочники.НоменклатураМатериалов.ПустаяСсылка()));
		
		Если	 Отбор.Количество()=1 тогда
			ЛС = Отбор[0].ЛинейнаяСкоростьОборудования;    		
		КонецЕсли;       
		//ОБЩАЯ СКРУТКА////////////////////////////////////////////////////				
	ИначеЕсли ВидОп=Операция.ОбщаяСкрутка тогда    //++
		Отбор = ТЗ.НайтиСтроки(Новый Структура("Материал",Справочники.НоменклатураМатериалов.ПустаяСсылка()));
		Если	 Отбор.Количество()=1 тогда
			ЛС = Отбор[0].ЛинейнаяСкоростьОборудования;    		
		КонецЕсли;     
		//ОБМОТКА БРОНЁЙ////////////////////////////////////////////////////				
	ИначеЕсли ВидОп=Операция.ОбмоткаБроней тогда    //++
		ШиринаБрони = Сред(Материал.Ширина_Толщина,СтрНайти(Материал.Ширина_Толщина,"х")+1);
		Отбор = ТЗ.НайтиСтроки(Новый Структура("ШиринаБрони",Число(ШиринаБрони)));
		Если	 Отбор.Количество()=1 тогда
			ЛС = Отбор[0].ЛинейнаяСкоростьОборудования;    		
		КонецЕсли;     
		//ОБМОТКА ПРОВОЛОЧНОЙ БРОНЁЙ - ДРАМ////////////////////////////////////////////////////				
	ИначеЕсли ВидОп = Операция.ОбмоткаПроволочнойБронёй и Драм тогда
		Диам = Материал.Толщина;   //выбираем исходя из толщины проволоки брони!
		Для каждого Скорость из ТЗ цикл
			Если не (Скорость.ДиамОТ.Наименование="" или Скорость.ДиамДО.Наименование="") тогда
				Если 	Диам>=Число(Скорость.ДиамОТ.Наименование)
					и 	Диам<=Число(Скорость.ДиамДО.Наименование) тогда    
					ЛС=Скорость.ЛинейнаяСкоростьОборудования; Прервать;
				КонецЕсли;
			КонецЕсли;
		КонецЦикла;      
		
		ПараметрыПоискаЛС = ПараметрыПоискаЛС +символы.ПС+ "Обмотка проволочной бронёй: "+ Диам+символы.ПС;
		//ОБМОТКА ПРОВОЛОЧНОЙ БРОНЁЙ ////////////////////////////////////////////////////					
	ИначеЕсли ВидОп = Операция.ОбмоткаПроволочнойБронёй тогда
		//ОБМОТКА ПРОВОЛОЧНЫМ ЭКРАНОМ////////////////////////////////////////////////////					
	ИначеЕсли ВидОп = Операция.ОбмоткаПроволочнымЭкраном тогда
		Если	 ТЗ.Количество()=1 тогда
			ЛС = ТЗ[0].ЛинейнаяСкоростьОборудования;
		КонецЕсли;  
		ПараметрыПоискаЛС = ПараметрыПоискаЛС +символы.ПС+ "Обмотка проволочным экраном";
	Иначе   
		Отбор = ТЗ.НайтиСтроки(Новый Структура("Материал",Материал));       //Изол, оболочка
		Если	 Отбор.Количество()=1 тогда
			ЛС = Отбор[0].ЛинейнаяСкоростьОборудования;    		
		КонецЕсли;                                          
		ПараметрыПоискаЛС = ПараметрыПоискаЛС +символы.ПС+ "Материал: "+ Материал;
	КонецЕсли;
	Если ВидОп = Операция.Изоляция и Материал = Справочники.НоменклатураМатериалов.ПустаяСсылка() тогда
		//Сообщаем в другом месте	
	Иначе
		Если ЛС = 0 тогда сообщить("Линейная скорость оборудования "+Оборуд+" не найдена"+ПараметрыПоискаЛС) КонецЕсли;;
	КонецЕсли;
	Возврат ЛС;
	

</details>


 ## Функция ПолучитьСсылкуНаДок(НомерСчета) экспорт  //находит ссылку на документ по номеру счета

 <details> 
   <summary> 
     Код  </summary>
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЗаказыВПроизводство.Ссылка КАК Ссылка
	|ИЗ
	|	Документ.ЗаказыВПроизводство КАК ЗаказыВПроизводство
	|ГДЕ
	|	ЗаказыВПроизводство.НомерСчета = &НомерСчета
	| 	И ЗаказыВПроизводство.ПометкаУдаления = ЛОЖЬ";
	КолВоЗаказов=ПроверитьКоличествоЗаказов(НомерСчета);
	Если КолвоЗаказов.количество()>1 тогда //+01.02.23 
		Запрос.Текст=Запрос.Текст+" И Год(ЗаказыВПроизводство.ссылка.Дата)= &Дата";
		Запрос.УстановитьПараметр("Дата", Год(ТекущаяДатаСеанса()));
	КонецЕсли;
	
	Запрос.УстановитьПараметр("НомерСчета", НомерСчета);
	РезультатЗапроса = Запрос.Выполнить();
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		Возврат ВыборкаДетальныеЗаписи.Ссылка;
	КонецЦикла;
	Сообщить("Ссылка на документ #"+НомерСчета+" не найдена!");

</details>


 ## Функция ОпределитьОборудованиеИМаркоРазмер(ВидОперации, СсылкаНаЗаказ, НомерОперации)  экспорт//Находит оборудование и маркоразмер

 <details> 
   <summary> 
     Код  </summary>
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЗВП_ЭТАПЫ.НазваниеОборудования КАК НазваниеОборудования,
	|	ЗаказыВПроизводство.Ссылка КАК Ссылка
	|ИЗ
	|	Документ.ЗаказыВПроизводство.ЭтапыИОборудование КАК ЗВП_ЭТАПЫ
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЗаказыВПроизводство КАК ЗаказыВПроизводство
	|		ПО ЗВП_ЭТАПЫ.Ссылка = ЗаказыВПроизводство.Ссылка
	|ГДЕ
	|	ЗВП_ЭТАПЫ.ВидОперации = &ВидОперации
	|	И ЗВП_ЭТАПЫ.Ссылка = &СсылкаНаЗаказ";	
	
	Запрос.УстановитьПараметр("СсылкаНаЗаказ", СсылкаНаЗаказ);
	Запрос.УстановитьПараметр("ВидОперации", ВидОперации);
	РезультатЗапроса = Запрос.Выполнить();
	ВДЗ = РезультатЗапроса.Выбрать();
	Если ВДЗ.Количество()>0 тогда 
		Счетчик=0;                      
		Пока ВДЗ.Следующий() Цикл
			Счетчик=Счетчик+1;
			Если Счетчик=НомерОперации тогда
				Результат=Новый Структура;
				Если ВидОперации = Перечисления.ВидОперации.Волочение Тогда 
					//Волочилка
					Если ВДЗ.Ссылка.ДиаметрПроволокиДляПотребностиВМеталле = "0" или ВДЗ.Ссылка.ДиаметрПроволокиДляПотребностиВМеталле = 0 Тогда
						//Значит 2 этап мультивайер... маркоразмер 2,08
						Результат.Вставить("МаркоРазмер", "1,80");		
					Иначе
						//Мультика нет
						Если ВДЗ.Ссылка.ПлюсовойКабель и НомерОперации > 1 Тогда
							//Плюсовой
							Результат.Вставить("МаркоРазмер", ВДЗ.Ссылка.ДиаметрПроволокиПлюсовой);		
						Иначе
							Результат.Вставить("МаркоРазмер", ВДЗ.Ссылка.ДиаметрПроволоки);				
						КонецЕсли;	
					КонецЕсли;			
					//Мультивайер				
				Иначе
					Если ВДЗ.Ссылка.ПлюсовойКабель и НомерОперации > 1 Тогда
						//Плюсовой
						Результат.Вставить("МаркоРазмер", ВДЗ.Ссылка.ДиаметрПроволокиПлюсовой);		
					Иначе
						Результат.Вставить("МаркоРазмер", ВДЗ.Ссылка.ДиаметрПроволоки);				
					КонецЕсли;
				КонецЕсли;
				Результат.Вставить("Оборудование",ВДЗ.НазваниеОборудования);
				Возврат Результат;
			КонецЕсли;
		КонецЦикла;
	иначе 
		Сообщить("Оборудование по заказу #"+ СсылкаНаЗаказ.НомерСчета+" и виду операции #"+ ВидОперации +" не найдено. Проверьте данные!");
	КонецЕсли;

</details>

///////+10.04.2024
## &НаСервере   ПерезаписатьЗаказ(СсылкаНаЗаказ) экспорт

 <details> 
   <summary> 
     Код  </summary>

	Док=СсылкаНаЗаказ.ПолучитьОбъект(); 
	Док.н_Принудительныйпересчет=Истина; 
	Если Док.статусЗаказа=Перечисления.СтатусыПроизводства.Изготовлен тогда
		Статус=	Док.статусЗаказа;
		Док.статусЗаказа=Перечисления.СтатусыПроизводства.НаИспытании;		
	КонецЕсли;
	Док.Записать();
	Если не статус=Неопределено тогда
		Док.статусЗаказа=Статус;
		Док.Записать();
	КонецЕсли;	

</details>

///////-10.04.2024

//целиком сюда не перенесено (используется и в форме документа и в форме списка)
## &НаСервере   ОпрессовщикНомерСчетаПриИзмененииНаСервере(ТД, Документ)	экспорт

 <details> 
   <summary> 
     Код  </summary>
	Операция 					= Перечисления.ВидОперации;
	ПараметрыДляРасчета 		= Новый Структура;
	ДлительностьОпераций 		= Новый Структура;
	ВидОперации 				= ТД.ВидОперации;                                                                               
	ОборудованиеИМаркоРазмер	= ОпределитьОборудованиеИМаркоРазмер(ВидОперации, ТД.СсылкаНаЗаказ,ТД.номерОперации);		
	ПараметрыДляРасчета 		= ПараметрыДляРасчетаИзЗаказа(ТД.СсылкаНаЗаказ, ВидОперации,ОборудованиеИМаркоРазмер.Оборудование.Наименование, ТД.НомерОперации);
	Если ПараметрыДляРасчета = ложь тогда
	иначе			                              
		РасценкаЗаСменуИКоэффициент	= РасчетРасценкиЗаСмену(ОборудованиеИМаркоРазмер.Оборудование);
		ПараметрыДляРасчета.Вставить("РасценкаЗаСмену", РасценкаЗаСменуИКоэффициент.РасценкаЗаСмену);			
		ДопОперации 							= НайтиНаименованияОпераций(1);
		ДопОперации 							= НайтиДлительностьОпераций1(ОборудованиеИМаркоРазмер.Оборудование, ВидОперации, ДопОперации);
		НовСтр									= Документ.Опрессовщик[ТД.НомерСтроки-1];
		ЗаполнитьЗначенияСвойств(НовСтр,ПараметрыДляРасчета);
		НовСтр.РасценкаЗаКМ						= РасчетРасценокЗаКМ(ПараметрыДляРасчета.РасценкаЗаСмену,ПараметрыДляРасчета.ДлинаКон,ПараметрыДляРасчета.ВремяИзготовленияПоЗаказу);
		НовСтр.МаркоРазмер						= ОборудованиеИМаркоРазмер.Маркоразмер;			
		НовСтр.РасценкаЗаСменуЦвета				= ?(ВидОперации = Операция.Изоляция,РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[0][1]),0);				
		НовСтр.РасценкаЗаСменуПластиката 		= РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[1][1]);		
		НовСтр.РасценкаЗаСменуИнструмента		= РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[2][1]);		
		НовСтр.Оборудование						= ОборудованиеИМаркоРазмер.Оборудование;
		НовСтр.ЛинейнаяСкорость					= НайтиЛСкорость(НовСтр.СсылкаНаЗаказ,НовСтр.Материал1,НовСтр.ВидОперации,НовСтр.Оборудование, ТД.НомерОперации);	
		НовСтр.КоэффициентСмены					= ПоискКоэффициентаЗаСмену(НовСтр.Оборудование);
		Документ.Записать();                                           				
	КонецЕсли;

</details>
	 
## &НаСервере   СкрутчикНомерСчетаПриИзмененииНаСервере(ТД, Документ)экспорт

 <details> 
   <summary> 
     Код  </summary>
	ПараметрыДляРасчета 		= Новый Структура;
	ДлительностьОпераций 		= Новый Структура;
	ВидОперации = ТД.ВидОперации;                                                                               
	ОборудованиеИМаркоРазмер	= ОпределитьОборудованиеИМаркоРазмер(ВидОперации, ТД.СсылкаНаЗаказ,ТД.номерОперации);		
	ПараметрыДляРасчета 		= ПараметрыДляРасчетаИзЗаказа(ТД.СсылкаНаЗаказ, ВидОперации,ОборудованиеИМаркоРазмер.Оборудование.Наименование, ТД.НомерОперации);
	Если ПараметрыДляРасчета	= ложь тогда
	иначе			
		РасценкаЗаСменуИКоэффициент = РасчетРасценкиЗаСмену(ОборудованиеИМаркоРазмер.Оборудование);
		ПараметрыДляРасчета.Вставить("РасценкаЗаСмену", РасценкаЗаСменуИКоэффициент.РасценкаЗаСмену);			
		ДопОперации									= НайтиНаименованияОпераций(2);
		ДопОперации 								= НайтиДлительностьОпераций1(ОборудованиеИМаркоРазмер.Оборудование, ВидОперации, ДопОперации,ПолучитьСсылкуНаДок(ТД.НомерСчета).ИсполнениеЖилы);         
		НовСтр										= Документ.Скрутчик[ТД.НомерСтроки-1];
		ЗаполнитьЗначенияСвойств(НовСтр,ПараметрыДляРасчета);
		НовСтр.РасценкаЗаКМ							= РасчетРасценокЗаКМ(ПараметрыДляРасчета.РасценкаЗаСмену,ПараметрыДляРасчета.ДлинаКон,ПараметрыДляРасчета.ВремяИзготовленияПоЗаказу);
		НовСтр.МаркоРазмер							= ОборудованиеИМаркоРазмер.Маркоразмер;
		НовСтр.РасценкаЗаСнятиеЗаряднойКатушки		= РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[0][1]);
		НовСтр.РасценкаЗаУстановкуЗаряднойКатушки	= РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[1][1]);	
		НовСтр.РасценкаЗаСнятиеКатушкиБрониЭкрана	= РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[2][1]);
		НовСтр.РасценкаЗаУстановкуКатушкиБрониЭкрана= РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[3][1]);
		НовСтр.Оборудование							= ОборудованиеИМаркоРазмер.Оборудование;				
		НовСтр.ЛинейнаяСкорость						= НайтиЛСкорость(ТД.СсылкаНаЗаказ,НовСтр.Материал1,ВидОперации,НовСтр.Оборудование, ТД.НомерОперации);
		НовСтр.КоэффициентСмены						= ПоискКоэффициентаЗаСмену(НовСтр.Оборудование);
		Документ.Записать();                                           				
	КонецЕсли;

</details>
	 
## &НаСервере   ВолочильщикМультивайерНомерСчетаПриИзмененииНаСервере(ТД, Документ) экспорт 	

 <details> 
   <summary> 
     Код  </summary>
	ПараметрыДляРасчета = Новый Структура;
	ДлительностьОпераций = Новый Структура;
	Материал=Неопределено;
	ВидОперации = ТД.ВидОперации;                                                                               
	//Определяем Оборудование и маркоразмер
	ОборудованиеИМаркоРазмер=ОпределитьОборудованиеИМаркоРазмер(ВидОперации, ТД.СсылкаНаЗаказ,ТД.номерОперации);
	ПараметрыДляРасчета = ПараметрыДляРасчетаИзЗаказа(ТД.СсылкаНаЗаказ, ВидОперации,ОборудованиеИМаркоРазмер.Оборудование.Наименование,ТД.НомерОперации);
	Если ПараметрыДляРасчета= ложь тогда
	иначе			
		РасценкаЗаСменуИКоэффициент=РасчетРасценкиЗаСмену(ОборудованиеИМаркоРазмер.Оборудование);
		ПараметрыДляРасчета.Вставить("РасценкаЗаСмену", РасценкаЗаСменуИКоэффициент.РасценкаЗаСмену);
		ДопОперации = НайтиНаименованияОпераций(3);
		ДопОперации = НайтиДлительностьОпераций1(ОборудованиеИМаркоРазмер.Оборудование, ВидОперации, ДопОперации);	
		НовСтр=Документ.ВолочильщикМультивайер[ТД.НомерСтроки-1];
		ЗаполнитьЗначенияСвойств(НовСтр,ПараметрыДляРасчета);
		НовСтр.РасценкаЗаКМ							= РасчетРасценокЗаКМ(ПараметрыДляРасчета.РасценкаЗаСмену,ПараметрыДляРасчета.ДлинаКон,ПараметрыДляРасчета.ВремяИзготовленияПоЗаказу);
		НовСтр.МаркоРазмер 							= ОборудованиеИМаркоРазмер.Маркоразмер;
		НовСтр.РасценкаЗаПереходНаМаркоразмер		= РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[3][1]);
		НовСтр.РасценкаЗаСменуКорзин				= РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[2][1]);
		НовСтр.РасценкаЗаСменуВолок					= РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[1][1]);
		НовСтр.РасценкаЗаСменуКатушекНаПриемнике	= РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[0][1]);
		НовСтр.Оборудование								= ОборудованиеИМаркоРазмер.Оборудование; 
		НовСтр.ЛинейнаяСкорость							= НайтиЛСкорость(ТД.СсылкаНаЗаказ,ПараметрыДляРасчета.Материал1,ВидОперации,НовСтр.Оборудование, ТД.НомерОперации);	
		НовСтр.КоэффициентСмены							= ПоискКоэффициентаЗаСмену(НовСтр.Оборудование);
		Документ.Записать();
	КонецЕсли;

</details>
	 
## &НаСервере   ВолочильщикНомерСчетаПриИзмененииНаСервере(ТД, Документ)экспорт 

 <details> 
   <summary> 
     Код  </summary>
	ПараметрыДляРасчета 		= Новый Структура;
	ДлительностьОпераций 		= Новый Структура;
	Материал					= Неопределено;
	ВидОперации 				= ТД.ВидОперации;                                                                               
	ОборудованиеИМаркоРазмер	= ОпределитьОборудованиеИМаркоРазмер(ВидОперации, ТД.СсылкаНаЗаказ, ТД.номерОперации);
	ПараметрыДляРасчета 		= ПараметрыДляРасчетаИзЗаказа(ТД.СсылкаНаЗаказ, ВидОперации,ОборудованиеИМаркоРазмер.Оборудование.Наименование, ТД.НомерОперации);
	Если ПараметрыДляРасчета	= ложь тогда
	иначе
		РасценкаЗаСменуИКоэффициент=РасчетРасценкиЗаСмену(ОборудованиеИМаркоРазмер.Оборудование);
		ПараметрыДляРасчета.Вставить("РасценкаЗаСмену", РасценкаЗаСменуИКоэффициент.РасценкаЗаСмену);    //Удалить все ненужные комментарии 		
		ДопОперации 									= НайтиНаименованияОпераций(4);
		ДопОперации 									= НайтиДлительностьОпераций1(ОборудованиеИМаркоРазмер.Оборудование, ВидОперации, ДопОперации);
		НовСтр											= Документ.Волочильщик[ТД.НомерСтроки-1];			
		ЗаполнитьЗначенияСвойств(НовСтр,ПараметрыДляРасчета);
		НовСтр.РасценкаЗаКМ								= РасчетРасценокЗаКМ(ПараметрыДляРасчета.РасценкаЗаСмену,ПараметрыДляРасчета.ДлинаКон,ПараметрыДляРасчета.ВремяИзготовленияПоЗаказу);		
		НовСтр.МаркоРазмер 								= ОборудованиеИМаркоРазмер.Маркоразмер;
		НовСтр.РасценкаЗаСменуКатушекНаПриемнике		= РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[0][1]);
		НовСтр.РасценкаЗаСменуБунта						= РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[1][1]);
		НовСтр.РасценкаЗаПереходНаМаркоразмер			= РасчетРасценокЗаТехнологическуюОперацию(ПараметрыДляРасчета.РасценкаЗаСмену,ДопОперации[2][1]);
		НовСтр.Оборудование								= ОборудованиеИМаркоРазмер.Оборудование;			
		НовСтр.ЛинейнаяСкорость							= НайтиЛСкорость(ТД.СсылкаНаЗаказ,ПараметрыДляРасчета.Материал1,ВидОперации,НовСтр.Оборудование, ТД.НомерОперации);
		НовСтр.КоэффициентСмены							= ПоискКоэффициентаЗаСмену(НовСтр.Оборудование); 											
		Документ.Записать();
	КонецЕсли;

</details>
//-


## #Область   Коэффициенты_Выработки

 <details> 
   <summary> 
     Код  </summary>


 ## Функция КоэфЗаРазряд(ФИО)    экспорт  //находит коэф за разряд

 <details> 
   <summary> 
     Код  </summary>
	Сотрудник=Справочники.СписокСотрудниковИзЕРП.НайтиПоНаименованию(ФИО).ПолучитьОбъект();
	КоэфЗаРазряд=Сотрудник.КоэфЗаРазряд; 
	Если КоэфЗаРазряд=0 или КоэфЗаРазряд=Неопределено тогда
		КоэфЗаРазряд=1
	КонецЕсли;
	Возврат КоэфЗаРазряд;

</details>


 ## Функция	ПоискКоэффициентаЗаСмену(Оборудование) экспорт

 <details> 
   <summary> 
     Код  </summary>
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	НоменклатураОборудований.Наименование КАК Оборудование,
	|	НоменклатураОборудований.Коэффициент КАК Коэффициент
	|ИЗ
	|	Справочник.НоменклатураОборудований КАК НоменклатураОборудований
	|ГДЕ
	|	НоменклатураОборудований.Наименование = &Оборудование";
	Запрос.УстановитьПараметр("Оборудование", Строка(Оборудование));
	РезультатЗапроса = Запрос.Выполнить();
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл 
		Если ВыборкаДетальныеЗаписи.Оборудование=Строка(Оборудование) тогда
			Если ВыборкаДетальныеЗаписи.Коэффициент=0 или ВыборкаДетальныеЗаписи.Коэффициент=неопределено тогда					
				Результат=1;
				Возврат Результат
			иначе
				Результат=ВыборкаДетальныеЗаписи.Коэффициент;
				Возврат Результат;					
			КонецЕсли;			
		КонецЕсли;
	КонецЦикла;
	
	

</details>


 ## Функция РасчетКоэФЗагрОборуд(Групповой=Ложь,ВидОперации, НазваниеОборудования,НомерОперации,ПараметрыДляСкруткиТПЖ,СсылкаНаЗаказ)	экспорт	//доделать, возвращает ВремяНеЗависящееОтДлиныЗаказа ПустоеВремяНаЭтапе КоэффициентЗагруженностиОборудования ОбщееВремяНаЭтапе	

 <details> 
   <summary> 
     Код  </summary>
	Док=СсылкаНаЗаказ.ПолучитьОбъект();		
	ВО=Перечисления.ВидОперации;
	
	Если ВидОперации=ВО.СкруткаСтренги тогда
		
		Возврат РасчетКоэФЗагрОборуд_Стренга(Док.ссылка,НомерОперации,Групповой);			
	ИначеЕсли ВидОперации=ВО.ОбщаяСкрутка тогда
		
		Возврат РасчетКоэФЗагрОборуд_ОбщаяСкрутка(Док.ссылка,НомерОперации,Групповой);
	ИначеЕсли ВидОперации=ВО.СкруткаТПЖ тогда
		
		Возврат РасчетКоэФЗагрОборуд_СкруткаТПЖ(Док.ссылка,НомерОперации,Групповой,ПараметрыДляСкруткиТПЖ);		
	ИначеЕсли ВидОперации=ВО.ОбмоткаАлюмофлексом тогда
		
		Возврат РасчетКоэФЗагрОборуд_ОбмоткаАлюмофлексом_БронеОбмотка(Док.ссылка,НомерОперации,Групповой,ВидОперации);	
	ИначеЕсли ВидОперации=ВО.ОбмоткаБроней тогда
		
		Возврат РасчетКоэФЗагрОборуд_ОбмоткаАлюмофлексом_БронеОбмотка(Док.ссылка,НомерОперации,Групповой,ВидОперации);	
	ИначеЕсли ВидОперации=ВО.ОбмоткаПроволочнойБронёй тогда                       
		
		Возврат РасчетКоэФЗагрОборуд_ПоУмолчанию(Док.ссылка,НомерОперации,Групповой,ВидОперации);
	ИначеЕсли ВидОперации=ВО.ОбмоткаПроволочнымЭкраном тогда                       
		
		Возврат РасчетКоэФЗагрОборуд_ПоУмолчанию(Док.ссылка,НомерОперации,Групповой,ВидОперации);
		
	ИначеЕсли ВидОперации = ВО.Изоляция3слоя      //пресса...
		или ВидОперации = ВО.Изоляция
		или ВидОперации = ВО.Заполнение
		или ВидОперации = ВО.ЗаполнениеИОболочка
		или ВидОперации = ВО.ОболочкаКруглый
		или ВидОперации = ВО.ОболочкаПлоский
		или ВидОперации = ВО.ОболочкаПлоскийШлангом
		или ВидОперации = ВО.ОболочкаШлангом
		тогда 
		
		Возврат РасчетКоэФЗагрОборуд_пресса(Док.ссылка,НомерОперации,Групповой,ВидОперации);
	ИначеЕсли ВидОперации = ВО.Волочение тогда       
		Возврат ПоискКоэффициентаЗаСмену(НазваниеОборудования);     
	ИначеЕсли ВидОперации = ВО.ВолочениеМультивайер тогда       
		Возврат ПоискКоэффициентаЗаСмену(НазваниеОборудования);     
	Иначе
		Возврат РасчетКоэФЗагрОборуд_ПоУмолчанию(Док.ссылка,НомерОперации,Групповой,ВидОперации);
	КонецЕсли;           
	

</details>  
//в них всех одно и то же, но это явно лучше чем было...теперь хотя бы понятно что и куда идет, какие условия для них и тд.

//пресса

 ## Функция РасчетКоэФЗагрОборуд_пресса(СсылкаНаЗаказ,номерОперации,Групповой=Ложь,ВидОперации)     экспорт

 <details> 
   <summary> 
     Код  </summary>
	ОбщееВремяНаЭтапе=0;	
	ПустоеВремяНаЭтапе=0;
	ВремяСменаЦвета=0;
	Результат= Новый структура;
	
	//Если Номер операции =1 тогда это основной, если 2 тогда это плюсовой. Суммарный отстутствует в номере операции, для этого также используется 1				
	Если СсылкаНаЗаказ.ПлюсовойКабель тогда
		Если НомерОперации=1 тогда                                         
			ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.Основной;
		Иначе
			ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой;
		КонецЕсли; 
	иначе
		ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.ПустаяСсылка();	
	КонецЕсли;                                                                  
	
	ПараметрыОтбора = Новый Структура;
	ПараметрыОтбора.Вставить("ВидОперации", ВидОперации);
	ПараметрыОтбора.Вставить("Плюсовой", ПлюсовойКабель);                       
	
	НайденныеСтроки = СсылкаНаЗаказ.ДополнительныеОперацииНаЭтапах.НайтиСтроки(ПараметрыОтбора);  
	Если не НайденныеСтроки.Количество() и ПлюсовойКабель = Перечисления.ОсновнойПлюсовойСуммарный.Основной тогда           
		ПараметрыОтбора.Вставить("Плюсовой", Перечисления.ОсновнойПлюсовойСуммарный.Суммарный ); 
		НайденныеСтроки = СсылкаНаЗаказ.ДополнительныеОперацииНаЭтапах.НайтиСтроки(ПараметрыОтбора);  
	КонецЕсли;
	
	
	Для каждого строка из НайденныеСтроки цикл        
		Затраты 			= Строка.ЗатратыВремениНаОперацию;
		ОбщееВремяНаЭтапе 	= ОбщееВремяНаЭтапе + Затраты;     
		
		Если 	  Строка.НаименованиеОперации=Перечисления.НаименованиеОперации.СменаЦвета тогда
			ВремяСменаЦвета		= 	Затраты;                               
		ИначеЕсли Строка.НаименованиеОперации=Перечисления.НаименованиеОперации.ПустаяСсылка() тогда
			ПустоеВремяНаЭтапе	= 	Затраты;			
		КонецЕсли; 			
	КонецЦикла;  
	
	ВремяНеЗависящееОтДлиныЗаказа		 = ОбщееВремяНаЭтапе-ПустоеВремяНаЭтапе;               
	КоэффициентЗагруженностиОборудования = ПустоеВремяНаЭтапе/(ОбщееВремяНаЭтапе-ВремяСменаЦвета);	   
	
	Если Групповой > 0 тогда
		Результат.Вставить("ПустоеВремяНаЭтапе",					ПустоеВремяНаЭтапе);
		Результат.Вставить("ВремяНеЗависящееОтДлиныЗаказа",			ВремяНеЗависящееОтДлиныЗаказа);
		Результат.Вставить("КоэффициентЗагруженностиОборудования",	КоэффициентЗагруженностиОборудования);                 
		Результат.Вставить("ОбщееВремяНаЭтапе",						ОбщееВремяНаЭтапе);
	иначе
		Результат = КоэффициентЗагруженностиОборудования;
	КонецЕсли;
	
	Возврат Результат; 

</details>
//стренга

 ## Функция РасчетКоэФЗагрОборуд_Стренга(СсылкаНаЗаказ,номерОперации,Групповой=Ложь)     экспорт

 <details> 
   <summary> 
     Код  </summary>
	
	ДанныеПоЭтапамУрезанные		= СобратьУрезанныеДанныеПоЭтапам(СсылкаНаЗаказ);
	ПараметрыЗаказаУрезанные	= СобратьУрезанныеПараметрыЗаказа(СсылкаНаЗаказ); 
	
	//Определяем плюсовой. Номер операции 1 - основной/суммарный, 2 - плюсовой
	Если СсылкаНаЗаказ.ПлюсовойКабель тогда
		Если НомерОперации=1 тогда                                         
			ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.Основной;
		Иначе
			ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой;
		КонецЕсли; 
	иначе
		ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.ПустаяСсылка();	
	КонецЕсли;     
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЗаказыВПроизводствоЭтапыИОборудование.НомерЭтапа КАК НомерЭтапа
	|ИЗ
	|	Документ.ЗаказыВПроизводство.ЭтапыИОборудование КАК ЗаказыВПроизводствоЭтапыИОборудование
	|ГДЕ
	|	ЗаказыВПроизводствоЭтапыИОборудование.Ссылка.IDZak = &IDZak
	|	И ЗаказыВПроизводствоЭтапыИОборудование.ПлюсовойКабель = &ПлюсовойКабель
	|	И ЗаказыВПроизводствоЭтапыИОборудование.ВидОперации= &ВидОперации";
	Запрос.УстановитьПараметр("IDZak", 			СсылкаНаЗаказ.idzak);      
	Запрос.УстановитьПараметр("ВидОперации", 	Перечисления.ВидОперации.СкруткаСтренги);      
	Запрос.УстановитьПараметр("ПлюсовойКабель", ПлюсовойКабель);
	РезультатЗапроса = Запрос.Выполнить();
	Выборка= РезультатЗапроса.Выбрать();
	Пока Выборка.Следующий() Цикл
		НомерЭтапа=Выборка.НомерЭтапа;   //номер этапа нужен для вызова функции
	КонецЦикла;
	
	//Время одной заправки есть...
	Производительности = РасчетПроизводительностиОборудований.РасчетЧистойПроизводительности_СкруткаСтренги(ПараметрыЗаказаУрезанные,ДанныеПоЭтапамУрезанные,НомерЭтапа);
	
	//Коэф
	
	ПараметрыОтбора = Новый Структура;
	ПараметрыОтбора.Вставить("ВидОперации", Перечисления.ВидОперации.СкруткаСтренги);
	ПараметрыОтбора.Вставить("Плюсовой", 	ПлюсовойКабель);
	НайденныеСтроки = СсылкаНаЗаказ.ДополнительныеОперацииНаЭтапах.НайтиСтроки(ПараметрыОтбора);      
	
	ЧистоеВремя		= Производительности.ЧистоеВремя;   //В 
	ВремяПодготовки	= 0;
	ВремяСмены 		= 0;  
	
	Для каждого строка из НайденныеСтроки цикл   	                      
		
		//Коэф= В/(А+Б+В),  
		Затраты 	= Строка.ЗатратыВремениНаОперацию;
		Операция	= Строка.НаименованиеОперации;  
		
		Если 	Операция = Перечисления.НаименованиеОперации.СнятиеЗаряднойКатушки  
			или Операция = Перечисления.НаименованиеОперации.УстановкаЗаряднойКатушки  
			или Операция = Перечисления.НаименованиеОперации.ПодготовкаКЗапуску тогда
			ВремяПодготовки = ВремяПодготовки + Затраты;     //А
		ИначеЕсли Операция = Перечисления.НаименованиеОперации.СменаКатушкиНаПриёмнике тогда
			ВремяСмены = Затраты;     //Б
		КонецЕсли; 	
		
	КонецЦикла;  
	ВремяПодготовки = ?(ВремяПодготовки = неопределено,0,ВремяПодготовки);
	ВремяСмены 		= ?(ВремяСмены 		= неопределено,0,ВремяСмены);
	КоэффициентЗагруженностиОборудования = ЧистоеВремя/(ВремяПодготовки+ЧистоеВремя+ВремяСмены);
	
	Результат=Новый структура;	
	Если Групповой тогда
		Результат.Вставить("ЧистоеВремя",							ЧистоеВремя);
		Результат.Вставить("ВремяПодготовки",						ВремяПодготовки);     
		Результат.Вставить("ВремяСмены",							ВремяСмены);	
		Результат.Вставить("КоэффициентЗагруженностиОборудования",	КоэффициентЗагруженностиОборудования);                 
	иначе
		Результат = КоэффициентЗагруженностиОборудования;
	КонецЕсли;
	
	
	Возврат Результат;     
	

</details>
//Общая скрутка

 ## Функция РасчетКоэФЗагрОборуд_ОбщаяСкрутка(СсылкаНаЗаказ,НомерОперации,Групповой=Ложь)     экспорт

 <details> 
   <summary> 
     Код  </summary>
	
	Если СсылкаНаЗаказ.ПлюсовойКабель тогда
		Если НомерОперации=1 тогда                                         
			ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.Основной;
		Иначе
			ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой;
		КонецЕсли; 
	иначе
		ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.ПустаяСсылка();	
	КонецЕсли;
	
	ПараметрыОтбора = Новый Структура;
	ПараметрыОтбора.Вставить("ВидОперации", Перечисления.ВидОперации.ОбщаяСкрутка);
	ПараметрыОтбора.Вставить("Плюсовой", ПлюсовойКабель);
	НайденныеСтроки = СсылкаНаЗаказ.ДополнительныеОперацииНаЭтапах.НайтиСтроки(ПараметрыОтбора);  
	Если не НайденныеСтроки.Количество() и ПлюсовойКабель = Перечисления.ОсновнойПлюсовойСуммарный.Основной тогда           
		ПараметрыОтбора.Вставить("Плюсовой", Перечисления.ОсновнойПлюсовойСуммарный.Суммарный ); 
		НайденныеСтроки = СсылкаНаЗаказ.ДополнительныеОперацииНаЭтапах.НайтиСтроки(ПараметрыОтбора);  
	КонецЕсли;
	
	ВремяУстановкаКатушки		= 0;
	ВремяСнятиеЗаряднойКатушки	= 0; 
	ПустоеВремяНаЭтапе			= 0;
	ОбщееВремяНаЭтапе           = 0;
	
	Для каждого строка из НайденныеСтроки цикл  
		Затраты = Строка.ЗатратыВремениНаОперацию; 
		ОбщееВремяНаЭтапе = ОбщееВремяНаЭтапе + Затраты;
		Если Строка.НаименованиеОперации=Перечисления.НаименованиеОперации.УстановкаЗаряднойКатушки тогда
			ВремяУстановкаКатушки		= ?(Затраты=неопределено,0,Затраты); 
		ИначеЕсли Строка.НаименованиеОперации=Перечисления.НаименованиеОперации.СнятиеЗаряднойКатушки тогда
			ВремяСнятиеЗаряднойКатушки	= ?(Затраты=неопределено,0,Затраты); 		
		ИначеЕсли Строка.НаименованиеОперации=Перечисления.НаименованиеОперации.ПустаяСсылка() тогда
			ПустоеВремяНаЭтапе			= Затраты;			
		КонецЕсли; 			
	КонецЦикла;    
	
	ВремяНеЗависящееОтДлиныЗаказа=ОбщееВремяНаЭтапе-ПустоеВремяНаЭтапе; // Суммарное время на доп. операции
	
	КоэффициентЗагруженностиОборудования = ПустоеВремяНаЭтапе / (ОбщееВремяНаЭтапе - ВремяСнятиеЗаряднойКатушки - ВремяУстановкаКатушки);	
	
	Если Групповой тогда          
		Результат = Новый Структура;
		Результат.Вставить("ПустоеВремяНаЭтапе",					ПустоеВремяНаЭтапе);
		Результат.Вставить("ВремяНеЗависящееОтДлиныЗаказа",			ВремяНеЗависящееОтДлиныЗаказа);
		Результат.Вставить("КоэффициентЗагруженностиОборудования",	КоэффициентЗагруженностиОборудования);                 
		Результат.Вставить("ОбщееВремяНаЭтапе",						ОбщееВремяНаЭтапе);
	иначе
		Результат= КоэффициентЗагруженностиОборудования;
	КонецЕсли;
	
	
	Возврат Результат;  
	

</details>
//Скрутка ТПЖ

 ## Функция РасчетКоэФЗагрОборуд_СкруткаТПЖ(СсылкаНаЗаказ,НомерОперации,Групповой=Ложь,ПараметрыДляСкруткиТПЖ=Ложь)     экспорт

 <details> 
   <summary> 
     Код  </summary>
	
	ПараметрыДляСкруткиТПЖ=?(ПараметрыДляСкруткиТПЖ=Неопределено,ложь,ПараметрыДляСкруткиТПЖ);
	Если СсылкаНаЗаказ.ПлюсовойКабель тогда
		Если НомерОперации=1 тогда                                         
			ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.Основной;
		Иначе
			ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой;
		КонецЕсли; 
	иначе
		ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.ПустаяСсылка();	
	КонецЕсли;                                                                  
	
	ПараметрыОтбора = Новый Структура;
	ПараметрыОтбора.Вставить("ВидОперации", Перечисления.ВидОперации.СкруткаТПЖ);
	ПараметрыОтбора.Вставить("Плюсовой", ПлюсовойКабель);                       
	
	ВремяУстановкаКатушки		= 0;
	ВремяСнятиеЗаряднойКатушки	= 0; 
	ПустоеВремяНаЭтапе			= 0;
	ОбщееВремяНаЭтапе           = 0;
	
	НайденныеСтроки = СсылкаНаЗаказ.ДополнительныеОперацииНаЭтапах.НайтиСтроки(ПараметрыОтбора);  
	Если не НайденныеСтроки.Количество() и ПлюсовойКабель = Перечисления.ОсновнойПлюсовойСуммарный.Основной тогда           
		ПараметрыОтбора.Вставить("Плюсовой", Перечисления.ОсновнойПлюсовойСуммарный.Суммарный ); 
		НайденныеСтроки = СсылкаНаЗаказ.ДополнительныеОперацииНаЭтапах.НайтиСтроки(ПараметрыОтбора);  
	КонецЕсли;
	
	Для каждого строка из НайденныеСтроки цикл                    
		Затраты = Строка.ЗатратыВремениНаОперацию;
		ОбщееВремяНаЭтапе = ОбщееВремяНаЭтапе + Затраты;
		Если Строка.НаименованиеОперации=Перечисления.НаименованиеОперации.УстановкаЗаряднойКатушки тогда
			ВремяУстановкаКатушки		= ?(Затраты = неопределено,0,Затраты); 
		ИначеЕсли Строка.НаименованиеОперации=Перечисления.НаименованиеОперации.СнятиеЗаряднойКатушки тогда
			ВремяСнятиеЗаряднойКатушки	= ?(Затраты = неопределено,0,Затраты); 		
		ИначеЕсли Строка.НаименованиеОперации=Перечисления.НаименованиеОперации.ПустаяСсылка() тогда
			ПустоеВремяНаЭтапе			= 	Затраты;			
		КонецЕсли; 			
	КонецЦикла;  
	
	ВремяНеЗависящееОтДлиныЗаказа = ОбщееВремяНаЭтапе-ПустоеВремяНаЭтапе; //Время допюопераций              
	
	Если Групповой и не ПараметрыДляСкруткиТПЖ = Ложь тогда
		КоэффициентЗагруженностиОборудования = ПараметрыДляСкруткиТПЖ.ОбщееПустоеВремя/
		(ОбщееВремяНаЭтапе-ВремяСнятиеЗаряднойКатушки-ВремяУстановкаКатушки+ПараметрыДляСкруткиТПЖ.ПустоеВремяВсехЗаказовКромеПервого);		
	Иначе
		КоэффициентЗагруженностиОборудования= ПустоеВремяНаЭтапе/(ОбщееВремяНаЭтапе-ВремяСнятиеЗаряднойКатушки-ВремяУстановкаКатушки);				                                                                                                                        	
	КонецЕсли;
	
	Если Групповой тогда  
		Результат = Новый структура;
		Результат.Вставить("ПустоеВремяНаЭтапе",					ПустоеВремяНаЭтапе);
		Результат.Вставить("ВремяНеЗависящееОтДлиныЗаказа",			ВремяНеЗависящееОтДлиныЗаказа);
		Результат.Вставить("КоэффициентЗагруженностиОборудования",	КоэффициентЗагруженностиОборудования);                 
		Результат.Вставить("ОбщееВремяНаЭтапе",						ОбщееВремяНаЭтапе);
	иначе
		Результат = КоэффициентЗагруженностиОборудования;
	КонецЕсли;
	Возврат Результат;  

</details>
//Обмотка алюмофлексом //Обмотка Броней 

 ## Функция РасчетКоэФЗагрОборуд_ОбмоткаАлюмофлексом_БронеОбмотка(СсылкаНаЗаказ,НомерОперации,Групповой=Ложь,ВидОперации)     экспорт

 <details> 
   <summary> 
     Код  </summary>
	
	Если СсылкаНаЗаказ.ПлюсовойКабель тогда
		Если НомерОперации=1 тогда                                         
			ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.Основной;
		Иначе
			ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой;
		КонецЕсли; 
	иначе
		ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.ПустаяСсылка();	
	КонецЕсли;                                                                  
	
	ВремяУстановкаКатушки		= 0;
	ВремяСнятиеЗаряднойКатушки	= 0; 
	ПустоеВремяНаЭтапе			= 0;
	ОбщееВремяНаЭтапе           = 0;
	
	
	ПараметрыОтбора = Новый Структура;
	ПараметрыОтбора.Вставить("ВидОперации", ВидОперации);
	ПараметрыОтбора.Вставить("Плюсовой", ПлюсовойКабель);                       
	
	НайденныеСтроки = СсылкаНаЗаказ.ДополнительныеОперацииНаЭтапах.НайтиСтроки(ПараметрыОтбора);  
	Если не НайденныеСтроки.Количество() и ПлюсовойКабель = Перечисления.ОсновнойПлюсовойСуммарный.Основной тогда           
		ПараметрыОтбора.Вставить("Плюсовой", Перечисления.ОсновнойПлюсовойСуммарный.Суммарный ); 
		НайденныеСтроки = СсылкаНаЗаказ.ДополнительныеОперацииНаЭтапах.НайтиСтроки(ПараметрыОтбора);  
	КонецЕсли;
	
	Для каждого строка из НайденныеСтроки цикл        
		
		Затраты 			= Строка.ЗатратыВремениНаОперацию;
		ОбщееВремяНаЭтапе 	= ОбщееВремяНаЭтапе + Затраты;     
		
		Если 	  Строка.НаименованиеОперации=Перечисления.НаименованиеОперации.УстановкаЗаряднойКатушки тогда
			ВремяУстановкаКатушки		= ?(Затраты = неопределено,0,Затраты);                               
		ИначеЕсли Строка.НаименованиеОперации=Перечисления.НаименованиеОперации.УстановкаКатушкиВОтдатчик тогда
			ВремяУстановкаКатушки		= ?(Затраты = неопределено,0,Затраты); 
		ИначеЕсли Строка.НаименованиеОперации=Перечисления.НаименованиеОперации.СнятиеЗаряднойКатушки тогда
			ВремяСнятиеЗаряднойКатушки	= ?(Затраты = неопределено,0,Затраты); 		
		ИначеЕсли Строка.НаименованиеОперации=Перечисления.НаименованиеОперации.ПустаяСсылка() тогда
			ПустоеВремяНаЭтапе			= 	Затраты;			
		КонецЕсли; 			
	КонецЦикла;  
	
	ВремяНеЗависящееОтДлиныЗаказа = ОбщееВремяНаЭтапе-ПустоеВремяНаЭтапе; //Время допопераций              
	КоэффициентЗагруженностиОборудования = ПустоеВремяНаЭтапе/(ОбщееВремяНаЭтапе-ВремяСнятиеЗаряднойКатушки-ВремяУстановкаКатушки);
	
	Если Групповой тогда  
		Результат = Новый структура;
		Результат.Вставить("ПустоеВремяНаЭтапе",					ПустоеВремяНаЭтапе);
		Результат.Вставить("ВремяНеЗависящееОтДлиныЗаказа",			ВремяНеЗависящееОтДлиныЗаказа);
		Результат.Вставить("КоэффициентЗагруженностиОборудования",	КоэффициентЗагруженностиОборудования);                 
		Результат.Вставить("ОбщееВремяНаЭтапе",						ОбщееВремяНаЭтапе);
	иначе
		Результат = КоэффициентЗагруженностиОборудования;
	КонецЕсли;
	
	Возврат Результат; 
	

</details>
//Обмотка проволочным экраном //Обмотка проволочной бронёй 

 ## Функция РасчетКоэФЗагрОборуд_ОбмоткаПроволочными(СсылкаНаЗаказ,НомерОперации,Групповой=Ложь,ВидОперации)     экспорт

 <details> 
   <summary> 
     Код  </summary>
	
	ВремяСменаКатушекЭкранБроня = 0;
	ПустоеВремяНаЭтапе			= 0;
	ОбщееВремяНаЭтапе           = 0;
	
	Если СсылкаНаЗаказ.ПлюсовойКабель тогда
		Если НомерОперации=1 тогда                                         
			ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.Основной;
		Иначе
			ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой;
		КонецЕсли; 
	иначе
		ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.ПустаяСсылка();	
	КонецЕсли;                                                                  
	
	ПараметрыОтбора = Новый Структура;
	ПараметрыОтбора.Вставить("ВидОперации", ВидОперации);
	ПараметрыОтбора.Вставить("Плюсовой", ПлюсовойКабель);                       
	
	НайденныеСтроки = СсылкаНаЗаказ.ДополнительныеОперацииНаЭтапах.НайтиСтроки(ПараметрыОтбора);  
	Если не НайденныеСтроки.Количество() и ПлюсовойКабель = Перечисления.ОсновнойПлюсовойСуммарный.Основной тогда           
		ПараметрыОтбора.Вставить("Плюсовой", Перечисления.ОсновнойПлюсовойСуммарный.Суммарный ); 
		НайденныеСтроки = СсылкаНаЗаказ.ДополнительныеОперацииНаЭтапах.НайтиСтроки(ПараметрыОтбора);  
	КонецЕсли;
	
	Для каждого строка из НайденныеСтроки цикл        
		
		Затраты 			= Строка.ЗатратыВремениНаОперацию;
		ОбщееВремяНаЭтапе 	= ОбщееВремяНаЭтапе + Затраты;     
		
		Если 	  Строка.НаименованиеОперации=Перечисления.НаименованиеОперации.УстановкаКатушекСПроволочнымЭкраномБроней тогда
			ВремяСменаКатушекЭкранБроня	= ВремяСменаКатушекЭкранБроня + Затраты;			
		ИначеЕсли Строка.НаименованиеОперации=Перечисления.НаименованиеОперации.СнятиеПустыхКатушекИзПодЭкранаБрони тогда
			ВремяСменаКатушекЭкранБроня	= ВремяСменаКатушекЭкранБроня + Затраты;			
		ИначеЕсли Строка.НаименованиеОперации=Перечисления.НаименованиеОперации.ПустаяСсылка() тогда
			ПустоеВремяНаЭтапе			= Затраты;			
		КонецЕсли; 			
	КонецЦикла; 
	
	ВремяНеЗависящееОтДлиныЗаказа=ОбщееВремяНаЭтапе-ПустоеВремяНаЭтапе;               
	
	КоэффициентЗагруженностиОборудования = ПустоеВремяНаЭтапе/(ОбщееВремяНаЭтапе-ВремяСменаКатушекЭкранБроня);	      
	
	Если Групповой тогда  
		Результат = Новый структура;
		Результат.Вставить("ПустоеВремяНаЭтапе",					ПустоеВремяНаЭтапе);
		Результат.Вставить("ВремяНеЗависящееОтДлиныЗаказа",			ВремяНеЗависящееОтДлиныЗаказа);
		Результат.Вставить("КоэффициентЗагруженностиОборудования",	КоэффициентЗагруженностиОборудования);                 
		Результат.Вставить("ОбщееВремяНаЭтапе",						ОбщееВремяНаЭтапе);
	иначе
		Результат = КоэффициентЗагруженностиОборудования;
	КонецЕсли;
	
	Возврат Результат; 	

</details>
//По умолчанию

 ## Функция РасчетКоэФЗагрОборуд_ПоУмолчанию(СсылкаНаЗаказ,НомерОперации,Групповой=Ложь,ВидОперации)     экспорт

 <details> 
   <summary> 
     Код  </summary>
	ОбщееВремяНаЭтапе 				= 0; 
	ПустоеВремяНаЭтапе 				= 0;
	ВремяНеЗависящееОтДлиныЗаказа 	= 0;
	//
	Если СсылкаНаЗаказ.ПлюсовойКабель тогда
		Если НомерОперации=1 тогда                                         
			ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.Основной;
		Иначе
			ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой;
		КонецЕсли; 
	иначе
		ПлюсовойКабель=Перечисления.ОсновнойПлюсовойСуммарный.ПустаяСсылка();	
	КонецЕсли;                                                                  
	
	ПараметрыОтбора = Новый Структура;
	ПараметрыОтбора.Вставить("ВидОперации", ВидОперации);
	ПараметрыОтбора.Вставить("Плюсовой", ПлюсовойКабель);                       
	
	НайденныеСтроки = СсылкаНаЗаказ.ДополнительныеОперацииНаЭтапах.НайтиСтроки(ПараметрыОтбора);  
	Если не НайденныеСтроки.Количество() и ПлюсовойКабель = Перечисления.ОсновнойПлюсовойСуммарный.Основной тогда           
		ПараметрыОтбора.Вставить("Плюсовой", Перечисления.ОсновнойПлюсовойСуммарный.Суммарный ); 
		НайденныеСтроки = СсылкаНаЗаказ.ДополнительныеОперацииНаЭтапах.НайтиСтроки(ПараметрыОтбора);  
	КонецЕсли;
	//Находим наши времена
	Для каждого строка из НайденныеСтроки цикл        
		
		Затраты 			= Строка.ЗатратыВремениНаОперацию;
		ОбщееВремяНаЭтапе 	= ОбщееВремяНаЭтапе + Затраты;  //Сюда не попадает время, которое с галкой "Зависит от очереди заказа"   
		
		Если Строка.НаименованиеОперации = Перечисления.НаименованиеОперации.ПустаяСсылка() тогда
			ПустоеВремяНаЭтапе			 = Затраты; //чистое
		КонецЕсли; 			
	КонецЦикла; 
	
	ВремяНеЗависящееОтДлиныЗаказа		 = ОбщееВремяНаЭтапе-ПустоеВремяНаЭтапе;               
	
	КоэффициентЗагруженностиОборудования = ПустоеВремяНаЭтапе/ОбщееВремяНаЭтапе;
	
	Если Групповой тогда  
		Результат = Новый структура;
		Результат.Вставить("ПустоеВремяНаЭтапе",					ПустоеВремяНаЭтапе);
		Результат.Вставить("ВремяНеЗависящееОтДлиныЗаказа",			ВремяНеЗависящееОтДлиныЗаказа);
		Результат.Вставить("КоэффициентЗагруженностиОборудования",	КоэффициентЗагруженностиОборудования);                 
		Результат.Вставить("ОбщееВремяНаЭтапе",						ОбщееВремяНаЭтапе);
	иначе
		Результат = КоэффициентЗагруженностиОборудования;
	КонецЕсли;
	
	Возврат Результат; 	

</details>


</details>



 ## Функция ДенюжкиВыработки(Признак,ТЧ, Коэф) экспорт //20,07,2023    

 <details> 
   <summary> 
     Код  </summary>
	ТЧ = ТЧ[0];
	// 1 Волочильщик (мультивайер)
	// 2 Опрессовщик
	// 3 Скрутчик
	// 4 Волочильщик                
	Сумма = 0;
	Денюжки = Новый структура;
	Если 		Признак = 1 тогда	
		Сумма=ТЧ.РасценкаЗаСменуКатушекНаПриемнике 	* ТЧ.СменаКатушек
		+ТЧ.РасценкаЗаПереходНаМаркоразмер 			* ТЧ.ПереходНаМаркоРазмер
		+ТЧ.РасценкаЗаСменуКорзин					* ТЧ.СменаКорзин
		+ТЧ.РасценкаЗаСменуВолок					* ТЧ.СменаВолок;      
	ИначеЕсли	Признак = 2 тогда	
		Сумма=ТЧ.РасценкаЗаСменуЦвета				* ТЧ.СменаЦвета
		+ТЧ.РасценкаЗаПереходНаМаркоразмер			* ТЧ.ПереходНаМаркоразмер
		+ТЧ.РасценкаЗаСменуПластиката				* ТЧ.СменаПластиката
		+ТЧ.РасценкаЗаСменуИнструмента				* ТЧ.СменаИнструмента;
	ИначеЕсли 	Признак = 3 тогда	
		Сумма = ТЧ.РасценкаЗаУстановкуЗаряднойКатушки 	* ТЧ.УстановкаЗаряднойКатушки
		+ТЧ.СнятиеЗаряднойКатушки					 	* ТЧ.РасценкаЗаСнятиеЗаряднойКатушки
		+ТЧ.РасценкаЗаСнятиеКатушкиБрониЭкрана			* ТЧ.СнятиеЗаряднойКатушки
		+ТЧ.РасценкаЗаУстановкуКатушкиБрониЭкрана		* ТЧ.УстановкаКатушкиБрониЭкрана;    
		
	ИначеЕсли 	Признак = 4 тогда	
		Сумма=ТЧ.РасценкаЗаСменуБунта					* ТЧ.СменаБунта
		+ТЧ.РасценкаЗаСменуКатушекНаПриемнике			* ТЧ.СменаКатушекНаПриемнике
		+ТЧ.РасценкаЗаПереходНаМаркоразмер				* ТЧ.ПереходНаМаркоразмер;			
	КонецЕсли;	
	ИтоговаяСумма=(ТЧ.КоличествоВКМ*(ТЧ.РасценкаЗаКМ/ТЧ.КоэффициентЗагруженностиОборудования))+Сумма;
	ИтоговаяСуммаСРазрядом=(ИтоговаяСумма-Сумма)*Коэф+Сумма*Коэф;  		
	
	Денюжки.Вставить("Итог",ИтоговаяСумма);
	Денюжки.Вставить("ИтогСРазрядом",ИтоговаяСуммаСРазрядом);
	Возврат Денюжки

</details>



 ## #Область   Выработка_Пресс7090

 <details> 
   <summary> 
     Код  </summary>


 ## Функция ОбновитьВыработку7090пресс(ГрупповойРезерв,Фио,СсылкаНаЗаказ) экспорт

 <details> 
   <summary> 
     Код  </summary>
	
	
 ## #Область   расшифровка_и_внесение_в_таблицу	

 <details> 
   <summary> 
     Код  </summary>
	
	ТаблЗначений=Новый ТаблицаЗначений;	  
	ТаблЗначений.Колонки.Добавить("НомерСчета");
	ТаблЗначений.Колонки.Добавить("НомерЭтапа");
	ТаблЗначений.Колонки.Добавить("ВидОперации");
	ТаблЗначений.Колонки.Добавить("РасценкаЗа1Км");
	ТаблЗначений.Колонки.Добавить("Оборудование");
	ТаблЗначений.Колонки.Добавить("РасценкаЗаСменуИнструмента");
	ТаблЗначений.Колонки.Добавить("РасценкаЗаСменуКатушкиВПриемник");
	ТаблЗначений.Колонки.Добавить("РасценкаЗаСменуКатушкиНаОтдатчике");
	ТаблЗначений.Колонки.Добавить("РасценкаЗаСменуЦвета");
	ТаблЗначений.Колонки.Добавить("РасценкаЗаСменуПластиката");
	ТаблЗначений.Колонки.Добавить("цветКуска");
	ТаблЗначений.Колонки.Добавить("НомерСтроки");
	ТаблЗначений.Колонки.Добавить("ИтоговаяСумма");
	ТаблЗначений.Колонки.Добавить("ИтоговаяСуммаСРазрядом");
	ТаблЗначений.Колонки.Добавить("КоэффициентЗагруженностиОборудования");
	ТаблЗначений.Колонки.Добавить("КоэффициентСмены");
	ТаблЗначений.Колонки.Добавить("НомерОперации");
	ТаблЗначений.Колонки.Добавить("КоличествоКМ");  
	ТаблЗначений.Колонки.Добавить("ЦенаКуска");  
	
	итератор=1;
	Строка=ГрупповойРезерв;
	Результат=Новый структура;
	Пока не СтрПолучитьСтроку(Строка,итератор)="" цикл    
		СтрокаИтератор=СтрПолучитьСтроку(Строка,Итератор);
		
		Вхождение0=Найти(СтрокаИтератор,"#"); //номер счета	 
		Вхождение1=Найти(СтрокаИтератор,"ab");//номер этапа
		Вхождение2=Найти(СтрокаИтератор,"bc");//вид операции
		Вхождение3=Найти(СтрокаИтератор,"cd");//оборуд
		Вхождение4=Найти(СтрокаИтератор,"de");//РасценкаЗаСменуИнструмента
		Вхождение5=Найти(СтрокаИтератор,"ef");//РасценкаЗаСменуКатушкиВПриемник
		Вхождение6=Найти(СтрокаИтератор,"fg");//РасценкаЗаСменуКатушкиНаОтдатчике 
		Вхождение7=Найти(СтрокаИтератор, "gh");//РасценкаЗаСменуЦвета
		Вхождение8=Найти(СтрокаИтератор, "hj");//ЦветКуска 
		Вхождение9=Найти(СтрокаИтератор,"jk");//Цена  
		Вхождение10=Найти(СтрокаИтератор, "kl");//КоличествоКМ 
		Вхождение11=Найти(СтрокаИтератор, "lm");//КоэфЗагрОб 
		Вхождение12=Найти(СтрокаИтератор,"mn");//номер операции 
		Вхождение13=Найти(СтрокаИтератор, "no");///номер строки      
		Вхождение14=Найти(СтрокаИтератор, "op");///Расценка за смену пластиката      	
		Вхождение15=Найти(СтрокаИтератор, "pq");//Расценка за длину куска
		Вхождение16=Найти(СтрокаИтератор, "idzak");//idzak  		
		НоваяЗапись=ТаблЗначений.Добавить();
		
		НоваяЗапись.НомерСчета=Сред(СтрокаИтератор,Вхождение0+1,Вхождение1-1-Вхождение0);
		НоваяЗапись.НомерЭтапа=Сред(СтрокаИтератор,Вхождение1+2,Вхождение2-1-Вхождение1-1);
		НоваяЗапись.ВидОперации=Перечисления.ВидОперации[СтрЗаменить(Стрзаменить(Стрзаменить(Сред(СтрокаИтератор,Вхождение2+2,Вхождение3-1-Вхождение2-1)," ",""),"(",""),")","")];
		НоваяЗапись.Оборудование=Справочники.НоменклатураОборудований.НайтиПоКоду(Сред(СтрокаИтератор,Вхождение3+2,Вхождение4-1-Вхождение3-1)); 
		
		НоваяЗапись.РасценкаЗаСменуИнструмента=число(Сред(СтрокаИтератор,Вхождение4+2,Вхождение5-1-Вхождение4-1));
		НоваяЗапись.РасценкаЗаСменуКатушкиВПриемник=число(Сред(СтрокаИтератор,Вхождение5+2,Вхождение6-1-Вхождение5-1));    
		НоваяЗапись.РасценкаЗаСменуКатушкиНаОтдатчике=число(Сред(СтрокаИтератор,Вхождение6+2,Вхождение7-1-Вхождение6-1));  
		НоваяЗапись.РасценкаЗаСменуЦвета=число(Сред(СтрокаИтератор,Вхождение7+2,Вхождение8-1-Вхождение7-1));  
		
		НоваяЗапись.цветКуска=Справочники.ПереченьЦветовЖил.НайтиПоКоду(Сред(СтрокаИтератор,Вхождение8+2,Вхождение9-1-Вхождение8-1));
		Цена=число(Сред(СтрокаИтератор,Вхождение9+2,Вхождение10-1-Вхождение9-1));    
		
		НоваяЗапись.КоличествоКМ=число(Сред(СтрокаИтератор,Вхождение10+2,Вхождение11-1-Вхождение10-1));
		
		КоэфЗагрОб=число(Сред(СтрокаИтератор,Вхождение11+2,Вхождение12-1-Вхождение11-1));    
		НоваяЗапись.НомерОперации=число(Сред(СтрокаИтератор,Вхождение12+2,Вхождение13-1-Вхождение12-1));  
		НоваяЗапись.НомерСтроки=число(Сред(СтрокаИтератор,Вхождение13+2,Вхождение14-1-Вхождение13-1));       
		НоваяЗапись.РасценкаЗаСменуПластиката=число(Сред(СтрокаИтератор,Вхождение14+2,Вхождение15-1-Вхождение14-1));  
		НоваяЗапись.ЦенаКуска=число(Сред(СтрокаИтератор,Вхождение15+2,Вхождение16-1-Вхождение15-1));  
		
		Idzak=Сред(СтрокаИтератор,Вхождение16+5);
		
		Если СтрНачинаетсяС(СтрокаИтератор,"1#") тогда
			НомерЭтапа = НоваяЗапись.НомерЭтапа;
		КонецЕсли;
		итератор=итератор+1;
	КонецЦикла;
	
	ДанныеПоЭтапам=ФормированиеРабочихМассивов.СобратьУрезанныеДанныеПоЭтапам(СсылкаНаЗаказ);
	ПараметрыЗаказа=ФормированиеРабочихМассивов.СобратьУрезанныеПараметрыЗаказа(СсылкаНаЗаказ);
	
	СуммарноеЧистоеВремя=0;                                                             
	СуммарнаяДеньга=0;
	ОбщееКолВоКМ=0;
	
	
</details>
	
 ## #Область   Обновляем                     

 <details> 
   <summary> 
     Код  </summary>
	Для каждого Данные из ТаблЗначений цикл		
		Расценки=ПолучитьРасценкиДляПресса7090(Данные,ТаблЗначений);      
		
		//далее вносим в Тбл знач новые данные:
		ТЧ = Документы.ЗаказыВПроизводство.НайтиПоРеквизиту("idzak",idzak).ЭтапыИОборудование;
		Отбор = Новый структура;
		Отбор.Вставить("ВидОперации",Данные.ВидОперации);
		ИндексНомераЭтапа = тч.индекс(ТЧ.НайтиСтроки(Отбор)[Данные.НомерОперации-1]);
		
		Данные.Оборудование=ДанныеПоЭтапам[ИндексНомераЭтапа][1];
		
		//Получаем ОбщееЧистоеВремя                                                                    //Было Данные.НомерЭтапа
		ЧистоеВремя=РасчетПроизводительностиОборудований.РасчетЧистойПроизводительности_Изоляция(ИндексНомераЭтапа+1, ДанныеПоЭтапам, ПараметрыЗаказа,Данные.КоличествоКМ);
		СуммарноеЧистоеВремя=СуммарноеЧистоеВремя+ЧистоеВремя;
		ДеньгаЗаКМ=ЧистоеВремя*Расценки.РасценкаЗаСмену/720;
		СуммарнаяДеньга=СуммарнаяДеньга+ДеньгаЗаКм;     
		ОбщееКолВоКМ=ОбщееКолВоКМ+Данные.КоличествоКм;
		
		
		
		Данные.РасценкаЗаСменуИнструмента= Расценки.РасценкаЗаСменуИнструмента;
		Данные.РасценкаЗаСменуЦвета = Расценки.РасценкаЗаСменуЦвета;
		Данные.РасценкаЗаСменуКатушкиВПриемник= Расценки.РасценкаЗаСменуКатушкиВПриемник;
		Данные.РасценкаЗаСменуКатушкиНаОтдатчике= Расценки.РасценкаЗаСменуКатушкиНаОтдатчике;
		Данные.РасценкаЗаСменуПластиката= Расценки.РасценкаЗаСменуПластиката;
		
		
		Данные.РасценкаЗа1Км = ДеньгаЗаКМ;  //это на форму выработки
		Данные.ЦенаКуска 	 = ДеньгаЗаКМ; //это на форму 70/90
	КонецЦикла;      
	Коэф=СуммарноеЧистоеВремя/(СуммарноеЧистоеВремя+Расценки.ОбщееВремяОпераций);//       
	КоэфСмены=ФормированиеРабочихМассивов.ПоискКоэффициентаЗаСмену(ТаблЗначений[0].Оборудование);   
	
	КоэфЗагрОб=Коэф;   
	Цена=СуммарнаяДеньга; 
	Разряд=ФормированиеРабочихМассивов.КоэфЗаРазряд(ФИО);
	
	
</details>
	
 ## #Область  шифруем
 <details> 
   <summary> 
     Код  </summary>
 
	ГрупповойРезерв="";    
	Итератор=0;   	
	
	
	Для каждого строка из ТаблЗначений цикл		
		Итератор=Итератор+1;		
		Текст=Строка(Итератор)+"#"
		+Строка.НомерСчета+
		"ab"+Строка(Строка.НомерЭтапа)+
		"bc"+Строка(Строка.ВидОперации)+
		"cd"+Строка(Строка.Оборудование.код)+
		"de"+Строка(Строка.РасценкаЗаСменуИнструмента)+
		"ef"+Строка(Строка.РасценкаЗаСменуКатушкиВПриемник)+
		"fg"+Строка(Строка.РасценкаЗаСменуКатушкиНаОтдатчике)+
		"gh"+Строка(Строка.РасценкаЗаСменуЦвета)+
		"hj"+Строка(Строка.ЦветКуска.код)+
		"jk"+Строка(Цена)+
		"kl"+Строка(Строка.КоличествоКМ)+
		"lm"+Строка(КоэфЗагрОб)+
		"mn"+Строка(Строка.НомерОперации)+
		"no"+Строка(Строка.НомерСтроки)+ 
		"op"+Строка(Строка.РасценкаЗаСменуПластиката)+  		
		"pq"+Строка(Строка.ЦенаКуска)+  		
		
		"idzak"+idzak;
		
		Если Итератор=1 тогда 
			ГрупповойРезерв=Текст;   
		ИначеЕсли Итератор>1 тогда
			ГрупповойРезерв=ГрупповойРезерв+Символы.ПС+Текст;
		КонецЕсли;
		
	КонецЦикла;   
	
</details>     
	//возврат
	Итог=Новый структура;
	Итог.Вставить("КоличествоВКМ",ОбщееКолвоКМ); 
	Итог.Вставить("Цена",Цена); 
	Итог.Вставить("Разряд",Разряд); 
	Итог.Вставить("КоэффициентСмены",КоэфСмены); 
	Итог.Вставить("КоэффициентЗагруженностиОборудования",КоэфЗагрОб); 
	Итог.Вставить("РасценкаЗаСменуЦвета",ТаблЗначений[0].РасценкаЗаСменуЦвета);    
	Итог.Вставить("РасценкаЗаСменуИнструмента",ТаблЗначений[0].РасценкаЗаСменуИнструмента);    
	Итог.Вставить("РасценкаЗаСменуПластиката",ТаблЗначений[0].РасценкаЗаСменуПластиката);    
	//СДЕЛАТЬ ПОИСК МАТЕРИАЛА
	Итог.Вставить("Материал1",ВернутьМатериалПоНомеруОперации(idzak,Строка.номероперации,"Материал1",Строка.номерЭтапа));
	Итог.Вставить("Материал2",ВернутьМатериалПоНомеруОперации(idzak,Строка.номероперации,"Материал2",Строка.номерЭтапа));
	Итог.Вставить("Материал3",ВернутьМатериалПоНомеруОперации(idzak,Строка.номероперации,"Материал3",Строка.номерЭтапа));
	Итог.Вставить("Материал4",ВернутьМатериалПоНомеруОперации(idzak,Строка.номероперации,"Материал4",Строка.номерЭтапа));
	Итог.Вставить("Материал5",ВернутьМатериалПоНомеруОперации(idzak,Строка.номероперации,"Материал5",Строка.номерЭтапа));
	
	
	Итог.Вставить("Оборудование",Строка.Оборудование);
	Итог.Вставить("ВидОперации",Строка.ВидОперации);
	Итог.Вставить("НомерОперации",Строка.НомерОперации);
	
	Итог.Вставить("ГрупповойРезерв",ГрупповойРезерв);
	
	
	
	
	возврат Итог;

</details>

 ## Функция СобратьУрезанныеДанныеПоЭтапам(СсылкаНаЗаказ) экспорт

 <details> 
   <summary> 
     Код  </summary>
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ДанныеПоЭтапам.Период КАК Период,
	|	ДанныеПоЭтапам.IDZak КАК IDZak,
	|	ДанныеПоЭтапам.НомерЭтапа КАК НомерЭтапа,
	|	ДанныеПоЭтапам.НаименованиеОборудования КАК НаименованиеОборудования,
	|	ДанныеПоЭтапам.ВидОперации КАК ВидОперации,
	|	ДанныеПоЭтапам.ВыбранныйБарабан КАК ВыбранныйБарабан,
	|	ДанныеПоЭтапам.ПлюсовойКабель КАК ПлюсовойКабель,
	|	ДанныеПоЭтапам.ДанныеУстановленыВручную КАК ДанныеУстановленыВручную,
	|	ДанныеПоЭтапам.ДиамКон КАК ДиамКон,
	|	ДанныеПоЭтапам.МассаИздКон КАК МассаИздКон,
	|	ДанныеПоЭтапам.ДлинаКон КАК ДлинаКон,
	|	ДанныеПоЭтапам.КолЖилКон КАК КолЖилКон,
	|	ДанныеПоЭтапам.РадиальнаяТолщина КАК РадиальнаяТолщина
	|ИЗ
	|	РегистрСведений.ДанныеПоЭтапам КАК ДанныеПоЭтапам
	|ГДЕ
	|	ДанныеПоЭтапам.IDZak = &IDZak
	|
	|УПОРЯДОЧИТЬ ПО
	|	ПлюсовойКабель,
	|	НомерЭтапа
	|АВТОУПОРЯДОЧИВАНИЕ";
	
	Запрос.УстановитьПараметр("IDZak", СсылкаНаЗаказ.IDZak);
	РезультатЗапроса = Запрос.Выполнить();
	
	НаборЗаписей = РезультатЗапроса.Выгрузить();
	НЗ=НаборЗаписей;     
	
	ДанныеПоЭтапам=новый массив(25,100);
	Для индекс=0 по НаборЗаписей.Количество()-1 цикл	
		ДанныеПоЭтапам[индекс][0]=нз[индекс].idzak;   
		Заказ=СсылкаНаЗаказ;
		
		ДанныеПоЭтапам[индекс][1]=нз[индекс].НаименованиеОборудования;
		ДанныеПоЭтапам[индекс][2]=нз[индекс].НомерЭтапа;
		ДанныеПоЭтапам[индекс][3]=нз[индекс].ДиамКон; 
		//ДанныеПоЭтапам[индекс][4]=нз[индекс].МассаИздКон;
		ДанныеПоЭтапам[индекс][5]=нз[индекс].ДлинаКон;
		//ДанныеПоЭтапам[индекс][6]=нз[индекс].КолЖилКон;
		//ДанныеПоЭтапам[индекс][7]=Заказ.ЭтапыИОборудование[индекс].ВыбранныйБарабан.Наименование;	
		
		ДанныеПоЭтапам[0][12]=Заказ.ЭтапыИОборудование.Количество();
		ДанныеПоЭтапам[индекс][15]=нз[индекс].ВидОперации;   
		//ДанныеПоЭтапам[индекс][16]=Дата("00010101"); 
		//ДанныеПоЭтапам[индекс][17]=Дата("00010101"); 
		ДанныеПоЭтапам[индекс][18]=нз[индекс].ПлюсовойКабель;   
		//Если не ПустаяСтрока(нз[индекс].РадиальнаяТолщина) тогда
		//	Если стрНайти(нз[индекс].РадиальнаяТолщина,"+") тогда
		//		Радиалка=Сред(нз[индекс].РадиальнаяТолщина,0,стрНайти(нз[индекс].РадиальнаяТолщина,"+")-1);
		//	иначе
		//		Радиалка=нз[индекс].РадиальнаяТолщина;
		//	КонецЕсли;
		//КонецЕсли;
		//ДанныеПоЭтапам[индекс][19]=Радиалка;    
		//ДанныеПоЭтапам[индекс][20]=Заказ.ЭтапыИОборудование[индекс].Материал1;		
	КонецЦикла; 
	
	возврат ДанныеПоЭтапам

</details>

 ## Функция СобратьУрезанныеПараметрыЗаказа(СсылкаНаЗаказ)       экспорт

 <details> 
   <summary> 
     Код  </summary>
	Заказ=СсылкаНаЗаказ;
	МаркаК = Заказ.МаркаЗаказа;
	Если СтрНайти(МаркаК, "-") Тогда
		Марка = СокрЛП(МаркаК);
		ПозицияСлева=Найти(Марка,"-");
		Марка =Лев(Марка,ПозицияСлева-1);
		Расширение = Сред(СокрЛП(МаркаК), ПозицияСлева+1, СтрДлина(СокрЛП(МаркаК))- ПозицияСлева);						               
	КонецЕсли; 
	ПараметрыЗаказа=Новый массив(106);
	ПараметрыЗаказа[0] = СсылкаНаЗаказ.IDZAK;								                                              
	//ПараметрыЗаказа[1] = МаркаК;									                                      
	ПараметрыЗаказа[2] = Заказ.КоличествоЖил.Наименование;							
	ПараметрыЗаказа[3] = Заказ.ДиаметрПроволоки;            									
	//ПараметрыЗаказа[4] = Заказ.Сечение.Наименование;                                                 
	//ПараметрыЗаказа[5] = Заказ.Напряжение.Наименование;                                              
	//ПараметрыЗаказа[6] = Заказ.КоличествоКилометровВПроизводство;                                    
	ПараметрыЗаказа[7] = Заказ.ИсполнениеЖилы.Наименование;                                          
	//ПараметрыЗаказа[8] = Заказ.ВариантИсполнения;                    										
	//ПараметрыЗаказа[9] = Заказ.КоличествоПроволокВЖиле;                                              
	ПараметрыЗаказа[10] = Заказ.КоличествоЗарядныхКатушекНаСтренге;                                  
	ПараметрыЗаказа[11] = Заказ.КоличествоПроволокНаОднойКатушке;       
	//ПараметрыЗаказа[12] = Заказ.NPE;                                                                 
	//ПараметрыЗаказа[13] = Заказ.РазновидностьКабеля;                                                 
	//ПараметрыЗаказа[18] = Заказ.Номер;  
	//ПараметрыЗаказа[19] = Заказ.ЭтапыИОборудование[0].Материал1.Плотность;
	//ПараметрыЗаказа[20] = Заказ.ДатаВыпускаПоЗаказу; 
	//ПараметрыЗаказа[21] = Заказ.Расширение; 
	//ПараметрыЗаказа[22] = Заказ.ДиаметрПроволокиДляПотребностиВМеталле;     
	ПараметрыЗаказа[24] = Заказ.НомерСчета; 
	//ПараметрыЗаказа[25] = Заказ.Ссылка;                                                              
	//ПараметрыЗаказа[26] = Заказ.МаркаЗаказа;                                                         
	//ПараметрыЗаказа[28] = Заказ.РасчётнаяДатаВыходаЗаказа;                                           
	//ПараметрыЗаказа[29] = Заказ.ПлюсовойКабель;                                                      
	//ПараметрыЗаказа[30] = Заказ.СечениеПлюсовой.Наименование;
	//ПараметрыЗаказа[31] = ОпределениеПлоскийДаНет(Заказ);
	//ПараметрыЗаказа[32] = Заказ.ДатаПриоритета;  					
	//ПараметрыЗаказа[33] = Заказ.КоличествоПроволокВЖилеПлюсовой;                                     
	//ПараметрыЗаказа[34] = Заказ.КоличествоЗарядныхКатушекНаСтренгеПлюсовой;                          
	//ПараметрыЗаказа[35] = Заказ.КоличествоПроволокНаОднойКатушкеПлюсовой;                            
	//ПараметрыЗаказа[36] = Заказ.ДиаметрПроволокиПлюсовой;                                            
	//ПараметрыЗаказа[37] = Заказ.ДиаметрПроволокиДляПотребностиВМеталлеПлюсовой;
	ПараметрыЗаказа[38] = Заказ.КоличествоЖилПлюсовой.Наименование;					
	//ПараметрыЗаказа[39] = Заказ.ИсполнениеЖилыПлюсовой.Наименование;
	//ПараметрыЗаказа[43] = Заказ.РазновидностьКабеляПлюсовой;            					
	//ПараметрыЗаказа[44] = Заказ.СечениеЭкранаИЛенты;
	//ПараметрыЗаказа[45] = Заказ.КомментарийИзERP;
	//ПараметрыЗаказа[46] = Заказ.ПримечаниеИНамоткаИзERP;
	//ПараметрыЗаказа[48] = Заказ.КодТестирования;
	//ПараметрыЗаказа[49] = Заказ.ДанныеУстановленыВручную;    					                                                                                                                                                                                                    
	//ПараметрыЗаказа[50] = Заказ.ЦветаЗаказа.ВыгрузитьКолонку("ЦветаЖил");
	//ПараметрыЗаказа[52] = Заказ.н_ДанныеУстановленыВручнуюЭталон;  
	//ПараметрыЗаказа[53] = 0;  
	//ПараметрыЗаказа[54] = Заказ.Тип;  
	//ПараметрыЗаказа[56] = Заказ.ДиаметрТПЖ;    
	//ПараметрыЗаказа[57] = Заказ.ФактическоеСечение;     
	//ПараметрыЗаказа[58] = Заказ.ДиаметрТПЖПлюсовой;    
	//ПараметрыЗаказа[59] = Заказ.ФактическоеСечениеПлюсовой; 	
	//ПараметрыЗаказа[60] = 0;
	ПараметрыЗаказа[69]="Пресс";
	//+Данилова 01.08.2023
	ПараметрыЗаказа[78] = 	Заказ.КоличествоЗарядныхКатушекНаСтренгеДоп;                                  
	ПараметрыЗаказа[79] = 	Заказ.КоличествоПроволокНаОднойКатушкеДоп;   
	ПараметрыЗаказа[80] = 	Заказ.КоличествоЗарядныхКатушекНаСтренгеПлюсовойДоп;                          
	ПараметрыЗаказа[81] = 	Заказ.КоличествоПроволокНаОднойКатушкеПлюсовойДоп;   
	//-Данилова                                                                  
	
	
	ПараметрыЗаказа[101] = Заказ.КрасительОболочки;               //11.03.2024
	ПараметрыЗаказа[102] = Заказ.СоотношениеДляКрасителяОболочки; //11.03.2024
	ПараметрыЗаказа[103] = Заказ.КатализаторДляИзоляции;
	ПараметрыЗаказа[104] = Заказ.СоотношениеДляКатализатораИзоляции;
	ПараметрыЗаказа[105] = Заказ.Дата;

	Возврат ПараметрыЗаказа;

</details>

 ## Функция ВернутьМатериалПоНомеруОперации(идзак,номерОперации=1,материал,НомерЭтапа)

 <details> 
   <summary> 
     Код  </summary>
	Док=Документы.ЗаказыВПроизводство.НайтиПоРеквизиту("Idzak",идзак);
	Если не док=неопределено или не док=документы.ЗаказыВПроизводство.ПустаяСсылка() тогда
		Если док.ПлюсовойКабель тогда
			Если НомерОперации=1 тогда
				ПлюсовойОсновнойСуммарный=Перечисления.ОсновнойПлюсовойСуммарный.Основной;
			Иначе                                                                         
				ПлюсовойОсновнойСуммарный=Перечисления.ОсновнойПлюсовойСуммарный.Плюсовой;
			КонецЕсли;                                                                    	
		Иначе
			ПлюсовойОсновнойСуммарный=Перечисления.ОсновнойПлюсовойСуммарный.ПустаяСсылка();
		КонецЕсли;
		ПараметрыОтбора=Новый структура;
		ПараметрыОтбора.Вставить("НомерЭтапа",Число(НомерЭтапа));
		ПараметрыОтбора.Вставить("ПлюсовойКабель",ПлюсовойОсновнойСуммарный);
		Отбор= Док.ЭтапыИОборудование.НайтиСтроки(ПараметрыОтбора);	
		Если Отбор.Количество()=0 и ПлюсовойОсновнойСуммарный=Перечисления.ОсновнойПлюсовойСуммарный.Основной тогда                               
			ПараметрыОтбора=Новый структура;
			ПараметрыОтбора.Вставить("НомерЭтапа",Число(НомерЭтапа));
			ПараметрыОтбора.Вставить("ПлюсовойКабель",Перечисления.ОсновнойПлюсовойСуммарный.Суммарный);
			Отбор= Док.ЭтапыИОборудование.НайтиСтроки(ПараметрыОтбора);	
		КонецЕсли;                                                      
		Если отбор.Количество() тогда
			Возврат Отбор[0][Материал];	
		КонецЕсли;
	КонецЕсли;
	
	

</details>

 ## Функция ПолучитьРасценкиДляПресса7090(Данные,ТЗ)  экспорт 

 <details> 
   <summary> 
     Код  </summary>
	
	
 ## #Область   ДопОперации    

 <details> 
   <summary> 
     Код  </summary>
	ФРМ = ФормированиеРабочихМассивов;
	
	РасценкаЗаСмену = ФРМ.РасчетРасценкиЗаСмену(Данные.Оборудование);    
	РасценкаЗаСмену = РасценкаЗаСмену.РасценкаЗаСмену;
	ДопОперации = НайтиНаименованияОпераций(5);
	ДопОперации = НайтиДлительностьОпераций1(Данные.Оборудование, Данные.ВидОперации, ДопОперации);
	ДопОперации[1][1] = ?(ДопОперации[1][1]=Неопределено,0,ДопОперации[1][1]);    
	
	РасценкаЗаСменуКатушкиВПриемник = ФРМ.РасчетРасценокЗаТехнологическуюОперацию(РасценкаЗаСмену,ДопОперации[0][1]);
	РасценкаЗаСменуКатушкиВПриемник = ?(РасценкаЗаСменуКатушкиВПриемник=неопределено,0,РасценкаЗаСменуКатушкиВПриемник);      
	
	РасценкаЗаСменуЦвета = ФРМ.РасчетРасценокЗаТехнологическуюОперацию(РасценкаЗаСмену,ДопОперации[1][1]);
	РасценкаЗаСменуЦвета = ?(РасценкаЗаСменуЦвета=неопределено,0,РасценкаЗаСменуЦвета);      
	
	РасценкаЗаСменуПластиката = ФРМ.РасчетРасценокЗаТехнологическуюОперацию(РасценкаЗаСмену,ДопОперации[2][1]);
	РасценкаЗаСменуПластиката = ?(РасценкаЗаСменуПластиката=неопределено,0,РасценкаЗаСменуПластиката);      
	
	РасценкаЗаСменуИнструмента = ФРМ.РасчетРасценокЗаТехнологическуюОперацию(РасценкаЗаСмену,ДопОперации[3][1]);
	РасценкаЗаСменуИнструмента = ?(РасценкаЗаСменуИнструмента=неопределено,0,РасценкаЗаСменуИнструмента);      
	
	РасценкаЗаСменуКатушкиНаОтдатчике = ФРМ.РасчетРасценокЗаТехнологическуюОперацию(РасценкаЗаСмену,ДопОперации[4][1]);
	РасценкаЗаСменуКатушкиНаОтдатчике = ?(РасценкаЗаСменуКатушкиНаОтдатчике=неопределено,0,РасценкаЗаСменуКатушкиНаОтдатчике);      
	
	
	КолвоРазныхЦветов = ОпределитьКолвоРазныхЦветов(ТЗ);  
	КолвоРазныхЦветов = ?(Данные.ВидОперации = Перечисления.ВидОперации.Изоляция,КолвоРазныхЦветов,2);
	
	ДеньгаЗаОперации	= РасценкаЗаСменуЦвета+РасценкаЗаСменуИнструмента+РасценкаЗаСменуКатушкиНаОтдатчике+РасценкаЗаСменуКатушкиВПриемник*(КолвоРазныхЦветов-1);
	ОбщееВремяОпераций 	= ДопОперации[1][1]+ДопОперации[3][1]+ДопОперации[4][1]+ДопОперации[0][1]*(КолвоРазныхЦветов-1);
	//
	
	
	
</details>
	Расценки= Новый структура;
	Расценки.Вставить("РасценкаЗаСменуКатушкиВПриемник",РасценкаЗаСменуКатушкиВПриемник);
	Расценки.Вставить("РасценкаЗаСменуЦвета",РасценкаЗаСменуЦвета);
	Расценки.Вставить("РасценкаЗаСменуИнструмента",РасценкаЗаСменуИнструмента);
	Расценки.Вставить("РасценкаЗаСменуКатушкиНаОтдатчике",РасценкаЗаСменуКатушкиНаОтдатчике);     
	Расценки.Вставить("РасценкаЗаСменуПластиката",РасценкаЗаСменуПластиката);     
	Расценки.Вставить("ОбщееВремяОпераций",ОбщееВремяОпераций);   
	Расценки.Вставить("РасценкаЗаСмену",РасценкаЗаСмену);
	Возврат Расценки
	
	

</details>


 ## Функция ОпределитьКолВоРазныхЦветов(ТЗ)

 <details> 
   <summary> 
     Код  </summary>
	Цвета = ТЗ;
	НеповторяющиесяЦвета = новый массив();
	Для каждого Цвет из Цвета цикл
		Если НеповторяющиесяЦвета.Найти(Цвет.ЦветКуска)=неопределено или НеповторяющиесяЦвета.Количество()=0  тогда
			НеповторяющиесяЦвета.добавить(Цвет.ЦветКуска);	
		КонецЕсли;
	КонецЦикла;
	Возврат НеповторяющиесяЦвета.Количество()

</details>


</details>


</details>
